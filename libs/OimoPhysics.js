!function(t){"use strict";function $extend(t,i){function Inherit(){}Inherit.prototype=t;var a=new Inherit;for(var o in i)a[o]=i[o];return i.toString!==Object.prototype.toString&&(a.toString=i.toString),a}var i=function(t){this._type=t,this._numProxies=0,this._proxyList=null,this._proxyListLast=null,this._proxyPairList=null,this._incremental=!1,this._testCount=0,this._proxyPairPool=null,this._idCount=0,this._convexSweep=new n,this._aabb=new s,this.identity=new O,this.zero=new F,this.rayCastHit=new Y};i.prototype={createProxy:function(t,i){return null},destroyProxy:function(t){},moveProxy:function(t,i,a){},isOverlapping:function(t,i){return t._aabbMinX<i._aabbMaxX&&t._aabbMaxX>i._aabbMinX&&t._aabbMinY<i._aabbMaxY&&t._aabbMaxY>i._aabbMinY&&t._aabbMinZ<i._aabbMaxZ&&t._aabbMaxZ>i._aabbMinZ},collectPairs:function(){},getProxyPairList:function(){return this._proxyPairList},isIncremental:function(){return this._incremental},getTestCount:function(){return this._testCount},rayCast:function(t,i,a){},convexCast:function(t,i,a,o){},aabbTest:function(t,i){}};var a=function(t){this._type=t,this._volume=0};a.prototype={_updateMass:function(){},_computeAabb:function(t,i){},_rayCastLocal:function(t,i,a,o,n,s,r){return!1},getType:function(){return this._type},getVolume:function(){return this._volume},rayCast:function(t,i,a,o){var n,s,r,e,_,h,l=t;n=l.x,s=l.y,r=l.z;var c,p,v,m,b,f,x=i;if(e=x.x,_=x.y,h=x.z,n-=a._positionX,s-=a._positionY,r-=a._positionZ,e-=a._positionX,_-=a._positionY,h-=a._positionZ,c=a._rotation00*n+a._rotation10*s+a._rotation20*r,p=a._rotation01*n+a._rotation11*s+a._rotation21*r,v=a._rotation02*n+a._rotation12*s+a._rotation22*r,n=c,s=p,r=v,m=a._rotation00*e+a._rotation10*_+a._rotation20*h,b=a._rotation01*e+a._rotation11*_+a._rotation21*h,f=a._rotation02*e+a._rotation12*_+a._rotation22*h,e=m,_=b,h=f,this._rayCastLocal(n,s,r,e,_,h,o)){var u,y,g,X,z,M,Y=o.position;u=Y.x,y=Y.y,g=Y.z;var Z,d,I,V,L,w,A=o.normal;X=A.x,z=A.y,M=A.z,Z=a._rotation00*u+a._rotation01*y+a._rotation02*g,d=a._rotation10*u+a._rotation11*y+a._rotation12*g,I=a._rotation20*u+a._rotation21*y+a._rotation22*g,u=Z,y=d,g=I,V=a._rotation00*X+a._rotation01*z+a._rotation02*M,L=a._rotation10*X+a._rotation11*z+a._rotation12*M,w=a._rotation20*X+a._rotation21*z+a._rotation22*M,X=V,z=L,M=w,u+=a._positionX,y+=a._positionY,g+=a._positionZ;var k=o.position;k.x=u,k.y=y,k.z=g;var B=o.normal;return B.x=X,B.y=z,B.z=M,!0}return!1}};var o=function(t){a.call(this,t),this._gjkMargin=W.defaultGJKMargin,this._useGjkRayCast=!1};o.__super__=a,o.prototype=$extend(a.prototype,{getGjkMergin:function(){return this._gjkMargin},setGjkMergin:function(t){t<0&&(t=0),this._gjkMargin=t},computeLocalSupportingVertex:function(t,i){},rayCast:function(t,i,o,n){return this._useGjkRayCast?G.instance.rayCast(this,o,t,i,n):a.prototype.rayCast.call(this,t,i,o,n)}});var n=function(){o.call(this,-1)};n.__super__=o,n.prototype=$extend(o.prototype,{init:function(t,i,a){var o,n,s;this.c=t;var r,e,_,h=a;o=h.x,n=h.y,s=h.z,r=i._rotation00*o+i._rotation10*n+i._rotation20*s,e=i._rotation01*o+i._rotation11*n+i._rotation21*s,_=i._rotation02*o+i._rotation12*n+i._rotation22*s,this.localTranslation=new F;var l=this.localTranslation;l.x=r,l.y=e,l.z=_,this._gjkMargin=t._gjkMargin},computeLocalSupportingVertex:function(t,i){this.c.computeLocalSupportingVertex(t,i);var a=this.localTranslation;if(t.x*a.x+t.y*a.y+t.z*a.z>0){var o=this.localTranslation,n=i.x+o.x,s=i.y+o.y,r=i.z+o.z;i.x=n,i.y=s,i.z=r}}});var s=function(){o.call(this,-1),this.min=new F,this.max=new F};s.__super__=o,s.prototype=$extend(o.prototype,{computeLocalSupportingVertex:function(t,i){i.x=t.x>0?this.max.x:this.min.x,i.y=t.y>0?this.max.y:this.min.y,i.z=t.z>0?this.max.z:this.min.z}});var r=function(){};r.prototype={process:function(t){}};var e=function(){},_=function(t,i){this.userData=t,this._id=i,this._prev=null,this._next=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0};_.prototype={getId:function(){return this._id},getFatAabb:function(){var t=new x;return t._minX=this._aabbMinX,t._minY=this._aabbMinY,t._minZ=this._aabbMinZ,t._maxX=this._aabbMaxX,t._maxY=this._aabbMaxY,t._maxZ=this._aabbMaxZ,t},getFatAabbTo:function(t){t._minX=this._aabbMinX,t._minY=this._aabbMinY,t._minZ=this._aabbMinZ,t._maxX=this._aabbMaxX,t._maxY=this._aabbMaxY,t._maxZ=this._aabbMaxZ}};var h=function(){this._p1=null,this._p2=null};h.prototype={getProxy1:function(){return this._p1},getProxy2:function(){return this._p2},getNext:function(){return this._next}};var l=function(){i.call(this,1),this._incremental=!1};l.__super__=i,l.prototype=$extend(i.prototype,{createProxy:function(t,i){var a=new _(t,this._idCount++);return this._numProxies++,null==this._proxyList?(this._proxyList=a,this._proxyListLast=a):(this._proxyListLast._next=a,a._prev=this._proxyListLast,this._proxyListLast=a),a._aabbMinX=i._minX,a._aabbMinY=i._minY,a._aabbMinZ=i._minZ,a._aabbMaxX=i._maxX,a._aabbMaxY=i._maxY,a._aabbMaxZ=i._maxZ,a},destroyProxy:function(t){this._numProxies--;var i=t._prev,a=t._next;null!=i&&(i._next=a),null!=a&&(a._prev=i),t==this._proxyList&&(this._proxyList=this._proxyList._next),t==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),t._next=null,t._prev=null,t.userData=null},moveProxy:function(t,i,a){t._aabbMinX=i._minX,t._aabbMinY=i._minY,t._aabbMinZ=i._minZ,t._aabbMaxX=i._maxX,t._aabbMaxY=i._maxY,t._aabbMaxZ=i._maxZ},collectPairs:function(){var t=this._proxyPairList;if(null!=t){for(;t._p1=null,t._p2=null,null!=(t=t._next););this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}this._testCount=0;for(var i=this._proxyList;null!=i;){for(var a=i._next,o=i._next;null!=o;){var n=o._next;if(this._testCount++,i._aabbMinX<o._aabbMaxX&&i._aabbMaxX>o._aabbMinX&&i._aabbMinY<o._aabbMaxY&&i._aabbMaxY>o._aabbMinY&&i._aabbMinZ<o._aabbMaxZ&&i._aabbMaxZ>o._aabbMinZ){var s=this._proxyPairPool;null!=s?(this._proxyPairPool=s._next,s._next=null):s=new h;var r=s;null==this._proxyPairList?this._proxyPairList=r:(r._next=this._proxyPairList,this._proxyPairList=r),r._p1=i,r._p2=o}o=n}i=a}},rayCast:function(t,i,a){var o,n,s,r,e,_,h=t;o=h.x,n=h.y,s=h.z;var l=i;r=l.x,e=l.y,_=l.z;for(var c=this._proxyList;null!=c;){var p,v=c._next,m=o,b=n,f=s,x=r,u=e,y=_,g=m<x?m:x,X=b<u?b:u,z=f<y?f:y,M=m>x?m:x,Y=b>u?b:u,Z=f>y?f:y,d=c._aabbMinX,I=c._aabbMinY,V=c._aabbMinZ,L=c._aabbMaxX,w=c._aabbMaxY,A=c._aabbMaxZ;if(d>M||L<g||I>Y||w<X||V>Z||A<z)p=!1;else{var k,B,P=x-m,T=u-b,S=y-f,C=P<0?-P:P,q=T<0?-T:T,R=S<0?-S:S,E=.5*(L-d),j=.5*(w-I),N=.5*(A-V),D=m-.5*(L+d),F=b-.5*(w+I),O=f-.5*(A+V),W=F*S-O*T;if((W<0?-W:W)-(j*R+N*q)>0)B=!0;else{var G=O*P-D*S;B=(G<0?-G:G)-(N*C+E*R)>0}if(B)k=!0;else{var H=D*T-F*P;k=(H<0?-H:H)-(E*q+j*C)>0}p=!k}p&&a.process(c),c=v}},convexCast:function(t,i,a,o){for(var n=this._proxyList;null!=n;){var s=n._next,r=this._aabb.min;r.x=n._aabbMinX,r.y=n._aabbMinY,r.z=n._aabbMinZ;var e=this._aabb.max;e.x=n._aabbMaxX,e.y=n._aabbMaxY,e.z=n._aabbMaxZ,this._convexSweep.init(t,i,a);var _=G.instance;0==_.computeClosestPointsImpl(this._convexSweep,this._aabb,i,this.identity,null,!1)&&_.distance<=0&&o.process(n),n=s}},aabbTest:function(t,i){for(var a=this._proxyList;null!=a;){var o=a._next;t._minX<a._aabbMaxX&&t._maxX>a._aabbMinX&&t._minY<a._aabbMaxY&&t._maxY>a._aabbMinY&&t._minZ<a._aabbMaxZ&&t._maxZ>a._aabbMinZ&&i.process(a),a=o}}});var c=function(){i.call(this,2),this._incremental=!0,this._tree=new f;var t=new Array(1024);this.movedProxies=t,this.numMovedProxies=0};c.__super__=i,c.prototype=$extend(i.prototype,{collide:function(t,i){this._testCount++;var a=0==t._height,o=0==i._height;if(t==i){if(a)return;return this.collide(t._children[0],i),void this.collide(t._children[1],i)}if(t._aabbMinX<i._aabbMaxX&&t._aabbMaxX>i._aabbMinX&&t._aabbMinY<i._aabbMaxY&&t._aabbMaxY>i._aabbMinY&&t._aabbMinZ<i._aabbMaxZ&&t._aabbMaxZ>i._aabbMinZ){if(a&&o){var n=t._proxy,s=i._proxy,r=this._proxyPairPool;null!=r?(this._proxyPairPool=r._next,r._next=null):r=new h;var e=r;return null==this._proxyPairList?this._proxyPairList=e:(e._next=this._proxyPairList,this._proxyPairList=e),e._p1=n,void(e._p2=s)}o||t._height>i._height?(this.collide(t._children[0],i),this.collide(t._children[1],i)):(this.collide(i._children[0],t),this.collide(i._children[1],t))}},rayCastRecursive:function(t,i,a,o,n,s,r,e){var _,h,l,c,p,v,m,b=_=i,f=h=a,x=l=o,u=c=n,y=p=s,g=v=r,X=b<u?b:u,z=f<y?f:y,M=x<g?x:g,Y=b>u?b:u,Z=f>y?f:y,d=x>g?x:g,I=t._aabbMinX,V=t._aabbMinY,L=t._aabbMinZ,w=t._aabbMaxX,A=t._aabbMaxY,k=t._aabbMaxZ;if(I>Y||w<X||V>Z||A<z||L>d||k<M)m=!1;else{var B,P,T=u-b,S=y-f,C=g-x,q=T<0?-T:T,R=S<0?-S:S,E=C<0?-C:C,j=.5*(w-I),N=.5*(A-V),D=.5*(k-L),F=b-.5*(w+I),O=f-.5*(A+V),W=x-.5*(k+L),G=O*C-W*S;if((G<0?-G:G)-(N*E+D*R)>0)P=!0;else{var H=W*T-F*C;P=(H<0?-H:H)-(D*q+j*E)>0}if(P)B=!0;else{var U=F*S-O*T;B=(U<0?-U:U)-(j*R+N*q)>0}m=!B}m&&(0!=t._height?(this.rayCastRecursive(t._children[0],_,h,l,c,p,v,e),this.rayCastRecursive(t._children[1],_,h,l,c,p,v,e)):e.process(t._proxy))},convexCastRecursive:function(t,i,a,o,n){var s=this._aabb.min;s.x=t._aabbMinX,s.y=t._aabbMinY,s.z=t._aabbMinZ;var r=this._aabb.max;r.x=t._aabbMaxX,r.y=t._aabbMaxY,r.z=t._aabbMaxZ,this._convexSweep.init(i,a,o);var e=G.instance;0==e.computeClosestPointsImpl(this._convexSweep,this._aabb,a,this.identity,null,!1)&&e.distance<=0&&(0!=t._height?(this.convexCastRecursive(t._children[0],i,a,o,n),this.convexCastRecursive(t._children[1],i,a,o,n)):n.process(t._proxy))},aabbTestRecursive:function(t,i,a){t._aabbMinX<i._maxX&&t._aabbMaxX>i._minX&&t._aabbMinY<i._maxY&&t._aabbMaxY>i._minY&&t._aabbMinZ<i._maxZ&&t._aabbMaxZ>i._minZ&&(0!=t._height?(this.aabbTestRecursive(t._children[0],i,a),this.aabbTestRecursive(t._children[1],i,a)):a.process(t._proxy))},createProxy:function(t,i){var a=new m(t,this._idCount++);this._numProxies++,null==this._proxyList?(this._proxyList=a,this._proxyListLast=a):(this._proxyListLast._next=a,a._prev=this._proxyListLast,this._proxyListLast=a),a._aabbMinX=i._minX,a._aabbMinY=i._minY,a._aabbMinZ=i._minZ,a._aabbMaxX=i._maxX,a._aabbMaxY=i._maxY,a._aabbMaxZ=i._maxZ;var o,n,s,r=W.bvhProxyPadding;o=r,n=r,s=r,a._aabbMinX-=o,a._aabbMinY-=n,a._aabbMinZ-=s,a._aabbMaxX+=o,a._aabbMaxY+=n,a._aabbMaxZ+=s;var e=this._tree,_=e._nodePool;null!=_?(e._nodePool=_._next,_._next=null):_=new v;var h=_;if(h._proxy=a,a._leaf=h,h._aabbMinX=a._aabbMinX,h._aabbMinY=a._aabbMinY,h._aabbMinZ=a._aabbMinZ,h._aabbMaxX=a._aabbMaxX,h._aabbMaxY=a._aabbMaxY,h._aabbMaxZ=a._aabbMaxZ,e._numLeaves++,null==e.leafList?(e.leafList=h,e.leafListLast=h):(e.leafListLast._nextLeaf=h,h._prevLeaf=e.leafListLast,e.leafListLast=h),null==e._root)e._root=h;else{for(var l=e._root;l._height>0;){var c=e._strategy._decideInsertion(l,h);if(-1==c)break;l=l._children[c]}var p=l._parent,b=e._nodePool;null!=b?(e._nodePool=b._next,b._next=null):b=new v;var f=b;if(null==p)e._root=f;else{var x=l._childIndex;p._children[x]=f,f._parent=p,f._childIndex=x}var u=l._childIndex;f._children[u]=l,l._parent=f,l._childIndex=u;var y=1^l._childIndex;for(f._children[y]=h,h._parent=f,h._childIndex=y;null!=f;){if(e._strategy._balancingEnabled)if(f._height<2)f=f;else{var g=f._parent,X=f._children[0],z=f._children[1],M=X._height-z._height,Y=f._childIndex;if(M>1){var Z=X._children[0],d=X._children[1];if(Z._height>d._height){X._children[1]=f,f._parent=X,f._childIndex=1,f._children[0]=d,d._parent=f,d._childIndex=0;var I=X._children[0],V=X._children[1];X._aabbMinX=I._aabbMinX<V._aabbMinX?I._aabbMinX:V._aabbMinX,X._aabbMinY=I._aabbMinY<V._aabbMinY?I._aabbMinY:V._aabbMinY,X._aabbMinZ=I._aabbMinZ<V._aabbMinZ?I._aabbMinZ:V._aabbMinZ,X._aabbMaxX=I._aabbMaxX>V._aabbMaxX?I._aabbMaxX:V._aabbMaxX,X._aabbMaxY=I._aabbMaxY>V._aabbMaxY?I._aabbMaxY:V._aabbMaxY,X._aabbMaxZ=I._aabbMaxZ>V._aabbMaxZ?I._aabbMaxZ:V._aabbMaxZ;var L=X._children[0]._height,w=X._children[1]._height;X._height=(L>w?L:w)+1;var A=f._children[0],k=f._children[1];f._aabbMinX=A._aabbMinX<k._aabbMinX?A._aabbMinX:k._aabbMinX,f._aabbMinY=A._aabbMinY<k._aabbMinY?A._aabbMinY:k._aabbMinY,f._aabbMinZ=A._aabbMinZ<k._aabbMinZ?A._aabbMinZ:k._aabbMinZ,f._aabbMaxX=A._aabbMaxX>k._aabbMaxX?A._aabbMaxX:k._aabbMaxX,f._aabbMaxY=A._aabbMaxY>k._aabbMaxY?A._aabbMaxY:k._aabbMaxY,f._aabbMaxZ=A._aabbMaxZ>k._aabbMaxZ?A._aabbMaxZ:k._aabbMaxZ;var B=f._children[0]._height,P=f._children[1]._height;f._height=(B>P?B:P)+1}else{X._children[0]=f,f._parent=X,f._childIndex=0,f._children[0]=Z,Z._parent=f,Z._childIndex=0;var T=X._children[0],S=X._children[1];X._aabbMinX=T._aabbMinX<S._aabbMinX?T._aabbMinX:S._aabbMinX,X._aabbMinY=T._aabbMinY<S._aabbMinY?T._aabbMinY:S._aabbMinY,X._aabbMinZ=T._aabbMinZ<S._aabbMinZ?T._aabbMinZ:S._aabbMinZ,X._aabbMaxX=T._aabbMaxX>S._aabbMaxX?T._aabbMaxX:S._aabbMaxX,X._aabbMaxY=T._aabbMaxY>S._aabbMaxY?T._aabbMaxY:S._aabbMaxY,X._aabbMaxZ=T._aabbMaxZ>S._aabbMaxZ?T._aabbMaxZ:S._aabbMaxZ;var C=X._children[0]._height,q=X._children[1]._height;X._height=(C>q?C:q)+1;var R=f._children[0],E=f._children[1];f._aabbMinX=R._aabbMinX<E._aabbMinX?R._aabbMinX:E._aabbMinX,f._aabbMinY=R._aabbMinY<E._aabbMinY?R._aabbMinY:E._aabbMinY,f._aabbMinZ=R._aabbMinZ<E._aabbMinZ?R._aabbMinZ:E._aabbMinZ,f._aabbMaxX=R._aabbMaxX>E._aabbMaxX?R._aabbMaxX:E._aabbMaxX,f._aabbMaxY=R._aabbMaxY>E._aabbMaxY?R._aabbMaxY:E._aabbMaxY,f._aabbMaxZ=R._aabbMaxZ>E._aabbMaxZ?R._aabbMaxZ:E._aabbMaxZ;var j=f._children[0]._height,N=f._children[1]._height;f._height=(j>N?j:N)+1}null!=g?(g._children[Y]=X,X._parent=g,X._childIndex=Y):(e._root=X,X._parent=null),f=X}else if(M<-1){var D=z._children[0],F=z._children[1];if(D._height>F._height){z._children[1]=f,f._parent=z,f._childIndex=1,f._children[1]=F,F._parent=f,F._childIndex=1;var O=z._children[0],G=z._children[1];z._aabbMinX=O._aabbMinX<G._aabbMinX?O._aabbMinX:G._aabbMinX,z._aabbMinY=O._aabbMinY<G._aabbMinY?O._aabbMinY:G._aabbMinY,z._aabbMinZ=O._aabbMinZ<G._aabbMinZ?O._aabbMinZ:G._aabbMinZ,z._aabbMaxX=O._aabbMaxX>G._aabbMaxX?O._aabbMaxX:G._aabbMaxX,z._aabbMaxY=O._aabbMaxY>G._aabbMaxY?O._aabbMaxY:G._aabbMaxY,z._aabbMaxZ=O._aabbMaxZ>G._aabbMaxZ?O._aabbMaxZ:G._aabbMaxZ;var H=z._children[0]._height,U=z._children[1]._height;z._height=(H>U?H:U)+1;var J=f._children[0],Q=f._children[1];f._aabbMinX=J._aabbMinX<Q._aabbMinX?J._aabbMinX:Q._aabbMinX,f._aabbMinY=J._aabbMinY<Q._aabbMinY?J._aabbMinY:Q._aabbMinY,f._aabbMinZ=J._aabbMinZ<Q._aabbMinZ?J._aabbMinZ:Q._aabbMinZ,f._aabbMaxX=J._aabbMaxX>Q._aabbMaxX?J._aabbMaxX:Q._aabbMaxX,f._aabbMaxY=J._aabbMaxY>Q._aabbMaxY?J._aabbMaxY:Q._aabbMaxY,f._aabbMaxZ=J._aabbMaxZ>Q._aabbMaxZ?J._aabbMaxZ:Q._aabbMaxZ;var $=f._children[0]._height,K=f._children[1]._height;f._height=($>K?$:K)+1}else{z._children[0]=f,f._parent=z,f._childIndex=0,f._children[1]=D,D._parent=f,D._childIndex=1;var tt=z._children[0],it=z._children[1];z._aabbMinX=tt._aabbMinX<it._aabbMinX?tt._aabbMinX:it._aabbMinX,z._aabbMinY=tt._aabbMinY<it._aabbMinY?tt._aabbMinY:it._aabbMinY,z._aabbMinZ=tt._aabbMinZ<it._aabbMinZ?tt._aabbMinZ:it._aabbMinZ,z._aabbMaxX=tt._aabbMaxX>it._aabbMaxX?tt._aabbMaxX:it._aabbMaxX,z._aabbMaxY=tt._aabbMaxY>it._aabbMaxY?tt._aabbMaxY:it._aabbMaxY,z._aabbMaxZ=tt._aabbMaxZ>it._aabbMaxZ?tt._aabbMaxZ:it._aabbMaxZ;var at=z._children[0]._height,ot=z._children[1]._height;z._height=(at>ot?at:ot)+1;var nt=f._children[0],st=f._children[1];f._aabbMinX=nt._aabbMinX<st._aabbMinX?nt._aabbMinX:st._aabbMinX,f._aabbMinY=nt._aabbMinY<st._aabbMinY?nt._aabbMinY:st._aabbMinY,f._aabbMinZ=nt._aabbMinZ<st._aabbMinZ?nt._aabbMinZ:st._aabbMinZ,f._aabbMaxX=nt._aabbMaxX>st._aabbMaxX?nt._aabbMaxX:st._aabbMaxX,f._aabbMaxY=nt._aabbMaxY>st._aabbMaxY?nt._aabbMaxY:st._aabbMaxY,f._aabbMaxZ=nt._aabbMaxZ>st._aabbMaxZ?nt._aabbMaxZ:st._aabbMaxZ;var rt=f._children[0]._height,et=f._children[1]._height;f._height=(rt>et?rt:et)+1}null!=g?(g._children[Y]=z,z._parent=g,z._childIndex=Y):(e._root=z,z._parent=null),f=z}else f=f}var _t=f._children[0]._height,ht=f._children[1]._height;f._height=(_t>ht?_t:ht)+1;var lt=f._children[0],ct=f._children[1];f._aabbMinX=lt._aabbMinX<ct._aabbMinX?lt._aabbMinX:ct._aabbMinX,f._aabbMinY=lt._aabbMinY<ct._aabbMinY?lt._aabbMinY:ct._aabbMinY,f._aabbMinZ=lt._aabbMinZ<ct._aabbMinZ?lt._aabbMinZ:ct._aabbMinZ,f._aabbMaxX=lt._aabbMaxX>ct._aabbMaxX?lt._aabbMaxX:ct._aabbMaxX,f._aabbMaxY=lt._aabbMaxY>ct._aabbMaxY?lt._aabbMaxY:ct._aabbMaxY,f._aabbMaxZ=lt._aabbMaxZ>ct._aabbMaxZ?lt._aabbMaxZ:ct._aabbMaxZ,f=f._parent}}if(!a._moved){if(a._moved=!0,this.movedProxies.length==this.numMovedProxies){for(var pt=this.numMovedProxies<<1,vt=new Array(pt),mt=0,bt=this.numMovedProxies;mt<bt;){var ft=mt++;vt[ft]=this.movedProxies[ft],this.movedProxies[ft]=null}this.movedProxies=vt}this.movedProxies[this.numMovedProxies++]=a}return a},destroyProxy:function(t){this._numProxies--;var i=t._prev,a=t._next;null!=i&&(i._next=a),null!=a&&(a._prev=i),t==this._proxyList&&(this._proxyList=this._proxyList._next),t==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),t._next=null,t._prev=null;var o=t,n=this._tree,s=o._leaf;n._numLeaves--;var r=s._prevLeaf,e=s._nextLeaf;if(null!=r&&(r._nextLeaf=e),null!=e&&(e._prevLeaf=r),s==n.leafList&&(n.leafList=n.leafList._nextLeaf),s==n.leafListLast&&(n.leafListLast=n.leafListLast._prevLeaf),s._nextLeaf=null,s._prevLeaf=null,n._root==s)n._root=null;else{var _=s._parent,h=_._children[1^s._childIndex],l=_._parent;if(null==l)h._parent=null,h._childIndex=0,n._root=h,_._next=null,_._childIndex=0,_._children[0]=null,_._children[1]=null,_._childIndex=0,_._parent=null,_._height=0,_._proxy=null,_._next=n._nodePool,n._nodePool=_;else{h._parent=l;var c=_._childIndex;l._children[c]=h,h._parent=l,h._childIndex=c,_._next=null,_._childIndex=0,_._children[0]=null,_._children[1]=null,_._childIndex=0,_._parent=null,_._height=0,_._proxy=null,_._next=n._nodePool,n._nodePool=_;for(var p=l;null!=p;){if(n._strategy._balancingEnabled)if(p._height<2)p=p;else{var v=p._parent,m=p._children[0],b=p._children[1],f=m._height-b._height,x=p._childIndex;if(f>1){var u=m._children[0],y=m._children[1];if(u._height>y._height){m._children[1]=p,p._parent=m,p._childIndex=1,p._children[0]=y,y._parent=p,y._childIndex=0;var g=m._children[0],X=m._children[1];m._aabbMinX=g._aabbMinX<X._aabbMinX?g._aabbMinX:X._aabbMinX,m._aabbMinY=g._aabbMinY<X._aabbMinY?g._aabbMinY:X._aabbMinY,m._aabbMinZ=g._aabbMinZ<X._aabbMinZ?g._aabbMinZ:X._aabbMinZ,m._aabbMaxX=g._aabbMaxX>X._aabbMaxX?g._aabbMaxX:X._aabbMaxX,m._aabbMaxY=g._aabbMaxY>X._aabbMaxY?g._aabbMaxY:X._aabbMaxY,m._aabbMaxZ=g._aabbMaxZ>X._aabbMaxZ?g._aabbMaxZ:X._aabbMaxZ;var z=m._children[0]._height,M=m._children[1]._height;m._height=(z>M?z:M)+1;var Y=p._children[0],Z=p._children[1];p._aabbMinX=Y._aabbMinX<Z._aabbMinX?Y._aabbMinX:Z._aabbMinX,p._aabbMinY=Y._aabbMinY<Z._aabbMinY?Y._aabbMinY:Z._aabbMinY,p._aabbMinZ=Y._aabbMinZ<Z._aabbMinZ?Y._aabbMinZ:Z._aabbMinZ,p._aabbMaxX=Y._aabbMaxX>Z._aabbMaxX?Y._aabbMaxX:Z._aabbMaxX,p._aabbMaxY=Y._aabbMaxY>Z._aabbMaxY?Y._aabbMaxY:Z._aabbMaxY,p._aabbMaxZ=Y._aabbMaxZ>Z._aabbMaxZ?Y._aabbMaxZ:Z._aabbMaxZ;var d=p._children[0]._height,I=p._children[1]._height;p._height=(d>I?d:I)+1}else{m._children[0]=p,p._parent=m,p._childIndex=0,p._children[0]=u,u._parent=p,u._childIndex=0;var V=m._children[0],L=m._children[1];m._aabbMinX=V._aabbMinX<L._aabbMinX?V._aabbMinX:L._aabbMinX,m._aabbMinY=V._aabbMinY<L._aabbMinY?V._aabbMinY:L._aabbMinY,m._aabbMinZ=V._aabbMinZ<L._aabbMinZ?V._aabbMinZ:L._aabbMinZ,m._aabbMaxX=V._aabbMaxX>L._aabbMaxX?V._aabbMaxX:L._aabbMaxX,m._aabbMaxY=V._aabbMaxY>L._aabbMaxY?V._aabbMaxY:L._aabbMaxY,m._aabbMaxZ=V._aabbMaxZ>L._aabbMaxZ?V._aabbMaxZ:L._aabbMaxZ;var w=m._children[0]._height,A=m._children[1]._height;m._height=(w>A?w:A)+1;var k=p._children[0],B=p._children[1];p._aabbMinX=k._aabbMinX<B._aabbMinX?k._aabbMinX:B._aabbMinX,p._aabbMinY=k._aabbMinY<B._aabbMinY?k._aabbMinY:B._aabbMinY,p._aabbMinZ=k._aabbMinZ<B._aabbMinZ?k._aabbMinZ:B._aabbMinZ,p._aabbMaxX=k._aabbMaxX>B._aabbMaxX?k._aabbMaxX:B._aabbMaxX,p._aabbMaxY=k._aabbMaxY>B._aabbMaxY?k._aabbMaxY:B._aabbMaxY,p._aabbMaxZ=k._aabbMaxZ>B._aabbMaxZ?k._aabbMaxZ:B._aabbMaxZ;var P=p._children[0]._height,T=p._children[1]._height;p._height=(P>T?P:T)+1}null!=v?(v._children[x]=m,m._parent=v,m._childIndex=x):(n._root=m,m._parent=null),p=m}else if(f<-1){var S=b._children[0],C=b._children[1];if(S._height>C._height){b._children[1]=p,p._parent=b,p._childIndex=1,p._children[1]=C,C._parent=p,C._childIndex=1;var q=b._children[0],R=b._children[1];b._aabbMinX=q._aabbMinX<R._aabbMinX?q._aabbMinX:R._aabbMinX,b._aabbMinY=q._aabbMinY<R._aabbMinY?q._aabbMinY:R._aabbMinY,b._aabbMinZ=q._aabbMinZ<R._aabbMinZ?q._aabbMinZ:R._aabbMinZ,b._aabbMaxX=q._aabbMaxX>R._aabbMaxX?q._aabbMaxX:R._aabbMaxX,b._aabbMaxY=q._aabbMaxY>R._aabbMaxY?q._aabbMaxY:R._aabbMaxY,b._aabbMaxZ=q._aabbMaxZ>R._aabbMaxZ?q._aabbMaxZ:R._aabbMaxZ;var E=b._children[0]._height,j=b._children[1]._height;b._height=(E>j?E:j)+1;var N=p._children[0],D=p._children[1];p._aabbMinX=N._aabbMinX<D._aabbMinX?N._aabbMinX:D._aabbMinX,p._aabbMinY=N._aabbMinY<D._aabbMinY?N._aabbMinY:D._aabbMinY,p._aabbMinZ=N._aabbMinZ<D._aabbMinZ?N._aabbMinZ:D._aabbMinZ,p._aabbMaxX=N._aabbMaxX>D._aabbMaxX?N._aabbMaxX:D._aabbMaxX,p._aabbMaxY=N._aabbMaxY>D._aabbMaxY?N._aabbMaxY:D._aabbMaxY,p._aabbMaxZ=N._aabbMaxZ>D._aabbMaxZ?N._aabbMaxZ:D._aabbMaxZ;var F=p._children[0]._height,O=p._children[1]._height;p._height=(F>O?F:O)+1}else{b._children[0]=p,p._parent=b,p._childIndex=0,p._children[1]=S,S._parent=p,S._childIndex=1;var W=b._children[0],G=b._children[1];b._aabbMinX=W._aabbMinX<G._aabbMinX?W._aabbMinX:G._aabbMinX,b._aabbMinY=W._aabbMinY<G._aabbMinY?W._aabbMinY:G._aabbMinY,b._aabbMinZ=W._aabbMinZ<G._aabbMinZ?W._aabbMinZ:G._aabbMinZ,b._aabbMaxX=W._aabbMaxX>G._aabbMaxX?W._aabbMaxX:G._aabbMaxX,b._aabbMaxY=W._aabbMaxY>G._aabbMaxY?W._aabbMaxY:G._aabbMaxY,b._aabbMaxZ=W._aabbMaxZ>G._aabbMaxZ?W._aabbMaxZ:G._aabbMaxZ;var H=b._children[0]._height,U=b._children[1]._height;b._height=(H>U?H:U)+1;var J=p._children[0],Q=p._children[1];p._aabbMinX=J._aabbMinX<Q._aabbMinX?J._aabbMinX:Q._aabbMinX,p._aabbMinY=J._aabbMinY<Q._aabbMinY?J._aabbMinY:Q._aabbMinY,p._aabbMinZ=J._aabbMinZ<Q._aabbMinZ?J._aabbMinZ:Q._aabbMinZ,p._aabbMaxX=J._aabbMaxX>Q._aabbMaxX?J._aabbMaxX:Q._aabbMaxX,p._aabbMaxY=J._aabbMaxY>Q._aabbMaxY?J._aabbMaxY:Q._aabbMaxY,p._aabbMaxZ=J._aabbMaxZ>Q._aabbMaxZ?J._aabbMaxZ:Q._aabbMaxZ;var $=p._children[0]._height,K=p._children[1]._height;p._height=($>K?$:K)+1}null!=v?(v._children[x]=b,b._parent=v,b._childIndex=x):(n._root=b,b._parent=null),p=b}else p=p}var tt=p._children[0]._height,it=p._children[1]._height;p._height=(tt>it?tt:it)+1;var at=p._children[0],ot=p._children[1];p._aabbMinX=at._aabbMinX<ot._aabbMinX?at._aabbMinX:ot._aabbMinX,p._aabbMinY=at._aabbMinY<ot._aabbMinY?at._aabbMinY:ot._aabbMinY,p._aabbMinZ=at._aabbMinZ<ot._aabbMinZ?at._aabbMinZ:ot._aabbMinZ,p._aabbMaxX=at._aabbMaxX>ot._aabbMaxX?at._aabbMaxX:ot._aabbMaxX,p._aabbMaxY=at._aabbMaxY>ot._aabbMaxY?at._aabbMaxY:ot._aabbMaxY,p._aabbMaxZ=at._aabbMaxZ>ot._aabbMaxZ?at._aabbMaxZ:ot._aabbMaxZ,p=p._parent}}}o._leaf=null,s._next=null,s._childIndex=0,s._children[0]=null,s._children[1]=null,s._childIndex=0,s._parent=null,s._height=0,s._proxy=null,s._next=n._nodePool,n._nodePool=s,o.userData=null,o._next=null,o._prev=null,o._moved&&(o._moved=!1)},moveProxy:function(t,i,a){var o=t;if(!(o._aabbMinX<=i._minX&&o._aabbMaxX>=i._maxX&&o._aabbMinY<=i._minY&&o._aabbMaxY>=i._maxY&&o._aabbMinZ<=i._minZ&&o._aabbMaxZ>=i._maxZ)){o._aabbMinX=i._minX,o._aabbMinY=i._minY,o._aabbMinZ=i._minZ,o._aabbMaxX=i._maxX,o._aabbMaxY=i._maxY,o._aabbMaxZ=i._maxZ;var n,s,r,e=W.bvhProxyPadding;if(n=e,s=e,r=e,o._aabbMinX-=n,o._aabbMinY-=s,o._aabbMinZ-=r,o._aabbMaxX+=n,o._aabbMaxY+=s,o._aabbMaxZ+=r,null!=a){var _,h,l,c,p,v,m,b,f;0,0,0;var x=a;c=0<(_=x.x)?0:_,p=0<(h=x.y)?0:h,v=0<(l=x.z)?0:l,m=0>_?0:_,b=0>h?0:h,f=0>l?0:l,o._aabbMinX+=c,o._aabbMinY+=p,o._aabbMinZ+=v,o._aabbMaxX+=m,o._aabbMaxY+=b,o._aabbMaxZ+=f}if(!o._moved){if(o._moved=!0,this.movedProxies.length==this.numMovedProxies){for(var u=this.numMovedProxies<<1,y=new Array(u),g=0,X=this.numMovedProxies;g<X;){var z=g++;y[z]=this.movedProxies[z],this.movedProxies[z]=null}this.movedProxies=y}this.movedProxies[this.numMovedProxies++]=o}}},collectPairs:function(){var t=this._proxyPairList;if(null!=t){for(;t._p1=null,t._p2=null,null!=(t=t._next););this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}if(this._testCount=0,!(this._numProxies<2)){for(var i=this.numMovedProxies/this._numProxies<W.bvhIncrementalCollisionThreshold,a=0,o=this.numMovedProxies;a<o;){var n=a++,s=this.movedProxies[n];if(s._moved){var r=this._tree,e=s._leaf;r._numLeaves--;var _=e._prevLeaf,h=e._nextLeaf;if(null!=_&&(_._nextLeaf=h),null!=h&&(h._prevLeaf=_),e==r.leafList&&(r.leafList=r.leafList._nextLeaf),e==r.leafListLast&&(r.leafListLast=r.leafListLast._prevLeaf),e._nextLeaf=null,e._prevLeaf=null,r._root==e)r._root=null;else{var l=e._parent,c=l._children[1^e._childIndex],p=l._parent;if(null==p)c._parent=null,c._childIndex=0,r._root=c,l._next=null,l._childIndex=0,l._children[0]=null,l._children[1]=null,l._childIndex=0,l._parent=null,l._height=0,l._proxy=null,l._next=r._nodePool,r._nodePool=l;else{c._parent=p;var m=l._childIndex;p._children[m]=c,c._parent=p,c._childIndex=m,l._next=null,l._childIndex=0,l._children[0]=null,l._children[1]=null,l._childIndex=0,l._parent=null,l._height=0,l._proxy=null,l._next=r._nodePool,r._nodePool=l;for(var b=p;null!=b;){if(r._strategy._balancingEnabled)if(b._height<2)b=b;else{var f=b._parent,x=b._children[0],u=b._children[1],y=x._height-u._height,g=b._childIndex;if(y>1){var X=x._children[0],z=x._children[1];if(X._height>z._height){x._children[1]=b,b._parent=x,b._childIndex=1,b._children[0]=z,z._parent=b,z._childIndex=0;var M=x._children[0],Y=x._children[1];x._aabbMinX=M._aabbMinX<Y._aabbMinX?M._aabbMinX:Y._aabbMinX,x._aabbMinY=M._aabbMinY<Y._aabbMinY?M._aabbMinY:Y._aabbMinY,x._aabbMinZ=M._aabbMinZ<Y._aabbMinZ?M._aabbMinZ:Y._aabbMinZ,x._aabbMaxX=M._aabbMaxX>Y._aabbMaxX?M._aabbMaxX:Y._aabbMaxX,x._aabbMaxY=M._aabbMaxY>Y._aabbMaxY?M._aabbMaxY:Y._aabbMaxY,x._aabbMaxZ=M._aabbMaxZ>Y._aabbMaxZ?M._aabbMaxZ:Y._aabbMaxZ;var Z=x._children[0]._height,d=x._children[1]._height;x._height=(Z>d?Z:d)+1;var I=b._children[0],V=b._children[1];b._aabbMinX=I._aabbMinX<V._aabbMinX?I._aabbMinX:V._aabbMinX,b._aabbMinY=I._aabbMinY<V._aabbMinY?I._aabbMinY:V._aabbMinY,b._aabbMinZ=I._aabbMinZ<V._aabbMinZ?I._aabbMinZ:V._aabbMinZ,b._aabbMaxX=I._aabbMaxX>V._aabbMaxX?I._aabbMaxX:V._aabbMaxX,b._aabbMaxY=I._aabbMaxY>V._aabbMaxY?I._aabbMaxY:V._aabbMaxY,b._aabbMaxZ=I._aabbMaxZ>V._aabbMaxZ?I._aabbMaxZ:V._aabbMaxZ;var L=b._children[0]._height,w=b._children[1]._height;b._height=(L>w?L:w)+1}else{x._children[0]=b,b._parent=x,b._childIndex=0,b._children[0]=X,X._parent=b,X._childIndex=0;var A=x._children[0],k=x._children[1];x._aabbMinX=A._aabbMinX<k._aabbMinX?A._aabbMinX:k._aabbMinX,x._aabbMinY=A._aabbMinY<k._aabbMinY?A._aabbMinY:k._aabbMinY,x._aabbMinZ=A._aabbMinZ<k._aabbMinZ?A._aabbMinZ:k._aabbMinZ,x._aabbMaxX=A._aabbMaxX>k._aabbMaxX?A._aabbMaxX:k._aabbMaxX,x._aabbMaxY=A._aabbMaxY>k._aabbMaxY?A._aabbMaxY:k._aabbMaxY,x._aabbMaxZ=A._aabbMaxZ>k._aabbMaxZ?A._aabbMaxZ:k._aabbMaxZ;var B=x._children[0]._height,P=x._children[1]._height;x._height=(B>P?B:P)+1;var T=b._children[0],S=b._children[1];b._aabbMinX=T._aabbMinX<S._aabbMinX?T._aabbMinX:S._aabbMinX,b._aabbMinY=T._aabbMinY<S._aabbMinY?T._aabbMinY:S._aabbMinY,b._aabbMinZ=T._aabbMinZ<S._aabbMinZ?T._aabbMinZ:S._aabbMinZ,b._aabbMaxX=T._aabbMaxX>S._aabbMaxX?T._aabbMaxX:S._aabbMaxX,b._aabbMaxY=T._aabbMaxY>S._aabbMaxY?T._aabbMaxY:S._aabbMaxY,b._aabbMaxZ=T._aabbMaxZ>S._aabbMaxZ?T._aabbMaxZ:S._aabbMaxZ;var C=b._children[0]._height,q=b._children[1]._height;b._height=(C>q?C:q)+1}null!=f?(f._children[g]=x,x._parent=f,x._childIndex=g):(r._root=x,x._parent=null),b=x}else if(y<-1){var R=u._children[0],E=u._children[1];if(R._height>E._height){u._children[1]=b,b._parent=u,b._childIndex=1,b._children[1]=E,E._parent=b,E._childIndex=1;var j=u._children[0],N=u._children[1];u._aabbMinX=j._aabbMinX<N._aabbMinX?j._aabbMinX:N._aabbMinX,u._aabbMinY=j._aabbMinY<N._aabbMinY?j._aabbMinY:N._aabbMinY,u._aabbMinZ=j._aabbMinZ<N._aabbMinZ?j._aabbMinZ:N._aabbMinZ,u._aabbMaxX=j._aabbMaxX>N._aabbMaxX?j._aabbMaxX:N._aabbMaxX,u._aabbMaxY=j._aabbMaxY>N._aabbMaxY?j._aabbMaxY:N._aabbMaxY,u._aabbMaxZ=j._aabbMaxZ>N._aabbMaxZ?j._aabbMaxZ:N._aabbMaxZ;var D=u._children[0]._height,F=u._children[1]._height;u._height=(D>F?D:F)+1;var O=b._children[0],G=b._children[1];b._aabbMinX=O._aabbMinX<G._aabbMinX?O._aabbMinX:G._aabbMinX,b._aabbMinY=O._aabbMinY<G._aabbMinY?O._aabbMinY:G._aabbMinY,b._aabbMinZ=O._aabbMinZ<G._aabbMinZ?O._aabbMinZ:G._aabbMinZ,b._aabbMaxX=O._aabbMaxX>G._aabbMaxX?O._aabbMaxX:G._aabbMaxX,b._aabbMaxY=O._aabbMaxY>G._aabbMaxY?O._aabbMaxY:G._aabbMaxY,b._aabbMaxZ=O._aabbMaxZ>G._aabbMaxZ?O._aabbMaxZ:G._aabbMaxZ;var H=b._children[0]._height,U=b._children[1]._height;b._height=(H>U?H:U)+1}else{u._children[0]=b,b._parent=u,b._childIndex=0,b._children[1]=R,R._parent=b,R._childIndex=1;var J=u._children[0],Q=u._children[1];u._aabbMinX=J._aabbMinX<Q._aabbMinX?J._aabbMinX:Q._aabbMinX,u._aabbMinY=J._aabbMinY<Q._aabbMinY?J._aabbMinY:Q._aabbMinY,u._aabbMinZ=J._aabbMinZ<Q._aabbMinZ?J._aabbMinZ:Q._aabbMinZ,u._aabbMaxX=J._aabbMaxX>Q._aabbMaxX?J._aabbMaxX:Q._aabbMaxX,u._aabbMaxY=J._aabbMaxY>Q._aabbMaxY?J._aabbMaxY:Q._aabbMaxY,u._aabbMaxZ=J._aabbMaxZ>Q._aabbMaxZ?J._aabbMaxZ:Q._aabbMaxZ;var $=u._children[0]._height,K=u._children[1]._height;u._height=($>K?$:K)+1;var tt=b._children[0],it=b._children[1];b._aabbMinX=tt._aabbMinX<it._aabbMinX?tt._aabbMinX:it._aabbMinX,b._aabbMinY=tt._aabbMinY<it._aabbMinY?tt._aabbMinY:it._aabbMinY,b._aabbMinZ=tt._aabbMinZ<it._aabbMinZ?tt._aabbMinZ:it._aabbMinZ,b._aabbMaxX=tt._aabbMaxX>it._aabbMaxX?tt._aabbMaxX:it._aabbMaxX,b._aabbMaxY=tt._aabbMaxY>it._aabbMaxY?tt._aabbMaxY:it._aabbMaxY,b._aabbMaxZ=tt._aabbMaxZ>it._aabbMaxZ?tt._aabbMaxZ:it._aabbMaxZ;var at=b._children[0]._height,ot=b._children[1]._height;b._height=(at>ot?at:ot)+1}null!=f?(f._children[g]=u,u._parent=f,u._childIndex=g):(r._root=u,u._parent=null),b=u}else b=b}var nt=b._children[0]._height,st=b._children[1]._height;b._height=(nt>st?nt:st)+1;var rt=b._children[0],et=b._children[1];b._aabbMinX=rt._aabbMinX<et._aabbMinX?rt._aabbMinX:et._aabbMinX,b._aabbMinY=rt._aabbMinY<et._aabbMinY?rt._aabbMinY:et._aabbMinY,b._aabbMinZ=rt._aabbMinZ<et._aabbMinZ?rt._aabbMinZ:et._aabbMinZ,b._aabbMaxX=rt._aabbMaxX>et._aabbMaxX?rt._aabbMaxX:et._aabbMaxX,b._aabbMaxY=rt._aabbMaxY>et._aabbMaxY?rt._aabbMaxY:et._aabbMaxY,b._aabbMaxZ=rt._aabbMaxZ>et._aabbMaxZ?rt._aabbMaxZ:et._aabbMaxZ,b=b._parent}}}s._leaf=null,e._next=null,e._childIndex=0,e._children[0]=null,e._children[1]=null,e._childIndex=0,e._parent=null,e._height=0,e._proxy=null,e._next=r._nodePool,r._nodePool=e;var _t=this._tree,ht=_t._nodePool;null!=ht?(_t._nodePool=ht._next,ht._next=null):ht=new v;var lt=ht;if(lt._proxy=s,s._leaf=lt,lt._aabbMinX=s._aabbMinX,lt._aabbMinY=s._aabbMinY,lt._aabbMinZ=s._aabbMinZ,lt._aabbMaxX=s._aabbMaxX,lt._aabbMaxY=s._aabbMaxY,lt._aabbMaxZ=s._aabbMaxZ,_t._numLeaves++,null==_t.leafList?(_t.leafList=lt,_t.leafListLast=lt):(_t.leafListLast._nextLeaf=lt,lt._prevLeaf=_t.leafListLast,_t.leafListLast=lt),null==_t._root)_t._root=lt;else{for(var ct=_t._root;ct._height>0;){var pt=_t._strategy._decideInsertion(ct,lt);if(-1==pt)break;ct=ct._children[pt]}var vt=ct._parent,mt=_t._nodePool;null!=mt?(_t._nodePool=mt._next,mt._next=null):mt=new v;var bt=mt;if(null==vt)_t._root=bt;else{var ft=ct._childIndex;vt._children[ft]=bt,bt._parent=vt,bt._childIndex=ft}var xt=ct._childIndex;bt._children[xt]=ct,ct._parent=bt,ct._childIndex=xt;var ut=1^ct._childIndex;for(bt._children[ut]=lt,lt._parent=bt,lt._childIndex=ut;null!=bt;){if(_t._strategy._balancingEnabled)if(bt._height<2)bt=bt;else{var yt=bt._parent,gt=bt._children[0],Xt=bt._children[1],zt=gt._height-Xt._height,Mt=bt._childIndex;if(zt>1){var Yt=gt._children[0],Zt=gt._children[1];if(Yt._height>Zt._height){gt._children[1]=bt,bt._parent=gt,bt._childIndex=1,bt._children[0]=Zt,Zt._parent=bt,Zt._childIndex=0;var dt=gt._children[0],It=gt._children[1];gt._aabbMinX=dt._aabbMinX<It._aabbMinX?dt._aabbMinX:It._aabbMinX,gt._aabbMinY=dt._aabbMinY<It._aabbMinY?dt._aabbMinY:It._aabbMinY,gt._aabbMinZ=dt._aabbMinZ<It._aabbMinZ?dt._aabbMinZ:It._aabbMinZ,gt._aabbMaxX=dt._aabbMaxX>It._aabbMaxX?dt._aabbMaxX:It._aabbMaxX,gt._aabbMaxY=dt._aabbMaxY>It._aabbMaxY?dt._aabbMaxY:It._aabbMaxY,gt._aabbMaxZ=dt._aabbMaxZ>It._aabbMaxZ?dt._aabbMaxZ:It._aabbMaxZ;var Vt=gt._children[0]._height,Lt=gt._children[1]._height;gt._height=(Vt>Lt?Vt:Lt)+1;var wt=bt._children[0],At=bt._children[1];bt._aabbMinX=wt._aabbMinX<At._aabbMinX?wt._aabbMinX:At._aabbMinX,bt._aabbMinY=wt._aabbMinY<At._aabbMinY?wt._aabbMinY:At._aabbMinY,bt._aabbMinZ=wt._aabbMinZ<At._aabbMinZ?wt._aabbMinZ:At._aabbMinZ,bt._aabbMaxX=wt._aabbMaxX>At._aabbMaxX?wt._aabbMaxX:At._aabbMaxX,bt._aabbMaxY=wt._aabbMaxY>At._aabbMaxY?wt._aabbMaxY:At._aabbMaxY,bt._aabbMaxZ=wt._aabbMaxZ>At._aabbMaxZ?wt._aabbMaxZ:At._aabbMaxZ;var kt=bt._children[0]._height,Bt=bt._children[1]._height;bt._height=(kt>Bt?kt:Bt)+1}else{gt._children[0]=bt,bt._parent=gt,bt._childIndex=0,bt._children[0]=Yt,Yt._parent=bt,Yt._childIndex=0;var Pt=gt._children[0],Tt=gt._children[1];gt._aabbMinX=Pt._aabbMinX<Tt._aabbMinX?Pt._aabbMinX:Tt._aabbMinX,gt._aabbMinY=Pt._aabbMinY<Tt._aabbMinY?Pt._aabbMinY:Tt._aabbMinY,gt._aabbMinZ=Pt._aabbMinZ<Tt._aabbMinZ?Pt._aabbMinZ:Tt._aabbMinZ,gt._aabbMaxX=Pt._aabbMaxX>Tt._aabbMaxX?Pt._aabbMaxX:Tt._aabbMaxX,gt._aabbMaxY=Pt._aabbMaxY>Tt._aabbMaxY?Pt._aabbMaxY:Tt._aabbMaxY,gt._aabbMaxZ=Pt._aabbMaxZ>Tt._aabbMaxZ?Pt._aabbMaxZ:Tt._aabbMaxZ;var St=gt._children[0]._height,Ct=gt._children[1]._height;gt._height=(St>Ct?St:Ct)+1;var qt=bt._children[0],Rt=bt._children[1];bt._aabbMinX=qt._aabbMinX<Rt._aabbMinX?qt._aabbMinX:Rt._aabbMinX,bt._aabbMinY=qt._aabbMinY<Rt._aabbMinY?qt._aabbMinY:Rt._aabbMinY,bt._aabbMinZ=qt._aabbMinZ<Rt._aabbMinZ?qt._aabbMinZ:Rt._aabbMinZ,bt._aabbMaxX=qt._aabbMaxX>Rt._aabbMaxX?qt._aabbMaxX:Rt._aabbMaxX,bt._aabbMaxY=qt._aabbMaxY>Rt._aabbMaxY?qt._aabbMaxY:Rt._aabbMaxY,bt._aabbMaxZ=qt._aabbMaxZ>Rt._aabbMaxZ?qt._aabbMaxZ:Rt._aabbMaxZ;var Et=bt._children[0]._height,jt=bt._children[1]._height;bt._height=(Et>jt?Et:jt)+1}null!=yt?(yt._children[Mt]=gt,gt._parent=yt,gt._childIndex=Mt):(_t._root=gt,gt._parent=null),bt=gt}else if(zt<-1){var Nt=Xt._children[0],Dt=Xt._children[1];if(Nt._height>Dt._height){Xt._children[1]=bt,bt._parent=Xt,bt._childIndex=1,bt._children[1]=Dt,Dt._parent=bt,Dt._childIndex=1;var Ft=Xt._children[0],Ot=Xt._children[1];Xt._aabbMinX=Ft._aabbMinX<Ot._aabbMinX?Ft._aabbMinX:Ot._aabbMinX,Xt._aabbMinY=Ft._aabbMinY<Ot._aabbMinY?Ft._aabbMinY:Ot._aabbMinY,Xt._aabbMinZ=Ft._aabbMinZ<Ot._aabbMinZ?Ft._aabbMinZ:Ot._aabbMinZ,Xt._aabbMaxX=Ft._aabbMaxX>Ot._aabbMaxX?Ft._aabbMaxX:Ot._aabbMaxX,Xt._aabbMaxY=Ft._aabbMaxY>Ot._aabbMaxY?Ft._aabbMaxY:Ot._aabbMaxY,Xt._aabbMaxZ=Ft._aabbMaxZ>Ot._aabbMaxZ?Ft._aabbMaxZ:Ot._aabbMaxZ;var Wt=Xt._children[0]._height,Gt=Xt._children[1]._height;Xt._height=(Wt>Gt?Wt:Gt)+1;var Ht=bt._children[0],Ut=bt._children[1];bt._aabbMinX=Ht._aabbMinX<Ut._aabbMinX?Ht._aabbMinX:Ut._aabbMinX,bt._aabbMinY=Ht._aabbMinY<Ut._aabbMinY?Ht._aabbMinY:Ut._aabbMinY,bt._aabbMinZ=Ht._aabbMinZ<Ut._aabbMinZ?Ht._aabbMinZ:Ut._aabbMinZ,bt._aabbMaxX=Ht._aabbMaxX>Ut._aabbMaxX?Ht._aabbMaxX:Ut._aabbMaxX,bt._aabbMaxY=Ht._aabbMaxY>Ut._aabbMaxY?Ht._aabbMaxY:Ut._aabbMaxY,bt._aabbMaxZ=Ht._aabbMaxZ>Ut._aabbMaxZ?Ht._aabbMaxZ:Ut._aabbMaxZ;var Jt=bt._children[0]._height,Qt=bt._children[1]._height;bt._height=(Jt>Qt?Jt:Qt)+1}else{Xt._children[0]=bt,bt._parent=Xt,bt._childIndex=0,bt._children[1]=Nt,Nt._parent=bt,Nt._childIndex=1;var $t=Xt._children[0],Kt=Xt._children[1];Xt._aabbMinX=$t._aabbMinX<Kt._aabbMinX?$t._aabbMinX:Kt._aabbMinX,Xt._aabbMinY=$t._aabbMinY<Kt._aabbMinY?$t._aabbMinY:Kt._aabbMinY,Xt._aabbMinZ=$t._aabbMinZ<Kt._aabbMinZ?$t._aabbMinZ:Kt._aabbMinZ,Xt._aabbMaxX=$t._aabbMaxX>Kt._aabbMaxX?$t._aabbMaxX:Kt._aabbMaxX,Xt._aabbMaxY=$t._aabbMaxY>Kt._aabbMaxY?$t._aabbMaxY:Kt._aabbMaxY,Xt._aabbMaxZ=$t._aabbMaxZ>Kt._aabbMaxZ?$t._aabbMaxZ:Kt._aabbMaxZ;var ti=Xt._children[0]._height,ii=Xt._children[1]._height;Xt._height=(ti>ii?ti:ii)+1;var ai=bt._children[0],oi=bt._children[1];bt._aabbMinX=ai._aabbMinX<oi._aabbMinX?ai._aabbMinX:oi._aabbMinX,bt._aabbMinY=ai._aabbMinY<oi._aabbMinY?ai._aabbMinY:oi._aabbMinY,bt._aabbMinZ=ai._aabbMinZ<oi._aabbMinZ?ai._aabbMinZ:oi._aabbMinZ,bt._aabbMaxX=ai._aabbMaxX>oi._aabbMaxX?ai._aabbMaxX:oi._aabbMaxX,bt._aabbMaxY=ai._aabbMaxY>oi._aabbMaxY?ai._aabbMaxY:oi._aabbMaxY,bt._aabbMaxZ=ai._aabbMaxZ>oi._aabbMaxZ?ai._aabbMaxZ:oi._aabbMaxZ;var ni=bt._children[0]._height,si=bt._children[1]._height;bt._height=(ni>si?ni:si)+1}null!=yt?(yt._children[Mt]=Xt,Xt._parent=yt,Xt._childIndex=Mt):(_t._root=Xt,Xt._parent=null),bt=Xt}else bt=bt}var ri=bt._children[0]._height,ei=bt._children[1]._height;bt._height=(ri>ei?ri:ei)+1;var _i=bt._children[0],hi=bt._children[1];bt._aabbMinX=_i._aabbMinX<hi._aabbMinX?_i._aabbMinX:hi._aabbMinX,bt._aabbMinY=_i._aabbMinY<hi._aabbMinY?_i._aabbMinY:hi._aabbMinY,bt._aabbMinZ=_i._aabbMinZ<hi._aabbMinZ?_i._aabbMinZ:hi._aabbMinZ,bt._aabbMaxX=_i._aabbMaxX>hi._aabbMaxX?_i._aabbMaxX:hi._aabbMaxX,bt._aabbMaxY=_i._aabbMaxY>hi._aabbMaxY?_i._aabbMaxY:hi._aabbMaxY,bt._aabbMaxZ=_i._aabbMaxZ>hi._aabbMaxZ?_i._aabbMaxZ:hi._aabbMaxZ,bt=bt._parent}}i&&this.collide(this._tree._root,s._leaf),s._moved=!1}this.movedProxies[n]=null}i||this.collide(this._tree._root,this._tree._root),this.numMovedProxies=0}},rayCast:function(t,i,a){if(null!=this._tree._root){var o,n,s,r,e,_,h=t;o=h.x,n=h.y,s=h.z;var l=i;r=l.x,e=l.y,_=l.z,this.rayCastRecursive(this._tree._root,o,n,s,r,e,_,a)}},convexCast:function(t,i,a,o){null!=this._tree._root&&this.convexCastRecursive(this._tree._root,t,i,a,o)},aabbTest:function(t,i){null!=this._tree._root&&this.aabbTestRecursive(this._tree._root,t,i)},getTreeBalance:function(){return this._tree._getBalance()}});var p=function(){},v=function(){this._next=null,this._prevLeaf=null,this._nextLeaf=null;var t=new Array(2);this._children=t,this._childIndex=0,this._parent=null,this._height=0,this._proxy=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0},m=function(t,i){_.call(this,t,i),this._leaf=null,this._moved=!1};m.__super__=_,m.prototype=$extend(_.prototype,{});var b=function(){this._insertionStrategy=0,this._balancingEnabled=!1};b.prototype={_decideInsertion:function(t,i){switch(this._insertionStrategy){case 0:var a,o,n;a=i._aabbMinX+i._aabbMaxX,o=i._aabbMinY+i._aabbMaxY,n=i._aabbMinZ+i._aabbMaxZ;var s,r,e,_,h,l,c=t._children[0],p=t._children[1];return s=c._aabbMinX+c._aabbMaxX,r=c._aabbMinY+c._aabbMaxY,e=c._aabbMinZ+c._aabbMaxZ,_=p._aabbMinX+p._aabbMaxX,h=p._aabbMinY+p._aabbMaxY,l=p._aabbMinZ+p._aabbMaxZ,(s-=a)*s+(r-=o)*r+(e-=n)*e<(_-=a)*_+(h-=o)*h+(l-=n)*l?0:1;case 1:var v,m,b,f,x,u,y=t._children[0],g=t._children[1],X=t._aabbMaxX-t._aabbMinX,z=t._aabbMaxY-t._aabbMinY,M=t._aabbMaxZ-t._aabbMinZ,Y=2*(X*(z+M)+z*M);v=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,m=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,b=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,f=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX;var Z=(x=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY)-m,d=(u=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ)-b,I=2*((f-v)*(Z+d)+Z*d),V=2*I,L=2*(I-Y),w=L;if(v=y._aabbMinX<i._aabbMinX?y._aabbMinX:i._aabbMinX,m=y._aabbMinY<i._aabbMinY?y._aabbMinY:i._aabbMinY,b=y._aabbMinZ<i._aabbMinZ?y._aabbMinZ:i._aabbMinZ,f=y._aabbMaxX>i._aabbMaxX?y._aabbMaxX:i._aabbMaxX,x=y._aabbMaxY>i._aabbMaxY?y._aabbMaxY:i._aabbMaxY,u=y._aabbMaxZ>i._aabbMaxZ?y._aabbMaxZ:i._aabbMaxZ,0==y._height){var A=x-m,k=u-b;w+=2*((f-v)*(A+k)+A*k)}else{var B=f-v,P=x-m,T=u-b,S=y._aabbMaxX-y._aabbMinX,C=y._aabbMaxY-y._aabbMinY,q=y._aabbMaxZ-y._aabbMinZ;w+=2*(B*(P+T)+P*T)-2*(S*(C+q)+C*q)}var R=L;if(v=g._aabbMinX<i._aabbMinX?g._aabbMinX:i._aabbMinX,m=g._aabbMinY<i._aabbMinY?g._aabbMinY:i._aabbMinY,b=g._aabbMinZ<i._aabbMinZ?g._aabbMinZ:i._aabbMinZ,f=g._aabbMaxX>i._aabbMaxX?g._aabbMaxX:i._aabbMaxX,x=g._aabbMaxY>i._aabbMaxY?g._aabbMaxY:i._aabbMaxY,u=g._aabbMaxZ>i._aabbMaxZ?g._aabbMaxZ:i._aabbMaxZ,0==g._height){var E=x-m,j=u-b;R+=2*((f-v)*(E+j)+E*j)}else{var N=f-v,D=x-m,F=u-b,O=g._aabbMaxX-g._aabbMinX,W=g._aabbMaxY-g._aabbMinY,G=g._aabbMaxZ-g._aabbMinZ;R+=2*(N*(D+F)+D*F)-2*(O*(W+G)+W*G)}return V<w?V<R?-1:1:w<R?0:1;default:return console.log("BvhStrategy.hx:37:","invalid BVH insertion strategy: "+this._insertionStrategy),-1}},_splitLeaves:function(t,i,a){var o,n,s,r=1/(a-i);o=0,n=0,s=0;for(var e,_,h,l=i,c=a;l<c;){var p=t[l++];p._tmpX=p._aabbMaxX+p._aabbMinX,p._tmpY=p._aabbMaxY+p._aabbMinY,p._tmpZ=p._aabbMaxZ+p._aabbMinZ,o+=p._tmpX,n+=p._tmpY,s+=p._tmpZ}o*=r,n*=r,s*=r,e=0,_=0,h=0;for(var v=i,m=a;v<m;){var b,f,x,u=t[v++];b=u._tmpX-o,f=u._tmpY-n,x=u._tmpZ-s,e+=b*=b,_+=f*=f,h+=x*=x}var y=_,g=h,X=i,z=a-1;if(e>y)if(e>g)for(var M=o;;){for(;;){if(t[X]._tmpX<=M)break;++X}for(;;){if(t[z]._tmpX>=M)break;--z}if(X>=z)break;var Y=t[X];t[X]=t[z],t[z]=Y,++X,--z}else for(var Z=s;;){for(;;){if(t[X]._tmpZ<=Z)break;++X}for(;;){if(t[z]._tmpZ>=Z)break;--z}if(X>=z)break;var d=t[X];t[X]=t[z],t[z]=d,++X,--z}else if(y>g)for(var I=n;;){for(;;){if(t[X]._tmpY<=I)break;++X}for(;;){if(t[z]._tmpY>=I)break;--z}if(X>=z)break;var V=t[X];t[X]=t[z],t[z]=V,++X,--z}else for(var L=s;;){for(;;){if(t[X]._tmpZ<=L)break;++X}for(;;){if(t[z]._tmpZ>=L)break;--z}if(X>=z)break;var w=t[X];t[X]=t[z],t[z]=w,++X,--z}return X}};var f=function(){this._root=null,this._numLeaves=0,this._strategy=new b,this._nodePool=null,this.leafList=null,this.leafListLast=null;var t=new Array(1024);this.tmp=t};f.prototype={_print:function(t,i){if(null==i&&(i=""),null!=t)if(0==t._height)console.log("BvhTree.hx:39:",i+t._proxy._id);else{var a,o,n,s;this._print(t._children[0],i+"  "),o=t._aabbMaxX-t._aabbMinX;n=t._aabbMaxY-t._aabbMinY,s=t._aabbMaxZ-t._aabbMinZ;if(o*(n+s)+n*s>0){var r,e,_;r=t._aabbMaxX-t._aabbMinX;e=t._aabbMaxY-t._aabbMinY,_=t._aabbMaxZ-t._aabbMinZ;a=(1e3*(r*(e+_)+e*_)+.5|0)/1e3}else{var h,l,c;h=t._aabbMaxX-t._aabbMinX;l=t._aabbMaxY-t._aabbMinY,c=t._aabbMaxZ-t._aabbMinZ;a=(1e3*(h*(l+c)+l*c)-.5|0)/1e3}console.log("BvhTree.hx:42:",i+"#"+t._height+", "+a),this._print(t._children[1],i+"  ")}},_getBalance:function(){return this.getBalanceRecursive(this._root)},deleteRecursive:function(t){if(0==t._height){var i=t._prevLeaf,a=t._nextLeaf;return null!=i&&(i._nextLeaf=a),null!=a&&(a._prevLeaf=i),t==this.leafList&&(this.leafList=this.leafList._nextLeaf),t==this.leafListLast&&(this.leafListLast=this.leafListLast._prevLeaf),t._nextLeaf=null,t._prevLeaf=null,t._proxy._leaf=null,t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,void(this._nodePool=t)}this.deleteRecursive(t._children[0]),this.deleteRecursive(t._children[1]),t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,this._nodePool=t},decomposeRecursive:function(t){if(0==t._height)return t._childIndex=0,void(t._parent=null);this.decomposeRecursive(t._children[0]),this.decomposeRecursive(t._children[1]),t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,this._nodePool=t},buildTopDownRecursive:function(t,i,a){if(1==a-i){var o=t[i],n=o._proxy;return o._aabbMinX=n._aabbMinX,o._aabbMinY=n._aabbMinY,o._aabbMinZ=n._aabbMinZ,o._aabbMaxX=n._aabbMaxX,o._aabbMaxY=n._aabbMaxY,o._aabbMaxZ=n._aabbMaxZ,o}var s=this._strategy._splitLeaves(t,i,a),r=this.buildTopDownRecursive(t,i,s),e=this.buildTopDownRecursive(t,s,a),_=this._nodePool;null!=_?(this._nodePool=_._next,_._next=null):_=new v;var h=_;h._children[0]=r,r._parent=h,r._childIndex=0,h._children[1]=e,e._parent=h,e._childIndex=1;var l=h._children[0],c=h._children[1];h._aabbMinX=l._aabbMinX<c._aabbMinX?l._aabbMinX:c._aabbMinX,h._aabbMinY=l._aabbMinY<c._aabbMinY?l._aabbMinY:c._aabbMinY,h._aabbMinZ=l._aabbMinZ<c._aabbMinZ?l._aabbMinZ:c._aabbMinZ,h._aabbMaxX=l._aabbMaxX>c._aabbMaxX?l._aabbMaxX:c._aabbMaxX,h._aabbMaxY=l._aabbMaxY>c._aabbMaxY?l._aabbMaxY:c._aabbMaxY,h._aabbMaxZ=l._aabbMaxZ>c._aabbMaxZ?l._aabbMaxZ:c._aabbMaxZ;var p=h._children[0]._height,m=h._children[1]._height;return h._height=(p>m?p:m)+1,h},getBalanceRecursive:function(t){if(null==t||0==t._height)return 0;var i=t._children[0]._height-t._children[1]._height;return i<0&&(i=-i),i+this.getBalanceRecursive(t._children[0])+this.getBalanceRecursive(t._children[1])}};var x=function(){this._minX=0,this._minY=0,this._minZ=0,this._maxX=0,this._maxY=0,this._maxZ=0};x.prototype={init:function(t,i){var a=t;this._minX=a.x,this._minY=a.y,this._minZ=a.z;var o=i;return this._maxX=o.x,this._maxY=o.y,this._maxZ=o.z,this},getMin:function(){var t=new F,i=t;return i.x=this._minX,i.y=this._minY,i.z=this._minZ,t},getMinTo:function(t){var i=t;i.x=this._minX,i.y=this._minY,i.z=this._minZ},setMin:function(t){var i=t;return this._minX=i.x,this._minY=i.y,this._minZ=i.z,this},getMax:function(){var t=new F,i=t;return i.x=this._maxX,i.y=this._maxY,i.z=this._maxZ,t},getMaxTo:function(t){var i=t;i.x=this._maxX,i.y=this._maxY,i.z=this._maxZ},setMax:function(t){var i=t;return this._maxX=i.x,this._maxY=i.y,this._maxZ=i.z,this},getCenter:function(){var t,i,a,o=new F;t=this._minX+this._maxX,i=this._minY+this._maxY,a=this._minZ+this._maxZ,t*=.5,i*=.5,a*=.5;var n=o;return n.x=t,n.y=i,n.z=a,o},getCenterTo:function(t){var i,a,o;i=this._minX+this._maxX,a=this._minY+this._maxY,o=this._minZ+this._maxZ,i*=.5,a*=.5,o*=.5;var n=t;n.x=i,n.y=a,n.z=o},getExtents:function(){var t,i,a,o=new F;t=this._maxX-this._minX,i=this._maxY-this._minY,a=this._maxZ-this._minZ,t*=.5,i*=.5,a*=.5;var n=o;return n.x=t,n.y=i,n.z=a,o},getExtentsTo:function(t){var i,a,o;i=this._maxX-this._minX,a=this._maxY-this._minY,o=this._maxZ-this._minZ,i*=.5,a*=.5,o*=.5;var n=t;n.x=i,n.y=a,n.z=o},combine:function(t){return this._minX=this._minX<t._minX?this._minX:t._minX,this._minY=this._minY<t._minY?this._minY:t._minY,this._minZ=this._minZ<t._minZ?this._minZ:t._minZ,this._maxX=this._maxX>t._maxX?this._maxX:t._maxX,this._maxY=this._maxY>t._maxY?this._maxY:t._maxY,this._maxZ=this._maxZ>t._maxZ?this._maxZ:t._maxZ,this},combined:function(t){var i=new x;return i._minX=this._minX<t._minX?this._minX:t._minX,i._minY=this._minY<t._minY?this._minY:t._minY,i._minZ=this._minZ<t._minZ?this._minZ:t._minZ,i._maxX=this._maxX>t._maxX?this._maxX:t._maxX,i._maxY=this._maxY>t._maxY?this._maxY:t._maxY,i._maxZ=this._maxZ>t._maxZ?this._maxZ:t._maxZ,i},overlap:function(t){return this._minX<t._maxX&&this._maxX>t._minX&&this._minY<t._maxY&&this._maxY>t._minY&&this._minZ<t._maxZ&&this._maxZ>t._minZ},getIntersection:function(t){var i=new x;return i._minX=this._minX>t._minX?this._minX:t._minX,i._minY=this._minY>t._minY?this._minY:t._minY,i._minZ=this._minZ>t._minZ?this._minZ:t._minZ,i._maxX=this._maxX<t._maxX?this._maxX:t._maxX,i._maxY=this._maxY<t._maxY?this._maxY:t._maxY,i._maxZ=this._maxZ<t._maxZ?this._maxZ:t._maxZ,i},getIntersectionTo:function(t,i){i._minX=this._minX>t._minX?this._minX:t._minX,i._minY=this._minY>t._minY?this._minY:t._minY,i._minZ=this._minZ>t._minZ?this._minZ:t._minZ,i._maxX=this._maxX<t._maxX?this._maxX:t._maxX,i._maxY=this._maxY<t._maxY?this._maxY:t._maxY,i._maxZ=this._maxZ<t._maxZ?this._maxZ:t._maxZ},copyFrom:function(t){return this._minX=t._minX,this._minY=t._minY,this._minZ=t._minZ,this._maxX=t._maxX,this._maxY=t._maxY,this._maxZ=t._maxZ,this},clone:function(){var t=new x;return t._minX=this._minX,t._minY=this._minY,t._minZ=this._minZ,t._maxX=this._maxX,t._maxY=this._maxY,t._maxZ=this._maxZ,t}};var u=function(t){o.call(this,1);var i=t;this._halfExtentsX=i.x,this._halfExtentsY=i.y,this._halfExtentsZ=i.z,this._halfAxisXX=t.x,this._halfAxisXY=0,this._halfAxisXZ=0,this._halfAxisYX=0,this._halfAxisYY=t.y,this._halfAxisYZ=0,this._halfAxisZX=0,this._halfAxisZY=0,this._halfAxisZZ=t.z,this._updateMass();var a=t.x<t.y?t.z<t.x?t.z:t.x:t.z<t.y?t.z:t.y;this._gjkMargin>.2*a&&(this._gjkMargin=.2*a)};u.__super__=o,u.prototype=$extend(o.prototype,{getHalfExtents:function(){var t=new F,i=t;return i.x=this._halfExtentsX,i.y=this._halfExtentsY,i.z=this._halfExtentsZ,t},getHalfExtentsTo:function(t){var i=t;i.x=this._halfExtentsX,i.y=this._halfExtentsY,i.z=this._halfExtentsZ},_updateMass:function(){var t,i,a;this._volume=this._halfExtentsX*this._halfExtentsY*this._halfExtentsZ*8,t=this._halfExtentsX*this._halfExtentsX,i=this._halfExtentsY*this._halfExtentsY,a=this._halfExtentsZ*this._halfExtentsZ,this._inertiaCoeff00=.3333333333333333*(i+a),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(a+t),this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(t+i)},_computeAabb:function(t,i){var a,o,n,s,r,e,_,h,l,c,p,v,m;c=i._rotation00*this._halfAxisXX+i._rotation01*this._halfAxisXY+i._rotation02*this._halfAxisXZ,o=i._rotation10*this._halfAxisXX+i._rotation11*this._halfAxisXY+i._rotation12*this._halfAxisXZ,n=i._rotation20*this._halfAxisXX+i._rotation21*this._halfAxisXY+i._rotation22*this._halfAxisXZ,p=(a=(a=c)<0?-a:a)+(s=(s=i._rotation00*this._halfAxisYX+i._rotation01*this._halfAxisYY+i._rotation02*this._halfAxisYZ)<0?-s:s),v=(o=o<0?-o:o)+(r=(r=i._rotation10*this._halfAxisYX+i._rotation11*this._halfAxisYY+i._rotation12*this._halfAxisYZ)<0?-r:r),m=(n=n<0?-n:n)+(e=(e=i._rotation20*this._halfAxisYX+i._rotation21*this._halfAxisYY+i._rotation22*this._halfAxisYZ)<0?-e:e),p+=_=(_=i._rotation00*this._halfAxisZX+i._rotation01*this._halfAxisZY+i._rotation02*this._halfAxisZZ)<0?-_:_,v+=h=(h=i._rotation10*this._halfAxisZX+i._rotation11*this._halfAxisZY+i._rotation12*this._halfAxisZZ)<0?-h:h,m+=l=(l=i._rotation20*this._halfAxisZX+i._rotation21*this._halfAxisZY+i._rotation22*this._halfAxisZZ)<0?-l:l,t._minX=i._positionX-p,t._minY=i._positionY-v,t._minZ=i._positionZ-m,t._maxX=i._positionX+p,t._maxY=i._positionY+v,t._maxZ=i._positionZ+m},computeLocalSupportingVertex:function(t,i){var a,o,n,s,r,e;a=this._gjkMargin,o=this._gjkMargin,n=this._gjkMargin,a=a<this._halfExtentsX?a:this._halfExtentsX,o=o<this._halfExtentsY?o:this._halfExtentsY,n=n<this._halfExtentsZ?n:this._halfExtentsZ,s=this._halfExtentsX-a,r=this._halfExtentsY-o,e=this._halfExtentsZ-n,i.x=t.x>0?s:-s,i.y=t.y>0?r:-r,i.z=t.z>0?e:-e},_rayCastLocal:function(t,i,a,o,n,s,r){var e=t,_=i,h=a,l=o,c=n,p=s,v=this._halfExtentsX,m=this._halfExtentsY,b=this._halfExtentsZ,f=l-e,x=c-_,u=p-h,y=0,g=0,X=0,z=1,M=1,Y=1;if(f>-1e-6&&f<1e-6){if(e<=-v||e>=v)return!1}else{var Z=1/f,d=(-v-e)*Z,I=(v-e)*Z;if(d>I){var V=d;d=I,I=V}d>0&&(y=d),I<1&&(z=I)}if(x>-1e-6&&x<1e-6){if(_<=-m||_>=m)return!1}else{var L=1/x,w=(-m-_)*L,A=(m-_)*L;if(w>A){var k=w;w=A,A=k}w>0&&(g=w),A<1&&(M=A)}if(u>-1e-6&&u<1e-6){if(h<=-b||h>=b)return!1}else{var B=1/u,P=(-b-h)*B,T=(b-h)*B;if(P>T){var S=P;P=T,T=S}P>0&&(X=P),T<1&&(Y=T)}if(y>=1||g>=1||X>=1||z<=0||M<=0||Y<=0)return!1;var C=y,q=z,R=0;if(g>C&&(C=g,R=1),X>C&&(C=X,R=2),M<q&&(q=M),Y<q&&(q=Y),C>q)return!1;if(0==C)return!1;switch(R){case 0:r.normal.init(f>0?-1:1,0,0);break;case 1:r.normal.init(0,x>0?-1:1,0);break;case 2:r.normal.init(0,0,u>0?-1:1)}return r.position.init(e+C*f,_+C*x,h+C*u),r.fraction=C,!0}});var y=function(t,i){o.call(this,4),this._radius=t,this._halfHeight=i,this._gjkMargin=this._radius,this._updateMass()};y.__super__=o,y.prototype=$extend(o.prototype,{getRadius:function(){return this._radius},getHalfHeight:function(){return this._halfHeight},_updateMass:function(){var t=this._radius*this._radius,i=this._halfHeight*this._halfHeight,a=6.28318530717958*t*this._halfHeight,o=3.14159265358979*t*this._radius*4/3;this._volume=a+o;var n=0==this._volume?0:1/this._volume,s=n*(a*t*.5+o*t*.4),r=n*(a*(.25*t+i/3)+o*(.4*t+this._halfHeight*this._radius*.75+i));this._inertiaCoeff00=r,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=s,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=r},_computeAabb:function(t,i){var a,o,n,s,r,e;a=this._radius,o=this._radius,n=this._radius,s=(s=i._rotation01)<0?-s:s,r=(r=i._rotation11)<0?-r:r,e=(e=i._rotation21)<0?-e:e,a+=s*=this._halfHeight,o+=r*=this._halfHeight,n+=e*=this._halfHeight,t._minX=i._positionX-a,t._minY=i._positionY-o,t._minZ=i._positionZ-n,t._maxX=i._positionX+a,t._maxY=i._positionY+o,t._maxZ=i._positionZ+n},computeLocalSupportingVertex:function(t,i){t.y>0?i.init(0,this._halfHeight,0):i.init(0,-this._halfHeight,0)},_rayCastLocal:function(t,i,a,o,n,s,r){var e=t,_=i,h=a,l=o,c=n,p=s,v=this._halfHeight,m=l-e,b=c-_,f=p-h,x=0,u=1,y=m*m+f*f,g=e*m+h*f,X=e*e+h*h-this._radius*this._radius,z=g*g-y*X;if(z<0)return!1;if(y>0){var M=Math.sqrt(z);if(u=(-g+M)/y,(x=(-g-M)/y)>=1||u<=0)return!1}else{if(X>=0)return!1;x=0,u=1}var Y,Z,d,I,V,L,w,A,k=_+b*x;if(k>-v&&k<v){if(x>0){Y=x;var B=r.normal.init(e+m*Y,0,h+f*Y),P=Math.sqrt(B.x*B.x+B.y*B.y+B.z*B.z);P>0&&(P=1/P);var T=B.x*P,S=B.y*P,C=B.z*P;return B.x=T,B.y=S,B.z=C,r.position.init(e+Y*m,k,h+Y*f),r.fraction=Y,!0}return!1}if(0,0,(z=(g=(d=t-0)*(L=o-t)+(I=i-(Z=k<0?-v:v))*(w=n-i)+(V=a-0)*(A=s-a))*g-(y=L*L+w*w+A*A)*(X=d*d+I*I+V*V-this._radius*this._radius))<0)return!1;var q,R,E,j,N,D,F=(-g-Math.sqrt(z))/y;if(F<0||F>1)return!1;var O=(q=d+L*F)*q+(R=I+w*F)*R+(E=V+A*F)*E;O>0&&(O=1/Math.sqrt(O)),j=q*O,N=R*O,D=E*O,q+=0,R+=Z,E+=0;var W=r.position;W.x=q,W.y=R,W.z=E;var G=r.normal;return G.x=j,G.y=N,G.z=D,r.fraction=F,!0}});var g=function(t,i){o.call(this,3),this._radius=t,this._halfHeight=i,this.sinTheta=t/Math.sqrt(t*t+4*i*i),this.cosTheta=2*i/Math.sqrt(t*t+4*i*i),this._updateMass()};g.__super__=o,g.prototype=$extend(o.prototype,{getRadius:function(){return this._radius},getHalfHeight:function(){return this._halfHeight},_updateMass:function(){var t=this._radius*this._radius,i=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*t*this._halfHeight*2/3,this._inertiaCoeff00=.05*(3*t+2*i),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3*t,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.08333333333333333*(3*t+2*i)},_computeAabb:function(t,i){var a,o,n,s,r,e,_,h,l,c,p,v,m,b,f,x,u,y,g,X,z,M=(a=i._rotation01)*a,Y=(o=i._rotation11)*o,Z=(n=i._rotation21)*n;_=Math.sqrt(1-M),h=Math.sqrt(1-Y),l=Math.sqrt(1-Z),_*=this._radius,h*=this._radius,l*=this._radius,c=-(s=a*this._halfHeight),p=-(r=o*this._halfHeight),v=-(e=n*this._halfHeight),m=-s,b=-r,f=-e,x=(x=(c-=_)>(m+=_)?c:m)>s?x:s,u=(u=(p-=h)>(b+=h)?p:b)>r?u:r,y=(y=(v-=l)>(f+=l)?v:f)>e?y:e,g=(g=c<m?c:m)<s?g:s,X=(X=p<b?p:b)<r?X:r,z=(z=v<f?v:f)<e?z:e,t._minX=i._positionX+g,t._minY=i._positionY+X,t._minZ=i._positionZ+z,t._maxX=i._positionX+x,t._maxY=i._positionY+u,t._maxZ=i._positionZ+y},computeLocalSupportingVertex:function(t,i){var a=t.x,o=t.y,n=t.z;if(o>0&&o*o>this.sinTheta*this.sinTheta*(a*a+o*o+n*n))return i.init(0,this._halfHeight-this._gjkMargin/this.sinTheta,0),void(i.y<0&&(i.y=0));var s=t.x,r=t.z,e=s*s+r*r,_=2*this._halfHeight,h=(_-this._gjkMargin)/_*this._radius-this._gjkMargin/this.cosTheta;h<0&&(h=0);var l=e>0?h/Math.sqrt(e):0,c=this._halfHeight-this._gjkMargin;c<0&&(c=0),i.x=s*l,i.y=-c,i.z=r*l},_rayCastLocal:function(t,i,a,o,n,s,r){var e=t,_=i,h=a,l=o,c=n,p=s,v=this._halfHeight,m=l-e,b=c-_,f=p-h,x=0,u=1;if(b>-1e-6&&b<1e-6){if(_<=-v||_>=v)return!1}else{var y=1/b,g=(-v-_)*y,X=(v-_)*y;if(g>X){var z=g;g=X,X=z}g>0&&(x=g),X<1&&(u=X)}if(x>=1||u<=0)return!1;var M=0,Y=0;_-=v;var Z,d=this.cosTheta*this.cosTheta,I=d*(m*m+b*b+f*f)-b*b,V=d*(e*m+_*b+h*f)-_*b,L=d*(e*e+_*_+h*h)-_*_,w=V*V-I*L;if(0!=I){if(w<0)return!1;var A=Math.sqrt(w);if(I<0){if(b>0){if(M=0,(Y=(-V+A)/I)<=0)return!1}else if(Y=1,(M=(-V-A)/I)>=1)return!1}else if(Y=(-V+A)/I,(M=(-V-A)/I)>=1||Y<=0)return!1}else{var k=-L/(2*V);if(V>0){if(M=0,Y=k,k<=0)return!1}else if(M=k,Y=1,k>=1)return!1}if(_+=v,Y<=x||u<=M)return!1;if(M<x){if(0==(Z=x))return!1;r.normal.init(0,b>0?-1:1,0)}else{if(0==(Z=M))return!1;var B=r.normal.init(e+m*Z,0,h+f*Z),P=Math.sqrt(B.x*B.x+B.y*B.y+B.z*B.z);P>0&&(P=1/P);var T=B.x*P,S=B.y*P,C=B.z*P;B.x=T,B.y=S,B.z=C;var q=B,R=this.cosTheta,E=q.x*R,j=q.y*R,N=q.z*R;q.x=E,q.y=j,q.z=N,r.normal.y+=this.sinTheta}return r.position.init(e+Z*m,_+Z*b,h+Z*f),r.fraction=Z,!0}});var X=function(t){o.call(this,5),this._numVertices=t.length;var i=this._numVertices,a=new Array(i);this._vertices=a;var n=this._numVertices,s=new Array(n);this._tmpVertices=s;for(var r=0,e=this._numVertices;r<e;){var _=r++;this._vertices[_]=t[_],this._tmpVertices[_]=new F}this._useGjkRayCast=!0,this._updateMass()};X.__super__=o,X.prototype=$extend(o.prototype,{getVertices:function(){return this._vertices},_updateMass:function(){this._volume=1,this._inertiaCoeff00=1,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=1,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=1;for(var t=this._vertices[0].x,i=this._vertices[0].y,a=this._vertices[0].z,o=this._vertices[0].x,n=this._vertices[0].y,s=this._vertices[0].z,r=1,e=this._numVertices;r<e;){var _=r++,h=this._vertices[_].x,l=this._vertices[_].y,c=this._vertices[_].z;h<t?t=h:h>o&&(o=h),l<i?i=l:l>n&&(n=l),c<a?a=c:c>s&&(s=c)}var p=o-t,v=n-i,m=s-a;this._volume=p*v*m;var b=.25*((t+o)*(t+o)+(i+n)*(i+n)+(a+s)*(a+s));p=p*p*.25,v=v*v*.25,m=m*m*.25,this._inertiaCoeff00=.3333333333333333*(v+m)+b,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(m+p)+b,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(p+v)+b},_computeAabb:function(t,i){var a,o,n,s,r,e,_,h,l,c,p,v;_=this._gjkMargin,h=this._gjkMargin,l=this._gjkMargin;var m,b,f,x=this._vertices[0];c=x.x,p=x.y,v=x.z,m=i._rotation00*c+i._rotation01*p+i._rotation02*v,b=i._rotation10*c+i._rotation11*p+i._rotation12*v,f=i._rotation20*c+i._rotation21*p+i._rotation22*v,a=m+=i._positionX,o=b+=i._positionY,n=f+=i._positionZ,s=m,r=b,e=f;for(var u=1,y=this._numVertices;u<y;){var g=u++,X=this._vertices[g];c=X.x,p=X.y,v=X.z,m=i._rotation00*c+i._rotation01*p+i._rotation02*v,b=i._rotation10*c+i._rotation11*p+i._rotation12*v,f=i._rotation20*c+i._rotation21*p+i._rotation22*v,a=a<(m+=i._positionX)?a:m,o=o<(b+=i._positionY)?o:b,n=n<(f+=i._positionZ)?n:f,s=s>m?s:m,r=r>b?r:b,e=e>f?e:f}t._minX=a-_,t._minY=o-h,t._minZ=n-l,t._maxX=s+_,t._maxY=r+h,t._maxZ=e+l},computeLocalSupportingVertex:function(t,i){for(var a=this._vertices[0],o=a.x*t.x+a.y*t.y+a.z*t.z,n=0,s=1,r=this._numVertices;s<r;){var e=s++,_=this._vertices[e],h=_.x*t.x+_.y*t.y+_.z*t.z;h>o&&(o=h,n=e)}var l=this._vertices[n];i.x=l.x,i.y=l.y,i.z=l.z}});var z=function(t,i){o.call(this,2),this._radius=t,this._halfHeight=i,this._updateMass()};z.__super__=o,z.prototype=$extend(o.prototype,{getRadius:function(){return this._radius},getHalfHeight:function(){return this._halfHeight},_updateMass:function(){var t=this._radius*this._radius,i=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*t*this._halfHeight*2,this._inertiaCoeff00=.08333333333333333*(3*t+i),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.5*t,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.08333333333333333*(3*t+i)},_computeAabb:function(t,i){var a,o,n,s,r,e,_,h,l,c=(a=(a=i._rotation01)<0?-a:a)*a,p=(o=(o=i._rotation11)<0?-o:o)*o,v=(n=(n=i._rotation21)<0?-n:n)*n;s=Math.sqrt(1-c),r=Math.sqrt(1-p),e=Math.sqrt(1-v),s*=this._radius,r*=this._radius,e*=this._radius,_=s+a*this._halfHeight,h=r+o*this._halfHeight,l=e+n*this._halfHeight,t._minX=i._positionX-_,t._minY=i._positionY-h,t._minZ=i._positionZ-l,t._maxX=i._positionX+_,t._maxY=i._positionY+h,t._maxZ=i._positionZ+l},computeLocalSupportingVertex:function(t,i){var a=t.x,o=t.z,n=a*a+o*o,s=this._radius-this._gjkMargin;s<0&&(s=0);var r=n>0?s/Math.sqrt(n):0,e=this._halfHeight-this._gjkMargin;e<0&&(e=0),i.x=a*r,i.y=t.y>0?e:-e,i.z=o*r},_rayCastLocal:function(t,i,a,o,n,s,r){var e=t,_=i,h=a,l=o,c=n,p=s,v=this._halfHeight,m=l-e,b=c-_,f=p-h,x=0,u=1;if(b>-1e-6&&b<1e-6){if(_<=-v||_>=v)return!1}else{var y=1/b,g=(-v-_)*y,X=(v-_)*y;if(g>X){var z=g;g=X,X=z}g>0&&(x=g),X<1&&(u=X)}if(x>=1||u<=0)return!1;var M,Y=0,Z=1,d=m*m+f*f,I=e*m+h*f,V=e*e+h*h-this._radius*this._radius,L=I*I-d*V;if(L<0)return!1;if(d>0){var w=Math.sqrt(L);if(Z=(-I+w)/d,(Y=(-I-w)/d)>=1||Z<=0)return!1}else{if(V>=0)return!1;Y=0,Z=1}if(Z<=x||u<=Y)return!1;if(Y<x){if(0==(M=x))return!1;r.normal.init(0,b>0?-1:1,0)}else{if(0==(M=Y))return!1;var A=r.normal.init(e+m*M,0,h+f*M),k=Math.sqrt(A.x*A.x+A.y*A.y+A.z*A.z);k>0&&(k=1/k);var B=A.x*k,P=A.y*k,T=A.z*k;A.x=B,A.y=P,A.z=T}return r.position.init(e+M*m,_+M*b,h+M*f),r.fraction=M,!0}});var M=function(){},Y=function(){this.position=new F,this.normal=new F,this.fraction=0},Z=function(t){o.call(this,0),this._radius=t,this._gjkMargin=this._radius,this._updateMass()};Z.__super__=o,Z.prototype=$extend(o.prototype,{getRadius:function(){return this._radius},_updateMass:function(){this._volume=4.188790204786386*this._radius*this._radius*this._radius,this._inertiaCoeff00=.4*this._radius*this._radius,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.4*this._radius*this._radius,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.4*this._radius*this._radius},_computeAabb:function(t,i){var a,o,n;a=this._radius,o=this._radius,n=this._radius,t._minX=i._positionX-a,t._minY=i._positionY-o,t._minZ=i._positionZ-n,t._maxX=i._positionX+a,t._maxY=i._positionY+o,t._maxZ=i._positionZ+n},computeLocalSupportingVertex:function(t,i){i.zero()},_rayCastLocal:function(t,i,a,o,n,s,r){var e,_,h,l=(e=o-t)*e+(_=n-i)*_+(h=s-a)*h,c=t*e+i*_+a*h,p=c*c-l*(t*t+i*i+a*a-this._radius*this._radius);if(p<0)return!1;var v,m,b,f,x,u,y=(-c-Math.sqrt(p))/l;if(y<0||y>1)return!1;var g=(v=t+e*y)*v+(m=i+_*y)*m+(b=a+h*y)*b;g>0&&(g=1/Math.sqrt(g)),f=v*g,x=m*g,u=b*g;var X=r.position;X.x=v,X.y=m,X.z=b;var z=r.normal;return z.x=f,z.y=x,z.z=u,r.fraction=y,!0}});var d=function(){var t=new Array(8);this.detectors=t;for(var i=0;i<6;){var a=i++,o=this.detectors,n=new Array(8);o[a]=n}var s=new T;this.detectors[0][0]=new q,this.detectors[0][1]=new S(!1),this.detectors[0][2]=s,this.detectors[0][3]=s,this.detectors[0][4]=new C(!1),this.detectors[0][5]=s,this.detectors[1][0]=new S(!0),this.detectors[1][1]=new w,this.detectors[1][2]=s,this.detectors[1][3]=s,this.detectors[1][4]=s,this.detectors[1][5]=s,this.detectors[2][0]=s,this.detectors[2][1]=s,this.detectors[2][2]=s,this.detectors[2][3]=s,this.detectors[2][4]=s,this.detectors[2][5]=s,this.detectors[3][0]=s,this.detectors[3][1]=s,this.detectors[3][2]=s,this.detectors[3][3]=s,this.detectors[3][4]=s,this.detectors[3][5]=s,this.detectors[4][0]=new C(!0),this.detectors[4][1]=s,this.detectors[4][2]=s,this.detectors[4][3]=s,this.detectors[4][4]=new P,this.detectors[4][5]=s,this.detectors[5][0]=s,this.detectors[5][1]=s,this.detectors[5][2]=s,this.detectors[5][3]=s,this.detectors[5][4]=s,this.detectors[5][5]=s};d.prototype={getDetector:function(t,i){return this.detectors[t][i]}};var I=function(){this.numPoints=0,this.normal=new F;var t=W.maxManifoldPoints,i=new Array(t);this.points=i,this.incremental=!1;for(var a=0,o=W.maxManifoldPoints;a<o;){var n=a++;this.points[n]=new V}};I.prototype={getMaxDepth:function(){for(var t=0,i=0,a=this.numPoints;i<a;){var o=i++;this.points[o].depth>t&&(t=this.points[o].depth)}return t},clear:function(){this.numPoints=0;for(var t=0,i=this.points;t<i.length;){var a=i[t];++t,a.position1.zero(),a.position2.zero(),a.depth=0,a.id=0}this.normal.zero()}};var V=function(){this.position1=new F,this.position2=new F,this.depth=0,this.id=0},L=function(t){this.swapped=t};L.prototype={setNormal:function(t,i,a,o){var n=t.normal;if(n.x=i,n.y=a,n.z=o,this.swapped){var s=t.normal,r=-s.x,e=-s.y,_=-s.z;s.x=r,s.y=e,s.z=_}},addPoint:function(t,i,a,o,n,s,r,e,_){var h=t.points[t.numPoints++];if(h.depth=e,h.id=_,this.swapped){var l=h.position1;l.x=n,l.y=s,l.z=r;var c=h.position2;c.x=i,c.y=a,c.z=o}else{var p=h.position1;p.x=i,p.y=a,p.z=o;var v=h.position2;v.x=n,v.y=s,v.z=r}},detectImpl:function(t,i,a,o,n,s){},detect:function(t,i,a,o,n,s){t.numPoints=0;for(var r=0,e=t.points;r<e.length;){var _=e[r];++r,_.position1.zero(),_.position2.zero(),_.depth=0,_.id=0}t.normal.zero(),this.swapped?this.detectImpl(t,a,i,n,o,s):this.detectImpl(t,i,a,o,n,s)}};var w=function(){L.call(this,!1),this.clipper=new k};w.__super__=L,w.prototype=$extend(L.prototype,{detectImpl:function(t,i,a,o,n,s){var r,e,_,h,l,c,p,v,m,b,f,x,u,y,g,X,z,M,Y,Z,d,I,V,L,w,A,k,B=i,P=a;t.incremental=!1,r=o._positionX,e=o._positionY,_=o._positionZ,p=(h=n._positionX)-r,v=(l=n._positionY)-e,m=(c=n._positionZ)-_,b=o._rotation00,f=o._rotation10,x=o._rotation20,u=o._rotation01,y=o._rotation11,g=o._rotation21,X=o._rotation02,z=o._rotation12,M=o._rotation22,Y=n._rotation00,Z=n._rotation10,d=n._rotation20,I=n._rotation01,V=n._rotation11,L=n._rotation21,w=n._rotation02,A=n._rotation12,k=n._rotation22;var T,S,C,q,R,E,j,N,D,F,O,G,H,U,J,Q,$,K,tt=B._halfExtentsX,it=B._halfExtentsY,at=B._halfExtentsZ,ot=P._halfExtentsX,nt=P._halfExtentsY,st=P._halfExtentsZ;T=b*tt,S=f*tt,C=x*tt,q=u*it,R=y*it,E=g*it,j=X*at,N=z*at,D=M*at;var rt,et,_t,ht=1/0,lt=-1,ct=0;rt=0,et=0,_t=0;var pt=tt,vt=b*(F=Y*ot)+f*(O=Z*ot)+x*(G=d*ot),mt=b*(H=I*nt)+f*(U=V*nt)+x*(J=L*nt),bt=b*(Q=w*st)+f*($=A*st)+x*(K=k*st);vt<0&&(vt=-vt),mt<0&&(mt=-mt),bt<0&&(bt=-bt);var ft=vt+mt+bt,xt=b*p+f*v+x*m,ut=pt+ft,yt=xt<0,gt=yt?-xt:xt;if(gt<ut){var Xt=ut-gt;Xt<ht&&(ht=Xt,lt=0,rt=b,et=f,_t=x,ct=yt?-1:1);var zt=u*F+y*O+g*G,Mt=u*H+y*U+g*J,Yt=u*Q+y*$+g*K;zt<0&&(zt=-zt),Mt<0&&(Mt=-Mt),Yt<0&&(Yt=-Yt);var Zt=(pt=it)+(ft=zt+Mt+Yt),dt=(xt=u*p+y*v+g*m)<0,It=dt?-xt:xt;if(It<Zt){var Vt=Zt-It;Vt<ht&&(ht=Vt,lt=1,rt=u,et=y,_t=g,ct=dt?-1:1);var Lt=X*F+z*O+M*G,wt=X*H+z*U+M*J,At=X*Q+z*$+M*K;Lt<0&&(Lt=-Lt),wt<0&&(wt=-wt),At<0&&(At=-At);var kt=(pt=at)+(ft=Lt+wt+At),Bt=(xt=X*p+z*v+M*m)<0,Pt=Bt?-xt:xt;if(Pt<kt){var Tt=kt-Pt;Tt<ht&&(ht=Tt,lt=2,rt=X,et=z,_t=M,ct=Bt?-1:1),ht>W.linearSlop?ht-=W.linearSlop:ht=0;var St=Y*T+Z*S+d*C,Ct=Y*q+Z*R+d*E,qt=Y*j+Z*N+d*D;St<0&&(St=-St),Ct<0&&(Ct=-Ct),qt<0&&(qt=-qt);var Rt=(pt=St+Ct+qt)+(ft=ot),Et=(xt=Y*p+Z*v+d*m)<0,jt=Et?-xt:xt;if(jt<Rt){var Nt=Rt-jt;Nt<ht&&(ht=Nt,lt=3,rt=Y,et=Z,_t=d,ct=Et?-1:1);var Dt=I*T+V*S+L*C,Ft=I*q+V*R+L*E,Ot=I*j+V*N+L*D;Dt<0&&(Dt=-Dt),Ft<0&&(Ft=-Ft),Ot<0&&(Ot=-Ot);var Wt=(pt=Dt+Ft+Ot)+(ft=nt),Gt=(xt=I*p+V*v+L*m)<0,Ht=Gt?-xt:xt;if(Ht<Wt){var Ut=Wt-Ht;Ut<ht&&(ht=Ut,lt=4,rt=I,et=V,_t=L,ct=Gt?-1:1);var Jt=w*T+A*S+k*C,Qt=w*q+A*R+k*E,$t=w*j+A*N+k*D;Jt<0&&(Jt=-Jt),Qt<0&&(Qt=-Qt),$t<0&&($t=-$t);var Kt=(pt=Jt+Qt+$t)+(ft=st),ti=(xt=w*p+A*v+k*m)<0,ii=ti?-xt:xt;if(ii<Kt){var ai,oi,ni,si,ri,ei,_i,hi,li,ci,pi,vi,mi,bi,fi,xi,ui,yi,gi,Xi,zi,Mi=Kt-ii;if(Mi<ht&&(ht=Mi,lt=5,rt=w,et=A,_t=k,ct=ti?-1:1),ht>W.linearSlop?ht-=W.linearSlop:ht=0,oi=x*Y-b*d,ni=b*Z-f*Y,0!=(ai=f*d-x*Z)||0!=oi||0!=ni){var Yi=ai*ai+oi*oi+ni*ni;Yi>0&&(Yi=1/Math.sqrt(Yi));var Zi=(ai*=Yi)*q+(oi*=Yi)*R+(ni*=Yi)*E,di=ai*j+oi*N+ni*D;Zi<0&&(Zi=-Zi),di<0&&(di=-di);var Ii=ai*H+oi*U+ni*J,Vi=ai*Q+oi*$+ni*K;Ii<0&&(Ii=-Ii),Vi<0&&(Vi=-Vi);var Li=(pt=Zi+di)+(ft=Ii+Vi),wi=(xt=ai*p+oi*v+ni*m)<0,Ai=wi?-xt:xt;if(!(Ai<Li))return;var ki=Li-Ai;ki<ht&&(ht=ki,lt=6,rt=ai,et=oi,_t=ni,ct=wi?-1:1)}if(oi=x*I-b*L,ni=b*V-f*I,0!=(ai=f*L-x*V)||0!=oi||0!=ni){var Bi=ai*ai+oi*oi+ni*ni;Bi>0&&(Bi=1/Math.sqrt(Bi));var Pi=(ai*=Bi)*q+(oi*=Bi)*R+(ni*=Bi)*E,Ti=ai*j+oi*N+ni*D;Pi<0&&(Pi=-Pi),Ti<0&&(Ti=-Ti);var Si=ai*F+oi*O+ni*G,Ci=ai*Q+oi*$+ni*K;Si<0&&(Si=-Si),Ci<0&&(Ci=-Ci);var qi=(pt=Pi+Ti)+(ft=Si+Ci),Ri=(xt=ai*p+oi*v+ni*m)<0,Ei=Ri?-xt:xt;if(!(Ei<qi))return;var ji=qi-Ei;ji<ht&&(ht=ji,lt=7,rt=ai,et=oi,_t=ni,ct=Ri?-1:1)}if(oi=x*w-b*k,ni=b*A-f*w,0!=(ai=f*k-x*A)||0!=oi||0!=ni){var Ni=ai*ai+oi*oi+ni*ni;Ni>0&&(Ni=1/Math.sqrt(Ni));var Di=(ai*=Ni)*q+(oi*=Ni)*R+(ni*=Ni)*E,Fi=ai*j+oi*N+ni*D;Di<0&&(Di=-Di),Fi<0&&(Fi=-Fi);var Oi=ai*F+oi*O+ni*G,Wi=ai*H+oi*U+ni*J;Oi<0&&(Oi=-Oi),Wi<0&&(Wi=-Wi);var Gi=(pt=Di+Fi)+(ft=Oi+Wi),Hi=(xt=ai*p+oi*v+ni*m)<0,Ui=Hi?-xt:xt;if(!(Ui<Gi))return;var Ji=Gi-Ui;Ji<ht&&(ht=Ji,lt=8,rt=ai,et=oi,_t=ni,ct=Hi?-1:1)}if(oi=g*Y-u*d,ni=u*Z-y*Y,0!=(ai=y*d-g*Z)||0!=oi||0!=ni){var Qi=ai*ai+oi*oi+ni*ni;Qi>0&&(Qi=1/Math.sqrt(Qi));var $i=(ai*=Qi)*T+(oi*=Qi)*S+(ni*=Qi)*C,Ki=ai*j+oi*N+ni*D;$i<0&&($i=-$i),Ki<0&&(Ki=-Ki);var ta=ai*H+oi*U+ni*J,ia=ai*Q+oi*$+ni*K;ta<0&&(ta=-ta),ia<0&&(ia=-ia);var aa=(pt=$i+Ki)+(ft=ta+ia),oa=(xt=ai*p+oi*v+ni*m)<0,na=oa?-xt:xt;if(!(na<aa))return;var sa=aa-na;sa<ht&&(ht=sa,lt=9,rt=ai,et=oi,_t=ni,ct=oa?-1:1)}if(oi=g*I-u*L,ni=u*V-y*I,0!=(ai=y*L-g*V)||0!=oi||0!=ni){var ra=ai*ai+oi*oi+ni*ni;ra>0&&(ra=1/Math.sqrt(ra));var ea=(ai*=ra)*T+(oi*=ra)*S+(ni*=ra)*C,_a=ai*j+oi*N+ni*D;ea<0&&(ea=-ea),_a<0&&(_a=-_a);var ha=ai*F+oi*O+ni*G,la=ai*Q+oi*$+ni*K;ha<0&&(ha=-ha),la<0&&(la=-la);var ca=(pt=ea+_a)+(ft=ha+la),pa=(xt=ai*p+oi*v+ni*m)<0,va=pa?-xt:xt;if(!(va<ca))return;var ma=ca-va;ma<ht&&(ht=ma,lt=10,rt=ai,et=oi,_t=ni,ct=pa?-1:1)}if(oi=g*w-u*k,ni=u*A-y*w,0!=(ai=y*k-g*A)||0!=oi||0!=ni){var ba=ai*ai+oi*oi+ni*ni;ba>0&&(ba=1/Math.sqrt(ba));var fa=(ai*=ba)*T+(oi*=ba)*S+(ni*=ba)*C,xa=ai*j+oi*N+ni*D;fa<0&&(fa=-fa),xa<0&&(xa=-xa);var ua=ai*F+oi*O+ni*G,ya=ai*H+oi*U+ni*J;ua<0&&(ua=-ua),ya<0&&(ya=-ya);var ga=(pt=fa+xa)+(ft=ua+ya),Xa=(xt=ai*p+oi*v+ni*m)<0,za=Xa?-xt:xt;if(!(za<ga))return;var Ma=ga-za;Ma<ht&&(ht=Ma,lt=11,rt=ai,et=oi,_t=ni,ct=Xa?-1:1)}if(oi=M*Y-X*d,ni=X*Z-z*Y,0!=(ai=z*d-M*Z)||0!=oi||0!=ni){var Ya=ai*ai+oi*oi+ni*ni;Ya>0&&(Ya=1/Math.sqrt(Ya));var Za=(ai*=Ya)*T+(oi*=Ya)*S+(ni*=Ya)*C,da=ai*q+oi*R+ni*E;Za<0&&(Za=-Za),da<0&&(da=-da);var Ia=ai*H+oi*U+ni*J,Va=ai*Q+oi*$+ni*K;Ia<0&&(Ia=-Ia),Va<0&&(Va=-Va);var La=(pt=Za+da)+(ft=Ia+Va),wa=(xt=ai*p+oi*v+ni*m)<0,Aa=wa?-xt:xt;if(!(Aa<La))return;var ka=La-Aa;ka<ht&&(ht=ka,lt=12,rt=ai,et=oi,_t=ni,ct=wa?-1:1)}if(oi=M*I-X*L,ni=X*V-z*I,0!=(ai=z*L-M*V)||0!=oi||0!=ni){var Ba=ai*ai+oi*oi+ni*ni;Ba>0&&(Ba=1/Math.sqrt(Ba));var Pa=(ai*=Ba)*T+(oi*=Ba)*S+(ni*=Ba)*C,Ta=ai*q+oi*R+ni*E;Pa<0&&(Pa=-Pa),Ta<0&&(Ta=-Ta);var Sa=ai*F+oi*O+ni*G,Ca=ai*Q+oi*$+ni*K;Sa<0&&(Sa=-Sa),Ca<0&&(Ca=-Ca);var qa=(pt=Pa+Ta)+(ft=Sa+Ca),Ra=(xt=ai*p+oi*v+ni*m)<0,Ea=Ra?-xt:xt;if(!(Ea<qa))return;var ja=qa-Ea;ja<ht&&(ht=ja,lt=13,rt=ai,et=oi,_t=ni,ct=Ra?-1:1)}if(oi=M*w-X*k,ni=X*A-z*w,0!=(ai=z*k-M*A)||0!=oi||0!=ni){var Na=ai*ai+oi*oi+ni*ni;Na>0&&(Na=1/Math.sqrt(Na));var Da=(ai*=Na)*T+(oi*=Na)*S+(ni*=Na)*C,Fa=ai*q+oi*R+ni*E;Da<0&&(Da=-Da),Fa<0&&(Fa=-Fa);var Oa=ai*F+oi*O+ni*G,Wa=ai*H+oi*U+ni*J;Oa<0&&(Oa=-Oa),Wa<0&&(Wa=-Wa);var Ga=(pt=Da+Fa)+(ft=Oa+Wa),Ha=(xt=ai*p+oi*v+ni*m)<0,Ua=Ha?-xt:xt;if(!(Ua<Ga))return;var Ja=Ga-Ua;Ja<ht&&(ht=Ja,lt=14,rt=ai,et=oi,_t=ni,ct=Ha?-1:1)}if(lt>=6){rt*=ct,et*=ct,_t*=ct;var Qa,$a,Ka,to,io,ao,oo,no,so,ro,eo,_o,ho,lo,co,po=(lt-6)/3|0,vo=lt-6-3*po;switch(po){case 0:oo=b,no=f,so=x;var mo=j*rt+N*et+D*_t>0;q*rt+R*et+E*_t>0?mo?(Qa=q+j,$a=R+N,Ka=E+D):(Qa=q-j,$a=R-N,Ka=E-D):mo?(Qa=j-q,$a=N-R,Ka=D-E):(Qa=-(Qa=q+j),$a=-($a=R+N),Ka=-(Ka=E+D));break;case 1:oo=u,no=y,so=g;var bo=j*rt+N*et+D*_t>0;T*rt+S*et+C*_t>0?bo?(Qa=T+j,$a=S+N,Ka=C+D):(Qa=T-j,$a=S-N,Ka=C-D):bo?(Qa=j-T,$a=N-S,Ka=D-C):(Qa=-(Qa=T+j),$a=-($a=S+N),Ka=-(Ka=C+D));break;default:oo=X,no=z,so=M;var fo=q*rt+R*et+E*_t>0;T*rt+S*et+C*_t>0?fo?(Qa=T+q,$a=S+R,Ka=C+E):(Qa=T-q,$a=S-R,Ka=C-E):fo?(Qa=q-T,$a=R-S,Ka=E-C):(Qa=-(Qa=T+q),$a=-($a=S+R),Ka=-(Ka=C+E))}switch(Qa=r+Qa,$a=e+$a,Ka=_+Ka,vo){case 0:ro=Y,eo=Z,_o=d;var xo=Q*rt+$*et+K*_t>0;H*rt+U*et+J*_t>0?xo?(to=H+Q,io=U+$,ao=J+K):(to=H-Q,io=U-$,ao=J-K):xo?(to=Q-H,io=$-U,ao=K-J):(to=-(to=H+Q),io=-(io=U+$),ao=-(ao=J+K));break;case 1:ro=I,eo=V,_o=L;var uo=Q*rt+$*et+K*_t>0;F*rt+O*et+G*_t>0?uo?(to=F+Q,io=O+$,ao=G+K):(to=F-Q,io=O-$,ao=G-K):uo?(to=Q-F,io=$-O,ao=K-G):(to=-(to=F+Q),io=-(io=O+$),ao=-(ao=G+K));break;default:ro=w,eo=A,_o=k;var yo=H*rt+U*et+J*_t>0;F*rt+O*et+G*_t>0?yo?(to=F+H,io=O+U,ao=G+J):(to=F-H,io=O-U,ao=G-J):yo?(to=H-F,io=U-O,ao=J-G):(to=-(to=F+H),io=-(io=O+U),ao=-(ao=G+J))}var go,Xo,zo,Mo,Yo,Zo,Io,Vo,Lo,wo=oo*ro+no*eo+so*_o,Ao=oo*(ho=Qa-(to=h-to))+no*(lo=$a-(io=l-io))+so*(co=Ka-(ao=c-ao)),ko=ro*ho+eo*lo+_o*co,Bo=1/(1-wo*wo),Po=(wo*ko-Ao)*Bo,To=(ko-wo*Ao)*Bo;return go=Qa+oo*Po,Xo=$a+no*Po,zo=Ka+so*Po,Mo=to+ro*To,Yo=io+eo*To,Zo=ao+_o*To,Io=-rt,Vo=-et,Lo=-_t,this.setNormal(t,Io,Vo,Lo),void this.addPoint(t,go,Xo,zo,Mo,Yo,Zo,ht,4)}if(lt>=3){ct=-ct,p=-p,v=-v,m=-m;var So=B;B=P,P=So;var Co=tt;tt=ot,ot=Co;var qo=it;it=nt,nt=qo;var Ro=at;at=st,st=Ro,si=r,ri=e,ei=_,r=h,e=l,_=c,h=si,l=ri,c=ei,si=b,ri=f,ei=x,b=Y,f=Z,x=d,Y=si,Z=ri,d=ei,si=u,ri=y,ei=g,u=I,y=V,g=L,I=si,V=ri,L=ei,si=X,ri=z,ei=M,X=w,z=A,M=k,w=si,A=ri,k=ei,si=T,ri=S,ei=C,T=F,S=O,C=G,F=si,O=ri,G=ei,si=q,ri=R,ei=E,q=H,R=U,E=J,H=si,U=ri,J=ei,si=j,ri=N,ei=D,j=Q,N=$,D=K,Q=si,$=ri,K=ei,lt-=3,_i=!0}else _i=!1;switch(lt){case 0:hi=T,li=S,ci=C,pi=b,vi=f,mi=x,bi=u,fi=y,xi=g,ui=X,yi=z,gi=M,Xi=it,zi=at;break;case 1:hi=q,li=R,ci=E,pi=u,vi=y,mi=g,bi=X,fi=z,xi=M,ui=b,yi=f,gi=x,Xi=at,zi=tt;break;default:hi=j,li=N,ci=D,pi=X,vi=z,mi=M,bi=b,fi=f,xi=x,ui=u,yi=y,gi=g,Xi=tt,zi=it}if(ct<0){hi=-hi,li=-li,ci=-ci,pi=-pi,vi=-vi,mi=-mi,si=bi,ri=fi,ei=xi,bi=ui,fi=yi,xi=gi,ui=si,yi=ri,gi=ei;var Eo=Xi;Xi=zi,zi=Eo}hi+=r,li+=e,ci+=_;var jo,No,Do,Fo,Oo,Wo,Go,Ho,Uo,Jo,Qo,$o,Ko=1,tn=0,an=pi*Y+vi*Z+mi*d;switch(an<Ko&&(Ko=an,tn=0),-an<Ko&&(Ko=-an,tn=1),(an=pi*I+vi*V+mi*L)<Ko&&(Ko=an,tn=2),-an<Ko&&(Ko=-an,tn=3),(an=pi*w+vi*A+mi*k)<Ko&&(Ko=an,tn=4),-an<Ko&&(Ko=-an,tn=5),tn){case 0:jo=F+H,No=O+U,Do=G+J,jo+=Q,No+=$,Do+=K,Fo=F-H,Oo=O-U,Wo=G-J,Fo+=Q,Oo+=$,Wo+=K,Go=F-H,Ho=O-U,Uo=G-J,Go-=Q,Ho-=$,Uo-=K,Jo=F+H,Qo=O+U,$o=G+J,Jo-=Q,Qo-=$,$o-=K;break;case 1:jo=H-F,No=U-O,Do=J-G,jo+=Q,No+=$,Do+=K,Fo=H-F,Oo=U-O,Wo=J-G,Fo-=Q,Oo-=$,Wo-=K,Go=-(Go=F+H),Ho=-(Ho=O+U),Uo=-(Uo=G+J),Go-=Q,Ho-=$,Uo-=K,Jo=-(Jo=F+H),Qo=-(Qo=O+U),$o=-($o=G+J),Jo+=Q,Qo+=$,$o+=K;break;case 2:jo=F+H,No=O+U,Do=G+J,jo+=Q,No+=$,Do+=K,Fo=F+H,Oo=O+U,Wo=G+J,Fo-=Q,Oo-=$,Wo-=K,Go=H-F,Ho=U-O,Uo=J-G,Go-=Q,Ho-=$,Uo-=K,Jo=H-F,Qo=U-O,$o=J-G,Jo+=Q,Qo+=$,$o+=K;break;case 3:jo=F-H,No=O-U,Do=G-J,jo+=Q,No+=$,Do+=K,Fo=-(Fo=F+H),Oo=-(Oo=O+U),Wo=-(Wo=G+J),Fo+=Q,Oo+=$,Wo+=K,Go=-(Go=F+H),Ho=-(Ho=O+U),Uo=-(Uo=G+J),Go-=Q,Ho-=$,Uo-=K,Jo=F-H,Qo=O-U,$o=G-J,Jo-=Q,Qo-=$,$o-=K;break;case 4:jo=F+H,No=O+U,Do=G+J,jo+=Q,No+=$,Do+=K,Fo=H-F,Oo=U-O,Wo=J-G,Fo+=Q,Oo+=$,Wo+=K,Go=-(Go=F+H),Ho=-(Ho=O+U),Uo=-(Uo=G+J),Go+=Q,Ho+=$,Uo+=K,Jo=F-H,Qo=O-U,$o=G-J,Jo+=Q,Qo+=$,$o+=K;break;default:jo=F+H,No=O+U,Do=G+J,jo-=Q,No-=$,Do-=K,Fo=F-H,Oo=O-U,Wo=G-J,Fo-=Q,Oo-=$,Wo-=K,Go=-(Go=F+H),Ho=-(Ho=O+U),Uo=-(Uo=G+J),Go-=Q,Ho-=$,Uo-=K,Jo=H-F,Qo=U-O,$o=J-G,Jo-=Q,Qo-=$,$o-=K}jo+=p,No+=v,Do+=m,Fo+=p,Oo+=v,Wo+=m,Go+=p,Ho+=v,Uo+=m,Jo+=p,Qo+=v,$o+=m;var on=this.clipper;on.w=Xi,on.h=zi,on.numVertices=0,on.numTmpVertices=0;var nn=this.clipper,sn=nn.vertices[nn.numVertices++];sn.x=jo*bi+No*fi+Do*xi,sn.y=jo*ui+No*yi+Do*gi,sn.wx=jo,sn.wy=No,sn.wz=Do;var rn=this.clipper,en=rn.vertices[rn.numVertices++];en.x=Fo*bi+Oo*fi+Wo*xi,en.y=Fo*ui+Oo*yi+Wo*gi,en.wx=Fo,en.wy=Oo,en.wz=Wo;var _n=this.clipper,hn=_n.vertices[_n.numVertices++];hn.x=Go*bi+Ho*fi+Uo*xi,hn.y=Go*ui+Ho*yi+Uo*gi,hn.wx=Go,hn.wy=Ho,hn.wz=Uo;var ln,cn,pn,vn=this.clipper,mn=vn.vertices[vn.numVertices++];mn.x=Jo*bi+Qo*fi+$o*xi,mn.y=Jo*ui+Qo*yi+$o*gi,mn.wx=Jo,mn.wy=Qo,mn.wz=$o,this.clipper.clip(),this.clipper.reduce(),_i?(ln=pi,cn=vi,pn=mi):(ln=-pi,cn=-vi,pn=-mi),this.setNormal(t,ln,cn,pn);for(var bn=0,fn=this.clipper.numVertices;bn<fn;){var xn,un,yn,gn=bn++,Xn=this.clipper.vertices[gn];xn=Xn.wx,un=Xn.wy,yn=Xn.wz;var zn,Mn,Yn,Zn=(hi-(xn+=r))*pi+(li-(un+=e))*vi+(ci-(yn+=_))*mi;zn=xn+pi*Zn,Mn=un+vi*Zn,Yn=yn+mi*Zn,Zn>-W.contactPersistenceThreshold&&(_i?this.addPoint(t,xn,un,yn,zn,Mn,Yn,Zn,gn):this.addPoint(t,zn,Mn,Yn,xn,un,yn,Zn,gn))}}}}}}}}});var A=function(){this.x=0,this.y=0,this.wx=0,this.wy=0,this.wz=0},k=function(){this.w=0,this.h=0,this.numVertices=0,this.numTmpVertices=0;var t=new Array(8);this.vertices=t;var i=new Array(8);this.tmpVertices=i;for(var a=0;a<8;){var o=a++;this.vertices[o]=new A,this.tmpVertices[o]=new A}};k.prototype={clip:function(){for(var t=0,i=this.numVertices;t<i;){var a=t++,o=this.vertices[a],n=this.vertices[(a+1)%this.numVertices],s=this.w+o.x,r=this.w+n.x;if(s>0&&r>0){var e=this.tmpVertices[this.numTmpVertices++];e.x=o.x,e.y=o.y,e.wx=o.wx,e.wy=o.wy,e.wz=o.wz}else if(s>0&&r<=0){var _=this.tmpVertices[this.numTmpVertices++];_.x=o.x,_.y=o.y,_.wx=o.wx,_.wy=o.wy,_.wz=o.wz;var h=s/(s-r),l=this.tmpVertices[this.numTmpVertices++];l.x=o.x+(n.x-o.x)*h,l.y=o.y+(n.y-o.y)*h,l.wx=o.wx+(n.wx-o.wx)*h,l.wy=o.wy+(n.wy-o.wy)*h,l.wz=o.wz+(n.wz-o.wz)*h}else if(s<=0&&r>0){var c=s/(s-r),p=this.tmpVertices[this.numTmpVertices++];p.x=o.x+(n.x-o.x)*c,p.y=o.y+(n.y-o.y)*c,p.wx=o.wx+(n.wx-o.wx)*c,p.wy=o.wy+(n.wy-o.wy)*c,p.wz=o.wz+(n.wz-o.wz)*c}}var v=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=v,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;for(var m=0,b=this.numVertices;m<b;){var f=m++,x=this.vertices[f],u=this.vertices[(f+1)%this.numVertices],y=this.w-x.x,g=this.w-u.x;if(y>0&&g>0){var X=this.tmpVertices[this.numTmpVertices++];X.x=x.x,X.y=x.y,X.wx=x.wx,X.wy=x.wy,X.wz=x.wz}else if(y>0&&g<=0){var z=this.tmpVertices[this.numTmpVertices++];z.x=x.x,z.y=x.y,z.wx=x.wx,z.wy=x.wy,z.wz=x.wz;var M=y/(y-g),Y=this.tmpVertices[this.numTmpVertices++];Y.x=x.x+(u.x-x.x)*M,Y.y=x.y+(u.y-x.y)*M,Y.wx=x.wx+(u.wx-x.wx)*M,Y.wy=x.wy+(u.wy-x.wy)*M,Y.wz=x.wz+(u.wz-x.wz)*M}else if(y<=0&&g>0){var Z=y/(y-g),d=this.tmpVertices[this.numTmpVertices++];d.x=x.x+(u.x-x.x)*Z,d.y=x.y+(u.y-x.y)*Z,d.wx=x.wx+(u.wx-x.wx)*Z,d.wy=x.wy+(u.wy-x.wy)*Z,d.wz=x.wz+(u.wz-x.wz)*Z}}var I=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=I,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;for(var V=0,L=this.numVertices;V<L;){var w=V++,A=this.vertices[w],k=this.vertices[(w+1)%this.numVertices],B=this.h+A.y,P=this.h+k.y;if(B>0&&P>0){var T=this.tmpVertices[this.numTmpVertices++];T.x=A.x,T.y=A.y,T.wx=A.wx,T.wy=A.wy,T.wz=A.wz}else if(B>0&&P<=0){var S=this.tmpVertices[this.numTmpVertices++];S.x=A.x,S.y=A.y,S.wx=A.wx,S.wy=A.wy,S.wz=A.wz;var C=B/(B-P),q=this.tmpVertices[this.numTmpVertices++];q.x=A.x+(k.x-A.x)*C,q.y=A.y+(k.y-A.y)*C,q.wx=A.wx+(k.wx-A.wx)*C,q.wy=A.wy+(k.wy-A.wy)*C,q.wz=A.wz+(k.wz-A.wz)*C}else if(B<=0&&P>0){var R=B/(B-P),E=this.tmpVertices[this.numTmpVertices++];E.x=A.x+(k.x-A.x)*R,E.y=A.y+(k.y-A.y)*R,E.wx=A.wx+(k.wx-A.wx)*R,E.wy=A.wy+(k.wy-A.wy)*R,E.wz=A.wz+(k.wz-A.wz)*R}}var j=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=j,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;for(var N=0,D=this.numVertices;N<D;){var F=N++,O=this.vertices[F],W=this.vertices[(F+1)%this.numVertices],G=this.h-O.y,H=this.h-W.y;if(G>0&&H>0){var U=this.tmpVertices[this.numTmpVertices++];U.x=O.x,U.y=O.y,U.wx=O.wx,U.wy=O.wy,U.wz=O.wz}else if(G>0&&H<=0){var J=this.tmpVertices[this.numTmpVertices++];J.x=O.x,J.y=O.y,J.wx=O.wx,J.wy=O.wy,J.wz=O.wz;var Q=G/(G-H),$=this.tmpVertices[this.numTmpVertices++];$.x=O.x+(W.x-O.x)*Q,$.y=O.y+(W.y-O.y)*Q,$.wx=O.wx+(W.wx-O.wx)*Q,$.wy=O.wy+(W.wy-O.wy)*Q,$.wz=O.wz+(W.wz-O.wz)*Q}else if(G<=0&&H>0){var K=G/(G-H),tt=this.tmpVertices[this.numTmpVertices++];tt.x=O.x+(W.x-O.x)*K,tt.y=O.y+(W.y-O.y)*K,tt.wx=O.wx+(W.wx-O.wx)*K,tt.wy=O.wy+(W.wy-O.wy)*K,tt.wz=O.wz+(W.wz-O.wz)*K}}var it=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=it,this.numVertices=this.numTmpVertices,this.numTmpVertices=0},reduce:function(){if(!(this.numVertices<4)){for(var t=-1/0,i=1/0,a=-1/0,o=1/0,n=null,s=null,r=null,e=null,_=0,h=this.numVertices;_<h;){var l=_++,c=this.vertices[l],p=1*c.x+1*c.y,v=-1*c.x+1*c.y;p>t&&(t=p,n=c),p<i&&(i=p,s=c),v>a&&(a=v,r=c),v<o&&(o=v,e=c)}var m=this.tmpVertices[this.numTmpVertices++];m.x=n.x,m.y=n.y,m.wx=n.wx,m.wy=n.wy,m.wz=n.wz;var b=this.tmpVertices[this.numTmpVertices++];b.x=r.x,b.y=r.y,b.wx=r.wx,b.wy=r.wy,b.wz=r.wz;var f=this.tmpVertices[this.numTmpVertices++];f.x=s.x,f.y=s.y,f.wx=s.wx,f.wy=s.wy,f.wz=s.wz;var x=this.tmpVertices[this.numTmpVertices++];x.x=e.x,x.y=e.y,x.wx=e.wx,x.wy=e.wy,x.wz=e.wz;var u=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=u,this.numVertices=this.numTmpVertices,this.numTmpVertices=0}}};var B=function(){};B.prototype={_clear:function(){null!=this._gjkCache&&this._gjkCache.clear()}};var P=function(){L.call(this,!1)};P.__super__=L,P.prototype=$extend(L.prototype,{detectImpl:function(t,i,a,o,n,s){var r,e,_,h,l,c,p=i,v=a;t.incremental=!1,r=o._rotation01,e=o._rotation11,_=o._rotation21,h=n._rotation01,l=n._rotation11,c=n._rotation21;var m,b,f,x,u,y,g,X,z,M,Y,Z,d,I,V,L,w,A,k=p._halfHeight,B=v._halfHeight,P=p._radius,T=v._radius;m=o._positionX+r*-k,b=o._positionY+e*-k,f=o._positionZ+_*-k,x=o._positionX+r*k,u=o._positionY+e*k,y=o._positionZ+_*k;var S,C,q,R,E,j,N,D,F,O,W,G=-((M=m-(g=n._positionX+h*-B))*(d=x-m)+(Y=b-(X=n._positionY+l*-B))*(I=u-b)+(Z=f-(z=n._positionZ+c*-B))*(V=y-f)),H=M*(L=n._positionX+h*B-g)+Y*(w=n._positionY+l*B-X)+Z*(A=n._positionZ+c*B-z),U=k*k*4,J=d*L+I*w+V*A,Q=B*B*4;if(0==U&&0==Q)S=0,C=0;else if(0==U)S=0,(C=H)<0?C=0:C>Q?C=1:C/=Q;else if(0==Q)C=0,(S=G)<0?S=0:S>U?S=1:S/=U;else{var $=U*Q-J*J;0==$?S=0:(S=J*H+Q*G)<0?S=0:S>$?S=1:S/=$,(C=S*J+H)<0?(C=0,(S=G)<0?S=0:S>U?S=1:S/=U):C>Q?(C=1,(S=J+G)<0?S=0:S>U?S=1:S/=U):C/=Q}var K=(F=(q=m+d*S)-(j=g+L*C))*F+(O=(R=b+I*S)-(N=X+w*C))*O+(W=(E=f+V*S)-(D=z+A*C))*W;if(!(K>=(P+T)*(P+T))){var tt,it,at,ot,nt,st,rt,et,_t,ht=Math.sqrt(K);ht>0?(tt=F*(1/ht),it=O*(1/ht),at=W*(1/ht)):(tt=1,it=0,at=0),this.setNormal(t,tt,it,at),ot=q+tt*-P,nt=R+it*-P,st=E+at*-P,rt=j+tt*T,et=N+it*T,_t=D+at*T,this.addPoint(t,ot,nt,st,rt,et,_t,P+T-ht,0)}}});var T=function(){L.call(this,!1)};T.__super__=L,T.prototype=$extend(L.prototype,{detectImpl:function(t,i,a,o,n,s){var r=G.instance,e=i,_=a,h=r.computeClosestPointsImpl(e,_,o,n,W.enableGJKCaching?s:null,!0);if(t.incremental=!0,h==H.SUCCEEDED){var l=e._gjkMargin,c=_._gjkMargin;if(!(r.distance>l+c)){var p,v,m,b,f,x,u=r.closestPoint1;p=u.x,v=u.y,m=u.z;var y,g,X,z=r.closestPoint2;if((y=p-(b=z.x))*y+(g=v-(f=z.y))*g+(X=m-(x=z.z))*X!=0){r.distance<0&&(y=-y,g=-g,X=-X);var M=y*y+g*g+X*X;M>0&&(M=1/Math.sqrt(M)),y*=M,g*=M,X*=M,this.setNormal(t,y,g,X),p+=y*-e._gjkMargin,v+=g*-e._gjkMargin,m+=X*-e._gjkMargin,b+=y*_._gjkMargin,f+=g*_._gjkMargin,x+=X*_._gjkMargin,this.addPoint(t,p,v,m,b,f,x,e._gjkMargin+_._gjkMargin-r.distance,0)}}}else console.log("GjkEpaDetector.hx:28:","GJK/EPA failed: status="+h)}});var S=function(t){L.call(this,t)};S.__super__=L,S.prototype=$extend(L.prototype,{detectImpl:function(t,i,a,o,n,s){var r,e,_,h,l,c,p=i,v=a;t.incremental=!1,h=-(r=v._halfExtentsX),l=-(e=v._halfExtentsY),c=-(_=v._halfExtentsZ);var m,b,f,x,u,y,g,X,z,M,Y=p._radius;if(m=o._positionX-n._positionX,b=o._positionY-n._positionY,f=o._positionZ-n._positionZ,g=n._rotation00*m+n._rotation10*b+n._rotation20*f,u=n._rotation01*m+n._rotation11*b+n._rotation21*f,y=n._rotation02*m+n._rotation12*b+n._rotation22*f,h<(x=g)&&r>x&&l<u&&e>u&&c<y&&_>y){var Z,d,I,V,L,w,A,k,B,P,T,S,C,q,R,E,j,N,D,F,O,W,G,H,U;Z=r-(Z=x<0?-x:x),d=e-(d=u<0?-u:u),I=_-(I=y<0?-y:y);return Z<d?Z<I?(x>0?(V=1,L=0,w=0):(V=-1,L=0,w=0),k=0,B=1,P=1,A=Z):(y>0?(V=0,L=0,w=1):(V=0,L=0,w=-1),k=1,B=1,P=0,A=I):d<I?(u>0?(V=0,L=1,w=0):(V=0,L=-1,w=0),k=1,B=0,P=1,A=d):(y>0?(V=0,L=0,w=1):(V=0,L=0,w=-1),k=1,B=1,P=0,A=I),T=V*r,S=L*e,C=w*_,T+=k*x,S+=B*u,C+=P*y,q=n._rotation00*T+n._rotation01*S+n._rotation02*C,R=n._rotation10*T+n._rotation11*S+n._rotation12*C,E=n._rotation20*T+n._rotation21*S+n._rotation22*C,j=n._rotation00*V+n._rotation01*L+n._rotation02*w,N=n._rotation10*V+n._rotation11*L+n._rotation12*w,D=n._rotation20*V+n._rotation21*L+n._rotation22*w,this.setNormal(t,j,N,D),F=o._positionX+j*-Y,O=o._positionY+N*-Y,W=o._positionZ+D*-Y,G=n._positionX+q,H=n._positionY+R,U=n._positionZ+E,void this.addPoint(t,F,O,W,G,H,U,A,0)}var J,Q,$;var K=(J=x-(X=(X=x<(r-=1e-9)?x:r)>(h+=1e-9)?X:h))*J+(Q=u-(z=(z=u<(e-=1e-9)?u:e)>(l+=1e-9)?z:l))*Q+($=y-(M=(M=y<(_-=1e-9)?y:_)>(c+=1e-9)?M:c))*$;if(!(K>=Y*Y)){var tt,it,at,ot,nt,st,rt,et,_t;K=Math.sqrt(K),tt=n._rotation00*X+n._rotation01*z+n._rotation02*M,it=n._rotation10*X+n._rotation11*z+n._rotation12*M,at=n._rotation20*X+n._rotation21*z+n._rotation22*M;var ht,lt,ct,pt,vt,mt,bt=(ot=n._rotation00*J+n._rotation01*Q+n._rotation02*$)*ot+(nt=n._rotation10*J+n._rotation11*Q+n._rotation12*$)*nt+(st=n._rotation20*J+n._rotation21*Q+n._rotation22*$)*st;bt>0&&(bt=1/Math.sqrt(bt)),rt=ot*bt,et=nt*bt,_t=st*bt,this.setNormal(t,rt,et,_t),ht=o._positionX+rt*-Y,lt=o._positionY+et*-Y,ct=o._positionZ+_t*-Y,pt=n._positionX+tt,vt=n._positionY+it,mt=n._positionZ+at,this.addPoint(t,ht,lt,ct,pt,vt,mt,Y-K,0)}}});var C=function(t){L.call(this,t)};C.__super__=L,C.prototype=$extend(L.prototype,{detectImpl:function(t,i,a,o,n,s){var r=i,e=a;t.incremental=!1;var _,h,l,c,p,v,m,b,f,x,u,y,g=e._halfHeight,X=r._radius,z=e._radius;_=n._rotation01,h=n._rotation11,l=n._rotation21,c=o._positionX,p=o._positionY,v=o._positionZ,m=n._positionX+_*-g,b=n._positionY+h*-g,f=n._positionZ+l*-g;var M,Y,Z,d,I,V,L=g*g*4,w=(c-m)*(x=n._positionX+_*g-m)+(p-b)*(u=n._positionY+h*g-b)+(v-f)*(y=n._positionZ+l*g-f);w<0?w=0:w>L?w=1:w/=L;var A=(d=c-(M=m+x*w))*d+(I=p-(Y=b+u*w))*I+(V=v-(Z=f+y*w))*V;if(!(A>=(X+z)*(X+z))){var k,B,P,T,S,C,q,R,E,j=Math.sqrt(A);j>0?(k=d*(1/j),B=I*(1/j),P=V*(1/j)):(k=1,B=0,P=0),this.setNormal(t,k,B,P),T=c+k*-X,S=p+B*-X,C=v+P*-X,q=M+k*z,R=Y+B*z,E=Z+P*z,this.addPoint(t,T,S,C,q,R,E,X+z-j,0)}}});var q=function(){L.call(this,!1)};q.__super__=L,q.prototype=$extend(L.prototype,{detectImpl:function(t,i,a,o,n,s){var r,e,_,h=i,l=a;t.incremental=!1,r=o._positionX-n._positionX,e=o._positionY-n._positionY,_=o._positionZ-n._positionZ;var c=h._radius,p=l._radius,v=r*r+e*e+_*_;if(!(v>=(c+p)*(c+p))){var m,b,f,x,u,y,g,X,z,M=Math.sqrt(v);M>0?(m=r*(1/M),b=e*(1/M),f=_*(1/M)):(m=1,b=0,f=0),this.setNormal(t,m,b,f),x=o._positionX+m*-c,u=o._positionY+b*-c,y=o._positionZ+f*-c,g=n._positionX+m*p,X=n._positionY+b*p,z=n._positionZ+f*p,this.addPoint(t,x,u,y,g,X,z,c+p-M,0)}}});var R=function(){var t=W.maxEPAVertices,i=new Array(t);this._vertices=i,this._center=new F,this._numVertices=0,this._triangleList=null,this._triangleListLast=null,this._numTriangles=0,this._trianglePool=null,this._vertexPool=null};R.prototype={dumpHoleEdge:function(t){},validate:function(){for(var t=this._triangleList;null!=t;){for(var i=t._next,a=0;a<3;){var o=a++;if(t._vertices[o]._tmpEdgeLoopOuterTriangle=null,t._vertices[o]._tmpEdgeLoopNext=null,-1==t._adjacentPairIndex[o])return this._status=2,!1;if(null==t._adjacentTriangles[o])return this._status=3,!1}t=i}return!0},findEdgeLoop:function(t,i,a){if(i._tmpDfsId!=t){i._tmpDfsId=t;var o=i.tmp;o.x=a.x,o.y=a.y,o.z=a.z;var n=o,s=i._vertices[0].v,r=n.x-s.x,e=n.y-s.y,_=n.z-s.z;n.x=r,n.y=e,n.z=_;var h=i.tmp,l=i._normal;if(i._tmpDfsVisible=h.x*l.x+h.y*l.y+h.z*l.z>0,i._tmpDfsVisible){for(var c=0;c<3;){var p=c++,v=i._adjacentTriangles[p];if(null!=v){var m=v.tmp;m.x=a.x,m.y=a.y,m.z=a.z;var b=m,f=v._vertices[0].v,x=b.x-f.x,u=b.y-f.y,y=b.z-f.z;b.x=x,b.y=u,b.z=y;var g=v.tmp,X=v._normal;if(v._tmpDfsVisible=g.x*X.x+g.y*X.y+g.z*X.z>0,v._tmpDfsVisible)this.findEdgeLoop(t,v,a);else{var z=i._nextIndex[p],M=i._vertices[p],Y=i._vertices[z];M._tmpEdgeLoopNext=Y,M._tmpEdgeLoopOuterTriangle=v}}}for(var Z=0;Z<3;){var d=Z++,I=i._adjacentTriangles[d];if(null!=I){var V=i._adjacentPairIndex[d];I._adjacentTriangles[V]=null,I._adjacentPairIndex[V]=-1,i._adjacentTriangles[d]=null,i._adjacentPairIndex[d]=-1}}this._numTriangles--;var L=i._prev,w=i._next;null!=L&&(L._next=w),null!=w&&(w._prev=L),i==this._triangleList&&(this._triangleList=this._triangleList._next),i==this._triangleListLast&&(this._triangleListLast=this._triangleListLast._prev),i._next=null,i._prev=null,i.removeReferences(),i._next=this._trianglePool,this._trianglePool=i}else this._status=6}},_init:function(t,i,a,o){this._status=0,this._numVertices=4,this._vertices[0]=t,this._vertices[1]=i,this._vertices[2]=a,this._vertices[3]=o;var n=this._center,s=t.v;n.x=s.x,n.y=s.y,n.z=s.z;var r=n,e=i.v,_=r.x+e.x,h=r.y+e.y,l=r.z+e.z;r.x=_,r.y=h,r.z=l;var c=r,p=a.v,v=c.x+p.x,m=c.y+p.y,b=c.z+p.z;c.x=v,c.y=m,c.z=b;var f=c,x=o.v,u=f.x+x.x,y=f.y+x.y,g=f.z+x.z;f.x=u,f.y=y,f.z=g;var X=f,z=.25*X.x,M=.25*X.y,Y=.25*X.z;X.x=z,X.y=M,X.z=Y;var Z=this._trianglePool;null!=Z?(this._trianglePool=Z._next,Z._next=null):Z=new j;var d=Z,I=this._trianglePool;null!=I?(this._trianglePool=I._next,I._next=null):I=new j;var V=I,L=this._trianglePool;null!=L?(this._trianglePool=L._next,L._next=null):L=new j;var w=L,A=this._trianglePool;null!=A?(this._trianglePool=A._next,A._next=null):A=new j;var k=A;return d.init(t,i,a,this._center,!0)||(this._status=1),V.init(t,i,o,this._center,!0)||(this._status=1),w.init(t,a,o,this._center,!0)||(this._status=1),k.init(i,a,o,this._center,!0)||(this._status=1),d.setAdjacentTriangle(V)||(this._status=1),d.setAdjacentTriangle(w)||(this._status=1),d.setAdjacentTriangle(k)||(this._status=1),V.setAdjacentTriangle(w)||(this._status=1),V.setAdjacentTriangle(k)||(this._status=1),w.setAdjacentTriangle(k)||(this._status=1),this._numTriangles++,null==this._triangleList?(this._triangleList=d,this._triangleListLast=d):(this._triangleListLast._next=d,d._prev=this._triangleListLast,this._triangleListLast=d),this._numTriangles++,null==this._triangleList?(this._triangleList=V,this._triangleListLast=V):(this._triangleListLast._next=V,V._prev=this._triangleListLast,this._triangleListLast=V),this._numTriangles++,null==this._triangleList?(this._triangleList=w,this._triangleListLast=w):(this._triangleListLast._next=w,w._prev=this._triangleListLast,this._triangleListLast=w),this._numTriangles++,null==this._triangleList?(this._triangleList=k,this._triangleListLast=k):(this._triangleListLast._next=k,k._prev=this._triangleListLast,this._triangleListLast=k),0==this._status},_addVertex:function(t,i){this._vertices[this._numVertices++]=t;var a=i._vertices[0];if(this.findEdgeLoop(this._numVertices,i,t.v),0!=this._status)return!1;for(var o=a,n=a,s=null,r=null;;){if(null==o._tmpEdgeLoopNext)return this._dumpAsObjModel(),this._status=4,!1;if(null==o._tmpEdgeLoopOuterTriangle)return this._status=5,!1;var e=this._trianglePool;null!=e?(this._trianglePool=e._next,e._next=null):e=new j;var _=e;if(null==r&&(r=_),_.init(o,o._tmpEdgeLoopNext,t,this._center,!1)||(this._status=1),0!=this._status)return!1;if(this._numTriangles++,null==this._triangleList?(this._triangleList=_,this._triangleListLast=_):(this._triangleListLast._next=_,_._prev=this._triangleListLast,this._triangleListLast=_),_.setAdjacentTriangle(o._tmpEdgeLoopOuterTriangle)||(this._status=1),null!=s&&(_.setAdjacentTriangle(s)||(this._status=1)),s=_,(o=o._tmpEdgeLoopNext)==n)break}return s.setAdjacentTriangle(r)||(this._status=1),0==this._status&&this.validate()},_dumpAsObjModel:function(){}};var E=function(){},j=function(){this.id=++j.count,this._next=null,this._prev=null,this._normal=new F,this._distanceSq=0,this._tmpDfsId=0,this._tmpDfsVisible=!1;var t=new Array(3);this._vertices=t;var i=new Array(3);this._adjacentTriangles=i;var a=new Array(3);this._adjacentPairIndex=a,this.tmp=new F;var o=new Array(3);this._nextIndex=o,this._nextIndex[0]=1,this._nextIndex[1]=2,this._nextIndex[2]=0};j.prototype={init:function(t,i,a,o,n){var s,r,e,_,h,l,c,p,v;null==n&&(n=!1);var m=t.v;s=m.x,r=m.y,e=m.z;var b=i.v;_=b.x,h=b.y,l=b.z;var f=a.v;c=f.x,p=f.y,v=f.z;var x,u,y,g,X,z,M,Y,Z,d=o,I=!1;if((s-d.x)*(M=(u=h-r)*(z=v-e)-(y=l-e)*(X=p-r))+(r-d.y)*(Y=y*(g=c-s)-(x=_-s)*z)+(e-d.z)*(Z=x*X-u*g)<0)if(n){var V=i;i=a,a=V,M*=-1,Y*=-1,Z*=-1}else I=!0;this._vertices[0]=t,this._vertices[1]=i,this._vertices[2]=a;var L=this._normal;L.x=M,L.y=Y,L.z=Z;var w,A,k,B,P,T,S,C,q,R,E,j,N,D,F,O,W,G,H=t.v,U=i.v,J=a.v,Q=this.tmp,$=H;w=$.x,A=$.y,k=$.z;var K=U;B=K.x,P=K.y,T=K.z;var tt,it,at,ot=J;S=ot.x;var nt,st,rt,et=B*((D=(C=ot.y)-P)*(at=(R=B-w)*D-(E=P-A)*(N=S-B))-(F=(q=ot.z)-T)*(it=(j=T-k)*N-R*F))+P*(F*(tt=E*F-j*D)-N*at)+T*(N*it-D*tt),_t=S*((W=A-C)*at-(G=k-q)*it)+C*(G*tt-(O=w-S)*at)+q*(O*it-W*tt),ht=-1;if(nt=0,st=0,rt=0,w*(E*at-j*it)+A*(j*tt-R*at)+k*(R*it-E*tt)<0){var lt,ct,pt,vt,mt,bt,ft=H;lt=ft.x,ct=ft.y,pt=ft.z;var xt,ut,yt,gt,Xt=U,zt=(xt=(vt=Xt.x)-lt)*lt+(ut=(mt=Xt.y)-ct)*ct+(yt=(bt=Xt.z)-pt)*pt;if((zt=-zt/(xt*xt+ut*ut+yt*yt))<0){var Mt=Q;Mt.x=lt,Mt.y=ct,Mt.z=pt,gt=1}else if(zt>1){var Yt=Q;Yt.x=vt,Yt.y=mt,Yt.z=bt,gt=2}else{var Zt,dt,It;Zt=lt+xt*zt,dt=ct+ut*zt,It=pt+yt*zt;var Vt=Q;Vt.x=Zt,Vt.y=dt,Vt.z=It,gt=3}gt,ht=Q.x*Q.x+Q.y*Q.y+Q.z*Q.z;var Lt=Q;nt=Lt.x,st=Lt.y,rt=Lt.z}if(et<0){var wt,At,kt,Bt,Pt,Tt,St=U;wt=St.x,At=St.y,kt=St.z;var Ct,qt,Rt,Et,jt=J,Nt=(Ct=(Bt=jt.x)-wt)*wt+(qt=(Pt=jt.y)-At)*At+(Rt=(Tt=jt.z)-kt)*kt;if((Nt=-Nt/(Ct*Ct+qt*qt+Rt*Rt))<0){var Dt=Q;Dt.x=wt,Dt.y=At,Dt.z=kt,Et=1}else if(Nt>1){var Ft=Q;Ft.x=Bt,Ft.y=Pt,Ft.z=Tt,Et=2}else{var Ot,Wt,Gt;Ot=wt+Ct*Nt,Wt=At+qt*Nt,Gt=kt+Rt*Nt;var Ht=Q;Ht.x=Ot,Ht.y=Wt,Ht.z=Gt,Et=3}var Ut=Q.x*Q.x+Q.y*Q.y+Q.z*Q.z;if(ht<0||Ut<ht){Et<<1,ht=Ut;var Jt=Q;nt=Jt.x,st=Jt.y,rt=Jt.z}}if(_t<0){var Qt,$t,Kt,ti,ii,ai,oi=H;Qt=oi.x,$t=oi.y,Kt=oi.z;var ni,si,ri,ei,_i=J,hi=(ni=(ti=_i.x)-Qt)*Qt+(si=(ii=_i.y)-$t)*$t+(ri=(ai=_i.z)-Kt)*Kt;if((hi=-hi/(ni*ni+si*si+ri*ri))<0){var li=Q;li.x=Qt,li.y=$t,li.z=Kt,ei=1}else if(hi>1){var ci=Q;ci.x=ti,ci.y=ii,ci.z=ai,ei=2}else{var pi,vi,mi;pi=Qt+ni*hi,vi=$t+si*hi,mi=Kt+ri*hi;var bi=Q;bi.x=pi,bi.y=vi,bi.z=mi,ei=3}var fi=Q.x*Q.x+Q.y*Q.y+Q.z*Q.z;if(ht<0||fi<ht){1&ei|(2&ei)<<1,ht=fi;var xi=Q;nt=xi.x,st=xi.y,rt=xi.z}}if(ht>0){var ui=Q;ui.x=nt,ui.y=st,ui.z=rt}else{var yi=tt*tt+it*it+at*at;yi>0&&(yi=1/Math.sqrt(yi));var gi=(tt*=yi)*tt+(it*=yi)*it+(at*=yi)*at;nt=tt*(gi=(w*tt+A*it+k*at)/gi),st=it*gi,rt=at*gi;var Xi=Q;Xi.x=nt,Xi.y=st,Xi.z=rt}var zi=this.tmp;return this._distanceSq=zi.x*zi.x+zi.y*zi.y+zi.z*zi.z,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=-1,this._adjacentPairIndex[1]=-1,this._adjacentPairIndex[2]=-1,!I},setAdjacentTriangle:function(t){for(var i=0,a=0;a<3;)for(var o=a++,n=0;n<3;){var s=n++,r=this._nextIndex[o],e=this._nextIndex[s];this._vertices[o]==t._vertices[e]&&this._vertices[r]==t._vertices[s]&&(this._adjacentTriangles[o]=t,this._adjacentPairIndex[o]=s,t._adjacentTriangles[s]=this,t._adjacentPairIndex[s]=o,++i)}return 1==i},removeAdjacentTriangles:function(){for(var t=0;t<3;){var i=t++,a=this._adjacentTriangles[i];if(null!=a){var o=this._adjacentPairIndex[i];a._adjacentTriangles[o]=null,a._adjacentPairIndex[o]=-1,this._adjacentTriangles[i]=null,this._adjacentPairIndex[i]=-1}}},removeReferences:function(){this._next=null,this._prev=null,this._tmpDfsId=0,this._tmpDfsVisible=!1,this._distanceSq=0,this._vertices[0]=null,this._vertices[1]=null,this._vertices[2]=null,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=0,this._adjacentPairIndex[1]=0,this._adjacentPairIndex[2]=0},dump:function(){}};var N=function(){this.randId=1e5*Math.random()|0,this.v=new F,this.w1=new F,this.w2=new F};N.prototype={init:function(t,i,a){var o=this.v;o.x=t.x,o.y=t.y,o.z=t.z;var n=this.w1;n.x=i.x,n.y=i.y,n.z=i.z;var s=this.w2;return s.x=a.x,s.y=a.y,s.z=a.z,this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null,this},removeReferences:function(){this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null}};var D=function(){this.prevClosestDir=new F};D.prototype={clear:function(){this.prevClosestDir.zero()}};var F=function(t,i,a){null==a&&(a=0),null==i&&(i=0),null==t&&(t=0),this.x=t,this.y=i,this.z=a,F.numCreations++};F.prototype={init:function(t,i,a){return this.x=t,this.y=i,this.z=a,this},zero:function(){return this.x=0,this.y=0,this.z=0,this},add:function(t){return new F(this.x+t.x,this.y+t.y,this.z+t.z)},addScaled:function(t,i){return new F(this.x+t.x*i,this.y+t.y*i,this.z+t.z*i)},sub:function(t){return new F(this.x-t.x,this.y-t.y,this.z-t.z)},scale:function(t){return new F(this.x*t,this.y*t,this.z*t)},scale3:function(t,i,a){return new F(this.x*t,this.y*i,this.z*a)},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},cross:function(t){return new F(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},addEq:function(t){var i=this.x+t.x,a=this.y+t.y,o=this.z+t.z;return this.x=i,this.y=a,this.z=o,this},addScaledEq:function(t,i){var a=this.x+t.x*i,o=this.y+t.y*i,n=this.z+t.z*i;return this.x=a,this.y=o,this.z=n,this},subEq:function(t){var i=this.x-t.x,a=this.y-t.y,o=this.z-t.z;return this.x=i,this.y=a,this.z=o,this},scaleEq:function(t){var i=this.x*t,a=this.y*t,o=this.z*t;return this.x=i,this.y=a,this.z=o,this},scale3Eq:function(t,i,a){var o=this.x*t,n=this.y*i,s=this.z*a;return this.x=o,this.y=n,this.z=s,this},crossEq:function(t){var i=this.y*t.z-this.z*t.y,a=this.z*t.x-this.x*t.z,o=this.x*t.y-this.y*t.x;return this.x=i,this.y=a,this.z=o,this},mulMat3:function(t){return new F(this.x*t.e00+this.y*t.e01+this.z*t.e02,this.x*t.e10+this.y*t.e11+this.z*t.e12,this.x*t.e20+this.y*t.e21+this.z*t.e22)},mulMat4:function(t){return new F(this.x*t.e00+this.y*t.e01+this.z*t.e02+t.e03,this.x*t.e10+this.y*t.e11+this.z*t.e12+t.e13,this.x*t.e20+this.y*t.e21+this.z*t.e22+t.e23)},mulTransform:function(t){var i,a,o,n,s,r;i=this.x,a=this.y,o=this.z,n=t._rotation00*i+t._rotation01*a+t._rotation02*o,s=t._rotation10*i+t._rotation11*a+t._rotation12*o,r=t._rotation20*i+t._rotation21*a+t._rotation22*o,i=n,a=s,o=r,i+=t._positionX,a+=t._positionY,o+=t._positionZ;var e=new F,_=e;return _.x=i,_.y=a,_.z=o,e},mulMat3Eq:function(t){var i=this.x*t.e00+this.y*t.e01+this.z*t.e02,a=this.x*t.e10+this.y*t.e11+this.z*t.e12,o=this.x*t.e20+this.y*t.e21+this.z*t.e22;return this.x=i,this.y=a,this.z=o,this},mulMat4Eq:function(t){var i=this.x*t.e00+this.y*t.e01+this.z*t.e02+t.e03,a=this.x*t.e10+this.y*t.e11+this.z*t.e12+t.e13,o=this.x*t.e20+this.y*t.e21+this.z*t.e22+t.e23;return this.x=i,this.y=a,this.z=o,this},mulTransformEq:function(t){var i,a,o,n,s,r;i=this.x,a=this.y,o=this.z,n=t._rotation00*i+t._rotation01*a+t._rotation02*o,s=t._rotation10*i+t._rotation11*a+t._rotation12*o,r=t._rotation20*i+t._rotation21*a+t._rotation22*o,i=n,a=s,o=r,i+=t._positionX,a+=t._positionY,o+=t._positionZ;return this.x=i,this.y=a,this.z=o,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},normalized:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return t>0&&(t=1/t),new F(this.x*t,this.y*t,this.z*t)},normalize:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);t>0&&(t=1/t);var i=this.x*t,a=this.y*t,o=this.z*t;return this.x=i,this.y=a,this.z=o,this},negate:function(){return new F(-this.x,-this.y,-this.z)},negateEq:function(){var t=-this.x,i=-this.y,a=-this.z;return this.x=t,this.y=i,this.z=a,this},copyFrom:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},clone:function(){return new F(this.x,this.y,this.z)},toString:function(){return"Vec3["+(this.x>0?(1e7*this.x+.5|0)/1e7:(1e7*this.x-.5|0)/1e7)+", "+(this.y>0?(1e7*this.y+.5|0)/1e7:(1e7*this.y-.5|0)/1e7)+", "+(this.z>0?(1e7*this.z+.5|0)/1e7:(1e7*this.z-.5|0)/1e7)+"]"}};var O=function(){this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1};O.prototype={identity:function(){return this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1,this},getPosition:function(){var t=new F,i=t;return i.x=this._positionX,i.y=this._positionY,i.z=this._positionZ,t},getPositionTo:function(t){var i=t;i.x=this._positionX,i.y=this._positionY,i.z=this._positionZ},setPosition:function(t){var i=t;return this._positionX=i.x,this._positionY=i.y,this._positionZ=i.z,this},translate:function(t){var i,a,o,n=t;i=n.x,a=n.y,o=n.z,this._positionX+=i,this._positionY+=a,this._positionZ+=o},getRotation:function(){var t=new J,i=t;return i.e00=this._rotation00,i.e01=this._rotation01,i.e02=this._rotation02,i.e10=this._rotation10,i.e11=this._rotation11,i.e12=this._rotation12,i.e20=this._rotation20,i.e21=this._rotation21,i.e22=this._rotation22,t},getRotationTo:function(t){var i=t;i.e00=this._rotation00,i.e01=this._rotation01,i.e02=this._rotation02,i.e10=this._rotation10,i.e11=this._rotation11,i.e12=this._rotation12,i.e20=this._rotation20,i.e21=this._rotation21,i.e22=this._rotation22},setRotation:function(t){var i=t;return this._rotation00=i.e00,this._rotation01=i.e01,this._rotation02=i.e02,this._rotation10=i.e10,this._rotation11=i.e11,this._rotation12=i.e12,this._rotation20=i.e20,this._rotation21=i.e21,this._rotation22=i.e22,this},setRotationXyz:function(t){var i,a,o,n=t;i=n.x,a=n.y,o=n.z;var s=Math.sin(i),r=Math.sin(a),e=Math.sin(o),_=Math.cos(i),h=Math.cos(a),l=Math.cos(o);this._rotation00=h*l,this._rotation01=-h*e,this._rotation02=r,this._rotation10=_*e+l*s*r,this._rotation11=_*l-s*r*e,this._rotation12=-h*s,this._rotation20=s*e-_*l*r,this._rotation21=l*s+_*r*e,this._rotation22=_*h},rotate:function(t){var i,a,o,n,s,r,e,_,h,l,c,p,v,m,b,f,x,u,y=t;i=y.e00,a=y.e01,o=y.e02,n=y.e10,s=y.e11,r=y.e12,e=y.e20,_=y.e21,h=y.e22,l=i*this._rotation00+a*this._rotation10+o*this._rotation20,c=i*this._rotation01+a*this._rotation11+o*this._rotation21,p=i*this._rotation02+a*this._rotation12+o*this._rotation22,v=n*this._rotation00+s*this._rotation10+r*this._rotation20,m=n*this._rotation01+s*this._rotation11+r*this._rotation21,b=n*this._rotation02+s*this._rotation12+r*this._rotation22,f=e*this._rotation00+_*this._rotation10+h*this._rotation20,x=e*this._rotation01+_*this._rotation11+h*this._rotation21,u=e*this._rotation02+_*this._rotation12+h*this._rotation22,this._rotation00=l,this._rotation01=c,this._rotation02=p,this._rotation10=v,this._rotation11=m,this._rotation12=b,this._rotation20=f,this._rotation21=x,this._rotation22=u},rotateXyz:function(t){var i,a,o,n,s,r,e,_,h,l,c,p,v=t;i=v.x,a=v.y,o=v.z;var m,b,f,x,u,y,g,X,z,M=Math.sin(i),Y=Math.sin(a),Z=Math.sin(o),d=Math.cos(i),I=Math.cos(a),V=Math.cos(o);s=-I*Z,r=Y,e=d*Z+V*M*Y,_=d*V-M*Y*Z,h=-I*M,l=M*Z-d*V*Y,c=V*M+d*Y*Z,p=d*I,m=(n=I*V)*this._rotation00+s*this._rotation10+r*this._rotation20,b=n*this._rotation01+s*this._rotation11+r*this._rotation21,f=n*this._rotation02+s*this._rotation12+r*this._rotation22,x=e*this._rotation00+_*this._rotation10+h*this._rotation20,u=e*this._rotation01+_*this._rotation11+h*this._rotation21,y=e*this._rotation02+_*this._rotation12+h*this._rotation22,g=l*this._rotation00+c*this._rotation10+p*this._rotation20,X=l*this._rotation01+c*this._rotation11+p*this._rotation21,z=l*this._rotation02+c*this._rotation12+p*this._rotation22,this._rotation00=m,this._rotation01=b,this._rotation02=f,this._rotation10=x,this._rotation11=u,this._rotation12=y,this._rotation20=g,this._rotation21=X,this._rotation22=z},getOrientation:function(){var t,i,a,o,n,s=new tt,r=this._rotation00,e=this._rotation11,_=this._rotation22,h=r+e+_;h>0?(o=.5*(n=Math.sqrt(h+1)),n=.5/n,t=(this._rotation21-this._rotation12)*n,i=(this._rotation02-this._rotation20)*n,a=(this._rotation10-this._rotation01)*n):r>e?r>_?(t=.5*(n=Math.sqrt(r-e-_+1)),n=.5/n,i=(this._rotation01+this._rotation10)*n,a=(this._rotation02+this._rotation20)*n,o=(this._rotation21-this._rotation12)*n):(a=.5*(n=Math.sqrt(_-r-e+1)),n=.5/n,t=(this._rotation02+this._rotation20)*n,i=(this._rotation12+this._rotation21)*n,o=(this._rotation10-this._rotation01)*n):e>_?(i=.5*(n=Math.sqrt(e-_-r+1)),n=.5/n,t=(this._rotation01+this._rotation10)*n,a=(this._rotation12+this._rotation21)*n,o=(this._rotation02-this._rotation20)*n):(a=.5*(n=Math.sqrt(_-r-e+1)),n=.5/n,t=(this._rotation02+this._rotation20)*n,i=(this._rotation12+this._rotation21)*n,o=(this._rotation10-this._rotation01)*n);var l=s;return l.x=t,l.y=i,l.z=a,l.w=o,s},getOrientationTo:function(t){var i,a,o,n,s,r=this._rotation00,e=this._rotation11,_=this._rotation22,h=r+e+_;h>0?(n=.5*(s=Math.sqrt(h+1)),s=.5/s,i=(this._rotation21-this._rotation12)*s,a=(this._rotation02-this._rotation20)*s,o=(this._rotation10-this._rotation01)*s):r>e?r>_?(i=.5*(s=Math.sqrt(r-e-_+1)),s=.5/s,a=(this._rotation01+this._rotation10)*s,o=(this._rotation02+this._rotation20)*s,n=(this._rotation21-this._rotation12)*s):(o=.5*(s=Math.sqrt(_-r-e+1)),s=.5/s,i=(this._rotation02+this._rotation20)*s,a=(this._rotation12+this._rotation21)*s,n=(this._rotation10-this._rotation01)*s):e>_?(a=.5*(s=Math.sqrt(e-_-r+1)),s=.5/s,i=(this._rotation01+this._rotation10)*s,o=(this._rotation12+this._rotation21)*s,n=(this._rotation02-this._rotation20)*s):(o=.5*(s=Math.sqrt(_-r-e+1)),s=.5/s,i=(this._rotation02+this._rotation20)*s,a=(this._rotation12+this._rotation21)*s,n=(this._rotation10-this._rotation01)*s);var l=t;l.x=i,l.y=a,l.z=o,l.w=n},setOrientation:function(t){var i,a,o,n,s=t,r=(i=s.x,a=s.y,o=s.z,n=s.w,2*i),e=2*a,_=2*o,h=i*r,l=a*e,c=o*_,p=i*e,v=a*_,m=i*_,b=n*r,f=n*e,x=n*_;return this._rotation00=1-l-c,this._rotation01=p-x,this._rotation02=m+f,this._rotation10=p+x,this._rotation11=1-h-c,this._rotation12=v-b,this._rotation20=m-f,this._rotation21=v+b,this._rotation22=1-h-l,this},clone:function(){var t=new O;return t._positionX=this._positionX,t._positionY=this._positionY,t._positionZ=this._positionZ,t._rotation00=this._rotation00,t._rotation01=this._rotation01,t._rotation02=this._rotation02,t._rotation10=this._rotation10,t._rotation11=this._rotation11,t._rotation12=this._rotation12,t._rotation20=this._rotation20,t._rotation21=this._rotation21,t._rotation22=this._rotation22,t},copyFrom:function(t){return this._positionX=t._positionX,this._positionY=t._positionY,this._positionZ=t._positionZ,this._rotation00=t._rotation00,this._rotation01=t._rotation01,this._rotation02=t._rotation02,this._rotation10=t._rotation10,this._rotation11=t._rotation11,this._rotation12=t._rotation12,this._rotation20=t._rotation20,this._rotation21=t._rotation21,this._rotation22=t._rotation22,this}};var W=function(){},G=function(){var t=new Array(4);this.s=t;var i=new Array(4);this.w1=i;var a=new Array(4);this.w2=a;var o=new Array(3);this.baseDirs=o,this.baseDirs[0]=new F(1,0,0),this.baseDirs[1]=new F(0,1,0),this.baseDirs[2]=new F(0,0,1),this.tl1=new F,this.tl2=new F,this.rayX=new F,this.rayR=new F,this.tempTransform=new O;for(var n=0;n<4;){var s=n++;this.s[s]=new F,this.w1[s]=new F,this.w2[s]=new F}this.dir=new F,this.closest=new F,this.closestPoint1=new F,this.closestPoint2=new F,this.polyhedron=new R};G.getInstance=function(){return G.instance},G.prototype={computeClosestPointsImpl:function(t,i,a,o,n,s){this.c1=t,this.c2=i,this.tf1=a,this.tf2=o;var r=this.s,e=this.w1,_=this.w2,h=this.closest,l=this.dir;if(null!=n?(null==n._gjkCache&&(n._gjkCache=new D),this.loadCache(n._gjkCache)):l.zero(),l.x*l.x+l.y*l.y+l.z*l.z==0){var c,p,v;c=o._positionX-a._positionX,p=o._positionY-a._positionY,v=o._positionZ-a._positionZ;var m=l;m.x=c,m.y=p,m.z=v,l.x*l.x+l.y*l.y+l.z*l.z<1e-6&&l.init(1,0,0)}this.simplexSize=0,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var b=this.s[this.simplexSize],f=this.w1[this.simplexSize];b.x=f.x,b.y=f.y,b.z=f.z;var x=b,u=this.w2[this.simplexSize],y=x.x-u.x,g=x.y-u.y,X=x.z-u.z;x.x=y,x.y=g,x.z=X,this.simplexSize=1;for(var z=0;z<40;){var M=0;switch(this.simplexSize){case 1:var Y=r[0];h.x=Y.x,h.y=Y.y,h.z=Y.z,M=1;break;case 2:var Z,d,I,V,L,w,A=r[0];Z=A.x,d=A.y,I=A.z;var k,B,P,T=r[1],S=(k=(V=T.x)-Z)*Z+(B=(L=T.y)-d)*d+(P=(w=T.z)-I)*I;if((S=-S/(k*k+B*B+P*P))<0){var C=h;C.x=Z,C.y=d,C.z=I,M=1}else if(S>1){var q=h;q.x=V,q.y=L,q.z=w,M=2}else{var R,E,j;R=Z+k*S,E=d+B*S,j=I+P*S;var N=h;N.x=R,N.y=E,N.z=j,M=3}break;case 3:var F,O,W,G,H,U,J,Q,$,K,tt,it,at,ot,nt,st,rt,et,_t=r[0],ht=r[1],lt=r[2],ct=_t;F=ct.x,O=ct.y,W=ct.z;var pt=ht;G=pt.x,H=pt.y,U=pt.z;var vt,mt,bt,ft=lt;J=ft.x;var xt,ut,yt,gt=G*((ot=(Q=ft.y)-H)*(bt=(K=G-F)*ot-(tt=H-O)*(at=J-G))-(nt=($=ft.z)-U)*(mt=(it=U-W)*at-K*nt))+H*(nt*(vt=tt*nt-it*ot)-at*bt)+U*(at*mt-ot*vt),Xt=J*((rt=O-Q)*bt-(et=W-$)*mt)+Q*(et*vt-(st=F-J)*bt)+$*(st*mt-rt*vt),zt=-1,Mt=0;if(xt=0,ut=0,yt=0,F*(tt*bt-it*mt)+O*(it*vt-K*bt)+W*(K*mt-tt*vt)<0){var Yt,Zt,dt,It,Vt,Lt,wt=_t;Yt=wt.x,Zt=wt.y,dt=wt.z;var At,kt,Bt,Pt,Tt=ht,St=(At=(It=Tt.x)-Yt)*Yt+(kt=(Vt=Tt.y)-Zt)*Zt+(Bt=(Lt=Tt.z)-dt)*dt;if((St=-St/(At*At+kt*kt+Bt*Bt))<0){var Ct=h;Ct.x=Yt,Ct.y=Zt,Ct.z=dt,Pt=1}else if(St>1){var qt=h;qt.x=It,qt.y=Vt,qt.z=Lt,Pt=2}else{var Rt,Et,jt;Rt=Yt+At*St,Et=Zt+kt*St,jt=dt+Bt*St;var Nt=h;Nt.x=Rt,Nt.y=Et,Nt.z=jt,Pt=3}Mt=Pt,zt=h.x*h.x+h.y*h.y+h.z*h.z;var Dt=h;xt=Dt.x,ut=Dt.y,yt=Dt.z}if(gt<0){var Ft,Ot,Wt,Gt,Ht,Ut,Jt=ht;Ft=Jt.x,Ot=Jt.y,Wt=Jt.z;var Qt,$t,Kt,ti,ii=lt,ai=(Qt=(Gt=ii.x)-Ft)*Ft+($t=(Ht=ii.y)-Ot)*Ot+(Kt=(Ut=ii.z)-Wt)*Wt;if((ai=-ai/(Qt*Qt+$t*$t+Kt*Kt))<0){var oi=h;oi.x=Ft,oi.y=Ot,oi.z=Wt,ti=1}else if(ai>1){var ni=h;ni.x=Gt,ni.y=Ht,ni.z=Ut,ti=2}else{var si,ri,ei;si=Ft+Qt*ai,ri=Ot+$t*ai,ei=Wt+Kt*ai;var _i=h;_i.x=si,_i.y=ri,_i.z=ei,ti=3}var hi=h.x*h.x+h.y*h.y+h.z*h.z;if(zt<0||hi<zt){Mt=ti<<1,zt=hi;var li=h;xt=li.x,ut=li.y,yt=li.z}}if(Xt<0){var ci,pi,vi,mi,bi,fi,xi=_t;ci=xi.x,pi=xi.y,vi=xi.z;var ui,yi,gi,Xi,zi=lt,Mi=(ui=(mi=zi.x)-ci)*ci+(yi=(bi=zi.y)-pi)*pi+(gi=(fi=zi.z)-vi)*vi;if((Mi=-Mi/(ui*ui+yi*yi+gi*gi))<0){var Yi=h;Yi.x=ci,Yi.y=pi,Yi.z=vi,Xi=1}else if(Mi>1){var Zi=h;Zi.x=mi,Zi.y=bi,Zi.z=fi,Xi=2}else{var di,Ii,Vi;di=ci+ui*Mi,Ii=pi+yi*Mi,Vi=vi+gi*Mi;var Li=h;Li.x=di,Li.y=Ii,Li.z=Vi,Xi=3}var wi=h.x*h.x+h.y*h.y+h.z*h.z;if(zt<0||wi<zt){Mt=1&Xi|(2&Xi)<<1,zt=wi;var Ai=h;xt=Ai.x,ut=Ai.y,yt=Ai.z}}if(zt>0){var ki=h;ki.x=xt,ki.y=ut,ki.z=yt,M=Mt}else{var Bi=vt*vt+mt*mt+bt*bt;Bi>0&&(Bi=1/Math.sqrt(Bi));var Pi=(vt*=Bi)*vt+(mt*=Bi)*mt+(bt*=Bi)*bt;xt=vt*(Pi=(F*vt+O*mt+W*bt)/Pi),ut=mt*Pi,yt=bt*Pi;var Ti=h;Ti.x=xt,Ti.y=ut,Ti.z=yt,M=7}break;case 4:var Si,Ci,qi,Ri,Ei,ji,Ni,Di,Fi,Oi,Wi,Gi,Hi,Ui,Ji,Qi,$i,Ki,ta,ia,aa,oa,na,sa,ra,ea,_a,ha=r[0],la=r[1],ca=r[2],pa=r[3],va=ha;Si=va.x,Ci=va.y,qi=va.z;var ma=la;Ri=ma.x,Ei=ma.y,ji=ma.z;var ba=ca;Ni=ba.x,Di=ba.y,Fi=ba.z;var fa,xa,ua,ya=pa;(Oi=ya.x)-Ni,(Wi=ya.y)-Di,(Gi=ya.z)-Fi;var ga,Xa,za,Ma=(Hi=Ri-Si)*(fa=(ea=Wi-Ei)*(sa=Fi-ji)-(_a=Gi-ji)*(na=Di-Ei))+(Ui=Ei-Ci)*(xa=_a*(oa=Ni-Ri)-(ra=Oi-Ri)*sa)+(Ji=ji-qi)*(ua=ra*na-ea*oa)>0?1:-1,Ya=Si*(($i=Di-Ci)*(aa=Gi-qi)-(Ki=Fi-qi)*(ia=Wi-Ci))+Ci*(Ki*(ta=Oi-Si)-(Qi=Ni-Si)*aa)+qi*(Qi*ia-$i*ta),Za=Si*(ia*Ji-aa*Ui)+Ci*(aa*Hi-ta*Ji)+qi*(ta*Ui-ia*Hi),da=Ri*fa+Ei*xa+ji*ua,Ia=-1,Va=0;if(ga=0,Xa=0,za=0,(Si*(Ui*Ki-Ji*$i)+Ci*(Ji*Qi-Hi*Ki)+qi*(Hi*$i-Ui*Qi))*Ma<0){var La,wa,Aa,ka,Ba,Pa,Ta,Sa,Ca,qa,Ra,Ea,ja,Na,Da,Fa,Oa,Wa,Ga=ha;La=Ga.x,wa=Ga.y,Aa=Ga.z;var Ha=la;ka=Ha.x,Ba=Ha.y,Pa=Ha.z;var Ua,Ja,Qa,$a=ca;Ta=$a.x;var Ka,to,io,ao,oo=ka*((Na=(Sa=$a.y)-Ba)*(Qa=(qa=ka-La)*Na-(Ra=Ba-wa)*(ja=Ta-ka))-(Da=(Ca=$a.z)-Pa)*(Ja=(Ea=Pa-Aa)*ja-qa*Da))+Ba*(Da*(Ua=Ra*Da-Ea*Na)-ja*Qa)+Pa*(ja*Ja-Na*Ua),no=Ta*((Oa=wa-Sa)*Qa-(Wa=Aa-Ca)*Ja)+Sa*(Wa*Ua-(Fa=La-Ta)*Qa)+Ca*(Fa*Ja-Oa*Ua),so=-1,ro=0;if(Ka=0,to=0,io=0,La*(Ra*Qa-Ea*Ja)+wa*(Ea*Ua-qa*Qa)+Aa*(qa*Ja-Ra*Ua)<0){var eo,_o,ho,lo,co,po,vo=ha;eo=vo.x,_o=vo.y,ho=vo.z;var mo,bo,fo,xo,uo=la,yo=(mo=(lo=uo.x)-eo)*eo+(bo=(co=uo.y)-_o)*_o+(fo=(po=uo.z)-ho)*ho;if((yo=-yo/(mo*mo+bo*bo+fo*fo))<0){var go=h;go.x=eo,go.y=_o,go.z=ho,xo=1}else if(yo>1){var Xo=h;Xo.x=lo,Xo.y=co,Xo.z=po,xo=2}else{var zo,Mo,Yo;zo=eo+mo*yo,Mo=_o+bo*yo,Yo=ho+fo*yo;var Zo=h;Zo.x=zo,Zo.y=Mo,Zo.z=Yo,xo=3}ro=xo,so=h.x*h.x+h.y*h.y+h.z*h.z;var Io=h;Ka=Io.x,to=Io.y,io=Io.z}if(oo<0){var Vo,Lo,wo,Ao,ko,Bo,Po=la;Vo=Po.x,Lo=Po.y,wo=Po.z;var To,So,Co,qo,Ro=ca,Eo=(To=(Ao=Ro.x)-Vo)*Vo+(So=(ko=Ro.y)-Lo)*Lo+(Co=(Bo=Ro.z)-wo)*wo;if((Eo=-Eo/(To*To+So*So+Co*Co))<0){var jo=h;jo.x=Vo,jo.y=Lo,jo.z=wo,qo=1}else if(Eo>1){var No=h;No.x=Ao,No.y=ko,No.z=Bo,qo=2}else{var Do,Fo,Oo;Do=Vo+To*Eo,Fo=Lo+So*Eo,Oo=wo+Co*Eo;var Wo=h;Wo.x=Do,Wo.y=Fo,Wo.z=Oo,qo=3}var Go=h.x*h.x+h.y*h.y+h.z*h.z;if(so<0||Go<so){ro=qo<<1,so=Go;var Ho=h;Ka=Ho.x,to=Ho.y,io=Ho.z}}if(no<0){var Uo,Jo,Qo,$o,Ko,tn,an=ha;Uo=an.x,Jo=an.y,Qo=an.z;var on,nn,sn,rn,en=ca,_n=(on=($o=en.x)-Uo)*Uo+(nn=(Ko=en.y)-Jo)*Jo+(sn=(tn=en.z)-Qo)*Qo;if((_n=-_n/(on*on+nn*nn+sn*sn))<0){var hn=h;hn.x=Uo,hn.y=Jo,hn.z=Qo,rn=1}else if(_n>1){var ln=h;ln.x=$o,ln.y=Ko,ln.z=tn,rn=2}else{var cn,pn,vn;cn=Uo+on*_n,pn=Jo+nn*_n,vn=Qo+sn*_n;var mn=h;mn.x=cn,mn.y=pn,mn.z=vn,rn=3}var bn=h.x*h.x+h.y*h.y+h.z*h.z;if(so<0||bn<so){ro=1&rn|(2&rn)<<1,so=bn;var fn=h;Ka=fn.x,to=fn.y,io=fn.z}}if(so>0){var xn=h;xn.x=Ka,xn.y=to,xn.z=io,ao=ro}else{var un=Ua*Ua+Ja*Ja+Qa*Qa;un>0&&(un=1/Math.sqrt(un));var yn=(Ua*=un)*Ua+(Ja*=un)*Ja+(Qa*=un)*Qa;Ka=Ua*(yn=(La*Ua+wa*Ja+Aa*Qa)/yn),to=Ja*yn,io=Qa*yn;var gn=h;gn.x=Ka,gn.y=to,gn.z=io,ao=7}Va=ao,Ia=h.x*h.x+h.y*h.y+h.z*h.z;var Xn=h;ga=Xn.x,Xa=Xn.y,za=Xn.z}if(Ya*Ma<0){var zn,Mn,Yn,Zn,dn,In,Vn,Ln,wn,An,kn,Bn,Pn,Tn,Sn,Cn,qn,Rn,En=ha;zn=En.x,Mn=En.y,Yn=En.z;var jn=ca;Zn=jn.x,dn=jn.y,In=jn.z;var Nn,Dn,Fn,On=pa;Vn=On.x;var Wn,Gn,Hn,Un,Jn=Zn*((Tn=(Ln=On.y)-dn)*(Fn=(An=Zn-zn)*Tn-(kn=dn-Mn)*(Pn=Vn-Zn))-(Sn=(wn=On.z)-In)*(Dn=(Bn=In-Yn)*Pn-An*Sn))+dn*(Sn*(Nn=kn*Sn-Bn*Tn)-Pn*Fn)+In*(Pn*Dn-Tn*Nn),Qn=Vn*((qn=Mn-Ln)*Fn-(Rn=Yn-wn)*Dn)+Ln*(Rn*Nn-(Cn=zn-Vn)*Fn)+wn*(Cn*Dn-qn*Nn),$n=-1,Kn=0;if(Wn=0,Gn=0,Hn=0,zn*(kn*Fn-Bn*Dn)+Mn*(Bn*Nn-An*Fn)+Yn*(An*Dn-kn*Nn)<0){var ts,is,as,os,ns,ss,rs=ha;ts=rs.x,is=rs.y,as=rs.z;var es,_s,hs,ls,cs=ca,ps=(es=(os=cs.x)-ts)*ts+(_s=(ns=cs.y)-is)*is+(hs=(ss=cs.z)-as)*as;if((ps=-ps/(es*es+_s*_s+hs*hs))<0){var vs=h;vs.x=ts,vs.y=is,vs.z=as,ls=1}else if(ps>1){var ms=h;ms.x=os,ms.y=ns,ms.z=ss,ls=2}else{var bs,fs,xs;bs=ts+es*ps,fs=is+_s*ps,xs=as+hs*ps;var us=h;us.x=bs,us.y=fs,us.z=xs,ls=3}Kn=ls,$n=h.x*h.x+h.y*h.y+h.z*h.z;var ys=h;Wn=ys.x,Gn=ys.y,Hn=ys.z}if(Jn<0){var gs,Xs,zs,Ms,Ys,Zs,ds=ca;gs=ds.x,Xs=ds.y,zs=ds.z;var Is,Vs,Ls,ws,As=pa,ks=(Is=(Ms=As.x)-gs)*gs+(Vs=(Ys=As.y)-Xs)*Xs+(Ls=(Zs=As.z)-zs)*zs;if((ks=-ks/(Is*Is+Vs*Vs+Ls*Ls))<0){var Bs=h;Bs.x=gs,Bs.y=Xs,Bs.z=zs,ws=1}else if(ks>1){var Ps=h;Ps.x=Ms,Ps.y=Ys,Ps.z=Zs,ws=2}else{var Ts,Ss,Cs;Ts=gs+Is*ks,Ss=Xs+Vs*ks,Cs=zs+Ls*ks;var qs=h;qs.x=Ts,qs.y=Ss,qs.z=Cs,ws=3}var Rs=h.x*h.x+h.y*h.y+h.z*h.z;if($n<0||Rs<$n){Kn=ws<<1,$n=Rs;var Es=h;Wn=Es.x,Gn=Es.y,Hn=Es.z}}if(Qn<0){var js,Ns,Ds,Fs,Os,Ws,Gs=ha;js=Gs.x,Ns=Gs.y,Ds=Gs.z;var Hs,Us,Js,Qs,$s=pa,Ks=(Hs=(Fs=$s.x)-js)*js+(Us=(Os=$s.y)-Ns)*Ns+(Js=(Ws=$s.z)-Ds)*Ds;if((Ks=-Ks/(Hs*Hs+Us*Us+Js*Js))<0){var tr=h;tr.x=js,tr.y=Ns,tr.z=Ds,Qs=1}else if(Ks>1){var ir=h;ir.x=Fs,ir.y=Os,ir.z=Ws,Qs=2}else{var ar,or,nr;ar=js+Hs*Ks,or=Ns+Us*Ks,nr=Ds+Js*Ks;var sr=h;sr.x=ar,sr.y=or,sr.z=nr,Qs=3}var rr=h.x*h.x+h.y*h.y+h.z*h.z;if($n<0||rr<$n){Kn=1&Qs|(2&Qs)<<1,$n=rr;var er=h;Wn=er.x,Gn=er.y,Hn=er.z}}if($n>0){var _r=h;_r.x=Wn,_r.y=Gn,_r.z=Hn,Un=Kn}else{var hr=Nn*Nn+Dn*Dn+Fn*Fn;hr>0&&(hr=1/Math.sqrt(hr));var lr=(Nn*=hr)*Nn+(Dn*=hr)*Dn+(Fn*=hr)*Fn;Wn=Nn*(lr=(zn*Nn+Mn*Dn+Yn*Fn)/lr),Gn=Dn*lr,Hn=Fn*lr;var cr=h;cr.x=Wn,cr.y=Gn,cr.z=Hn,Un=7}var pr=h.x*h.x+h.y*h.y+h.z*h.z;if(Ia<0||pr<Ia){Va=1&Un|(6&Un)<<1,Ia=pr;var vr=h;ga=vr.x,Xa=vr.y,za=vr.z}}if(Za*Ma<0){var mr,br,fr,xr,ur,yr,gr,Xr,zr,Mr,Yr,Zr,dr,Ir,Vr,Lr,wr,Ar,kr=ha;mr=kr.x,br=kr.y,fr=kr.z;var Br=la;xr=Br.x,ur=Br.y,yr=Br.z;var Pr,Tr,Sr,Cr=pa;gr=Cr.x;var qr,Rr,Er,jr,Nr=xr*((Ir=(Xr=Cr.y)-ur)*(Sr=(Mr=xr-mr)*Ir-(Yr=ur-br)*(dr=gr-xr))-(Vr=(zr=Cr.z)-yr)*(Tr=(Zr=yr-fr)*dr-Mr*Vr))+ur*(Vr*(Pr=Yr*Vr-Zr*Ir)-dr*Sr)+yr*(dr*Tr-Ir*Pr),Dr=gr*((wr=br-Xr)*Sr-(Ar=fr-zr)*Tr)+Xr*(Ar*Pr-(Lr=mr-gr)*Sr)+zr*(Lr*Tr-wr*Pr),Fr=-1,Or=0;if(qr=0,Rr=0,Er=0,mr*(Yr*Sr-Zr*Tr)+br*(Zr*Pr-Mr*Sr)+fr*(Mr*Tr-Yr*Pr)<0){var Wr,Gr,Hr,Ur,Jr,Qr,$r=ha;Wr=$r.x,Gr=$r.y,Hr=$r.z;var Kr,te,ie,ae,oe=la,ne=(Kr=(Ur=oe.x)-Wr)*Wr+(te=(Jr=oe.y)-Gr)*Gr+(ie=(Qr=oe.z)-Hr)*Hr;if((ne=-ne/(Kr*Kr+te*te+ie*ie))<0){var se=h;se.x=Wr,se.y=Gr,se.z=Hr,ae=1}else if(ne>1){var re=h;re.x=Ur,re.y=Jr,re.z=Qr,ae=2}else{var ee,_e,he;ee=Wr+Kr*ne,_e=Gr+te*ne,he=Hr+ie*ne;var le=h;le.x=ee,le.y=_e,le.z=he,ae=3}Or=ae,Fr=h.x*h.x+h.y*h.y+h.z*h.z;var ce=h;qr=ce.x,Rr=ce.y,Er=ce.z}if(Nr<0){var pe,ve,me,be,fe,xe,ue=la;pe=ue.x,ve=ue.y,me=ue.z;var ye,ge,Xe,ze,Me=pa,Ye=(ye=(be=Me.x)-pe)*pe+(ge=(fe=Me.y)-ve)*ve+(Xe=(xe=Me.z)-me)*me;if((Ye=-Ye/(ye*ye+ge*ge+Xe*Xe))<0){var Ze=h;Ze.x=pe,Ze.y=ve,Ze.z=me,ze=1}else if(Ye>1){var de=h;de.x=be,de.y=fe,de.z=xe,ze=2}else{var Ie,Ve,Le;Ie=pe+ye*Ye,Ve=ve+ge*Ye,Le=me+Xe*Ye;var we=h;we.x=Ie,we.y=Ve,we.z=Le,ze=3}var Ae=h.x*h.x+h.y*h.y+h.z*h.z;if(Fr<0||Ae<Fr){Or=ze<<1,Fr=Ae;var ke=h;qr=ke.x,Rr=ke.y,Er=ke.z}}if(Dr<0){var Be,Pe,Te,Se,Ce,qe,Re=ha;Be=Re.x,Pe=Re.y,Te=Re.z;var Ee,je,Ne,De,Fe=pa,Oe=(Ee=(Se=Fe.x)-Be)*Be+(je=(Ce=Fe.y)-Pe)*Pe+(Ne=(qe=Fe.z)-Te)*Te;if((Oe=-Oe/(Ee*Ee+je*je+Ne*Ne))<0){var We=h;We.x=Be,We.y=Pe,We.z=Te,De=1}else if(Oe>1){var Ge=h;Ge.x=Se,Ge.y=Ce,Ge.z=qe,De=2}else{var He,Ue,Je;He=Be+Ee*Oe,Ue=Pe+je*Oe,Je=Te+Ne*Oe;var Qe=h;Qe.x=He,Qe.y=Ue,Qe.z=Je,De=3}var $e=h.x*h.x+h.y*h.y+h.z*h.z;if(Fr<0||$e<Fr){Or=1&De|(2&De)<<1,Fr=$e;var Ke=h;qr=Ke.x,Rr=Ke.y,Er=Ke.z}}if(Fr>0){var t_=h;t_.x=qr,t_.y=Rr,t_.z=Er,jr=Or}else{var i_=Pr*Pr+Tr*Tr+Sr*Sr;i_>0&&(i_=1/Math.sqrt(i_));var a_=(Pr*=i_)*Pr+(Tr*=i_)*Tr+(Sr*=i_)*Sr;qr=Pr*(a_=(mr*Pr+br*Tr+fr*Sr)/a_),Rr=Tr*a_,Er=Sr*a_;var o_=h;o_.x=qr,o_.y=Rr,o_.z=Er,jr=7}var n_=h.x*h.x+h.y*h.y+h.z*h.z;if(Ia<0||n_<Ia){Va=3&jr|(4&jr)<<1,Ia=n_;var s_=h;ga=s_.x,Xa=s_.y,za=s_.z}}if(da*Ma<0){var r_,e_,__,h_,l_,c_,p_,v_,m_,b_,f_,x_,u_,y_,g_,X_,z_,M_,Y_=la;r_=Y_.x,e_=Y_.y,__=Y_.z;var Z_=ca;h_=Z_.x,l_=Z_.y,c_=Z_.z;var d_,I_,V_,L_=pa;p_=L_.x;var w_,A_,k_,B_,P_=h_*((y_=(v_=L_.y)-l_)*(V_=(b_=h_-r_)*y_-(f_=l_-e_)*(u_=p_-h_))-(g_=(m_=L_.z)-c_)*(I_=(x_=c_-__)*u_-b_*g_))+l_*(g_*(d_=f_*g_-x_*y_)-u_*V_)+c_*(u_*I_-y_*d_),T_=p_*((z_=e_-v_)*V_-(M_=__-m_)*I_)+v_*(M_*d_-(X_=r_-p_)*V_)+m_*(X_*I_-z_*d_),S_=-1,C_=0;if(w_=0,A_=0,k_=0,r_*(f_*V_-x_*I_)+e_*(x_*d_-b_*V_)+__*(b_*I_-f_*d_)<0){var q_,R_,E_,j_,N_,D_,F_=la;q_=F_.x,R_=F_.y,E_=F_.z;var O_,W_,G_,H_,U_=ca,J_=(O_=(j_=U_.x)-q_)*q_+(W_=(N_=U_.y)-R_)*R_+(G_=(D_=U_.z)-E_)*E_;if((J_=-J_/(O_*O_+W_*W_+G_*G_))<0){var Q_=h;Q_.x=q_,Q_.y=R_,Q_.z=E_,H_=1}else if(J_>1){var $_=h;$_.x=j_,$_.y=N_,$_.z=D_,H_=2}else{var K_,th,ih;K_=q_+O_*J_,th=R_+W_*J_,ih=E_+G_*J_;var ah=h;ah.x=K_,ah.y=th,ah.z=ih,H_=3}C_=H_,S_=h.x*h.x+h.y*h.y+h.z*h.z;var oh=h;w_=oh.x,A_=oh.y,k_=oh.z}if(P_<0){var nh,sh,rh,eh,_h,hh,lh=ca;nh=lh.x,sh=lh.y,rh=lh.z;var ch,ph,vh,mh,bh=pa,fh=(ch=(eh=bh.x)-nh)*nh+(ph=(_h=bh.y)-sh)*sh+(vh=(hh=bh.z)-rh)*rh;if((fh=-fh/(ch*ch+ph*ph+vh*vh))<0){var xh=h;xh.x=nh,xh.y=sh,xh.z=rh,mh=1}else if(fh>1){var uh=h;uh.x=eh,uh.y=_h,uh.z=hh,mh=2}else{var yh,gh,Xh;yh=nh+ch*fh,gh=sh+ph*fh,Xh=rh+vh*fh;var zh=h;zh.x=yh,zh.y=gh,zh.z=Xh,mh=3}var Mh=h.x*h.x+h.y*h.y+h.z*h.z;if(S_<0||Mh<S_){C_=mh<<1,S_=Mh;var Yh=h;w_=Yh.x,A_=Yh.y,k_=Yh.z}}if(T_<0){var Zh,dh,Ih,Vh,Lh,wh,Ah=la;Zh=Ah.x,dh=Ah.y,Ih=Ah.z;var kh,Bh,Ph,Th,Sh=pa,Ch=(kh=(Vh=Sh.x)-Zh)*Zh+(Bh=(Lh=Sh.y)-dh)*dh+(Ph=(wh=Sh.z)-Ih)*Ih;if((Ch=-Ch/(kh*kh+Bh*Bh+Ph*Ph))<0){var qh=h;qh.x=Zh,qh.y=dh,qh.z=Ih,Th=1}else if(Ch>1){var Rh=h;Rh.x=Vh,Rh.y=Lh,Rh.z=wh,Th=2}else{var Eh,jh,Nh;Eh=Zh+kh*Ch,jh=dh+Bh*Ch,Nh=Ih+Ph*Ch;var Dh=h;Dh.x=Eh,Dh.y=jh,Dh.z=Nh,Th=3}var Fh=h.x*h.x+h.y*h.y+h.z*h.z;if(S_<0||Fh<S_){C_=1&Th|(2&Th)<<1,S_=Fh;var Oh=h;w_=Oh.x,A_=Oh.y,k_=Oh.z}}if(S_>0){var Wh=h;Wh.x=w_,Wh.y=A_,Wh.z=k_,B_=C_}else{var Gh=d_*d_+I_*I_+V_*V_;Gh>0&&(Gh=1/Math.sqrt(Gh));var Hh=(d_*=Gh)*d_+(I_*=Gh)*I_+(V_*=Gh)*V_;w_=d_*(Hh=(r_*d_+e_*I_+__*V_)/Hh),A_=I_*Hh,k_=V_*Hh;var Uh=h;Uh.x=w_,Uh.y=A_,Uh.z=k_,B_=7}var Jh=h.x*h.x+h.y*h.y+h.z*h.z;if(Ia<0||Jh<Ia){Va=B_<<1,Ia=Jh;var Qh=h;ga=Qh.x,Xa=Qh.y,za=Qh.z}}if(Ia>0){var $h=h;$h.x=ga,$h.y=Xa,$h.z=za,M=Va}else h.zero(),M=15}if(h.x*h.x+h.y*h.y+h.z*h.z<1e-8){if(!s)return this.distance=0,0;switch(this.simplexSize){case 1:this.pointToTetrahedron();break;case 2:this.lineToTetrahedron();break;case 3:this.triangleToTetrahedron()}if(4==this.simplexSize){var Kh=this.computeDepth(t,i,a,o,r,e,_);return 0!=Kh?(this.distance=0,Kh):(this.distance=-this.depth,0)}return this.distance=0,1}this.shrinkSimplex(M),l.x=h.x,l.y=h.y,l.z=h.z;var tl=l,il=-tl.x,al=-tl.y,ol=-tl.z;tl.x=il,tl.y=al,tl.z=ol,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var nl=this.s[this.simplexSize],sl=this.w1[this.simplexSize];nl.x=sl.x,nl.y=sl.y,nl.z=sl.z;var rl=nl,el=this.w2[this.simplexSize],_l=rl.x-el.x,hl=rl.y-el.y,ll=rl.z-el.z;if(rl.x=_l,rl.y=hl,rl.z=ll,l.x*l.x+l.y*l.y+l.z*l.z<1e-8)throw new Error("!?");var cl=h.x*l.x+h.y*l.y+h.z*l.z,pl=r[this.simplexSize];if(pl.x*l.x+pl.y*l.y+pl.z*l.z-cl<1e-8)return this.interpolateClosestPoints(),this.distance=Math.sqrt(h.x*h.x+h.y*h.y+h.z*h.z),null!=n&&null!=n._gjkCache&&this.saveCache(n._gjkCache),0;this.simplexSize++,++z}return 2},convexCastImpl:function(t,i,a,o,n,s,r){this.c1=t,this.c2=i,this.tf1=a,this.tf2=o;var e,_,h,l=this.s,c=(this.w1,this.w2,this.closest),p=this.dir;e=o._positionX-a._positionX,_=o._positionY-a._positionY,h=o._positionZ-a._positionZ;var v=p;if(v.x=e,v.y=_,v.z=h,p.x*p.x+p.y*p.y+p.z*p.z<1e-6&&p.init(1,0,0),this.simplexSize=0,null!=this.c1)this.computeWitnessPoint1(!0);else{var m=this.w1[this.simplexSize];m.x=this.tf1._positionX,m.y=this.tf1._positionY,m.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);var b=this.s[this.simplexSize],f=this.w1[this.simplexSize];b.x=f.x,b.y=f.y,b.z=f.z;var x=b,u=this.w2[this.simplexSize],y=x.x-u.x,g=x.y-u.y,X=x.z-u.z;x.x=y,x.y=g,x.z=X,this.simplexSize=1;var z=0,M=0,Y=this.rayX,Z=this.rayR;Y.zero(),Z.x=s.x,Z.y=s.y,Z.z=s.z;var d=Z,I=d.x-n.x,V=d.y-n.y,L=d.z-n.z;d.x=I,d.y=V,d.z=L;for(;z<40;){var w=0;switch(this.simplexSize){case 1:var A=l[0];c.x=A.x,c.y=A.y,c.z=A.z,w=1;break;case 2:var k,B,P,T,S,C,q=l[0];k=q.x,B=q.y,P=q.z;var R,E,j,N=l[1],D=(R=(T=N.x)-k)*k+(E=(S=N.y)-B)*B+(j=(C=N.z)-P)*P;if((D=-D/(R*R+E*E+j*j))<0){var F=c;F.x=k,F.y=B,F.z=P,w=1}else if(D>1){var O=c;O.x=T,O.y=S,O.z=C,w=2}else{var W,G,H;W=k+R*D,G=B+E*D,H=P+j*D;var U=c;U.x=W,U.y=G,U.z=H,w=3}break;case 3:var J,Q,$,K,tt,it,at,ot,nt,st,rt,et,_t,ht,lt,ct,pt,vt,mt=l[0],bt=l[1],ft=l[2],xt=mt;J=xt.x,Q=xt.y,$=xt.z;var ut=bt;K=ut.x,tt=ut.y,it=ut.z;var yt,gt,Xt,zt=ft;at=zt.x;var Mt,Yt,Zt,dt=K*((ht=(ot=zt.y)-tt)*(Xt=(st=K-J)*ht-(rt=tt-Q)*(_t=at-K))-(lt=(nt=zt.z)-it)*(gt=(et=it-$)*_t-st*lt))+tt*(lt*(yt=rt*lt-et*ht)-_t*Xt)+it*(_t*gt-ht*yt),It=at*((pt=Q-ot)*Xt-(vt=$-nt)*gt)+ot*(vt*yt-(ct=J-at)*Xt)+nt*(ct*gt-pt*yt),Vt=-1,Lt=0;if(Mt=0,Yt=0,Zt=0,J*(rt*Xt-et*gt)+Q*(et*yt-st*Xt)+$*(st*gt-rt*yt)<0){var wt,At,kt,Bt,Pt,Tt,St=mt;wt=St.x,At=St.y,kt=St.z;var Ct,qt,Rt,Et,jt=bt,Nt=(Ct=(Bt=jt.x)-wt)*wt+(qt=(Pt=jt.y)-At)*At+(Rt=(Tt=jt.z)-kt)*kt;if((Nt=-Nt/(Ct*Ct+qt*qt+Rt*Rt))<0){var Dt=c;Dt.x=wt,Dt.y=At,Dt.z=kt,Et=1}else if(Nt>1){var Ft=c;Ft.x=Bt,Ft.y=Pt,Ft.z=Tt,Et=2}else{var Ot,Wt,Gt;Ot=wt+Ct*Nt,Wt=At+qt*Nt,Gt=kt+Rt*Nt;var Ht=c;Ht.x=Ot,Ht.y=Wt,Ht.z=Gt,Et=3}Lt=Et,Vt=c.x*c.x+c.y*c.y+c.z*c.z;var Ut=c;Mt=Ut.x,Yt=Ut.y,Zt=Ut.z}if(dt<0){var Jt,Qt,$t,Kt,ti,ii,ai=bt;Jt=ai.x,Qt=ai.y,$t=ai.z;var oi,ni,si,ri,ei=ft,_i=(oi=(Kt=ei.x)-Jt)*Jt+(ni=(ti=ei.y)-Qt)*Qt+(si=(ii=ei.z)-$t)*$t;if((_i=-_i/(oi*oi+ni*ni+si*si))<0){var hi=c;hi.x=Jt,hi.y=Qt,hi.z=$t,ri=1}else if(_i>1){var li=c;li.x=Kt,li.y=ti,li.z=ii,ri=2}else{var ci,pi,vi;ci=Jt+oi*_i,pi=Qt+ni*_i,vi=$t+si*_i;var mi=c;mi.x=ci,mi.y=pi,mi.z=vi,ri=3}var bi=c.x*c.x+c.y*c.y+c.z*c.z;if(Vt<0||bi<Vt){Lt=ri<<1,Vt=bi;var fi=c;Mt=fi.x,Yt=fi.y,Zt=fi.z}}if(It<0){var xi,ui,yi,gi,Xi,zi,Mi=mt;xi=Mi.x,ui=Mi.y,yi=Mi.z;var Yi,Zi,di,Ii,Vi=ft,Li=(Yi=(gi=Vi.x)-xi)*xi+(Zi=(Xi=Vi.y)-ui)*ui+(di=(zi=Vi.z)-yi)*yi;if((Li=-Li/(Yi*Yi+Zi*Zi+di*di))<0){var wi=c;wi.x=xi,wi.y=ui,wi.z=yi,Ii=1}else if(Li>1){var Ai=c;Ai.x=gi,Ai.y=Xi,Ai.z=zi,Ii=2}else{var ki,Bi,Pi;ki=xi+Yi*Li,Bi=ui+Zi*Li,Pi=yi+di*Li;var Ti=c;Ti.x=ki,Ti.y=Bi,Ti.z=Pi,Ii=3}var Si=c.x*c.x+c.y*c.y+c.z*c.z;if(Vt<0||Si<Vt){Lt=1&Ii|(2&Ii)<<1,Vt=Si;var Ci=c;Mt=Ci.x,Yt=Ci.y,Zt=Ci.z}}if(Vt>0){var qi=c;qi.x=Mt,qi.y=Yt,qi.z=Zt,w=Lt}else{var Ri=yt*yt+gt*gt+Xt*Xt;Ri>0&&(Ri=1/Math.sqrt(Ri));var Ei=(yt*=Ri)*yt+(gt*=Ri)*gt+(Xt*=Ri)*Xt;Mt=yt*(Ei=(J*yt+Q*gt+$*Xt)/Ei),Yt=gt*Ei,Zt=Xt*Ei;var ji=c;ji.x=Mt,ji.y=Yt,ji.z=Zt,w=7}break;case 4:var Ni,Di,Fi,Oi,Wi,Gi,Hi,Ui,Ji,Qi,$i,Ki,ta,ia,aa,oa,na,sa,ra,ea,_a,ha,la,ca,pa,va,ma,ba=l[0],fa=l[1],xa=l[2],ua=l[3],ya=ba;Ni=ya.x,Di=ya.y,Fi=ya.z;var ga=fa;Oi=ga.x,Wi=ga.y,Gi=ga.z;var Xa=xa;Hi=Xa.x,Ui=Xa.y,Ji=Xa.z;var za,Ma,Ya,Za=ua;(Qi=Za.x)-Hi,($i=Za.y)-Ui,(Ki=Za.z)-Ji;var da,Ia,Va,La=(ta=Oi-Ni)*(za=(va=$i-Wi)*(ca=Ji-Gi)-(ma=Ki-Gi)*(la=Ui-Wi))+(ia=Wi-Di)*(Ma=ma*(ha=Hi-Oi)-(pa=Qi-Oi)*ca)+(aa=Gi-Fi)*(Ya=pa*la-va*ha)>0?1:-1,wa=Ni*((na=Ui-Di)*(_a=Ki-Fi)-(sa=Ji-Fi)*(ea=$i-Di))+Di*(sa*(ra=Qi-Ni)-(oa=Hi-Ni)*_a)+Fi*(oa*ea-na*ra),Aa=Ni*(ea*aa-_a*ia)+Di*(_a*ta-ra*aa)+Fi*(ra*ia-ea*ta),ka=Oi*za+Wi*Ma+Gi*Ya,Ba=-1,Pa=0;if(da=0,Ia=0,Va=0,(Ni*(ia*sa-aa*na)+Di*(aa*oa-ta*sa)+Fi*(ta*na-ia*oa))*La<0){var Ta,Sa,Ca,qa,Ra,Ea,ja,Na,Da,Fa,Oa,Wa,Ga,Ha,Ua,Ja,Qa,$a,Ka=ba;Ta=Ka.x,Sa=Ka.y,Ca=Ka.z;var to=fa;qa=to.x,Ra=to.y,Ea=to.z;var io,ao,oo,no=xa;ja=no.x;var so,ro,eo,_o,ho=qa*((Ha=(Na=no.y)-Ra)*(oo=(Fa=qa-Ta)*Ha-(Oa=Ra-Sa)*(Ga=ja-qa))-(Ua=(Da=no.z)-Ea)*(ao=(Wa=Ea-Ca)*Ga-Fa*Ua))+Ra*(Ua*(io=Oa*Ua-Wa*Ha)-Ga*oo)+Ea*(Ga*ao-Ha*io),lo=ja*((Qa=Sa-Na)*oo-($a=Ca-Da)*ao)+Na*($a*io-(Ja=Ta-ja)*oo)+Da*(Ja*ao-Qa*io),co=-1,po=0;if(so=0,ro=0,eo=0,Ta*(Oa*oo-Wa*ao)+Sa*(Wa*io-Fa*oo)+Ca*(Fa*ao-Oa*io)<0){var vo,mo,bo,fo,xo,uo,yo=ba;vo=yo.x,mo=yo.y,bo=yo.z;var go,Xo,zo,Mo,Yo=fa,Zo=(go=(fo=Yo.x)-vo)*vo+(Xo=(xo=Yo.y)-mo)*mo+(zo=(uo=Yo.z)-bo)*bo;if((Zo=-Zo/(go*go+Xo*Xo+zo*zo))<0){var Io=c;Io.x=vo,Io.y=mo,Io.z=bo,Mo=1}else if(Zo>1){var Vo=c;Vo.x=fo,Vo.y=xo,Vo.z=uo,Mo=2}else{var Lo,wo,Ao;Lo=vo+go*Zo,wo=mo+Xo*Zo,Ao=bo+zo*Zo;var ko=c;ko.x=Lo,ko.y=wo,ko.z=Ao,Mo=3}po=Mo,co=c.x*c.x+c.y*c.y+c.z*c.z;var Bo=c;so=Bo.x,ro=Bo.y,eo=Bo.z}if(ho<0){var Po,To,So,Co,qo,Ro,Eo=fa;Po=Eo.x,To=Eo.y,So=Eo.z;var jo,No,Do,Fo,Oo=xa,Wo=(jo=(Co=Oo.x)-Po)*Po+(No=(qo=Oo.y)-To)*To+(Do=(Ro=Oo.z)-So)*So;if((Wo=-Wo/(jo*jo+No*No+Do*Do))<0){var Go=c;Go.x=Po,Go.y=To,Go.z=So,Fo=1}else if(Wo>1){var Ho=c;Ho.x=Co,Ho.y=qo,Ho.z=Ro,Fo=2}else{var Uo,Jo,Qo;Uo=Po+jo*Wo,Jo=To+No*Wo,Qo=So+Do*Wo;var $o=c;$o.x=Uo,$o.y=Jo,$o.z=Qo,Fo=3}var Ko=c.x*c.x+c.y*c.y+c.z*c.z;if(co<0||Ko<co){po=Fo<<1,co=Ko;var tn=c;so=tn.x,ro=tn.y,eo=tn.z}}if(lo<0){var an,on,nn,sn,rn,en,_n=ba;an=_n.x,on=_n.y,nn=_n.z;var hn,ln,cn,pn,vn=xa,mn=(hn=(sn=vn.x)-an)*an+(ln=(rn=vn.y)-on)*on+(cn=(en=vn.z)-nn)*nn;if((mn=-mn/(hn*hn+ln*ln+cn*cn))<0){var bn=c;bn.x=an,bn.y=on,bn.z=nn,pn=1}else if(mn>1){var fn=c;fn.x=sn,fn.y=rn,fn.z=en,pn=2}else{var xn,un,yn;xn=an+hn*mn,un=on+ln*mn,yn=nn+cn*mn;var gn=c;gn.x=xn,gn.y=un,gn.z=yn,pn=3}var Xn=c.x*c.x+c.y*c.y+c.z*c.z;if(co<0||Xn<co){po=1&pn|(2&pn)<<1,co=Xn;var zn=c;so=zn.x,ro=zn.y,eo=zn.z}}if(co>0){var Mn=c;Mn.x=so,Mn.y=ro,Mn.z=eo,_o=po}else{var Yn=io*io+ao*ao+oo*oo;Yn>0&&(Yn=1/Math.sqrt(Yn));var Zn=(io*=Yn)*io+(ao*=Yn)*ao+(oo*=Yn)*oo;so=io*(Zn=(Ta*io+Sa*ao+Ca*oo)/Zn),ro=ao*Zn,eo=oo*Zn;var dn=c;dn.x=so,dn.y=ro,dn.z=eo,_o=7}Pa=_o,Ba=c.x*c.x+c.y*c.y+c.z*c.z;var In=c;da=In.x,Ia=In.y,Va=In.z}if(wa*La<0){var Vn,Ln,wn,An,kn,Bn,Pn,Tn,Sn,Cn,qn,Rn,En,jn,Nn,Dn,Fn,On,Wn=ba;Vn=Wn.x,Ln=Wn.y,wn=Wn.z;var Gn=xa;An=Gn.x,kn=Gn.y,Bn=Gn.z;var Hn,Un,Jn,Qn=ua;Pn=Qn.x;var $n,Kn,ts,is,as=An*((jn=(Tn=Qn.y)-kn)*(Jn=(Cn=An-Vn)*jn-(qn=kn-Ln)*(En=Pn-An))-(Nn=(Sn=Qn.z)-Bn)*(Un=(Rn=Bn-wn)*En-Cn*Nn))+kn*(Nn*(Hn=qn*Nn-Rn*jn)-En*Jn)+Bn*(En*Un-jn*Hn),os=Pn*((Fn=Ln-Tn)*Jn-(On=wn-Sn)*Un)+Tn*(On*Hn-(Dn=Vn-Pn)*Jn)+Sn*(Dn*Un-Fn*Hn),ns=-1,ss=0;if($n=0,Kn=0,ts=0,Vn*(qn*Jn-Rn*Un)+Ln*(Rn*Hn-Cn*Jn)+wn*(Cn*Un-qn*Hn)<0){var rs,es,_s,hs,ls,cs,ps=ba;rs=ps.x,es=ps.y,_s=ps.z;var vs,ms,bs,fs,xs=xa,us=(vs=(hs=xs.x)-rs)*rs+(ms=(ls=xs.y)-es)*es+(bs=(cs=xs.z)-_s)*_s;if((us=-us/(vs*vs+ms*ms+bs*bs))<0){var ys=c;ys.x=rs,ys.y=es,ys.z=_s,fs=1}else if(us>1){var gs=c;gs.x=hs,gs.y=ls,gs.z=cs,fs=2}else{var Xs,zs,Ms;Xs=rs+vs*us,zs=es+ms*us,Ms=_s+bs*us;var Ys=c;Ys.x=Xs,Ys.y=zs,Ys.z=Ms,fs=3}ss=fs,ns=c.x*c.x+c.y*c.y+c.z*c.z;var Zs=c;$n=Zs.x,Kn=Zs.y,ts=Zs.z}if(as<0){var ds,Is,Vs,Ls,ws,As,ks=xa;ds=ks.x,Is=ks.y,Vs=ks.z;var Bs,Ps,Ts,Ss,Cs=ua,qs=(Bs=(Ls=Cs.x)-ds)*ds+(Ps=(ws=Cs.y)-Is)*Is+(Ts=(As=Cs.z)-Vs)*Vs;if((qs=-qs/(Bs*Bs+Ps*Ps+Ts*Ts))<0){var Rs=c;Rs.x=ds,Rs.y=Is,Rs.z=Vs,Ss=1}else if(qs>1){var Es=c;Es.x=Ls,Es.y=ws,Es.z=As,Ss=2}else{var js,Ns,Ds;js=ds+Bs*qs,Ns=Is+Ps*qs,Ds=Vs+Ts*qs;var Fs=c;Fs.x=js,Fs.y=Ns,Fs.z=Ds,Ss=3}var Os=c.x*c.x+c.y*c.y+c.z*c.z;if(ns<0||Os<ns){ss=Ss<<1,ns=Os;var Ws=c;$n=Ws.x,Kn=Ws.y,ts=Ws.z}}if(os<0){var Gs,Hs,Us,Js,Qs,$s,Ks=ba;Gs=Ks.x,Hs=Ks.y,Us=Ks.z;var tr,ir,ar,or,nr=ua,sr=(tr=(Js=nr.x)-Gs)*Gs+(ir=(Qs=nr.y)-Hs)*Hs+(ar=($s=nr.z)-Us)*Us;if((sr=-sr/(tr*tr+ir*ir+ar*ar))<0){var rr=c;rr.x=Gs,rr.y=Hs,rr.z=Us,or=1}else if(sr>1){var er=c;er.x=Js,er.y=Qs,er.z=$s,or=2}else{var _r,hr,lr;_r=Gs+tr*sr,hr=Hs+ir*sr,lr=Us+ar*sr;var cr=c;cr.x=_r,cr.y=hr,cr.z=lr,or=3}var pr=c.x*c.x+c.y*c.y+c.z*c.z;if(ns<0||pr<ns){ss=1&or|(2&or)<<1,ns=pr;var vr=c;$n=vr.x,Kn=vr.y,ts=vr.z}}if(ns>0){var mr=c;mr.x=$n,mr.y=Kn,mr.z=ts,is=ss}else{var br=Hn*Hn+Un*Un+Jn*Jn;br>0&&(br=1/Math.sqrt(br));var fr=(Hn*=br)*Hn+(Un*=br)*Un+(Jn*=br)*Jn;$n=Hn*(fr=(Vn*Hn+Ln*Un+wn*Jn)/fr),Kn=Un*fr,ts=Jn*fr;var xr=c;xr.x=$n,xr.y=Kn,xr.z=ts,is=7}var ur=c.x*c.x+c.y*c.y+c.z*c.z;if(Ba<0||ur<Ba){Pa=1&is|(6&is)<<1,Ba=ur;var yr=c;da=yr.x,Ia=yr.y,Va=yr.z}}if(Aa*La<0){var gr,Xr,zr,Mr,Yr,Zr,dr,Ir,Vr,Lr,wr,Ar,kr,Br,Pr,Tr,Sr,Cr,qr=ba;gr=qr.x,Xr=qr.y,zr=qr.z;var Rr=fa;Mr=Rr.x,Yr=Rr.y,Zr=Rr.z;var Er,jr,Nr,Dr=ua;dr=Dr.x;var Fr,Or,Wr,Gr,Hr=Mr*((Br=(Ir=Dr.y)-Yr)*(Nr=(Lr=Mr-gr)*Br-(wr=Yr-Xr)*(kr=dr-Mr))-(Pr=(Vr=Dr.z)-Zr)*(jr=(Ar=Zr-zr)*kr-Lr*Pr))+Yr*(Pr*(Er=wr*Pr-Ar*Br)-kr*Nr)+Zr*(kr*jr-Br*Er),Ur=dr*((Sr=Xr-Ir)*Nr-(Cr=zr-Vr)*jr)+Ir*(Cr*Er-(Tr=gr-dr)*Nr)+Vr*(Tr*jr-Sr*Er),Jr=-1,Qr=0;if(Fr=0,Or=0,Wr=0,gr*(wr*Nr-Ar*jr)+Xr*(Ar*Er-Lr*Nr)+zr*(Lr*jr-wr*Er)<0){var $r,Kr,te,ie,ae,oe,ne=ba;$r=ne.x,Kr=ne.y,te=ne.z;var se,re,ee,_e,he=fa,le=(se=(ie=he.x)-$r)*$r+(re=(ae=he.y)-Kr)*Kr+(ee=(oe=he.z)-te)*te;if((le=-le/(se*se+re*re+ee*ee))<0){var ce=c;ce.x=$r,ce.y=Kr,ce.z=te,_e=1}else if(le>1){var pe=c;pe.x=ie,pe.y=ae,pe.z=oe,_e=2}else{var ve,me,be;ve=$r+se*le,me=Kr+re*le,be=te+ee*le;var fe=c;fe.x=ve,fe.y=me,fe.z=be,_e=3}Qr=_e,Jr=c.x*c.x+c.y*c.y+c.z*c.z;var xe=c;Fr=xe.x,Or=xe.y,Wr=xe.z}if(Hr<0){var ue,ye,ge,Xe,ze,Me,Ye=fa;ue=Ye.x,ye=Ye.y,ge=Ye.z;var Ze,de,Ie,Ve,Le=ua,we=(Ze=(Xe=Le.x)-ue)*ue+(de=(ze=Le.y)-ye)*ye+(Ie=(Me=Le.z)-ge)*ge;if((we=-we/(Ze*Ze+de*de+Ie*Ie))<0){var Ae=c;Ae.x=ue,Ae.y=ye,Ae.z=ge,Ve=1}else if(we>1){var ke=c;ke.x=Xe,ke.y=ze,ke.z=Me,Ve=2}else{var Be,Pe,Te;Be=ue+Ze*we,Pe=ye+de*we,Te=ge+Ie*we;var Se=c;Se.x=Be,Se.y=Pe,Se.z=Te,Ve=3}var Ce=c.x*c.x+c.y*c.y+c.z*c.z;if(Jr<0||Ce<Jr){Qr=Ve<<1,Jr=Ce;var qe=c;Fr=qe.x,Or=qe.y,Wr=qe.z}}if(Ur<0){var Re,Ee,je,Ne,De,Fe,Oe=ba;Re=Oe.x,Ee=Oe.y,je=Oe.z;var We,Ge,He,Ue,Je=ua,Qe=(We=(Ne=Je.x)-Re)*Re+(Ge=(De=Je.y)-Ee)*Ee+(He=(Fe=Je.z)-je)*je;if((Qe=-Qe/(We*We+Ge*Ge+He*He))<0){var $e=c;$e.x=Re,$e.y=Ee,$e.z=je,Ue=1}else if(Qe>1){var Ke=c;Ke.x=Ne,Ke.y=De,Ke.z=Fe,Ue=2}else{var t_,i_,a_;t_=Re+We*Qe,i_=Ee+Ge*Qe,a_=je+He*Qe;var o_=c;o_.x=t_,o_.y=i_,o_.z=a_,Ue=3}var n_=c.x*c.x+c.y*c.y+c.z*c.z;if(Jr<0||n_<Jr){Qr=1&Ue|(2&Ue)<<1,Jr=n_;var s_=c;Fr=s_.x,Or=s_.y,Wr=s_.z}}if(Jr>0){var r_=c;r_.x=Fr,r_.y=Or,r_.z=Wr,Gr=Qr}else{var e_=Er*Er+jr*jr+Nr*Nr;e_>0&&(e_=1/Math.sqrt(e_));var __=(Er*=e_)*Er+(jr*=e_)*jr+(Nr*=e_)*Nr;Fr=Er*(__=(gr*Er+Xr*jr+zr*Nr)/__),Or=jr*__,Wr=Nr*__;var h_=c;h_.x=Fr,h_.y=Or,h_.z=Wr,Gr=7}var l_=c.x*c.x+c.y*c.y+c.z*c.z;if(Ba<0||l_<Ba){Pa=3&Gr|(4&Gr)<<1,Ba=l_;var c_=c;da=c_.x,Ia=c_.y,Va=c_.z}}if(ka*La<0){var p_,v_,m_,b_,f_,x_,u_,y_,g_,X_,z_,M_,Y_,Z_,d_,I_,V_,L_,w_=fa;p_=w_.x,v_=w_.y,m_=w_.z;var A_=xa;b_=A_.x,f_=A_.y,x_=A_.z;var k_,B_,P_,T_=ua;u_=T_.x;var S_,C_,q_,R_,E_=b_*((Z_=(y_=T_.y)-f_)*(P_=(X_=b_-p_)*Z_-(z_=f_-v_)*(Y_=u_-b_))-(d_=(g_=T_.z)-x_)*(B_=(M_=x_-m_)*Y_-X_*d_))+f_*(d_*(k_=z_*d_-M_*Z_)-Y_*P_)+x_*(Y_*B_-Z_*k_),j_=u_*((V_=v_-y_)*P_-(L_=m_-g_)*B_)+y_*(L_*k_-(I_=p_-u_)*P_)+g_*(I_*B_-V_*k_),N_=-1,D_=0;if(S_=0,C_=0,q_=0,p_*(z_*P_-M_*B_)+v_*(M_*k_-X_*P_)+m_*(X_*B_-z_*k_)<0){var F_,O_,W_,G_,H_,U_,J_=fa;F_=J_.x,O_=J_.y,W_=J_.z;var Q_,$_,K_,th,ih=xa,ah=(Q_=(G_=ih.x)-F_)*F_+($_=(H_=ih.y)-O_)*O_+(K_=(U_=ih.z)-W_)*W_;if((ah=-ah/(Q_*Q_+$_*$_+K_*K_))<0){var oh=c;oh.x=F_,oh.y=O_,oh.z=W_,th=1}else if(ah>1){var nh=c;nh.x=G_,nh.y=H_,nh.z=U_,th=2}else{var sh,rh,eh;sh=F_+Q_*ah,rh=O_+$_*ah,eh=W_+K_*ah;var _h=c;_h.x=sh,_h.y=rh,_h.z=eh,th=3}D_=th,N_=c.x*c.x+c.y*c.y+c.z*c.z;var hh=c;S_=hh.x,C_=hh.y,q_=hh.z}if(E_<0){var lh,ch,ph,vh,mh,bh,fh=xa;lh=fh.x,ch=fh.y,ph=fh.z;var xh,uh,yh,gh,Xh=ua,zh=(xh=(vh=Xh.x)-lh)*lh+(uh=(mh=Xh.y)-ch)*ch+(yh=(bh=Xh.z)-ph)*ph;if((zh=-zh/(xh*xh+uh*uh+yh*yh))<0){var Mh=c;Mh.x=lh,Mh.y=ch,Mh.z=ph,gh=1}else if(zh>1){var Yh=c;Yh.x=vh,Yh.y=mh,Yh.z=bh,gh=2}else{var Zh,dh,Ih;Zh=lh+xh*zh,dh=ch+uh*zh,Ih=ph+yh*zh;var Vh=c;Vh.x=Zh,Vh.y=dh,Vh.z=Ih,gh=3}var Lh=c.x*c.x+c.y*c.y+c.z*c.z;if(N_<0||Lh<N_){D_=gh<<1,N_=Lh;var wh=c;S_=wh.x,C_=wh.y,q_=wh.z}}if(j_<0){var Ah,kh,Bh,Ph,Th,Sh,Ch=fa;Ah=Ch.x,kh=Ch.y,Bh=Ch.z;var qh,Rh,Eh,jh,Nh=ua,Dh=(qh=(Ph=Nh.x)-Ah)*Ah+(Rh=(Th=Nh.y)-kh)*kh+(Eh=(Sh=Nh.z)-Bh)*Bh;if((Dh=-Dh/(qh*qh+Rh*Rh+Eh*Eh))<0){var Fh=c;Fh.x=Ah,Fh.y=kh,Fh.z=Bh,jh=1}else if(Dh>1){var Oh=c;Oh.x=Ph,Oh.y=Th,Oh.z=Sh,jh=2}else{var Wh,Gh,Hh;Wh=Ah+qh*Dh,Gh=kh+Rh*Dh,Hh=Bh+Eh*Dh;var Uh=c;Uh.x=Wh,Uh.y=Gh,Uh.z=Hh,jh=3}var Jh=c.x*c.x+c.y*c.y+c.z*c.z;if(N_<0||Jh<N_){D_=1&jh|(2&jh)<<1,N_=Jh;var Qh=c;S_=Qh.x,C_=Qh.y,q_=Qh.z}}if(N_>0){var $h=c;$h.x=S_,$h.y=C_,$h.z=q_,R_=D_}else{var Kh=k_*k_+B_*B_+P_*P_;Kh>0&&(Kh=1/Math.sqrt(Kh));var tl=(k_*=Kh)*k_+(B_*=Kh)*B_+(P_*=Kh)*P_;S_=k_*(tl=(p_*k_+v_*B_+m_*P_)/tl),C_=B_*tl,q_=P_*tl;var il=c;il.x=S_,il.y=C_,il.z=q_,R_=7}var al=c.x*c.x+c.y*c.y+c.z*c.z;if(Ba<0||al<Ba){Pa=R_<<1,Ba=al;var ol=c;da=ol.x,Ia=ol.y,Va=ol.z}}if(Ba>0){var nl=c;nl.x=da,nl.y=Ia,nl.z=Va,w=Pa}else c.zero(),w=15}if(this.shrinkSimplex(w),c.x*c.x+c.y*c.y+c.z*c.z<1e-8){if(0==M||4==this.simplexSize)return r.fraction=M,!1;this.interpolateClosestPoints(),r.fraction=M;var sl=r.normal;sl.x=p.x,sl.y=p.y,sl.z=p.z;var rl=sl,el=Math.sqrt(rl.x*rl.x+rl.y*rl.y+rl.z*rl.z);el>0&&(el=1/el);var _l=rl.x*el,hl=rl.y*el,ll=rl.z*el;rl.x=_l,rl.y=hl,rl.z=ll;var cl=r.position,pl=this.closestPoint1;cl.x=pl.x,cl.y=pl.y,cl.z=pl.z;var vl=cl,ml=vl.x+n.x*M,bl=vl.y+n.y*M,fl=vl.z+n.z*M;return vl.x=ml,vl.y=bl,vl.z=fl,!0}p.x=c.x,p.y=c.y,p.z=c.z;var xl=p,ul=-xl.x,yl=-xl.y,gl=-xl.z;if(xl.x=ul,xl.y=yl,xl.z=gl,null!=this.c1)this.computeWitnessPoint1(!0);else{var Xl=this.w1[this.simplexSize];Xl.x=this.tf1._positionX,Xl.y=this.tf1._positionY,Xl.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);var zl=this.s[this.simplexSize],Ml=this.w1[this.simplexSize];zl.x=Ml.x,zl.y=Ml.y,zl.z=Ml.z;var Yl=zl,Zl=this.w2[this.simplexSize],dl=Yl.x-Zl.x,Il=Yl.y-Zl.y,Vl=Yl.z-Zl.z;Yl.x=dl,Yl.y=Il,Yl.z=Vl;var Ll=l[this.simplexSize],wl=Ll.x-Y.x,Al=Ll.y-Y.y,kl=Ll.z-Y.z;if(Ll.x=wl,Ll.y=Al,Ll.z=kl,p.x*p.x+p.y*p.y+p.z*p.z<1e-8)throw new Error("!?");var Bl=l[this.simplexSize],Pl=p,Tl=Bl.x*Pl.x+Bl.y*Pl.y+Bl.z*Pl.z;if(Tl<0){if(Z.x*Pl.x+Z.y*Pl.y+Z.z*Pl.z>=0)return!1;var Sl=Tl/(Z.x*Pl.x+Z.y*Pl.y+Z.z*Pl.z);if((M+=Sl)>=1)return!1;var Cl=Y.x+Z.x*Sl,ql=Y.y+Z.y*Sl,Rl=Y.z+Z.z*Sl;Y.x=Cl,Y.y=ql,Y.z=Rl;for(var El=0,jl=this.simplexSize+1;El<jl;){var Nl=l[El++],Dl=-Sl,Fl=Nl.x+Z.x*Dl,Ol=Nl.y+Z.y*Dl,Wl=Nl.z+Z.z*Dl;Nl.x=Fl,Nl.y=Ol,Nl.z=Wl}}for(var Gl=!1,Hl=0,Ul=this.simplexSize;Hl<Ul;){var Jl=Hl++,Ql=l[Jl].x-l[this.simplexSize].x,$l=l[Jl].y-l[this.simplexSize].y,Kl=l[Jl].z-l[this.simplexSize].z;if(Ql*Ql+$l*$l+Kl*Kl<1e-8){Gl=!0;break}}Gl||this.simplexSize++,++z}return!1},interpolateClosestPoints:function(){switch(this.simplexSize){case 1:var t=this.closestPoint1,i=this.w1[0];t.x=i.x,t.y=i.y,t.z=i.z;var a=this.closestPoint2,o=this.w2[0];a.x=o.x,a.y=o.y,a.z=o.z;break;case 2:var n,s,r,e,_,h,l,c,p,v,m,b,f,x,u,y,g,X,z,M,Y,Z=this.closest;n=Z.x,s=Z.y,r=Z.z;var d=this.s[0];e=d.x,_=d.y,h=d.z;var I=this.w1[0];l=I.x,c=I.y,p=I.z;var V=this.w2[0];v=V.x,m=V.y,b=V.z;var L=this.s[1];f=L.x,x=L.y,u=L.z;var w=this.w1[1];y=w.x,g=w.y,X=w.z;var A=this.w2[1];z=A.x,M=A.y,Y=A.z;var k=this.s[2];k.x,k.y,k.z;var B=this.w1[2];B.x,B.y,B.z;var P,T,S,C=this.w2[2];C.x,C.y,C.z;var q=(P=f-e)*P+(T=x-_)*T+(S=u-h)*S;0!=q&&(q=1/q);var R,E,j,N,D,F,O=((n-e)*P+(s-_)*T+(r-h)*S)*q;R=l+(y-l)*O,E=c+(g-c)*O,j=p+(X-p)*O,N=v+(z-v)*O,D=m+(M-m)*O,F=b+(Y-b)*O;var W=this.closestPoint1;W.x=R,W.y=E,W.z=j;var G=this.closestPoint2;G.x=N,G.y=D,G.z=F;break;case 3:var H,U,J,Q,$,K,tt,it,at,ot,nt,st,rt,et,_t,ht,lt,ct,pt,vt,mt,bt,ft,xt,ut,yt,gt,Xt=this.closest;H=Xt.x,U=Xt.y,J=Xt.z;var zt=this.s[0];Q=zt.x,$=zt.y,K=zt.z;var Mt=this.w1[0];tt=Mt.x,it=Mt.y,at=Mt.z;var Yt=this.w2[0];ot=Yt.x,nt=Yt.y,st=Yt.z;var Zt=this.s[1];rt=Zt.x,et=Zt.y,_t=Zt.z;var dt=this.w1[1];ht=dt.x,lt=dt.y,ct=dt.z;var It=this.w2[1];pt=It.x,vt=It.y,mt=It.z;var Vt=this.s[2];bt=Vt.x,ft=Vt.y,xt=Vt.z;var Lt=this.w1[2];ut=Lt.x,yt=Lt.y,gt=Lt.z;var wt,At,kt,Bt,Pt,Tt,St,Ct,qt,Rt=this.w2[2],Et=(wt=rt-Q)*wt+(At=et-$)*At+(kt=_t-K)*kt,jt=wt*(Bt=bt-Q)+At*(Pt=ft-$)+kt*(Tt=xt-K),Nt=Bt*Bt+Pt*Pt+Tt*Tt,Dt=wt*(St=H-Q)+At*(Ct=U-$)+kt*(qt=J-K),Ft=Bt*St+Pt*Ct+Tt*qt,Ot=Et*Nt-jt*jt;0!=Ot&&(Ot=1/Ot);var Wt,Gt,Ht,Ut,Jt,Qt,$t=(Dt*Nt-Ft*jt)*Ot,Kt=(-Dt*jt+Ft*Et)*Ot;Wt=tt+(ht-tt)*$t,Gt=it+(lt-it)*$t,Ht=at+(ct-at)*$t,Wt+=(ut-tt)*Kt,Gt+=(yt-it)*Kt,Ht+=(gt-at)*Kt,Ut=ot+(pt-ot)*$t,Jt=nt+(vt-nt)*$t,Qt=st+(mt-st)*$t,Ut+=(Rt.x-ot)*Kt,Jt+=(Rt.y-nt)*Kt,Qt+=(Rt.z-st)*Kt;var ti=this.closestPoint1;ti.x=Wt,ti.y=Gt,ti.z=Ht;var ii=this.closestPoint2;ii.x=Ut,ii.y=Jt,ii.z=Qt;break;default:throw new Error("!?")}},loadCache:function(t){var i=this.dir,a=t.prevClosestDir;i.x=a.x,i.y=a.y,i.z=a.z},saveCache:function(t){var i=t.prevClosestDir,a=this.closest;i.x=a.x,i.y=a.y,i.z=a.z;var o=i,n=-o.x,s=-o.y,r=-o.z;o.x=n,o.y=s,o.z=r},shrinkSimplex:function(t){switch(this.simplexSize=t,this.simplexSize=(5&this.simplexSize)+(this.simplexSize>>1&5),this.simplexSize=(3&this.simplexSize)+(this.simplexSize>>2&3),t){case 2:var i=this.s[0],a=this.s[1];i.x=a.x,i.y=a.y,i.z=a.z;var o=this.w1[0],n=this.w1[1];o.x=n.x,o.y=n.y,o.z=n.z;var s=this.w2[0],r=this.w2[1];s.x=r.x,s.y=r.y,s.z=r.z;break;case 4:var e=this.s[0],_=this.s[2];e.x=_.x,e.y=_.y,e.z=_.z;var h=this.w1[0],l=this.w1[2];h.x=l.x,h.y=l.y,h.z=l.z;var c=this.w2[0],p=this.w2[2];c.x=p.x,c.y=p.y,c.z=p.z;break;case 5:var v=this.s[1],m=this.s[2];v.x=m.x,v.y=m.y,v.z=m.z;var b=this.w1[1],f=this.w1[2];b.x=f.x,b.y=f.y,b.z=f.z;var x=this.w2[1],u=this.w2[2];x.x=u.x,x.y=u.y,x.z=u.z;break;case 6:var y=this.s[0],g=this.s[2];y.x=g.x,y.y=g.y,y.z=g.z;var X=this.w1[0],z=this.w1[2];X.x=z.x,X.y=z.y,X.z=z.z;var M=this.w2[0],Y=this.w2[2];M.x=Y.x,M.y=Y.y,M.z=Y.z;break;case 8:var Z=this.s[0],d=this.s[3];Z.x=d.x,Z.y=d.y,Z.z=d.z;var I=this.w1[0],V=this.w1[3];I.x=V.x,I.y=V.y,I.z=V.z;var L=this.w2[0],w=this.w2[3];L.x=w.x,L.y=w.y,L.z=w.z;break;case 9:var A=this.s[1],k=this.s[3];A.x=k.x,A.y=k.y,A.z=k.z;var B=this.w1[1],P=this.w1[3];B.x=P.x,B.y=P.y,B.z=P.z;var T=this.w2[1],S=this.w2[3];T.x=S.x,T.y=S.y,T.z=S.z;break;case 10:var C=this.s[0],q=this.s[3];C.x=q.x,C.y=q.y,C.z=q.z;var R=this.w1[0],E=this.w1[3];R.x=E.x,R.y=E.y,R.z=E.z;var j=this.w2[0],N=this.w2[3];j.x=N.x,j.y=N.y,j.z=N.z;break;case 11:var D=this.s[2],F=this.s[3];D.x=F.x,D.y=F.y,D.z=F.z;var O=this.w1[2],W=this.w1[3];O.x=W.x,O.y=W.y,O.z=W.z;var G=this.w2[2],H=this.w2[3];G.x=H.x,G.y=H.y,G.z=H.z;break;case 12:var U=this.s[0],J=this.s[2];U.x=J.x,U.y=J.y,U.z=J.z;var Q=this.w1[0],$=this.w1[2];Q.x=$.x,Q.y=$.y,Q.z=$.z;var K=this.w2[0],tt=this.w2[2];K.x=tt.x,K.y=tt.y,K.z=tt.z;var it=this.s[1],at=this.s[3];it.x=at.x,it.y=at.y,it.z=at.z;var ot=this.w1[1],nt=this.w1[3];ot.x=nt.x,ot.y=nt.y,ot.z=nt.z;var st=this.w2[1],rt=this.w2[3];st.x=rt.x,st.y=rt.y,st.z=rt.z;break;case 13:var et=this.s[1],_t=this.s[3];et.x=_t.x,et.y=_t.y,et.z=_t.z;var ht=this.w1[1],lt=this.w1[3];ht.x=lt.x,ht.y=lt.y,ht.z=lt.z;var ct=this.w2[1],pt=this.w2[3];ct.x=pt.x,ct.y=pt.y,ct.z=pt.z;break;case 14:var vt=this.s[0],mt=this.s[3];vt.x=mt.x,vt.y=mt.y,vt.z=mt.z;var bt=this.w1[0],ft=this.w1[3];bt.x=ft.x,bt.y=ft.y,bt.z=ft.z;var xt=this.w2[0],ut=this.w2[3];xt.x=ut.x,xt.y=ut.y,xt.z=ut.z}},computeWitnessPoint1:function(t){var i,a,o,n,s,r,e,_,h,l,c,p,v=this.dir;n=v.x,s=v.y,r=v.z,e=this.tf1._rotation00*n+this.tf1._rotation10*s+this.tf1._rotation20*r,_=this.tf1._rotation01*n+this.tf1._rotation11*s+this.tf1._rotation21*r,h=this.tf1._rotation02*n+this.tf1._rotation12*s+this.tf1._rotation22*r;var m=this.dir;if(m.x=e,m.y=_,m.z=h,this.c1.computeLocalSupportingVertex(this.dir,this.w1[this.simplexSize]),t){var b=this.dir,f=Math.sqrt(b.x*b.x+b.y*b.y+b.z*b.z);f>0&&(f=1/f);var x=b.x*f,u=b.y*f,y=b.z*f;b.x=x,b.y=u,b.z=y;var g=this.w1[this.simplexSize],X=this.dir,z=this.c1._gjkMargin,M=g.x+X.x*z,Y=g.y+X.y*z,Z=g.z+X.z*z;g.x=M,g.y=Y,g.z=Z}var d=this.w1[this.simplexSize];i=d.x,a=d.y,o=d.z,l=this.tf1._rotation00*i+this.tf1._rotation01*a+this.tf1._rotation02*o,c=this.tf1._rotation10*i+this.tf1._rotation11*a+this.tf1._rotation12*o,p=this.tf1._rotation20*i+this.tf1._rotation21*a+this.tf1._rotation22*o,l+=this.tf1._positionX,c+=this.tf1._positionY,p+=this.tf1._positionZ;var I=this.w1[this.simplexSize];I.x=l,I.y=c,I.z=p;var V=this.dir;V.x=n,V.y=s,V.z=r},computeWitnessPoint2:function(t){var i,a,o,n,s,r,e,_,h,l,c,p,v=this.dir;n=v.x,s=v.y,r=v.z,e=-(e=this.tf2._rotation00*n+this.tf2._rotation10*s+this.tf2._rotation20*r),_=-(_=this.tf2._rotation01*n+this.tf2._rotation11*s+this.tf2._rotation21*r),h=-(h=this.tf2._rotation02*n+this.tf2._rotation12*s+this.tf2._rotation22*r);var m=this.dir;if(m.x=e,m.y=_,m.z=h,this.c2.computeLocalSupportingVertex(this.dir,this.w2[this.simplexSize]),t){var b=this.dir,f=Math.sqrt(b.x*b.x+b.y*b.y+b.z*b.z);f>0&&(f=1/f);var x=b.x*f,u=b.y*f,y=b.z*f;b.x=x,b.y=u,b.z=y;var g=this.w2[this.simplexSize],X=this.dir,z=this.c2._gjkMargin,M=g.x+X.x*z,Y=g.y+X.y*z,Z=g.z+X.z*z;g.x=M,g.y=Y,g.z=Z}var d=this.w2[this.simplexSize];i=d.x,a=d.y,o=d.z,l=this.tf2._rotation00*i+this.tf2._rotation01*a+this.tf2._rotation02*o,c=this.tf2._rotation10*i+this.tf2._rotation11*a+this.tf2._rotation12*o,p=this.tf2._rotation20*i+this.tf2._rotation21*a+this.tf2._rotation22*o,l+=this.tf2._positionX,c+=this.tf2._positionY,p+=this.tf2._positionZ;var I=this.w2[this.simplexSize];I.x=l,I.y=c,I.z=p;var V=this.dir;V.x=n,V.y=s,V.z=r},pointToTetrahedron:function(){for(var t=0;t<3;){var i=t++,a=this.dir,o=this.baseDirs[i];a.x=o.x,a.y=o.y,a.z=o.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var n=this.s[this.simplexSize],s=this.w1[this.simplexSize];n.x=s.x,n.y=s.y,n.z=s.z;var r=n,e=this.w2[this.simplexSize],_=r.x-e.x,h=r.y-e.y,l=r.z-e.z;if(r.x=_,r.y=h,r.z=l,this.simplexSize++,this.lineToTetrahedron(),4==this.simplexSize)break;this.simplexSize--;var c=this.dir,p=-c.x,v=-c.y,m=-c.z;c.x=p,c.y=v,c.z=m,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var b=this.s[this.simplexSize],f=this.w1[this.simplexSize];b.x=f.x,b.y=f.y,b.z=f.z;var x=b,u=this.w2[this.simplexSize],y=x.x-u.x,g=x.y-u.y,X=x.z-u.z;if(x.x=y,x.y=g,x.z=X,this.simplexSize++,this.lineToTetrahedron(),4==this.simplexSize)break;this.simplexSize--}},lineToTetrahedron:function(){var t,i,a,o,n,s,r,e,_,h=this.dir;t=h.x,i=h.y,a=h.z;var l=this.s[0];o=l.x,n=l.y,s=l.z;var c=this.s[1];r=o-c.x,e=n-c.y,_=s-c.z;for(var p=0;p<3;){var v,m,b,f,x,u,y=p++,g=this.baseDirs[y];v=g.x,m=g.y,f=e*(b=g.z)-_*m,x=_*v-r*b,u=r*m-e*v;var X=this.dir;X.x=f,X.y=x,X.z=u,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var z=this.s[this.simplexSize],M=this.w1[this.simplexSize];z.x=M.x,z.y=M.y,z.z=M.z;var Y=z,Z=this.w2[this.simplexSize],d=Y.x-Z.x,I=Y.y-Z.y,V=Y.z-Z.z;if(Y.x=d,Y.y=I,Y.z=V,this.simplexSize++,this.triangleToTetrahedron(),4==this.simplexSize)break;this.simplexSize--;var L=this.dir,w=-L.x,A=-L.y,k=-L.z;L.x=w,L.y=A,L.z=k,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var B=this.s[this.simplexSize],P=this.w1[this.simplexSize];B.x=P.x,B.y=P.y,B.z=P.z;var T=B,S=this.w2[this.simplexSize],C=T.x-S.x,q=T.y-S.y,R=T.z-S.z;if(T.x=C,T.y=q,T.z=R,this.simplexSize++,this.triangleToTetrahedron(),4==this.simplexSize)break;this.simplexSize--}var E=this.dir;E.x=t,E.y=i,E.z=a},triangleToTetrahedron:function(){var t,i,a,o=this.dir;for(t=o.x,i=o.y,a=o.z;;){var n,s,r,e,_,h,l,c,p,v,m,b,f,x,u=this.s[0];n=u.x,s=u.y,r=u.z;var y=this.s[1];e=y.x,_=y.y,h=y.z;var g,X,z,M=this.s[2];l=M.x,c=M.y,g=(v=_-s)*(x=M.z-r)-(m=h-r)*(f=c-s),X=m*(b=l-n)-(p=e-n)*x,z=p*f-v*b;var Y=this.dir;Y.x=g,Y.y=X,Y.z=z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var Z=this.s[this.simplexSize],d=this.w1[this.simplexSize];Z.x=d.x,Z.y=d.y,Z.z=d.z;var I=Z,V=this.w2[this.simplexSize],L=I.x-V.x,w=I.y-V.y,A=I.z-V.z;if(I.x=L,I.y=w,I.z=A,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;var k=this.dir,B=-k.x,P=-k.y,T=-k.z;k.x=B,k.y=P,k.z=T,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var S=this.s[this.simplexSize],C=this.w1[this.simplexSize];S.x=C.x,S.y=C.y,S.z=C.z;var q=S,R=this.w2[this.simplexSize],E=q.x-R.x,j=q.y-R.y,N=q.z-R.z;if(q.x=E,q.y=j,q.z=N,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;break}var D=this.dir;D.x=t,D.y=i,D.z=a},isValidTetrahedron:function(){var t=this.s[1].x-this.s[0].x,i=this.s[1].y-this.s[0].y,a=this.s[1].z-this.s[0].z,o=this.s[2].x-this.s[0].x,n=this.s[2].y-this.s[0].y,s=this.s[2].z-this.s[0].z,r=this.s[3].x-this.s[0].x,e=this.s[3].y-this.s[0].y,_=this.s[3].z-this.s[0].z,h=t*(n*_-s*e)-i*(o*_-s*r)+a*(o*e-n*r);return h>1e-12||h<-1e-12},computeDepth:function(t,i,a,o,n,s,r){for(var e=this.polyhedron;e._numTriangles>0;){var _=e._triangleList;e._numTriangles--;var h=_._prev,l=_._next;null!=h&&(h._next=l),null!=l&&(l._prev=h),_==e._triangleList&&(e._triangleList=e._triangleList._next),_==e._triangleListLast&&(e._triangleListLast=e._triangleListLast._prev),_._next=null,_._prev=null,_.removeReferences(),_._next=e._trianglePool,e._trianglePool=_}for(;e._numVertices>0;){var c=e._vertices[--e._numVertices];c.removeReferences(),c._next=e._vertexPool,e._vertexPool=c}var p=this.polyhedron,v=this.polyhedron,m=v._vertexPool;null!=m?(v._vertexPool=m._next,m._next=null):m=new N;var b=m.init(n[0],s[0],r[0]),f=this.polyhedron,x=f._vertexPool;null!=x?(f._vertexPool=x._next,x._next=null):x=new N;var u=x.init(n[1],s[1],r[1]),y=this.polyhedron,g=y._vertexPool;null!=g?(y._vertexPool=g._next,g._next=null):g=new N;var X=g.init(n[2],s[2],r[2]),z=this.polyhedron,M=z._vertexPool;if(null!=M?(z._vertexPool=M._next,M._next=null):M=new N,!p._init(b,u,X,M.init(n[3],s[3],r[3])))return H.EPA_FAILED_TO_INIT;this.simplexSize=0;for(var Y=this.s[0],Z=this.w1[0],d=this.w2[0],I=0;I<40;){for(var V=this.polyhedron._triangleList,L=1/0,w=null;null!=V;){var A=V._next;V._distanceSq<L&&(L=V._distanceSq,w=V),V=A}var k=w,B=this.dir,P=k._normal;B.x=P.x,B.y=P.y,B.z=P.z;var T=B,S=Math.sqrt(T.x*T.x+T.y*T.y+T.z*T.z);S>0&&(S=1/S);var C=T.x*S,q=T.y*S,R=T.z*S;T.x=C,T.y=q,T.z=R,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var E=this.s[this.simplexSize],j=this.w1[this.simplexSize];E.x=j.x,E.y=j.y,E.z=j.z;var D=E,F=this.w2[this.simplexSize],O=D.x-F.x,W=D.y-F.y,G=D.z-F.z;D.x=O,D.y=W,D.z=G;var U=k._vertices[0],J=k._vertices[1],Q=k._vertices[2],$=U.v,K=this.dir,tt=$.x*K.x+$.y*K.y+$.z*K.z,it=this.dir;if(Y.x*it.x+Y.y*it.y+Y.z*it.z-tt<1e-6||39==I){var at=this.closest,ot=this.dir;at.x=ot.x,at.y=ot.y,at.z=ot.z;var nt,st,rt,et=at,_t=this.dir,ht=U.v,lt=this.dir,ct=(_t.x*ht.x+_t.y*ht.y+_t.z*ht.z)/(lt.x*lt.x+lt.y*lt.y+lt.z*lt.z),pt=et.x*ct,vt=et.y*ct,mt=et.z*ct;et.x=pt,et.y=vt,et.z=mt;var bt,ft,xt,ut,yt,gt,Xt,zt,Mt,Yt,Zt,dt,It,Vt,Lt,wt,At,kt,Bt,Pt,Tt,St,Ct,qt,Rt=this.closest;nt=Rt.x,st=Rt.y,rt=Rt.z;var Et=U.v;bt=Et.x,ft=Et.y,xt=Et.z;var jt=U.w1;ut=jt.x,yt=jt.y,gt=jt.z;var Nt=U.w2;Xt=Nt.x,zt=Nt.y,Mt=Nt.z;var Dt=J.v;Yt=Dt.x,Zt=Dt.y,dt=Dt.z;var Ft=J.w1;It=Ft.x,Vt=Ft.y,Lt=Ft.z;var Ot=J.w2;wt=Ot.x,At=Ot.y,kt=Ot.z;var Wt=Q.v;Bt=Wt.x,Pt=Wt.y,Tt=Wt.z;var Gt=Q.w1;St=Gt.x,Ct=Gt.y,qt=Gt.z;var Ht,Ut,Jt,Qt,$t,Kt,ti,ii,ai,oi=Q.w2,ni=(Ht=Yt-bt)*Ht+(Ut=Zt-ft)*Ut+(Jt=dt-xt)*Jt,si=Ht*(Qt=Bt-bt)+Ut*($t=Pt-ft)+Jt*(Kt=Tt-xt),ri=Qt*Qt+$t*$t+Kt*Kt,ei=Ht*(ti=nt-bt)+Ut*(ii=st-ft)+Jt*(ai=rt-xt),_i=Qt*ti+$t*ii+Kt*ai,hi=ni*ri-si*si;0!=hi&&(hi=1/hi);var li,ci,pi,vi,mi,bi,fi=(ei*ri-_i*si)*hi,xi=(-ei*si+_i*ni)*hi;li=ut+(It-ut)*fi,ci=yt+(Vt-yt)*fi,pi=gt+(Lt-gt)*fi,li+=(St-ut)*xi,ci+=(Ct-yt)*xi,pi+=(qt-gt)*xi,vi=Xt+(wt-Xt)*fi,mi=zt+(At-zt)*fi,bi=Mt+(kt-Mt)*fi,vi+=(oi.x-Xt)*xi,mi+=(oi.y-zt)*xi,bi+=(oi.z-Mt)*xi;var ui=this.closestPoint1;ui.x=li,ui.y=ci,ui.z=pi;var yi=this.closestPoint2;yi.x=vi,yi.y=mi,yi.z=bi;var gi=this.closest;return this.depth=Math.sqrt(gi.x*gi.x+gi.y*gi.y+gi.z*gi.z),H.SUCCEEDED}var Xi=this.polyhedron,zi=Xi._vertexPool;null!=zi?(Xi._vertexPool=zi._next,zi._next=null):zi=new N;var Mi=zi.init(Y,Z,d);if(!this.polyhedron._addVertex(Mi,k))return H.EPA_FAILED_TO_ADD_VERTEX;++I}return H.EPA_DID_NOT_CONVERGE},computeClosestPoints:function(t,i,a,o,n){return this.computeClosestPointsImpl(t,i,a,o,n,!0)},computeDistance:function(t,i,a,o,n){return this.computeClosestPointsImpl(t,i,a,o,n,!1)},convexCast:function(t,i,a,o,n,s,r){return this.convexCastImpl(t,i,a,o,n,s,r)},rayCast:function(t,i,a,o,n){var s=this.tempTransform,r=i,e=a;s._positionX=e.x,s._positionY=e.y,s._positionZ=e.z;var _=this.tl1,h=this.tl2;_.x=o.x,_.y=o.y,_.z=o.z;var l=_,c=l.x-a.x,p=l.y-a.y,v=l.z-a.z;return l.x=c,l.y=p,l.z=v,h.zero(),this.convexCastImpl(null,t,s,r,_,h,n)}};var H=function(){},U=function(){};U.projectOrigin2=function(t,i,a){var o,n,s,r,e,_,h=t;o=h.x,n=h.y,s=h.z;var l,c,p,v,m,b,f=i,x=(l=(r=f.x)-o)*o+(c=(e=f.y)-n)*n+(p=(_=f.z)-s)*s;if((x=-x/(l*l+c*c+p*p))<0){var u=a;return u.x=o,u.y=n,u.z=s,1}if(x>1){var y=a;return y.x=r,y.y=e,y.z=_,2}v=o+l*x,m=n+c*x,b=s+p*x;var g=a;return g.x=v,g.y=m,g.z=b,3},U.projectOrigin3=function(t,i,a,o){var n,s,r,e,_,h,l,c,p,v,m,b,f,x,u,y,g,X,z=t;n=z.x,s=z.y,r=z.z;var M=i;e=M.x,_=M.y,h=M.z;var Y,Z,d,I=a;l=I.x;var V,L,w,A=e*((x=(c=I.y)-_)*(d=(v=e-n)*x-(m=_-s)*(f=l-e))-(u=(p=I.z)-h)*(Z=(b=h-r)*f-v*u))+_*(u*(Y=m*u-b*x)-f*d)+h*(f*Z-x*Y),k=l*((g=s-c)*d-(X=r-p)*Z)+c*(X*Y-(y=n-l)*d)+p*(y*Z-g*Y),B=-1,P=0;if(V=0,L=0,w=0,n*(m*d-b*Z)+s*(b*Y-v*d)+r*(v*Z-m*Y)<0){var T,S,C,q,R,E,j=t;T=j.x,S=j.y,C=j.z;var N,D,F,O,W=i,G=(N=(q=W.x)-T)*T+(D=(R=W.y)-S)*S+(F=(E=W.z)-C)*C;if((G=-G/(N*N+D*D+F*F))<0){var H=o;H.x=T,H.y=S,H.z=C,O=1}else if(G>1){var U=o;U.x=q,U.y=R,U.z=E,O=2}else{var J,Q,$;J=T+N*G,Q=S+D*G,$=C+F*G;var K=o;K.x=J,K.y=Q,K.z=$,O=3}P=O,B=o.x*o.x+o.y*o.y+o.z*o.z;var tt=o;V=tt.x,L=tt.y,w=tt.z}if(A<0){var it,at,ot,nt,st,rt,et=i;it=et.x,at=et.y,ot=et.z;var _t,ht,lt,ct,pt=a,vt=(_t=(nt=pt.x)-it)*it+(ht=(st=pt.y)-at)*at+(lt=(rt=pt.z)-ot)*ot;if((vt=-vt/(_t*_t+ht*ht+lt*lt))<0){var mt=o;mt.x=it,mt.y=at,mt.z=ot,ct=1}else if(vt>1){var bt=o;bt.x=nt,bt.y=st,bt.z=rt,ct=2}else{var ft,xt,ut;ft=it+_t*vt,xt=at+ht*vt,ut=ot+lt*vt;var yt=o;yt.x=ft,yt.y=xt,yt.z=ut,ct=3}var gt=o.x*o.x+o.y*o.y+o.z*o.z;if(B<0||gt<B){P=ct<<1,B=gt;var Xt=o;V=Xt.x,L=Xt.y,w=Xt.z}}if(k<0){var zt,Mt,Yt,Zt,dt,It,Vt=t;zt=Vt.x,Mt=Vt.y,Yt=Vt.z;var Lt,wt,At,kt,Bt=a,Pt=(Lt=(Zt=Bt.x)-zt)*zt+(wt=(dt=Bt.y)-Mt)*Mt+(At=(It=Bt.z)-Yt)*Yt;if((Pt=-Pt/(Lt*Lt+wt*wt+At*At))<0){var Tt=o;Tt.x=zt,Tt.y=Mt,Tt.z=Yt,kt=1}else if(Pt>1){var St=o;St.x=Zt,St.y=dt,St.z=It,kt=2}else{var Ct,qt,Rt;Ct=zt+Lt*Pt,qt=Mt+wt*Pt,Rt=Yt+At*Pt;var Et=o;Et.x=Ct,Et.y=qt,Et.z=Rt,kt=3}var jt=o.x*o.x+o.y*o.y+o.z*o.z;if(B<0||jt<B){P=1&kt|(2&kt)<<1,B=jt;var Nt=o;V=Nt.x,L=Nt.y,w=Nt.z}}if(B>0){var Dt=o;return Dt.x=V,Dt.y=L,Dt.z=w,P}var Ft=Y*Y+Z*Z+d*d;Ft>0&&(Ft=1/Math.sqrt(Ft));var Ot=(Y*=Ft)*Y+(Z*=Ft)*Z+(d*=Ft)*d;V=Y*(Ot=(n*Y+s*Z+r*d)/Ot),L=Z*Ot,w=d*Ot;var Wt=o;return Wt.x=V,Wt.y=L,Wt.z=w,7},U.projectOrigin4=function(t,i,a,o,n){var s,r,e,_,h,l,c,p,v,m,b,f,x,u,y,g,X,z,M,Y,Z,d,I,V,L,w,A,k=t;s=k.x,r=k.y,e=k.z;var B=i;_=B.x,h=B.y,l=B.z;var P=a;c=P.x,p=P.y,v=P.z;var T,S,C,q=o;m=q.x,b=q.y,f=q.z;var R,E,j,N=(x=_-s)*(T=(w=b-h)*(V=v-l)-(A=f-l)*(I=p-h))+(u=h-r)*(S=A*(d=c-_)-(L=m-_)*V)+(y=l-e)*(C=L*I-w*d)>0?1:-1,D=s*((X=p-r)*(Z=f-e)-(z=v-e)*(Y=b-r))+r*(z*(M=m-s)-(g=c-s)*Z)+e*(g*Y-X*M),F=s*(Y*y-Z*u)+r*(Z*x-M*y)+e*(M*u-Y*x),O=_*T+h*S+l*C,W=-1,G=0;if(R=0,E=0,j=0,(s*(u*z-y*X)+r*(y*g-x*z)+e*(x*X-u*g))*N<0){var H,U,J,Q,$,K,tt,it,at,ot,nt,st,rt,et,_t,ht,lt,ct,pt=t;H=pt.x,U=pt.y,J=pt.z;var vt=i;Q=vt.x,$=vt.y,K=vt.z;var mt,bt,ft,xt=a;tt=xt.x;var ut,yt,gt,Xt,zt=Q*((et=(it=xt.y)-$)*(ft=(ot=Q-H)*et-(nt=$-U)*(rt=tt-Q))-(_t=(at=xt.z)-K)*(bt=(st=K-J)*rt-ot*_t))+$*(_t*(mt=nt*_t-st*et)-rt*ft)+K*(rt*bt-et*mt),Mt=tt*((lt=U-it)*ft-(ct=J-at)*bt)+it*(ct*mt-(ht=H-tt)*ft)+at*(ht*bt-lt*mt),Yt=-1,Zt=0;if(ut=0,yt=0,gt=0,H*(nt*ft-st*bt)+U*(st*mt-ot*ft)+J*(ot*bt-nt*mt)<0){var dt,It,Vt,Lt,wt,At,kt=t;dt=kt.x,It=kt.y,Vt=kt.z;var Bt,Pt,Tt,St,Ct=i,qt=(Bt=(Lt=Ct.x)-dt)*dt+(Pt=(wt=Ct.y)-It)*It+(Tt=(At=Ct.z)-Vt)*Vt;if((qt=-qt/(Bt*Bt+Pt*Pt+Tt*Tt))<0){var Rt=n;Rt.x=dt,Rt.y=It,Rt.z=Vt,St=1}else if(qt>1){var Et=n;Et.x=Lt,Et.y=wt,Et.z=At,St=2}else{var jt,Nt,Dt;jt=dt+Bt*qt,Nt=It+Pt*qt,Dt=Vt+Tt*qt;var Ft=n;Ft.x=jt,Ft.y=Nt,Ft.z=Dt,St=3}Zt=St,Yt=n.x*n.x+n.y*n.y+n.z*n.z;var Ot=n;ut=Ot.x,yt=Ot.y,gt=Ot.z}if(zt<0){var Wt,Gt,Ht,Ut,Jt,Qt,$t=i;Wt=$t.x,Gt=$t.y,Ht=$t.z;var Kt,ti,ii,ai,oi=a,ni=(Kt=(Ut=oi.x)-Wt)*Wt+(ti=(Jt=oi.y)-Gt)*Gt+(ii=(Qt=oi.z)-Ht)*Ht;if((ni=-ni/(Kt*Kt+ti*ti+ii*ii))<0){var si=n;si.x=Wt,si.y=Gt,si.z=Ht,ai=1}else if(ni>1){var ri=n;ri.x=Ut,ri.y=Jt,ri.z=Qt,ai=2}else{var ei,_i,hi;ei=Wt+Kt*ni,_i=Gt+ti*ni,hi=Ht+ii*ni;var li=n;li.x=ei,li.y=_i,li.z=hi,ai=3}var ci=n.x*n.x+n.y*n.y+n.z*n.z;if(Yt<0||ci<Yt){Zt=ai<<1,Yt=ci;var pi=n;ut=pi.x,yt=pi.y,gt=pi.z}}if(Mt<0){var vi,mi,bi,fi,xi,ui,yi=t;vi=yi.x,mi=yi.y,bi=yi.z;var gi,Xi,zi,Mi,Yi=a,Zi=(gi=(fi=Yi.x)-vi)*vi+(Xi=(xi=Yi.y)-mi)*mi+(zi=(ui=Yi.z)-bi)*bi;if((Zi=-Zi/(gi*gi+Xi*Xi+zi*zi))<0){var di=n;di.x=vi,di.y=mi,di.z=bi,Mi=1}else if(Zi>1){var Ii=n;Ii.x=fi,Ii.y=xi,Ii.z=ui,Mi=2}else{var Vi,Li,wi;Vi=vi+gi*Zi,Li=mi+Xi*Zi,wi=bi+zi*Zi;var Ai=n;Ai.x=Vi,Ai.y=Li,Ai.z=wi,Mi=3}var ki=n.x*n.x+n.y*n.y+n.z*n.z;if(Yt<0||ki<Yt){Zt=1&Mi|(2&Mi)<<1,Yt=ki;var Bi=n;ut=Bi.x,yt=Bi.y,gt=Bi.z}}if(Yt>0){var Pi=n;Pi.x=ut,Pi.y=yt,Pi.z=gt,Xt=Zt}else{var Ti=mt*mt+bt*bt+ft*ft;Ti>0&&(Ti=1/Math.sqrt(Ti));var Si=(mt*=Ti)*mt+(bt*=Ti)*bt+(ft*=Ti)*ft;ut=mt*(Si=(H*mt+U*bt+J*ft)/Si),yt=bt*Si,gt=ft*Si;var Ci=n;Ci.x=ut,Ci.y=yt,Ci.z=gt,Xt=7}G=Xt,W=n.x*n.x+n.y*n.y+n.z*n.z;var qi=n;R=qi.x,E=qi.y,j=qi.z}if(D*N<0){var Ri,Ei,ji,Ni,Di,Fi,Oi,Wi,Gi,Hi,Ui,Ji,Qi,$i,Ki,ta,ia,aa,oa=t;Ri=oa.x,Ei=oa.y,ji=oa.z;var na=a;Ni=na.x,Di=na.y,Fi=na.z;var sa,ra,ea,_a=o;Oi=_a.x;var ha,la,ca,pa,va=Ni*(($i=(Wi=_a.y)-Di)*(ea=(Hi=Ni-Ri)*$i-(Ui=Di-Ei)*(Qi=Oi-Ni))-(Ki=(Gi=_a.z)-Fi)*(ra=(Ji=Fi-ji)*Qi-Hi*Ki))+Di*(Ki*(sa=Ui*Ki-Ji*$i)-Qi*ea)+Fi*(Qi*ra-$i*sa),ma=Oi*((ia=Ei-Wi)*ea-(aa=ji-Gi)*ra)+Wi*(aa*sa-(ta=Ri-Oi)*ea)+Gi*(ta*ra-ia*sa),ba=-1,fa=0;if(ha=0,la=0,ca=0,Ri*(Ui*ea-Ji*ra)+Ei*(Ji*sa-Hi*ea)+ji*(Hi*ra-Ui*sa)<0){var xa,ua,ya,ga,Xa,za,Ma=t;xa=Ma.x,ua=Ma.y,ya=Ma.z;var Ya,Za,da,Ia,Va=a,La=(Ya=(ga=Va.x)-xa)*xa+(Za=(Xa=Va.y)-ua)*ua+(da=(za=Va.z)-ya)*ya;if((La=-La/(Ya*Ya+Za*Za+da*da))<0){var wa=n;wa.x=xa,wa.y=ua,wa.z=ya,Ia=1}else if(La>1){var Aa=n;Aa.x=ga,Aa.y=Xa,Aa.z=za,Ia=2}else{var ka,Ba,Pa;ka=xa+Ya*La,Ba=ua+Za*La,Pa=ya+da*La;var Ta=n;Ta.x=ka,Ta.y=Ba,Ta.z=Pa,Ia=3}fa=Ia,ba=n.x*n.x+n.y*n.y+n.z*n.z;var Sa=n;ha=Sa.x,la=Sa.y,ca=Sa.z}if(va<0){var Ca,qa,Ra,Ea,ja,Na,Da=a;Ca=Da.x,qa=Da.y,Ra=Da.z;var Fa,Oa,Wa,Ga,Ha=o,Ua=(Fa=(Ea=Ha.x)-Ca)*Ca+(Oa=(ja=Ha.y)-qa)*qa+(Wa=(Na=Ha.z)-Ra)*Ra;if((Ua=-Ua/(Fa*Fa+Oa*Oa+Wa*Wa))<0){var Ja=n;Ja.x=Ca,Ja.y=qa,Ja.z=Ra,Ga=1}else if(Ua>1){var Qa=n;Qa.x=Ea,Qa.y=ja,Qa.z=Na,Ga=2}else{var $a,Ka,to;$a=Ca+Fa*Ua,Ka=qa+Oa*Ua,to=Ra+Wa*Ua;var io=n;io.x=$a,io.y=Ka,io.z=to,Ga=3}var ao=n.x*n.x+n.y*n.y+n.z*n.z;if(ba<0||ao<ba){fa=Ga<<1,ba=ao;var oo=n;ha=oo.x,la=oo.y,ca=oo.z}}if(ma<0){var no,so,ro,eo,_o,ho,lo=t;no=lo.x,so=lo.y,ro=lo.z;var co,po,vo,mo,bo=o,fo=(co=(eo=bo.x)-no)*no+(po=(_o=bo.y)-so)*so+(vo=(ho=bo.z)-ro)*ro;if((fo=-fo/(co*co+po*po+vo*vo))<0){var xo=n;xo.x=no,xo.y=so,xo.z=ro,mo=1}else if(fo>1){var uo=n;uo.x=eo,uo.y=_o,uo.z=ho,mo=2}else{var yo,go,Xo;yo=no+co*fo,go=so+po*fo,Xo=ro+vo*fo;var zo=n;zo.x=yo,zo.y=go,zo.z=Xo,mo=3}var Mo=n.x*n.x+n.y*n.y+n.z*n.z;if(ba<0||Mo<ba){fa=1&mo|(2&mo)<<1,ba=Mo;var Yo=n;ha=Yo.x,la=Yo.y,ca=Yo.z}}if(ba>0){var Zo=n;Zo.x=ha,Zo.y=la,Zo.z=ca,pa=fa}else{var Io=sa*sa+ra*ra+ea*ea;Io>0&&(Io=1/Math.sqrt(Io));var Vo=(sa*=Io)*sa+(ra*=Io)*ra+(ea*=Io)*ea;ha=sa*(Vo=(Ri*sa+Ei*ra+ji*ea)/Vo),la=ra*Vo,ca=ea*Vo;var Lo=n;Lo.x=ha,Lo.y=la,Lo.z=ca,pa=7}var wo=n.x*n.x+n.y*n.y+n.z*n.z;if(W<0||wo<W){G=1&pa|(6&pa)<<1,W=wo;var Ao=n;R=Ao.x,E=Ao.y,j=Ao.z}}if(F*N<0){var ko,Bo,Po,To,So,Co,qo,Ro,Eo,jo,No,Do,Fo,Oo,Wo,Go,Ho,Uo,Jo=t;ko=Jo.x,Bo=Jo.y,Po=Jo.z;var Qo=i;To=Qo.x,So=Qo.y,Co=Qo.z;var $o,Ko,tn,an=o;qo=an.x;var on,nn,sn,rn,en=To*((Oo=(Ro=an.y)-So)*(tn=(jo=To-ko)*Oo-(No=So-Bo)*(Fo=qo-To))-(Wo=(Eo=an.z)-Co)*(Ko=(Do=Co-Po)*Fo-jo*Wo))+So*(Wo*($o=No*Wo-Do*Oo)-Fo*tn)+Co*(Fo*Ko-Oo*$o),_n=qo*((Ho=Bo-Ro)*tn-(Uo=Po-Eo)*Ko)+Ro*(Uo*$o-(Go=ko-qo)*tn)+Eo*(Go*Ko-Ho*$o),hn=-1,ln=0;if(on=0,nn=0,sn=0,ko*(No*tn-Do*Ko)+Bo*(Do*$o-jo*tn)+Po*(jo*Ko-No*$o)<0){var cn,pn,vn,mn,bn,fn,xn=t;cn=xn.x,pn=xn.y,vn=xn.z;var un,yn,gn,Xn,zn=i,Mn=(un=(mn=zn.x)-cn)*cn+(yn=(bn=zn.y)-pn)*pn+(gn=(fn=zn.z)-vn)*vn;if((Mn=-Mn/(un*un+yn*yn+gn*gn))<0){var Yn=n;Yn.x=cn,Yn.y=pn,Yn.z=vn,Xn=1}else if(Mn>1){var Zn=n;Zn.x=mn,Zn.y=bn,Zn.z=fn,Xn=2}else{var dn,In,Vn;dn=cn+un*Mn,In=pn+yn*Mn,Vn=vn+gn*Mn;var Ln=n;Ln.x=dn,Ln.y=In,Ln.z=Vn,Xn=3}ln=Xn,hn=n.x*n.x+n.y*n.y+n.z*n.z;var wn=n;on=wn.x,nn=wn.y,sn=wn.z}if(en<0){var An,kn,Bn,Pn,Tn,Sn,Cn=i;An=Cn.x,kn=Cn.y,Bn=Cn.z;var qn,Rn,En,jn,Nn=o,Dn=(qn=(Pn=Nn.x)-An)*An+(Rn=(Tn=Nn.y)-kn)*kn+(En=(Sn=Nn.z)-Bn)*Bn;if((Dn=-Dn/(qn*qn+Rn*Rn+En*En))<0){var Fn=n;Fn.x=An,Fn.y=kn,Fn.z=Bn,jn=1}else if(Dn>1){var On=n;On.x=Pn,On.y=Tn,On.z=Sn,jn=2}else{var Wn,Gn,Hn;Wn=An+qn*Dn,Gn=kn+Rn*Dn,Hn=Bn+En*Dn;var Un=n;Un.x=Wn,Un.y=Gn,Un.z=Hn,jn=3}var Jn=n.x*n.x+n.y*n.y+n.z*n.z;if(hn<0||Jn<hn){ln=jn<<1,hn=Jn;var Qn=n;on=Qn.x,nn=Qn.y,sn=Qn.z}}if(_n<0){var $n,Kn,ts,is,as,os,ns=t;$n=ns.x,Kn=ns.y,ts=ns.z;var ss,rs,es,_s,hs=o,ls=(ss=(is=hs.x)-$n)*$n+(rs=(as=hs.y)-Kn)*Kn+(es=(os=hs.z)-ts)*ts;if((ls=-ls/(ss*ss+rs*rs+es*es))<0){var cs=n;cs.x=$n,cs.y=Kn,cs.z=ts,_s=1}else if(ls>1){var ps=n;ps.x=is,ps.y=as,ps.z=os,_s=2}else{var vs,ms,bs;vs=$n+ss*ls,ms=Kn+rs*ls,bs=ts+es*ls;var fs=n;fs.x=vs,fs.y=ms,fs.z=bs,_s=3}var xs=n.x*n.x+n.y*n.y+n.z*n.z;if(hn<0||xs<hn){ln=1&_s|(2&_s)<<1,hn=xs;var us=n;on=us.x,nn=us.y,sn=us.z}}if(hn>0){var ys=n;ys.x=on,ys.y=nn,ys.z=sn,rn=ln}else{var gs=$o*$o+Ko*Ko+tn*tn;gs>0&&(gs=1/Math.sqrt(gs));var Xs=($o*=gs)*$o+(Ko*=gs)*Ko+(tn*=gs)*tn;on=$o*(Xs=(ko*$o+Bo*Ko+Po*tn)/Xs),nn=Ko*Xs,sn=tn*Xs;var zs=n;zs.x=on,zs.y=nn,zs.z=sn,rn=7}var Ms=n.x*n.x+n.y*n.y+n.z*n.z;if(W<0||Ms<W){G=3&rn|(4&rn)<<1,W=Ms;var Ys=n;R=Ys.x,E=Ys.y,j=Ys.z}}if(O*N<0){var Zs,ds,Is,Vs,Ls,ws,As,ks,Bs,Ps,Ts,Ss,Cs,qs,Rs,Es,js,Ns,Ds=i;Zs=Ds.x,ds=Ds.y,Is=Ds.z;var Fs=a;Vs=Fs.x,Ls=Fs.y,ws=Fs.z;var Os,Ws,Gs,Hs=o;As=Hs.x;var Us,Js,Qs,$s,Ks=Vs*((qs=(ks=Hs.y)-Ls)*(Gs=(Ps=Vs-Zs)*qs-(Ts=Ls-ds)*(Cs=As-Vs))-(Rs=(Bs=Hs.z)-ws)*(Ws=(Ss=ws-Is)*Cs-Ps*Rs))+Ls*(Rs*(Os=Ts*Rs-Ss*qs)-Cs*Gs)+ws*(Cs*Ws-qs*Os),tr=As*((js=ds-ks)*Gs-(Ns=Is-Bs)*Ws)+ks*(Ns*Os-(Es=Zs-As)*Gs)+Bs*(Es*Ws-js*Os),ir=-1,ar=0;if(Us=0,Js=0,Qs=0,Zs*(Ts*Gs-Ss*Ws)+ds*(Ss*Os-Ps*Gs)+Is*(Ps*Ws-Ts*Os)<0){var or,nr,sr,rr,er,_r,hr=i;or=hr.x,nr=hr.y,sr=hr.z;var lr,cr,pr,vr,mr=a,br=(lr=(rr=mr.x)-or)*or+(cr=(er=mr.y)-nr)*nr+(pr=(_r=mr.z)-sr)*sr;if((br=-br/(lr*lr+cr*cr+pr*pr))<0){var fr=n;fr.x=or,fr.y=nr,fr.z=sr,vr=1}else if(br>1){var xr=n;xr.x=rr,xr.y=er,xr.z=_r,vr=2}else{var ur,yr,gr;ur=or+lr*br,yr=nr+cr*br,gr=sr+pr*br;var Xr=n;Xr.x=ur,Xr.y=yr,Xr.z=gr,vr=3}ar=vr,ir=n.x*n.x+n.y*n.y+n.z*n.z;var zr=n;Us=zr.x,Js=zr.y,Qs=zr.z}if(Ks<0){var Mr,Yr,Zr,dr,Ir,Vr,Lr=a;Mr=Lr.x,Yr=Lr.y,Zr=Lr.z;var wr,Ar,kr,Br,Pr=o,Tr=(wr=(dr=Pr.x)-Mr)*Mr+(Ar=(Ir=Pr.y)-Yr)*Yr+(kr=(Vr=Pr.z)-Zr)*Zr;if((Tr=-Tr/(wr*wr+Ar*Ar+kr*kr))<0){var Sr=n;Sr.x=Mr,Sr.y=Yr,Sr.z=Zr,Br=1}else if(Tr>1){var Cr=n;Cr.x=dr,Cr.y=Ir,Cr.z=Vr,Br=2}else{var qr,Rr,Er;qr=Mr+wr*Tr,Rr=Yr+Ar*Tr,Er=Zr+kr*Tr;var jr=n;jr.x=qr,jr.y=Rr,jr.z=Er,Br=3}var Nr=n.x*n.x+n.y*n.y+n.z*n.z;if(ir<0||Nr<ir){ar=Br<<1,ir=Nr;var Dr=n;Us=Dr.x,Js=Dr.y,Qs=Dr.z}}if(tr<0){var Fr,Or,Wr,Gr,Hr,Ur,Jr=i;Fr=Jr.x,Or=Jr.y,Wr=Jr.z;var Qr,$r,Kr,te,ie=o,ae=(Qr=(Gr=ie.x)-Fr)*Fr+($r=(Hr=ie.y)-Or)*Or+(Kr=(Ur=ie.z)-Wr)*Wr;if((ae=-ae/(Qr*Qr+$r*$r+Kr*Kr))<0){var oe=n;oe.x=Fr,oe.y=Or,oe.z=Wr,te=1}else if(ae>1){var ne=n;ne.x=Gr,ne.y=Hr,ne.z=Ur,te=2}else{var se,re,ee;se=Fr+Qr*ae,re=Or+$r*ae,ee=Wr+Kr*ae;var _e=n;_e.x=se,_e.y=re,_e.z=ee,te=3}var he=n.x*n.x+n.y*n.y+n.z*n.z;if(ir<0||he<ir){ar=1&te|(2&te)<<1,ir=he;var le=n;Us=le.x,Js=le.y,Qs=le.z}}if(ir>0){var ce=n;ce.x=Us,ce.y=Js,ce.z=Qs,$s=ar}else{var pe=Os*Os+Ws*Ws+Gs*Gs;pe>0&&(pe=1/Math.sqrt(pe));var ve=(Os*=pe)*Os+(Ws*=pe)*Ws+(Gs*=pe)*Gs;Us=Os*(ve=(Zs*Os+ds*Ws+Is*Gs)/ve),Js=Ws*ve,Qs=Gs*ve;var me=n;me.x=Us,me.y=Js,me.z=Qs,$s=7}var be=n.x*n.x+n.y*n.y+n.z*n.z;if(W<0||be<W){G=$s<<1,W=be;var fe=n;R=fe.x,E=fe.y,j=fe.z}}if(W>0){var xe=n;return xe.x=R,xe.y=E,xe.z=j,G}return n.zero(),15};var J=function(t,i,a,o,n,s,r,e,_){null==_&&(_=1),null==e&&(e=0),null==r&&(r=0),null==s&&(s=0),null==n&&(n=1),null==o&&(o=0),null==a&&(a=0),null==i&&(i=0),null==t&&(t=1),this.e00=t,this.e01=i,this.e02=a,this.e10=o,this.e11=n,this.e12=s,this.e20=r,this.e21=e,this.e22=_,J.numCreations++};J.prototype={init:function(t,i,a,o,n,s,r,e,_){return this.e00=t,this.e01=i,this.e02=a,this.e10=o,this.e11=n,this.e12=s,this.e20=r,this.e21=e,this.e22=_,this},identity:function(){return this.e00=1,this.e01=0,this.e02=0,this.e10=0,this.e11=1,this.e12=0,this.e20=0,this.e21=0,this.e22=1,this},add:function(t){return new J(this.e00+t.e00,this.e01+t.e01,this.e02+t.e02,this.e10+t.e10,this.e11+t.e11,this.e12+t.e12,this.e20+t.e20,this.e21+t.e21,this.e22+t.e22)},sub:function(t){return new J(this.e00-t.e00,this.e01-t.e01,this.e02-t.e02,this.e10-t.e10,this.e11-t.e11,this.e12-t.e12,this.e20-t.e20,this.e21-t.e21,this.e22-t.e22)},scale:function(t){return new J(this.e00*t,this.e01*t,this.e02*t,this.e10*t,this.e11*t,this.e12*t,this.e20*t,this.e21*t,this.e22*t)},mul:function(t){return new J(this.e00*t.e00+this.e01*t.e10+this.e02*t.e20,this.e00*t.e01+this.e01*t.e11+this.e02*t.e21,this.e00*t.e02+this.e01*t.e12+this.e02*t.e22,this.e10*t.e00+this.e11*t.e10+this.e12*t.e20,this.e10*t.e01+this.e11*t.e11+this.e12*t.e21,this.e10*t.e02+this.e11*t.e12+this.e12*t.e22,this.e20*t.e00+this.e21*t.e10+this.e22*t.e20,this.e20*t.e01+this.e21*t.e11+this.e22*t.e21,this.e20*t.e02+this.e21*t.e12+this.e22*t.e22)},addEq:function(t){var i=this.e00+t.e00,a=this.e01+t.e01,o=this.e02+t.e02,n=this.e10+t.e10,s=this.e11+t.e11,r=this.e12+t.e12,e=this.e20+t.e20,_=this.e21+t.e21,h=this.e22+t.e22;return this.e00=i,this.e01=a,this.e02=o,this.e10=n,this.e11=s,this.e12=r,this.e20=e,this.e21=_,this.e22=h,this},subEq:function(t){var i=this.e00-t.e00,a=this.e01-t.e01,o=this.e02-t.e02,n=this.e10-t.e10,s=this.e11-t.e11,r=this.e12-t.e12,e=this.e20-t.e20,_=this.e21-t.e21,h=this.e22-t.e22;return this.e00=i,this.e01=a,this.e02=o,this.e10=n,this.e11=s,this.e12=r,this.e20=e,this.e21=_,this.e22=h,this},scaleEq:function(t){var i=this.e00*t,a=this.e01*t,o=this.e02*t,n=this.e10*t,s=this.e11*t,r=this.e12*t,e=this.e20*t,_=this.e21*t,h=this.e22*t;return this.e00=i,this.e01=a,this.e02=o,this.e10=n,this.e11=s,this.e12=r,this.e20=e,this.e21=_,this.e22=h,this},mulEq:function(t){var i=this.e00*t.e00+this.e01*t.e10+this.e02*t.e20,a=this.e00*t.e01+this.e01*t.e11+this.e02*t.e21,o=this.e00*t.e02+this.e01*t.e12+this.e02*t.e22,n=this.e10*t.e00+this.e11*t.e10+this.e12*t.e20,s=this.e10*t.e01+this.e11*t.e11+this.e12*t.e21,r=this.e10*t.e02+this.e11*t.e12+this.e12*t.e22,e=this.e20*t.e00+this.e21*t.e10+this.e22*t.e20,_=this.e20*t.e01+this.e21*t.e11+this.e22*t.e21,h=this.e20*t.e02+this.e21*t.e12+this.e22*t.e22;return this.e00=i,this.e01=a,this.e02=o,this.e10=n,this.e11=s,this.e12=r,this.e20=e,this.e21=_,this.e22=h,this},prependScale:function(t,i,a){return new J(this.e00*t,this.e01*t,this.e02*t,this.e10*i,this.e11*i,this.e12*i,this.e20*a,this.e21*a,this.e22*a)},appendScale:function(t,i,a){return new J(this.e00*t,this.e01*i,this.e02*a,this.e10*t,this.e11*i,this.e12*a,this.e20*t,this.e21*i,this.e22*a)},prependRotation:function(t,i,a,o){var n=Math.sin(t),s=Math.cos(t),r=1-s,e=i*i*r+s,_=i*a*r-o*n,h=i*o*r+a*n,l=a*i*r+o*n,c=a*a*r+s,p=a*o*r-i*n,v=o*i*r-a*n,m=o*a*r+i*n,b=o*o*r+s;return new J(e*this.e00+_*this.e10+h*this.e20,e*this.e01+_*this.e11+h*this.e21,e*this.e02+_*this.e12+h*this.e22,l*this.e00+c*this.e10+p*this.e20,l*this.e01+c*this.e11+p*this.e21,l*this.e02+c*this.e12+p*this.e22,v*this.e00+m*this.e10+b*this.e20,v*this.e01+m*this.e11+b*this.e21,v*this.e02+m*this.e12+b*this.e22)},appendRotation:function(t,i,a,o){var n=Math.sin(t),s=Math.cos(t),r=1-s,e=i*i*r+s,_=i*a*r-o*n,h=i*o*r+a*n,l=a*i*r+o*n,c=a*a*r+s,p=a*o*r-i*n,v=o*i*r-a*n,m=o*a*r+i*n,b=o*o*r+s;return new J(this.e00*e+this.e01*l+this.e02*v,this.e00*_+this.e01*c+this.e02*m,this.e00*h+this.e01*p+this.e02*b,this.e10*e+this.e11*l+this.e12*v,this.e10*_+this.e11*c+this.e12*m,this.e10*h+this.e11*p+this.e12*b,this.e20*e+this.e21*l+this.e22*v,this.e20*_+this.e21*c+this.e22*m,this.e20*h+this.e21*p+this.e22*b)},prependScaleEq:function(t,i,a){var o=this.e00*t,n=this.e01*t,s=this.e02*t,r=this.e10*i,e=this.e11*i,_=this.e12*i,h=this.e20*a,l=this.e21*a,c=this.e22*a;return this.e00=o,this.e01=n,this.e02=s,this.e10=r,this.e11=e,this.e12=_,this.e20=h,this.e21=l,this.e22=c,this},appendScaleEq:function(t,i,a){var o=this.e00*t,n=this.e01*i,s=this.e02*a,r=this.e10*t,e=this.e11*i,_=this.e12*a,h=this.e20*t,l=this.e21*i,c=this.e22*a;return this.e00=o,this.e01=n,this.e02=s,this.e10=r,this.e11=e,this.e12=_,this.e20=h,this.e21=l,this.e22=c,this},prependRotationEq:function(t,i,a,o){var n=Math.sin(t),s=Math.cos(t),r=1-s,e=i*i*r+s,_=i*a*r-o*n,h=i*o*r+a*n,l=a*i*r+o*n,c=a*a*r+s,p=a*o*r-i*n,v=o*i*r-a*n,m=o*a*r+i*n,b=o*o*r+s,f=e*this.e00+_*this.e10+h*this.e20,x=e*this.e01+_*this.e11+h*this.e21,u=e*this.e02+_*this.e12+h*this.e22,y=l*this.e00+c*this.e10+p*this.e20,g=l*this.e01+c*this.e11+p*this.e21,X=l*this.e02+c*this.e12+p*this.e22,z=v*this.e00+m*this.e10+b*this.e20,M=v*this.e01+m*this.e11+b*this.e21,Y=v*this.e02+m*this.e12+b*this.e22;return this.e00=f,this.e01=x,this.e02=u,this.e10=y,this.e11=g,this.e12=X,this.e20=z,this.e21=M,this.e22=Y,this},appendRotationEq:function(t,i,a,o){var n=Math.sin(t),s=Math.cos(t),r=1-s,e=i*i*r+s,_=i*a*r-o*n,h=i*o*r+a*n,l=a*i*r+o*n,c=a*a*r+s,p=a*o*r-i*n,v=o*i*r-a*n,m=o*a*r+i*n,b=o*o*r+s,f=this.e00*e+this.e01*l+this.e02*v,x=this.e00*_+this.e01*c+this.e02*m,u=this.e00*h+this.e01*p+this.e02*b,y=this.e10*e+this.e11*l+this.e12*v,g=this.e10*_+this.e11*c+this.e12*m,X=this.e10*h+this.e11*p+this.e12*b,z=this.e20*e+this.e21*l+this.e22*v,M=this.e20*_+this.e21*c+this.e22*m,Y=this.e20*h+this.e21*p+this.e22*b;return this.e00=f,this.e01=x,this.e02=u,this.e10=y,this.e11=g,this.e12=X,this.e20=z,this.e21=M,this.e22=Y,this},transpose:function(){return new J(this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22)},transposeEq:function(){var t=this.e00,i=this.e10,a=this.e20,o=this.e01,n=this.e11,s=this.e21,r=this.e02,e=this.e12,_=this.e22;return this.e00=t,this.e01=i,this.e02=a,this.e10=o,this.e11=n,this.e12=s,this.e20=r,this.e21=e,this.e22=_,this},determinant:function(){return this.e00*(this.e11*this.e22-this.e12*this.e21)-this.e01*(this.e10*this.e22-this.e12*this.e20)+this.e02*(this.e10*this.e21-this.e11*this.e20)},trace:function(){return this.e00+this.e11+this.e22},inverse:function(){var t=this.e11*this.e22-this.e12*this.e21,i=this.e10*this.e22-this.e12*this.e20,a=this.e10*this.e21-this.e11*this.e20,o=this.e01*this.e22-this.e02*this.e21,n=this.e00*this.e22-this.e02*this.e20,s=this.e00*this.e21-this.e01*this.e20,r=this.e01*this.e12-this.e02*this.e11,e=this.e00*this.e12-this.e02*this.e10,_=this.e00*this.e11-this.e01*this.e10,h=this.e00*t-this.e01*i+this.e02*a;return 0!=h&&(h=1/h),new J(t*h,-o*h,r*h,-i*h,n*h,-e*h,a*h,-s*h,_*h)},inverseEq:function(){var t=this.e11*this.e22-this.e12*this.e21,i=this.e10*this.e22-this.e12*this.e20,a=this.e10*this.e21-this.e11*this.e20,o=this.e01*this.e22-this.e02*this.e21,n=this.e00*this.e22-this.e02*this.e20,s=this.e00*this.e21-this.e01*this.e20,r=this.e01*this.e12-this.e02*this.e11,e=this.e00*this.e12-this.e02*this.e10,_=this.e00*this.e11-this.e01*this.e10,h=this.e00*t-this.e01*i+this.e02*a;0!=h&&(h=1/h);var l=t*h,c=-o*h,p=r*h,v=-i*h,m=n*h,b=-e*h,f=a*h,x=-s*h,u=_*h;return this.e00=l,this.e01=c,this.e02=p,this.e10=v,this.e11=m,this.e12=b,this.e20=f,this.e21=x,this.e22=u,this},toArray:function(t){return null==t&&(t=!1),t?[this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22]:[this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22]},copyFrom:function(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this},clone:function(){return new J(this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22)},fromQuat:function(t){var i=t.x,a=t.y,o=t.z,n=t.w,s=2*i,r=2*a,e=2*o,_=i*s,h=a*r,l=o*e,c=i*r,p=a*e,v=i*e,m=n*s,b=n*r,f=n*e;return this.e00=1-h-l,this.e01=c-f,this.e02=v+b,this.e10=c+f,this.e11=1-_-l,this.e12=p-m,this.e20=v-b,this.e21=p+m,this.e22=1-_-h,this},toQuat:function(){var t,i=new tt,a=this.e00,o=this.e11,n=this.e22,s=a+o+n;return s>0?(t=Math.sqrt(s+1),i.w=.5*t,t=.5/t,i.x=(this.e21-this.e12)*t,i.y=(this.e02-this.e20)*t,i.z=(this.e10-this.e01)*t):a>o?a>n?(t=Math.sqrt(a-o-n+1),i.x=.5*t,t=.5/t,i.y=(this.e01+this.e10)*t,i.z=(this.e02+this.e20)*t,i.w=(this.e21-this.e12)*t):(t=Math.sqrt(n-a-o+1),i.z=.5*t,t=.5/t,i.x=(this.e02+this.e20)*t,i.y=(this.e12+this.e21)*t,i.w=(this.e10-this.e01)*t):o>n?(t=Math.sqrt(o-n-a+1),i.y=.5*t,t=.5/t,i.x=(this.e01+this.e10)*t,i.z=(this.e12+this.e21)*t,i.w=(this.e02-this.e20)*t):(t=Math.sqrt(n-a-o+1),i.z=.5*t,t=.5/t,i.x=(this.e02+this.e20)*t,i.y=(this.e12+this.e21)*t,i.w=(this.e10-this.e01)*t),i},fromEulerXyz:function(t){var i=Math.sin(t.x),a=Math.sin(t.y),o=Math.sin(t.z),n=Math.cos(t.x),s=Math.cos(t.y),r=Math.cos(t.z),e=s*r,_=-s*o,h=a,l=n*o+r*i*a,c=n*r-i*a*o,p=-s*i,v=i*o-n*r*a,m=r*i+n*a*o,b=n*s;return this.e00=e,this.e01=_,this.e02=h,this.e10=l,this.e11=c,this.e12=p,this.e20=v,this.e21=m,this.e22=b,this},toEulerXyz:function(){var t=this.e02;if(t<=-1){var i=Math.atan2(this.e21,this.e11);return new F(.5*i,-1.570796326794895,.5*-i)}if(t>=1){var a=Math.atan2(this.e21,this.e11);return new F(.5*a,1.570796326794895,.5*a)}var o=Math.asin(t),n=Math.atan2(-this.e12,this.e22),s=Math.atan2(-this.e01,this.e00);return new F(n,o,s)},getRow:function(t){return 0==t?new F(this.e00,this.e01,this.e02):1==t?new F(this.e10,this.e11,this.e12):2==t?new F(this.e20,this.e21,this.e22):null},getCol:function(t){return 0==t?new F(this.e00,this.e10,this.e20):1==t?new F(this.e01,this.e11,this.e21):2==t?new F(this.e02,this.e12,this.e22):null},getRowTo:function(t,i){0==t?i.init(this.e00,this.e01,this.e02):1==t?i.init(this.e10,this.e11,this.e12):2==t?i.init(this.e20,this.e21,this.e22):i.zero()},getColTo:function(t,i){0==t?i.init(this.e00,this.e10,this.e20):1==t?i.init(this.e01,this.e11,this.e21):2==t?i.init(this.e02,this.e12,this.e22):i.zero()},fromRows:function(t,i,a){var o=t.x,n=t.y,s=t.z,r=i.x,e=i.y,_=i.z,h=a.x,l=a.y,c=a.z;return this.e00=o,this.e01=n,this.e02=s,this.e10=r,this.e11=e,this.e12=_,this.e20=h,this.e21=l,this.e22=c,this},fromCols:function(t,i,a){var o=t.x,n=i.x,s=a.x,r=t.y,e=i.y,_=a.y,h=t.z,l=i.z,c=a.z;return this.e00=o,this.e01=n,this.e02=s,this.e10=r,this.e11=e,this.e12=_,this.e20=h,this.e21=l,this.e22=c,this},toString:function(){return"Mat3["+(this.e00>0?(1e7*this.e00+.5|0)/1e7:(1e7*this.e00-.5|0)/1e7)+", "+(this.e01>0?(1e7*this.e01+.5|0)/1e7:(1e7*this.e01-.5|0)/1e7)+", "+(this.e02>0?(1e7*this.e02+.5|0)/1e7:(1e7*this.e02-.5|0)/1e7)+",\n     "+(this.e10>0?(1e7*this.e10+.5|0)/1e7:(1e7*this.e10-.5|0)/1e7)+", "+(this.e11>0?(1e7*this.e11+.5|0)/1e7:(1e7*this.e11-.5|0)/1e7)+", "+(this.e12>0?(1e7*this.e12+.5|0)/1e7:(1e7*this.e12-.5|0)/1e7)+",\n     "+(this.e20>0?(1e7*this.e20+.5|0)/1e7:(1e7*this.e20-.5|0)/1e7)+", "+(this.e21>0?(1e7*this.e21+.5|0)/1e7:(1e7*this.e21-.5|0)/1e7)+", "+(this.e22>0?(1e7*this.e22+.5|0)/1e7:(1e7*this.e22-.5|0)/1e7)+"]"}};var Q=function(t,i,a,o,n,s,r,e,_,h,l,c,p,v,m,b){null==b&&(b=1),null==m&&(m=0),null==v&&(v=0),null==p&&(p=0),null==c&&(c=0),null==l&&(l=1),null==h&&(h=0),null==_&&(_=0),null==e&&(e=0),null==r&&(r=0),null==s&&(s=1),null==n&&(n=0),null==o&&(o=0),null==a&&(a=0),null==i&&(i=0),null==t&&(t=1),this.e00=t,this.e01=i,this.e02=a,this.e03=o,this.e10=n,this.e11=s,this.e12=r,this.e13=e,this.e20=_,this.e21=h,this.e22=l,this.e23=c,this.e30=p,this.e31=v,this.e32=m,this.e33=b,Q.numCreations++};Q.prototype={init:function(t,i,a,o,n,s,r,e,_,h,l,c,p,v,m,b){return this.e00=t,this.e01=i,this.e02=a,this.e03=o,this.e10=n,this.e11=s,this.e12=r,this.e13=e,this.e20=_,this.e21=h,this.e22=l,this.e23=c,this.e30=p,this.e31=v,this.e32=m,this.e33=b,this},identity:function(){return this.e00=1,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=1,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=1,this.e23=0,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this},add:function(t){return new Q(this.e00+t.e00,this.e01+t.e01,this.e02+t.e02,this.e03+t.e03,this.e10+t.e10,this.e11+t.e11,this.e12+t.e12,this.e13+t.e13,this.e20+t.e20,this.e21+t.e21,this.e22+t.e22,this.e23+t.e23,this.e30+t.e30,this.e31+t.e31,this.e32+t.e32,this.e33+t.e33)},sub:function(t){return new Q(this.e00-t.e00,this.e01-t.e01,this.e02-t.e02,this.e03-t.e03,this.e10-t.e10,this.e11-t.e11,this.e12-t.e12,this.e13-t.e13,this.e20-t.e20,this.e21-t.e21,this.e22-t.e22,this.e23-t.e23,this.e30-t.e30,this.e31-t.e31,this.e32-t.e32,this.e33-t.e33)},scale:function(t){return new Q(this.e00*t,this.e01*t,this.e02*t,this.e03*t,this.e10*t,this.e11*t,this.e12*t,this.e13*t,this.e20*t,this.e21*t,this.e22*t,this.e23*t,this.e30*t,this.e31*t,this.e32*t,this.e33*t)},mul:function(t){return new Q(this.e00*t.e00+this.e01*t.e10+this.e02*t.e20+this.e03*t.e30,this.e00*t.e01+this.e01*t.e11+this.e02*t.e21+this.e03*t.e31,this.e00*t.e02+this.e01*t.e12+this.e02*t.e22+this.e03*t.e32,this.e00*t.e03+this.e01*t.e13+this.e02*t.e23+this.e03*t.e33,this.e10*t.e00+this.e11*t.e10+this.e12*t.e20+this.e13*t.e30,this.e10*t.e01+this.e11*t.e11+this.e12*t.e21+this.e13*t.e31,this.e10*t.e02+this.e11*t.e12+this.e12*t.e22+this.e13*t.e32,this.e10*t.e03+this.e11*t.e13+this.e12*t.e23+this.e13*t.e33,this.e20*t.e00+this.e21*t.e10+this.e22*t.e20+this.e23*t.e30,this.e20*t.e01+this.e21*t.e11+this.e22*t.e21+this.e23*t.e31,this.e20*t.e02+this.e21*t.e12+this.e22*t.e22+this.e23*t.e32,this.e20*t.e03+this.e21*t.e13+this.e22*t.e23+this.e23*t.e33,this.e30*t.e00+this.e31*t.e10+this.e32*t.e20+this.e33*t.e30,this.e30*t.e01+this.e31*t.e11+this.e32*t.e21+this.e33*t.e31,this.e30*t.e02+this.e31*t.e12+this.e32*t.e22+this.e33*t.e32,this.e30*t.e03+this.e31*t.e13+this.e32*t.e23+this.e33*t.e33)},addEq:function(t){var i=this.e00+t.e00,a=this.e01+t.e01,o=this.e02+t.e02,n=this.e03+t.e03,s=this.e10+t.e10,r=this.e11+t.e11,e=this.e12+t.e12,_=this.e13+t.e13,h=this.e20+t.e20,l=this.e21+t.e21,c=this.e22+t.e22,p=this.e23+t.e23,v=this.e30+t.e30,m=this.e31+t.e31,b=this.e32+t.e32,f=this.e33+t.e33;return this.e00=i,this.e01=a,this.e02=o,this.e03=n,this.e10=s,this.e11=r,this.e12=e,this.e13=_,this.e20=h,this.e21=l,this.e22=c,this.e23=p,this.e30=v,this.e31=m,this.e32=b,this.e33=f,this},subEq:function(t){var i=this.e00-t.e00,a=this.e01-t.e01,o=this.e02-t.e02,n=this.e03-t.e03,s=this.e10-t.e10,r=this.e11-t.e11,e=this.e12-t.e12,_=this.e13-t.e13,h=this.e20-t.e20,l=this.e21-t.e21,c=this.e22-t.e22,p=this.e23-t.e23,v=this.e30-t.e30,m=this.e31-t.e31,b=this.e32-t.e32,f=this.e33-t.e33;return this.e00=i,this.e01=a,this.e02=o,this.e03=n,this.e10=s,this.e11=r,this.e12=e,this.e13=_,this.e20=h,this.e21=l,this.e22=c,this.e23=p,this.e30=v,this.e31=m,this.e32=b,this.e33=f,this},scaleEq:function(t){var i=this.e00*t,a=this.e01*t,o=this.e02*t,n=this.e03*t,s=this.e10*t,r=this.e11*t,e=this.e12*t,_=this.e13*t,h=this.e20*t,l=this.e21*t,c=this.e22*t,p=this.e23*t,v=this.e30*t,m=this.e31*t,b=this.e32*t,f=this.e33*t;return this.e00=i,this.e01=a,this.e02=o,this.e03=n,this.e10=s,this.e11=r,this.e12=e,this.e13=_,this.e20=h,this.e21=l,this.e22=c,this.e23=p,this.e30=v,this.e31=m,this.e32=b,this.e33=f,this},mulEq:function(t){var i=this.e00*t.e00+this.e01*t.e10+this.e02*t.e20+this.e03*t.e30,a=this.e00*t.e01+this.e01*t.e11+this.e02*t.e21+this.e03*t.e31,o=this.e00*t.e02+this.e01*t.e12+this.e02*t.e22+this.e03*t.e32,n=this.e00*t.e03+this.e01*t.e13+this.e02*t.e23+this.e03*t.e33,s=this.e10*t.e00+this.e11*t.e10+this.e12*t.e20+this.e13*t.e30,r=this.e10*t.e01+this.e11*t.e11+this.e12*t.e21+this.e13*t.e31,e=this.e10*t.e02+this.e11*t.e12+this.e12*t.e22+this.e13*t.e32,_=this.e10*t.e03+this.e11*t.e13+this.e12*t.e23+this.e13*t.e33,h=this.e20*t.e00+this.e21*t.e10+this.e22*t.e20+this.e23*t.e30,l=this.e20*t.e01+this.e21*t.e11+this.e22*t.e21+this.e23*t.e31,c=this.e20*t.e02+this.e21*t.e12+this.e22*t.e22+this.e23*t.e32,p=this.e20*t.e03+this.e21*t.e13+this.e22*t.e23+this.e23*t.e33,v=this.e30*t.e00+this.e31*t.e10+this.e32*t.e20+this.e33*t.e30,m=this.e30*t.e01+this.e31*t.e11+this.e32*t.e21+this.e33*t.e31,b=this.e30*t.e02+this.e31*t.e12+this.e32*t.e22+this.e33*t.e32,f=this.e30*t.e03+this.e31*t.e13+this.e32*t.e23+this.e33*t.e33;return this.e00=i,this.e01=a,this.e02=o,this.e03=n,this.e10=s,this.e11=r,this.e12=e,this.e13=_,this.e20=h,this.e21=l,this.e22=c,this.e23=p,this.e30=v,this.e31=m,this.e32=b,this.e33=f,this},prependScale:function(t,i,a){return new Q(this.e00*t,this.e01*t,this.e02*t,this.e03*t,this.e10*i,this.e11*i,this.e12*i,this.e13*i,this.e20*a,this.e21*a,this.e22*a,this.e23*a,this.e30,this.e31,this.e32,this.e33)},appendScale:function(t,i,a){return new Q(this.e00*t,this.e01*i,this.e02*a,this.e03,this.e10*t,this.e11*i,this.e12*a,this.e13,this.e20*t,this.e21*i,this.e22*a,this.e23,this.e30*t,this.e31*i,this.e32*a,this.e33)},prependRotation:function(t,i,a,o){var n=Math.sin(t),s=Math.cos(t),r=1-s,e=i*i*r+s,_=i*a*r-o*n,h=i*o*r+a*n,l=a*i*r+o*n,c=a*a*r+s,p=a*o*r-i*n,v=o*i*r-a*n,m=o*a*r+i*n,b=o*o*r+s;return new Q(e*this.e00+_*this.e10+h*this.e20,e*this.e01+_*this.e11+h*this.e21,e*this.e02+_*this.e12+h*this.e22,e*this.e03+_*this.e13+h*this.e23,l*this.e00+c*this.e10+p*this.e20,l*this.e01+c*this.e11+p*this.e21,l*this.e02+c*this.e12+p*this.e22,l*this.e03+c*this.e13+p*this.e23,v*this.e00+m*this.e10+b*this.e20,v*this.e01+m*this.e11+b*this.e21,v*this.e02+m*this.e12+b*this.e22,v*this.e03+m*this.e13+b*this.e23,this.e30,this.e31,this.e32,this.e33)},appendRotation:function(t,i,a,o){var n=Math.sin(t),s=Math.cos(t),r=1-s,e=i*i*r+s,_=i*a*r-o*n,h=i*o*r+a*n,l=a*i*r+o*n,c=a*a*r+s,p=a*o*r-i*n,v=o*i*r-a*n,m=o*a*r+i*n,b=o*o*r+s;return new Q(this.e00*e+this.e01*l+this.e02*v,this.e00*_+this.e01*c+this.e02*m,this.e00*h+this.e01*p+this.e02*b,this.e03,this.e10*e+this.e11*l+this.e12*v,this.e10*_+this.e11*c+this.e12*m,this.e10*h+this.e11*p+this.e12*b,this.e13,this.e20*e+this.e21*l+this.e22*v,this.e20*_+this.e21*c+this.e22*m,this.e20*h+this.e21*p+this.e22*b,this.e23,this.e30*e+this.e31*l+this.e32*v,this.e30*_+this.e31*c+this.e32*m,this.e30*h+this.e31*p+this.e32*b,this.e33)},prependTranslation:function(t,i,a){return new Q(this.e00+t*this.e30,this.e01+t*this.e31,this.e02+t*this.e32,this.e03+t*this.e33,this.e10+i*this.e30,this.e11+i*this.e31,this.e12+i*this.e32,this.e13+i*this.e33,this.e20+a*this.e30,this.e21+a*this.e31,this.e22+a*this.e32,this.e23+a*this.e33,this.e30,this.e31,this.e32,this.e33)},appendTranslation:function(t,i,a){return new Q(this.e00,this.e01,this.e02,this.e00*t+this.e01*i+this.e02*a+this.e03,this.e10,this.e11,this.e12,this.e10*t+this.e11*i+this.e12*a+this.e13,this.e20,this.e21,this.e22,this.e20*t+this.e21*i+this.e22*a+this.e23,this.e30,this.e31,this.e32,this.e30*t+this.e31*i+this.e32*a+this.e33)},prependScaleEq:function(t,i,a){var o=this.e00*t,n=this.e01*t,s=this.e02*t,r=this.e03*t,e=this.e10*i,_=this.e11*i,h=this.e12*i,l=this.e13*i,c=this.e20*a,p=this.e21*a,v=this.e22*a,m=this.e23*a,b=this.e30,f=this.e31,x=this.e32,u=this.e33;return this.e00=o,this.e01=n,this.e02=s,this.e03=r,this.e10=e,this.e11=_,this.e12=h,this.e13=l,this.e20=c,this.e21=p,this.e22=v,this.e23=m,this.e30=b,this.e31=f,this.e32=x,this.e33=u,this},appendScaleEq:function(t,i,a){var o=this.e00*t,n=this.e01*i,s=this.e02*a,r=this.e03,e=this.e10*t,_=this.e11*i,h=this.e12*a,l=this.e13,c=this.e20*t,p=this.e21*i,v=this.e22*a,m=this.e23,b=this.e30*t,f=this.e31*i,x=this.e32*a,u=this.e33;return this.e00=o,this.e01=n,this.e02=s,this.e03=r,this.e10=e,this.e11=_,this.e12=h,this.e13=l,this.e20=c,this.e21=p,this.e22=v,this.e23=m,this.e30=b,this.e31=f,this.e32=x,this.e33=u,this},prependRotationEq:function(t,i,a,o){var n=Math.sin(t),s=Math.cos(t),r=1-s,e=i*i*r+s,_=i*a*r-o*n,h=i*o*r+a*n,l=a*i*r+o*n,c=a*a*r+s,p=a*o*r-i*n,v=o*i*r-a*n,m=o*a*r+i*n,b=o*o*r+s,f=e*this.e00+_*this.e10+h*this.e20,x=e*this.e01+_*this.e11+h*this.e21,u=e*this.e02+_*this.e12+h*this.e22,y=e*this.e03+_*this.e13+h*this.e23,g=l*this.e00+c*this.e10+p*this.e20,X=l*this.e01+c*this.e11+p*this.e21,z=l*this.e02+c*this.e12+p*this.e22,M=l*this.e03+c*this.e13+p*this.e23,Y=v*this.e00+m*this.e10+b*this.e20,Z=v*this.e01+m*this.e11+b*this.e21,d=v*this.e02+m*this.e12+b*this.e22,I=v*this.e03+m*this.e13+b*this.e23,V=this.e30,L=this.e31,w=this.e32,A=this.e33;return this.e00=f,this.e01=x,this.e02=u,this.e03=y,this.e10=g,this.e11=X,this.e12=z,this.e13=M,this.e20=Y,this.e21=Z,this.e22=d,this.e23=I,this.e30=V,this.e31=L,this.e32=w,this.e33=A,this},appendRotationEq:function(t,i,a,o){var n=Math.sin(t),s=Math.cos(t),r=1-s,e=i*i*r+s,_=i*a*r-o*n,h=i*o*r+a*n,l=a*i*r+o*n,c=a*a*r+s,p=a*o*r-i*n,v=o*i*r-a*n,m=o*a*r+i*n,b=o*o*r+s,f=this.e00*e+this.e01*l+this.e02*v,x=this.e00*_+this.e01*c+this.e02*m,u=this.e00*h+this.e01*p+this.e02*b,y=this.e03,g=this.e10*e+this.e11*l+this.e12*v,X=this.e10*_+this.e11*c+this.e12*m,z=this.e10*h+this.e11*p+this.e12*b,M=this.e13,Y=this.e20*e+this.e21*l+this.e22*v,Z=this.e20*_+this.e21*c+this.e22*m,d=this.e20*h+this.e21*p+this.e22*b,I=this.e23,V=this.e30*e+this.e31*l+this.e32*v,L=this.e30*_+this.e31*c+this.e32*m,w=this.e30*h+this.e31*p+this.e32*b,A=this.e33;return this.e00=f,this.e01=x,this.e02=u,this.e03=y,this.e10=g,this.e11=X,this.e12=z,this.e13=M,this.e20=Y,this.e21=Z,this.e22=d,this.e23=I,this.e30=V,this.e31=L,this.e32=w,this.e33=A,this},prependTranslationEq:function(t,i,a){var o=this.e00+t*this.e30,n=this.e01+t*this.e31,s=this.e02+t*this.e32,r=this.e03+t*this.e33,e=this.e10+i*this.e30,_=this.e11+i*this.e31,h=this.e12+i*this.e32,l=this.e13+i*this.e33,c=this.e20+a*this.e30,p=this.e21+a*this.e31,v=this.e22+a*this.e32,m=this.e23+a*this.e33,b=this.e30,f=this.e31,x=this.e32,u=this.e33;return this.e00=o,this.e01=n,this.e02=s,this.e03=r,this.e10=e,this.e11=_,this.e12=h,this.e13=l,this.e20=c,this.e21=p,this.e22=v,this.e23=m,this.e30=b,this.e31=f,this.e32=x,this.e33=u,this},appendTranslationEq:function(t,i,a){var o=this.e00,n=this.e01,s=this.e02,r=this.e00*t+this.e01*i+this.e02*a+this.e03,e=this.e10,_=this.e11,h=this.e12,l=this.e10*t+this.e11*i+this.e12*a+this.e13,c=this.e20,p=this.e21,v=this.e22,m=this.e20*t+this.e21*i+this.e22*a+this.e23,b=this.e30,f=this.e31,x=this.e32,u=this.e30*t+this.e31*i+this.e32*a+this.e33;return this.e00=o,this.e01=n,this.e02=s,this.e03=r,this.e10=e,this.e11=_,this.e12=h,this.e13=l,this.e20=c,this.e21=p,this.e22=v,this.e23=m,this.e30=b,this.e31=f,this.e32=x,this.e33=u,this},transpose:function(){return new Q(this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33)},transposeEq:function(){var t=this.e00,i=this.e10,a=this.e20,o=this.e30,n=this.e01,s=this.e11,r=this.e21,e=this.e31,_=this.e02,h=this.e12,l=this.e22,c=this.e32,p=this.e03,v=this.e13,m=this.e23,b=this.e33;return this.e00=t,this.e01=i,this.e02=a,this.e03=o,this.e10=n,this.e11=s,this.e12=r,this.e13=e,this.e20=_,this.e21=h,this.e22=l,this.e23=c,this.e30=p,this.e31=v,this.e32=m,this.e33=b,this},determinant:function(){var t=this.e20*this.e31-this.e21*this.e30,i=this.e20*this.e32-this.e22*this.e30,a=this.e20*this.e33-this.e23*this.e30,o=this.e21*this.e32-this.e22*this.e31,n=this.e21*this.e33-this.e23*this.e31,s=this.e22*this.e33-this.e23*this.e32;return this.e00*(this.e11*s-this.e12*n+this.e13*o)-this.e01*(this.e10*s-this.e12*a+this.e13*i)+this.e02*(this.e10*n-this.e11*a+this.e13*t)-this.e03*(this.e10*o-this.e11*i+this.e12*t)},trace:function(){return this.e00+this.e11+this.e22+this.e33},inverse:function(){var t=this.e00*this.e11-this.e01*this.e10,i=this.e00*this.e12-this.e02*this.e10,a=this.e00*this.e13-this.e03*this.e10,o=this.e01*this.e12-this.e02*this.e11,n=this.e01*this.e13-this.e03*this.e11,s=this.e02*this.e13-this.e03*this.e12,r=this.e20*this.e31-this.e21*this.e30,e=this.e20*this.e32-this.e22*this.e30,_=this.e20*this.e33-this.e23*this.e30,h=this.e21*this.e32-this.e22*this.e31,l=this.e21*this.e33-this.e23*this.e31,c=this.e22*this.e33-this.e23*this.e32,p=this.e11*c-this.e12*l+this.e13*h,v=this.e10*c-this.e12*_+this.e13*e,m=this.e10*l-this.e11*_+this.e13*r,b=this.e10*h-this.e11*e+this.e12*r,f=this.e01*c-this.e02*l+this.e03*h,x=this.e00*c-this.e02*_+this.e03*e,u=this.e00*l-this.e01*_+this.e03*r,y=this.e00*h-this.e01*e+this.e02*r,g=this.e31*s-this.e32*n+this.e33*o,X=this.e30*s-this.e32*a+this.e33*i,z=this.e30*n-this.e31*a+this.e33*t,M=this.e30*o-this.e31*i+this.e32*t,Y=this.e21*s-this.e22*n+this.e23*o,Z=this.e20*s-this.e22*a+this.e23*i,d=this.e20*n-this.e21*a+this.e23*t,I=this.e20*o-this.e21*i+this.e22*t,V=this.e00*p-this.e01*v+this.e02*m-this.e03*b;return 0!=V&&(V=1/V),new Q(p*V,-f*V,g*V,-Y*V,-v*V,x*V,-X*V,Z*V,m*V,-u*V,z*V,-d*V,-b*V,y*V,-M*V,I*V)},inverseEq:function(){var t=this.e00*this.e11-this.e01*this.e10,i=this.e00*this.e12-this.e02*this.e10,a=this.e00*this.e13-this.e03*this.e10,o=this.e01*this.e12-this.e02*this.e11,n=this.e01*this.e13-this.e03*this.e11,s=this.e02*this.e13-this.e03*this.e12,r=this.e20*this.e31-this.e21*this.e30,e=this.e20*this.e32-this.e22*this.e30,_=this.e20*this.e33-this.e23*this.e30,h=this.e21*this.e32-this.e22*this.e31,l=this.e21*this.e33-this.e23*this.e31,c=this.e22*this.e33-this.e23*this.e32,p=this.e11*c-this.e12*l+this.e13*h,v=this.e10*c-this.e12*_+this.e13*e,m=this.e10*l-this.e11*_+this.e13*r,b=this.e10*h-this.e11*e+this.e12*r,f=this.e01*c-this.e02*l+this.e03*h,x=this.e00*c-this.e02*_+this.e03*e,u=this.e00*l-this.e01*_+this.e03*r,y=this.e00*h-this.e01*e+this.e02*r,g=this.e31*s-this.e32*n+this.e33*o,X=this.e30*s-this.e32*a+this.e33*i,z=this.e30*n-this.e31*a+this.e33*t,M=this.e30*o-this.e31*i+this.e32*t,Y=this.e21*s-this.e22*n+this.e23*o,Z=this.e20*s-this.e22*a+this.e23*i,d=this.e20*n-this.e21*a+this.e23*t,I=this.e20*o-this.e21*i+this.e22*t,V=this.e00*p-this.e01*v+this.e02*m-this.e03*b;0!=V&&(V=1/V);var L=p*V,w=-f*V,A=g*V,k=-Y*V,B=-v*V,P=x*V,T=-X*V,S=Z*V,C=m*V,q=-u*V,R=z*V,E=-d*V,j=-b*V,N=y*V,D=-M*V,F=I*V;return this.e00=L,this.e01=w,this.e02=A,this.e03=k,this.e10=B,this.e11=P,this.e12=T,this.e13=S,this.e20=C,this.e21=q,this.e22=R,this.e23=E,this.e30=j,this.e31=N,this.e32=D,this.e33=F,this},lookAt:function(t,i,a,o,n,s,r,e,_){var h=t-o,l=i-n,c=a-s,p=1/Math.sqrt(h*h+l*l+c*c),v=e*(c*=p)-_*(l*=p),m=_*(h*=p)-r*c,b=r*l-e*h,f=l*(b*=p=1/Math.sqrt(v*v+m*m+b*b))-c*(m*=p),x=c*(v*=p)-h*b,u=h*m-l*v;return this.e00=v,this.e01=m,this.e02=b,this.e03=-(v*t+m*i+b*a),this.e10=f,this.e11=x,this.e12=u,this.e13=-(f*t+x*i+u*a),this.e20=h,this.e21=l,this.e22=c,this.e23=-(h*t+l*i+c*a),this.e30=0,this.e31=0,this.e32=0,this.e33=1,this},perspective:function(t,i,a,o){var n=1/Math.tan(.5*t),s=o/(a-o);return this.e00=n/i,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=n,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=s,this.e23=a*s,this.e30=0,this.e31=0,this.e32=-1,this.e33=0,this},ortho:function(t,i,a,o){var n=1/(a-o);return this.e00=2/t,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=2/i,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=n,this.e23=a*n,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this},toArray:function(t){return null==t&&(t=!1),t?[this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33]:[this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33]},copyFrom:function(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e03=t.e03,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e13=t.e13,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this.e23=t.e23,this.e30=t.e30,this.e31=t.e31,this.e32=t.e32,this.e33=t.e33,this},fromMat3:function(t){var i=t.e00,a=t.e01,o=t.e02,n=t.e10,s=t.e11,r=t.e12,e=t.e20,_=t.e21,h=t.e22;return this.e00=i,this.e01=a,this.e02=o,this.e03=0,this.e10=n,this.e11=s,this.e12=r,this.e13=0,this.e20=e,this.e21=_,this.e22=h,this.e23=0,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this},fromTransform:function(t){var i=this;return i.e00=t._rotation00,i.e01=t._rotation01,i.e02=t._rotation02,i.e10=t._rotation10,i.e11=t._rotation11,i.e12=t._rotation12,i.e20=t._rotation20,i.e21=t._rotation21,i.e22=t._rotation22,i.e03=t._positionX,i.e13=t._positionY,i.e23=t._positionZ,i.e30=0,i.e31=0,i.e32=0,i.e33=1,this},clone:function(){return new Q(this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33)},toString:function(){return"Mat4["+(this.e00>0?(1e7*this.e00+.5|0)/1e7:(1e7*this.e00-.5|0)/1e7)+", "+(this.e01>0?(1e7*this.e01+.5|0)/1e7:(1e7*this.e01-.5|0)/1e7)+", "+(this.e02>0?(1e7*this.e02+.5|0)/1e7:(1e7*this.e02-.5|0)/1e7)+", "+(this.e03>0?(1e7*this.e03+.5|0)/1e7:(1e7*this.e03-.5|0)/1e7)+",\n    "+(this.e10>0?(1e7*this.e10+.5|0)/1e7:(1e7*this.e10-.5|0)/1e7)+", "+(this.e11>0?(1e7*this.e11+.5|0)/1e7:(1e7*this.e11-.5|0)/1e7)+", "+(this.e12>0?(1e7*this.e12+.5|0)/1e7:(1e7*this.e12-.5|0)/1e7)+", "+(this.e13>0?(1e7*this.e13+.5|0)/1e7:(1e7*this.e13-.5|0)/1e7)+",\n    "+(this.e20>0?(1e7*this.e20+.5|0)/1e7:(1e7*this.e20-.5|0)/1e7)+", "+(this.e21>0?(1e7*this.e21+.5|0)/1e7:(1e7*this.e21-.5|0)/1e7)+", "+(this.e22>0?(1e7*this.e22+.5|0)/1e7:(1e7*this.e22-.5|0)/1e7)+", "+(this.e23>0?(1e7*this.e23+.5|0)/1e7:(1e7*this.e23-.5|0)/1e7)+",\n    "+(this.e30>0?(1e7*this.e30+.5|0)/1e7:(1e7*this.e30-.5|0)/1e7)+", "+(this.e31>0?(1e7*this.e31+.5|0)/1e7:(1e7*this.e31-.5|0)/1e7)+", "+(this.e32>0?(1e7*this.e32+.5|0)/1e7:(1e7*this.e32-.5|0)/1e7)+", "+(this.e33>0?(1e7*this.e33+.5|0)/1e7:(1e7*this.e33-.5|0)/1e7)+"]"}};var $=function(){};$.abs=function(t){return t>0?t:-t},$.sin=function(t){return Math.sin(t)},$.cos=function(t){return Math.cos(t)},$.tan=function(t){return Math.tan(t)},$.asin=function(t){return Math.asin(t)},$.acos=function(t){return Math.acos(t)},$.atan=function(t){return Math.atan(t)},$.safeAsin=function(t){return t<=-1?-1.570796326794895:t>=1?1.570796326794895:Math.asin(t)},$.safeAcos=function(t){return t<=-1?3.14159265358979:t>=1?0:Math.acos(t)},$.atan2=function(t,i){return Math.atan2(t,i)},$.sqrt=function(t){return Math.sqrt(t)},$.clamp=function(t,i,a){return t<i?i:t>a?a:t},$.rand=function(){return Math.random()},$.randIn=function(t,i){return t+Math.random()*(i-t)},$.randVec3In=function(t,i){return new F(t+Math.random()*(i-t),t+Math.random()*(i-t),t+Math.random()*(i-t))},$.randVec3=function(){return new F(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1)};var K=function(){var t=new Array(256);this.stackVec3=t,this.sizeVec3=0;var i=new Array(256);this.stackMat3=i,this.sizeMat3=0;var a=new Array(256);this.stackMat4=a,this.sizeMat4=0;var o=new Array(256);this.stackQuat=o,this.sizeQuat=0};K.prototype={vec3:function(){return 0==this.sizeVec3?new F:this.stackVec3[--this.sizeVec3]},mat3:function(){return 0==this.sizeMat3?new J:this.stackMat3[--this.sizeMat3]},mat4:function(){return 0==this.sizeMat4?new Q:this.stackMat4[--this.sizeMat4]},quat:function(){return 0==this.sizeQuat?new tt:this.stackQuat[--this.sizeQuat]},dispose:function(t,i,a,o){if(null!=t){if(t.zero(),this.sizeVec3==this.stackVec3.length){for(var n=this.sizeVec3<<1,s=new Array(n),r=0,e=this.sizeVec3;r<e;){var _=r++;s[_]=this.stackVec3[_],this.stackVec3[_]=null}this.stackVec3=s}this.stackVec3[this.sizeVec3++]=t}if(null!=i){if(i.e00=1,i.e01=0,i.e02=0,i.e10=0,i.e11=1,i.e12=0,i.e20=0,i.e21=0,i.e22=1,this.sizeMat3==this.stackMat3.length){for(var h=this.sizeMat3<<1,l=new Array(h),c=0,p=this.sizeMat3;c<p;){var v=c++;l[v]=this.stackMat3[v],this.stackMat3[v]=null}this.stackMat3=l}this.stackMat3[this.sizeMat3++]=i}if(null!=a){if(a.e00=1,a.e01=0,a.e02=0,a.e03=0,a.e10=0,a.e11=1,a.e12=0,a.e13=0,a.e20=0,a.e21=0,a.e22=1,a.e23=0,a.e30=0,a.e31=0,a.e32=0,a.e33=1,this.sizeMat4==this.stackMat4.length){for(var m=this.sizeMat4<<1,b=new Array(m),f=0,x=this.sizeMat4;f<x;){var u=f++;b[u]=this.stackMat4[u],this.stackMat4[u]=null}this.stackMat4=b}this.stackMat4[this.sizeMat4++]=a}if(null!=o){if(o.x=0,o.y=0,o.z=0,o.w=1,this.sizeQuat==this.stackQuat.length){for(var y=this.sizeQuat<<1,g=new Array(y),X=0,z=this.sizeQuat;X<z;){var M=X++;g[M]=this.stackQuat[M],this.stackQuat[M]=null}this.stackQuat=g}this.stackQuat[this.sizeQuat++]=o}},disposeVec3:function(t){if(t.zero(),this.sizeVec3==this.stackVec3.length){for(var i=this.sizeVec3<<1,a=new Array(i),o=0,n=this.sizeVec3;o<n;){var s=o++;a[s]=this.stackVec3[s],this.stackVec3[s]=null}this.stackVec3=a}this.stackVec3[this.sizeVec3++]=t},disposeMat3:function(t){if(t.e00=1,t.e01=0,t.e02=0,t.e10=0,t.e11=1,t.e12=0,t.e20=0,t.e21=0,t.e22=1,this.sizeMat3==this.stackMat3.length){for(var i=this.sizeMat3<<1,a=new Array(i),o=0,n=this.sizeMat3;o<n;){var s=o++;a[s]=this.stackMat3[s],this.stackMat3[s]=null}this.stackMat3=a}this.stackMat3[this.sizeMat3++]=t},disposeMat4:function(t){if(t.e00=1,t.e01=0,t.e02=0,t.e03=0,t.e10=0,t.e11=1,t.e12=0,t.e13=0,t.e20=0,t.e21=0,t.e22=1,t.e23=0,t.e30=0,t.e31=0,t.e32=0,t.e33=1,this.sizeMat4==this.stackMat4.length){for(var i=this.sizeMat4<<1,a=new Array(i),o=0,n=this.sizeMat4;o<n;){var s=o++;a[s]=this.stackMat4[s],this.stackMat4[s]=null}this.stackMat4=a}this.stackMat4[this.sizeMat4++]=t},disposeQuat:function(t){if(t.x=0,t.y=0,t.z=0,t.w=1,this.sizeQuat==this.stackQuat.length){for(var i=this.sizeQuat<<1,a=new Array(i),o=0,n=this.sizeQuat;o<n;){var s=o++;a[s]=this.stackQuat[s],this.stackQuat[s]=null}this.stackQuat=a}this.stackQuat[this.sizeQuat++]=t}};var tt=function(t,i,a,o){null==o&&(o=1),null==a&&(a=0),null==i&&(i=0),null==t&&(t=0),this.x=t,this.y=i,this.z=a,this.w=o,tt.numCreations++};tt.prototype={identity:function(){return this.x=0,this.y=0,this.z=0,this.w=1,this},init:function(t,i,a,o){return this.x=t,this.y=i,this.z=a,this.w=o,this},add:function(t){return new tt(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},sub:function(t){return new tt(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},scale:function(t){return new tt(this.x*t,this.y*t,this.z*t,this.w*t)},addEq:function(t){var i=this.x+t.x,a=this.y+t.y,o=this.z+t.z,n=this.w+t.w;return this.x=i,this.y=a,this.z=o,this.w=n,this},subEq:function(t){var i=this.x-t.x,a=this.y-t.y,o=this.z-t.z,n=this.w-t.w;return this.x=i,this.y=a,this.z=o,this.w=n,this},scaleEq:function(t){var i=this.x*t,a=this.y*t,o=this.z*t,n=this.w*t;return this.x=i,this.y=a,this.z=o,this.w=n,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},normalized:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return t>0&&(t=1/t),new tt(this.x*t,this.y*t,this.z*t,this.w*t)},normalize:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);t>0&&(t=1/t);var i=this.x*t,a=this.y*t,o=this.z*t,n=this.w*t;return this.x=i,this.y=a,this.z=o,this.w=n,this},setArc:function(t,i){var a=t.x,o=t.y,n=t.z,s=i.x,r=i.y,e=i.z,_=a*s+o*r+n*e;if(this.w=Math.sqrt(.5*(1+_)),0==this.w)return e=n*n,(s=a*a)<(r=o*o)?s<e?(_=1/Math.sqrt(r+e),this.x=0,this.y=n*_,this.z=-o*_):(_=1/Math.sqrt(s+r),this.z=0,this.x=o*_,this.y=-a*_):r<e?(_=1/Math.sqrt(e+s),this.y=0,this.z=a*_,this.x=-n*_):(_=1/Math.sqrt(s+r),this.z=0,this.x=o*_,this.y=-a*_),this;_=.5/this.w;var h=o*e-n*r,l=n*s-a*e,c=a*r-o*s;return this.x=h*_,this.y=l*_,this.z=c*_,this},slerp:function(t,i){var a,o,n,s,r=this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w;if(r<0?(r=-r,a=-t.x,o=-t.y,n=-t.z,s=-t.w):(a=t.x,o=t.y,n=t.z,s=t.w),r>.999999){var e=new tt(this.x+(a-this.x)*i,this.y+(o-this.y)*i,this.z+(n-this.z)*i,this.w+(s-this.w)*i),_=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w);_>0&&(_=1/_);var h=e.x*_,l=e.y*_,c=e.z*_,p=e.w*_;return e.x=h,e.y=l,e.z=c,e.w=p,e}var v=i*Math.acos(r);a-=this.x*r,o-=this.y*r,n-=this.z*r,s-=this.w*r;var m=1/Math.sqrt(a*a+o*o+n*n+s*s);a*=m,o*=m,n*=m,s*=m;var b=Math.sin(v),f=Math.cos(v);return new tt(this.x*f+a*b,this.y*f+o*b,this.z*f+n*b,this.w*f+s*b)},copyFrom:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},clone:function(){return new tt(this.x,this.y,this.z,this.w)},fromMat3:function(t){var i,a=t.e00,o=t.e11,n=t.e22,s=a+o+n;return s>0?(i=Math.sqrt(s+1),this.w=.5*i,i=.5/i,this.x=(t.e21-t.e12)*i,this.y=(t.e02-t.e20)*i,this.z=(t.e10-t.e01)*i):a>o?a>n?(i=Math.sqrt(a-o-n+1),this.x=.5*i,i=.5/i,this.y=(t.e01+t.e10)*i,this.z=(t.e02+t.e20)*i,this.w=(t.e21-t.e12)*i):(i=Math.sqrt(n-a-o+1),this.z=.5*i,i=.5/i,this.x=(t.e02+t.e20)*i,this.y=(t.e12+t.e21)*i,this.w=(t.e10-t.e01)*i):o>n?(i=Math.sqrt(o-n-a+1),this.y=.5*i,i=.5/i,this.x=(t.e01+t.e10)*i,this.z=(t.e12+t.e21)*i,this.w=(t.e02-t.e20)*i):(i=Math.sqrt(n-a-o+1),this.z=.5*i,i=.5/i,this.x=(t.e02+t.e20)*i,this.y=(t.e12+t.e21)*i,this.w=(t.e10-t.e01)*i),this},toMat3:function(){var t=new J,i=this.x,a=this.y,o=this.z,n=this.w,s=2*i,r=2*a,e=2*o,_=i*s,h=a*r,l=o*e,c=i*r,p=a*e,v=i*e,m=n*s,b=n*r,f=n*e;return t.e00=1-h-l,t.e01=c-f,t.e02=v+b,t.e10=c+f,t.e11=1-_-l,t.e12=p-m,t.e20=v-b,t.e21=p+m,t.e22=1-_-h,t},toString:function(){return"Quat["+(this.x>0?(1e7*this.x+.5|0)/1e7:(1e7*this.x-.5|0)/1e7)+" i,\n    "+(this.y>0?(1e7*this.y+.5|0)/1e7:(1e7*this.y-.5|0)/1e7)+" j,\n    "+(this.z>0?(1e7*this.z+.5|0)/1e7:(1e7*this.z-.5|0)/1e7)+" k,\n    "+(this.w>0?(1e7*this.w+.5|0)/1e7:(1e7*this.w-.5|0)/1e7)+"]"}};var it=function(){this._next=null,this._prev=null,this._link1=new at,this._link2=new at,this._s1=null,this._s2=null,this._b1=null,this._b2=null,this._detector=null,this._cachedDetectorData=new B,this._detectorResult=new I,this._latest=!1,this._shouldBeSkipped=!1,this._manifold=new Xt,this._updater=new Mt(this._manifold),this._contactConstraint=new yt(this._manifold),this._touching=!1};it.prototype={_updateManifold:function(){if(null!=this._detector){var t=this._touching,i=this._detectorResult;this._detector.detect(i,this._s1._geom,this._s2._geom,this._s1._transform,this._s2._transform,this._cachedDetectorData);var a=i.numPoints;if(this._touching=a>0,this._touching?(this._manifold._buildBasis(i.normal),i.getMaxDepth()>W.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold?this._contactConstraint._positionCorrectionAlgorithm=W.alternativeContactPositionCorrectionAlgorithm:this._contactConstraint._positionCorrectionAlgorithm=W.defaultContactPositionCorrectionAlgorithm,i.incremental?this._updater.incrementalUpdate(i,this._b1._transform,this._b2._transform):this._updater.totalUpdate(i,this._b1._transform,this._b2._transform)):this._manifold._clear(),this._touching&&!t){var o=this._s1._contactCallback,n=this._s2._contactCallback;o==n&&(n=null),null!=o&&o.beginContact(this),null!=n&&n.beginContact(this)}if(!this._touching&&t){var s=this._s1._contactCallback,r=this._s2._contactCallback;s==r&&(r=null),null!=s&&s.endContact(this),null!=r&&r.endContact(this)}if(this._touching){var e=this._s1._contactCallback,_=this._s2._contactCallback;e==_&&(_=null),null!=e&&e.preSolve(this),null!=_&&_.preSolve(this)}}},_postSolve:function(){var t=this._s1._contactCallback,i=this._s2._contactCallback;t==i&&(i=null),null!=t&&t.postSolve(this),null!=i&&i.postSolve(this)},getShape1:function(){return this._s1},getShape2:function(){return this._s2},isTouching:function(){return this._touching},getManifold:function(){return this._manifold},getContactConstraint:function(){return this._contactConstraint},getPrev:function(){return this._prev},getNext:function(){return this._next}};var at=function(){this._prev=null,this._next=null,this._contact=null,this._other=null};at.prototype={getContact:function(){return this._contact},getOther:function(){return this._other},getPrev:function(){return this._prev},getNext:function(){return this._next}};var ot=function(t){this._broadPhase=t,this._collisionMatrix=new d,this._numContacts=0};ot.prototype={createContacts:function(){for(var t=this._broadPhase._proxyPairList;null!=t;){for(var i=t._next;;){var a,o;if(t._p1._id<t._p2._id?(a=t._p1.userData,o=t._p2.userData):(a=t._p2.userData,o=t._p1.userData),!this.shouldCollide(a,o))break;var n,s=a._rigidBody,r=o._rigidBody;n=s._numContactLinks<r._numContactLinks?s._contactLinkList:r._contactLinkList;for(var e=a._id,_=o._id,h=!1;null!=n;){var l=n._next,c=n._contact;if(c._s1._id==e&&c._s2._id==_){c._latest=!0,h=!0;break}n=l}if(!h){var p=this._contactPool;null!=p?(this._contactPool=p._next,p._next=null):p=new it;var v=p;null==this._contactList?(this._contactList=v,this._contactListLast=v):(this._contactListLast._next=v,v._prev=this._contactListLast,this._contactListLast=v),v._latest=!0;var m=this._collisionMatrix.detectors[a._geom._type][o._geom._type];v._s1=a,v._s2=o,v._b1=a._rigidBody,v._b2=o._rigidBody,v._touching=!1,null==v._b1._contactLinkList?(v._b1._contactLinkList=v._link1,v._b1._contactLinkListLast=v._link1):(v._b1._contactLinkListLast._next=v._link1,v._link1._prev=v._b1._contactLinkListLast,v._b1._contactLinkListLast=v._link1),null==v._b2._contactLinkList?(v._b2._contactLinkList=v._link2,v._b2._contactLinkListLast=v._link2):(v._b2._contactLinkListLast._next=v._link2,v._link2._prev=v._b2._contactLinkListLast,v._b2._contactLinkListLast=v._link2),v._b1._numContactLinks++,v._b2._numContactLinks++,v._link1._other=v._b2,v._link2._other=v._b1,v._link1._contact=v,v._link2._contact=v,v._detector=m;var b=v._contactConstraint;b._s1=a,b._s2=o,b._b1=b._s1._rigidBody,b._b2=b._s2._rigidBody,b._tf1=b._b1._transform,b._tf2=b._b2._transform,this._numContacts++}break}t=i}},destroyOutdatedContacts:function(){for(var t=this._broadPhase._incremental,i=this._contactList;null!=i;){for(var a=i._next;;){if(i._latest){i._latest=!1,i._shouldBeSkipped=!1;break}if(!t){var o=i._prev,n=i._next;if(null!=o&&(o._next=n),null!=n&&(n._prev=o),i==this._contactList&&(this._contactList=this._contactList._next),i==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),i._next=null,i._prev=null,i._touching){var s=i._s1._contactCallback,r=i._s2._contactCallback;s==r&&(r=null),null!=s&&s.endContact(i),null!=r&&r.endContact(i)}var e=i._link1._prev,_=i._link1._next;null!=e&&(e._next=_),null!=_&&(_._prev=e),i._link1==i._b1._contactLinkList&&(i._b1._contactLinkList=i._b1._contactLinkList._next),i._link1==i._b1._contactLinkListLast&&(i._b1._contactLinkListLast=i._b1._contactLinkListLast._prev),i._link1._next=null,i._link1._prev=null;var h=i._link2._prev,l=i._link2._next;null!=h&&(h._next=l),null!=l&&(l._prev=h),i._link2==i._b2._contactLinkList&&(i._b2._contactLinkList=i._b2._contactLinkList._next),i._link2==i._b2._contactLinkListLast&&(i._b2._contactLinkListLast=i._b2._contactLinkListLast._prev),i._link2._next=null,i._link2._prev=null,i._b1._numContactLinks--,i._b2._numContactLinks--,i._link1._other=null,i._link2._other=null,i._link1._contact=null,i._link2._contact=null,i._s1=null,i._s2=null,i._b1=null,i._b2=null,i._touching=!1,i._cachedDetectorData._clear(),i._manifold._clear(),i._detector=null;var c=i._contactConstraint;c._s1=null,c._s2=null,c._b1=null,c._b2=null,c._tf1=null,c._tf2=null,i._next=this._contactPool,this._contactPool=i,this._numContacts--;break}var p=i._s1,v=i._s2,m=p._rigidBody,b=v._rigidBody,f=!m._sleeping&&1!=m._type,x=!b._sleeping&&1!=b._type;if(!f&&!x){i._shouldBeSkipped=!0;break}var u=p._aabb,y=v._aabb,g=p._proxy,X=v._proxy;if(!(g._aabbMinX<X._aabbMaxX&&g._aabbMaxX>X._aabbMinX&&g._aabbMinY<X._aabbMaxY&&g._aabbMaxY>X._aabbMinY&&g._aabbMinZ<X._aabbMaxZ&&g._aabbMaxZ>X._aabbMinZ&&this.shouldCollide(p,v))){var z=i._prev,M=i._next;if(null!=z&&(z._next=M),null!=M&&(M._prev=z),i==this._contactList&&(this._contactList=this._contactList._next),i==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),i._next=null,i._prev=null,i._touching){var Y=i._s1._contactCallback,Z=i._s2._contactCallback;Y==Z&&(Z=null),null!=Y&&Y.endContact(i),null!=Z&&Z.endContact(i)}var d=i._link1._prev,I=i._link1._next;null!=d&&(d._next=I),null!=I&&(I._prev=d),i._link1==i._b1._contactLinkList&&(i._b1._contactLinkList=i._b1._contactLinkList._next),i._link1==i._b1._contactLinkListLast&&(i._b1._contactLinkListLast=i._b1._contactLinkListLast._prev),i._link1._next=null,i._link1._prev=null;var V=i._link2._prev,L=i._link2._next;null!=V&&(V._next=L),null!=L&&(L._prev=V),i._link2==i._b2._contactLinkList&&(i._b2._contactLinkList=i._b2._contactLinkList._next),i._link2==i._b2._contactLinkListLast&&(i._b2._contactLinkListLast=i._b2._contactLinkListLast._prev),i._link2._next=null,i._link2._prev=null,i._b1._numContactLinks--,i._b2._numContactLinks--,i._link1._other=null,i._link2._other=null,i._link1._contact=null,i._link2._contact=null,i._s1=null,i._s2=null,i._b1=null,i._b2=null,i._touching=!1,i._cachedDetectorData._clear(),i._manifold._clear(),i._detector=null;var w=i._contactConstraint;w._s1=null,w._s2=null,w._b1=null,w._b2=null,w._tf1=null,w._tf2=null,i._next=this._contactPool,this._contactPool=i,this._numContacts--;break}var A=u._minX<y._maxX&&u._maxX>y._minX&&u._minY<y._maxY&&u._maxY>y._minY&&u._minZ<y._maxZ&&u._maxZ>y._minZ;i._shouldBeSkipped=!A;break}i=a}},shouldCollide:function(t,i){var a,o,n=t._rigidBody,s=i._rigidBody;if(n==s)return!1;if(0!=n._type&&0!=s._type)return!1;if(0==(t._collisionGroup&i._collisionMask)||0==(i._collisionGroup&t._collisionMask))return!1;for(n._numJointLinks<s._numJointLinks?(a=n._jointLinkList,o=s):(a=s._jointLinkList,o=n);null!=a;){var r=a._next;if(a._other==o&&!a._joint._allowCollision)return!1;a=r}return!0},_updateContacts:function(){this._broadPhase.collectPairs(),this.createContacts(),this.destroyOutdatedContacts()},_postSolve:function(){for(var t=this._contactList;null!=t;){var i=t._next;t._touching&&t._postSolve(),t=i}},getNumContacts:function(){return this._numContacts},getContactList:function(){return this._contactList}};var nt=function(){var t=W.islandInitialRigidBodyArraySize,i=new Array(t);this.rigidBodies=i;var a=W.islandInitialConstraintArraySize,o=new Array(a);this.solvers=o;var n=W.islandInitialConstraintArraySize,s=new Array(n);this.solversSi=s;var r=W.islandInitialConstraintArraySize,e=new Array(r);this.solversNgs=e,this.numRigidBodies=0,this.numSolvers=0,this.numSolversSi=0,this.numSolversNgs=0};nt.prototype={_clear:function(){for(;this.numRigidBodies>0;)this.rigidBodies[--this.numRigidBodies]=null;for(;this.numSolvers>0;)this.solvers[--this.numSolvers]=null;for(;this.numSolversSi>0;)this.solversSi[--this.numSolversSi]=null;for(;this.numSolversNgs>0;)this.solversNgs[--this.numSolversNgs]=null},_addRigidBody:function(t){if(this.numRigidBodies==this.rigidBodies.length){for(var i=this.numRigidBodies<<1,a=new Array(i),o=0,n=this.numRigidBodies;o<n;){var s=o++;a[s]=this.rigidBodies[s],this.rigidBodies[s]=null}this.rigidBodies=a}t._addedToIsland=!0,this.rigidBodies[this.numRigidBodies++]=t},_addConstraintSolver:function(t,i){if(this.numSolvers==this.solvers.length){for(var a=this.numSolvers<<1,o=new Array(a),n=0,s=this.numSolvers;n<s;){var r=n++;o[r]=this.solvers[r],this.solvers[r]=null}this.solvers=o}if(t._addedToIsland=!0,this.solvers[this.numSolvers++]=t,i==ut.SPLIT_IMPULSE){if(this.numSolversSi==this.solversSi.length){for(var e=this.numSolversSi<<1,_=new Array(e),h=0,l=this.numSolversSi;h<l;){var c=h++;_[c]=this.solversSi[c],this.solversSi[c]=null}this.solversSi=_}this.solversSi[this.numSolversSi++]=t}if(i==ut.NGS){if(this.numSolversNgs==this.solversNgs.length){for(var p=this.numSolversNgs<<1,v=new Array(p),m=0,b=this.numSolversNgs;m<b;){var f=m++;v[f]=this.solversNgs[f],this.solversNgs[f]=null}this.solversNgs=v}this.solversNgs[this.numSolversNgs++]=t}},_stepSingleRigidBody:function(t,i){var a=t.dt,o=i._ptransform,n=i._transform;if(o._positionX=n._positionX,o._positionY=n._positionY,o._positionZ=n._positionZ,o._rotation00=n._rotation00,o._rotation01=n._rotation01,o._rotation02=n._rotation02,o._rotation10=n._rotation10,o._rotation11=n._rotation11,o._rotation12=n._rotation12,o._rotation20=n._rotation20,o._rotation21=n._rotation21,o._rotation22=n._rotation22,i._autoSleep&&i._velX*i._velX+i._velY*i._velY+i._velZ*i._velZ<W.sleepingVelocityThreshold*W.sleepingVelocityThreshold&&i._angVelX*i._angVelX+i._angVelY*i._angVelY+i._angVelZ*i._angVelZ<W.sleepingAngularVelocityThreshold*W.sleepingAngularVelocityThreshold?(i._sleepTime+=a,i._sleepTime>W.sleepingTimeThreshold&&(i._sleeping=!0,i._sleepTime=0)):i._sleepTime=0,!i._sleeping){if(0==i._type){var s,r,e,_,h,l,c=a*i._linearDamping,p=c*c,v=1/(1+c+p*(.5+.16666666666666666*c+.041666666666666664*p)),m=a*i._angularDamping,b=m*m,f=1/(1+m+b*(.5+.16666666666666666*m+.041666666666666664*b));s=this.gravityX*i._gravityScale,r=this.gravityY*i._gravityScale,e=this.gravityZ*i._gravityScale,s+=i._forceX*i._invMass,r+=i._forceY*i._invMass,e+=i._forceZ*i._invMass,_=i._invInertia00*i._torqueX+i._invInertia01*i._torqueY+i._invInertia02*i._torqueZ,h=i._invInertia10*i._torqueX+i._invInertia11*i._torqueY+i._invInertia12*i._torqueZ,l=i._invInertia20*i._torqueX+i._invInertia21*i._torqueY+i._invInertia22*i._torqueZ,i._velX+=s*a,i._velY+=r*a,i._velZ+=e*a,i._velX*=v,i._velY*=v,i._velZ*=v,i._angVelX+=_*a,i._angVelY+=h*a,i._angVelZ+=l*a,i._angVelX*=f,i._angVelY*=f,i._angVelZ*=f}i._integrate(a);for(var x=i._shapeList;null!=x;){var u,y,g,X,z,M,Y,Z,d,I,V,L,w=x._next,A=x._ptransform,k=x._localTransform,B=i._ptransform;u=B._rotation00*k._rotation00+B._rotation01*k._rotation10+B._rotation02*k._rotation20,y=B._rotation00*k._rotation01+B._rotation01*k._rotation11+B._rotation02*k._rotation21,g=B._rotation00*k._rotation02+B._rotation01*k._rotation12+B._rotation02*k._rotation22,X=B._rotation10*k._rotation00+B._rotation11*k._rotation10+B._rotation12*k._rotation20,z=B._rotation10*k._rotation01+B._rotation11*k._rotation11+B._rotation12*k._rotation21,M=B._rotation10*k._rotation02+B._rotation11*k._rotation12+B._rotation12*k._rotation22,Y=B._rotation20*k._rotation00+B._rotation21*k._rotation10+B._rotation22*k._rotation20,Z=B._rotation20*k._rotation01+B._rotation21*k._rotation11+B._rotation22*k._rotation21,d=B._rotation20*k._rotation02+B._rotation21*k._rotation12+B._rotation22*k._rotation22,A._rotation00=u,A._rotation01=y,A._rotation02=g,A._rotation10=X,A._rotation11=z,A._rotation12=M,A._rotation20=Y,A._rotation21=Z,A._rotation22=d,I=B._rotation00*k._positionX+B._rotation01*k._positionY+B._rotation02*k._positionZ,V=B._rotation10*k._positionX+B._rotation11*k._positionY+B._rotation12*k._positionZ,L=B._rotation20*k._positionX+B._rotation21*k._positionY+B._rotation22*k._positionZ,A._positionX=I,A._positionY=V,A._positionZ=L,A._positionX+=B._positionX,A._positionY+=B._positionY,A._positionZ+=B._positionZ;var P,T,S,C,q,R,E,j,N,D,F,O,G,H,U,J,Q,$,K=x._transform,tt=x._localTransform,it=i._transform;if(P=it._rotation00*tt._rotation00+it._rotation01*tt._rotation10+it._rotation02*tt._rotation20,T=it._rotation00*tt._rotation01+it._rotation01*tt._rotation11+it._rotation02*tt._rotation21,S=it._rotation00*tt._rotation02+it._rotation01*tt._rotation12+it._rotation02*tt._rotation22,C=it._rotation10*tt._rotation00+it._rotation11*tt._rotation10+it._rotation12*tt._rotation20,q=it._rotation10*tt._rotation01+it._rotation11*tt._rotation11+it._rotation12*tt._rotation21,R=it._rotation10*tt._rotation02+it._rotation11*tt._rotation12+it._rotation12*tt._rotation22,E=it._rotation20*tt._rotation00+it._rotation21*tt._rotation10+it._rotation22*tt._rotation20,j=it._rotation20*tt._rotation01+it._rotation21*tt._rotation11+it._rotation22*tt._rotation21,N=it._rotation20*tt._rotation02+it._rotation21*tt._rotation12+it._rotation22*tt._rotation22,K._rotation00=P,K._rotation01=T,K._rotation02=S,K._rotation10=C,K._rotation11=q,K._rotation12=R,K._rotation20=E,K._rotation21=j,K._rotation22=N,D=it._rotation00*tt._positionX+it._rotation01*tt._positionY+it._rotation02*tt._positionZ,F=it._rotation10*tt._positionX+it._rotation11*tt._positionY+it._rotation12*tt._positionZ,O=it._rotation20*tt._positionX+it._rotation21*tt._positionY+it._rotation22*tt._positionZ,K._positionX=D,K._positionY=F,K._positionZ=O,K._positionX+=it._positionX,K._positionY+=it._positionY,K._positionZ+=it._positionZ,x._geom._computeAabb(x._aabb,x._ptransform),G=x._aabb._minX,H=x._aabb._minY,U=x._aabb._minZ,J=x._aabb._maxX,Q=x._aabb._maxY,$=x._aabb._maxZ,x._geom._computeAabb(x._aabb,x._transform),x._aabb._minX=G<x._aabb._minX?G:x._aabb._minX,x._aabb._minY=H<x._aabb._minY?H:x._aabb._minY,x._aabb._minZ=U<x._aabb._minZ?U:x._aabb._minZ,x._aabb._maxX=J>x._aabb._maxX?J:x._aabb._maxX,x._aabb._maxY=Q>x._aabb._maxY?Q:x._aabb._maxY,x._aabb._maxZ=$>x._aabb._maxZ?$:x._aabb._maxZ,null!=x._proxy){var at,ot,nt;at=x._transform._positionX-x._ptransform._positionX,ot=x._transform._positionY-x._ptransform._positionY,nt=x._transform._positionZ-x._ptransform._positionZ;var st=x.displacement;st.x=at,st.y=ot,st.z=nt,x._rigidBody._world._broadPhase.moveProxy(x._proxy,x._aabb,x.displacement)}x=w}}},_step:function(t,i,a){for(var o=t.dt,n=!0,s=0,r=this.numRigidBodies;s<r;){var e=s++,_=this.rigidBodies[e],h=_._ptransform,l=_._transform;if(h._positionX=l._positionX,h._positionY=l._positionY,h._positionZ=l._positionZ,h._rotation00=l._rotation00,h._rotation01=l._rotation01,h._rotation02=l._rotation02,h._rotation10=l._rotation10,h._rotation11=l._rotation11,h._rotation12=l._rotation12,h._rotation20=l._rotation20,h._rotation21=l._rotation21,h._rotation22=l._rotation22,_._sleeping=!1,_._autoSleep&&_._velX*_._velX+_._velY*_._velY+_._velZ*_._velZ<W.sleepingVelocityThreshold*W.sleepingVelocityThreshold&&_._angVelX*_._angVelX+_._angVelY*_._angVelY+_._angVelZ*_._angVelZ<W.sleepingAngularVelocityThreshold*W.sleepingAngularVelocityThreshold?_._sleepTime+=o:_._sleepTime=0,_._sleepTime<W.sleepingTimeThreshold&&(n=!1),0==_._type){var c,p,v,m,b,f,x=o*_._linearDamping,u=x*x,y=1/(1+x+u*(.5+.16666666666666666*x+.041666666666666664*u)),g=o*_._angularDamping,X=g*g,z=1/(1+g+X*(.5+.16666666666666666*g+.041666666666666664*X));c=this.gravityX*_._gravityScale,p=this.gravityY*_._gravityScale,v=this.gravityZ*_._gravityScale,c+=_._forceX*_._invMass,p+=_._forceY*_._invMass,v+=_._forceZ*_._invMass,m=_._invInertia00*_._torqueX+_._invInertia01*_._torqueY+_._invInertia02*_._torqueZ,b=_._invInertia10*_._torqueX+_._invInertia11*_._torqueY+_._invInertia12*_._torqueZ,f=_._invInertia20*_._torqueX+_._invInertia21*_._torqueY+_._invInertia22*_._torqueZ,_._velX+=c*o,_._velY+=p*o,_._velZ+=v*o,_._velX*=y,_._velY*=y,_._velZ*=y,_._angVelX+=m*o,_._angVelY+=b*o,_._angVelZ+=f*o,_._angVelX*=z,_._angVelY*=z,_._angVelZ*=z}}if(n)for(var M=0,Y=this.numRigidBodies;M<Y;){var Z=M++,d=this.rigidBodies[Z];d._sleeping=!0,d._sleepTime=0}else{for(var I=0,V=this.numSolvers;I<V;){var L=I++;this.solvers[L].preSolveVelocity(t)}for(var w=0,A=this.numSolvers;w<A;){var k=w++;this.solvers[k].warmStart(t)}for(var B=0,P=i;B<P;){B++;for(var T=0,S=this.numSolvers;T<S;){var C=T++;this.solvers[C].solveVelocity()}}for(var q=0,R=this.numSolvers;q<R;){var E=q++;this.solvers[E].postSolveVelocity(t)}for(var j=0,N=this.numRigidBodies;j<N;){var D=j++;this.rigidBodies[D]._integrate(o)}for(var F=0,O=this.numSolversSi;F<O;){var G=F++;this.solversSi[G].preSolvePosition(t)}for(var H=0,U=a;H<U;){H++;for(var J=0,Q=this.numSolversSi;J<Q;){var $=J++;this.solversSi[$].solvePositionSplitImpulse()}}for(var K=0,tt=this.numRigidBodies;K<tt;){var it=K++;this.rigidBodies[it]._integratePseudoVelocity()}for(var at=0,ot=this.numSolversNgs;at<ot;){var nt=at++;this.solversNgs[nt].preSolvePosition(t)}for(var st=0,rt=a;st<rt;){st++;for(var et=0,_t=this.numSolversNgs;et<_t;){var ht=et++;this.solversNgs[ht].solvePositionNgs(t)}}for(var lt=0,ct=this.numSolvers;lt<ct;){var pt=lt++;this.solvers[pt].postSolve()}for(var vt=0,mt=this.numRigidBodies;vt<mt;)for(var bt=vt++,ft=this.rigidBodies[bt],xt=ft._shapeList;null!=xt;){var ut,yt,gt,Xt,zt,Mt,Yt,Zt,dt,It,Vt,Lt,wt=xt._next,At=xt._ptransform,kt=xt._localTransform,Bt=ft._ptransform;ut=Bt._rotation00*kt._rotation00+Bt._rotation01*kt._rotation10+Bt._rotation02*kt._rotation20,yt=Bt._rotation00*kt._rotation01+Bt._rotation01*kt._rotation11+Bt._rotation02*kt._rotation21,gt=Bt._rotation00*kt._rotation02+Bt._rotation01*kt._rotation12+Bt._rotation02*kt._rotation22,Xt=Bt._rotation10*kt._rotation00+Bt._rotation11*kt._rotation10+Bt._rotation12*kt._rotation20,zt=Bt._rotation10*kt._rotation01+Bt._rotation11*kt._rotation11+Bt._rotation12*kt._rotation21,Mt=Bt._rotation10*kt._rotation02+Bt._rotation11*kt._rotation12+Bt._rotation12*kt._rotation22,Yt=Bt._rotation20*kt._rotation00+Bt._rotation21*kt._rotation10+Bt._rotation22*kt._rotation20,Zt=Bt._rotation20*kt._rotation01+Bt._rotation21*kt._rotation11+Bt._rotation22*kt._rotation21,dt=Bt._rotation20*kt._rotation02+Bt._rotation21*kt._rotation12+Bt._rotation22*kt._rotation22,At._rotation00=ut,At._rotation01=yt,At._rotation02=gt,At._rotation10=Xt,At._rotation11=zt,At._rotation12=Mt,At._rotation20=Yt,At._rotation21=Zt,At._rotation22=dt,It=Bt._rotation00*kt._positionX+Bt._rotation01*kt._positionY+Bt._rotation02*kt._positionZ,Vt=Bt._rotation10*kt._positionX+Bt._rotation11*kt._positionY+Bt._rotation12*kt._positionZ,Lt=Bt._rotation20*kt._positionX+Bt._rotation21*kt._positionY+Bt._rotation22*kt._positionZ,At._positionX=It,At._positionY=Vt,At._positionZ=Lt,At._positionX+=Bt._positionX,At._positionY+=Bt._positionY,At._positionZ+=Bt._positionZ;var Pt,Tt,St,Ct,qt,Rt,Et,jt,Nt,Dt,Ft,Ot,Wt,Gt,Ht,Ut,Jt,Qt,$t=xt._transform,Kt=xt._localTransform,ti=ft._transform;if(Pt=ti._rotation00*Kt._rotation00+ti._rotation01*Kt._rotation10+ti._rotation02*Kt._rotation20,Tt=ti._rotation00*Kt._rotation01+ti._rotation01*Kt._rotation11+ti._rotation02*Kt._rotation21,St=ti._rotation00*Kt._rotation02+ti._rotation01*Kt._rotation12+ti._rotation02*Kt._rotation22,Ct=ti._rotation10*Kt._rotation00+ti._rotation11*Kt._rotation10+ti._rotation12*Kt._rotation20,qt=ti._rotation10*Kt._rotation01+ti._rotation11*Kt._rotation11+ti._rotation12*Kt._rotation21,Rt=ti._rotation10*Kt._rotation02+ti._rotation11*Kt._rotation12+ti._rotation12*Kt._rotation22,Et=ti._rotation20*Kt._rotation00+ti._rotation21*Kt._rotation10+ti._rotation22*Kt._rotation20,jt=ti._rotation20*Kt._rotation01+ti._rotation21*Kt._rotation11+ti._rotation22*Kt._rotation21,Nt=ti._rotation20*Kt._rotation02+ti._rotation21*Kt._rotation12+ti._rotation22*Kt._rotation22,$t._rotation00=Pt,$t._rotation01=Tt,$t._rotation02=St,$t._rotation10=Ct,$t._rotation11=qt,$t._rotation12=Rt,$t._rotation20=Et,$t._rotation21=jt,$t._rotation22=Nt,Dt=ti._rotation00*Kt._positionX+ti._rotation01*Kt._positionY+ti._rotation02*Kt._positionZ,Ft=ti._rotation10*Kt._positionX+ti._rotation11*Kt._positionY+ti._rotation12*Kt._positionZ,Ot=ti._rotation20*Kt._positionX+ti._rotation21*Kt._positionY+ti._rotation22*Kt._positionZ,$t._positionX=Dt,$t._positionY=Ft,$t._positionZ=Ot,$t._positionX+=ti._positionX,$t._positionY+=ti._positionY,$t._positionZ+=ti._positionZ,xt._geom._computeAabb(xt._aabb,xt._ptransform),Wt=xt._aabb._minX,Gt=xt._aabb._minY,Ht=xt._aabb._minZ,Ut=xt._aabb._maxX,Jt=xt._aabb._maxY,Qt=xt._aabb._maxZ,xt._geom._computeAabb(xt._aabb,xt._transform),xt._aabb._minX=Wt<xt._aabb._minX?Wt:xt._aabb._minX,xt._aabb._minY=Gt<xt._aabb._minY?Gt:xt._aabb._minY,xt._aabb._minZ=Ht<xt._aabb._minZ?Ht:xt._aabb._minZ,xt._aabb._maxX=Ut>xt._aabb._maxX?Ut:xt._aabb._maxX,xt._aabb._maxY=Jt>xt._aabb._maxY?Jt:xt._aabb._maxY,xt._aabb._maxZ=Qt>xt._aabb._maxZ?Qt:xt._aabb._maxZ,null!=xt._proxy){var ii,ai,oi;ii=xt._transform._positionX-xt._ptransform._positionX,ai=xt._transform._positionY-xt._ptransform._positionY,oi=xt._transform._positionZ-xt._ptransform._positionZ;var ni=xt.displacement;ni.x=ii,ni.y=ai,ni.z=oi,xt._rigidBody._world._broadPhase.moveProxy(xt._proxy,xt._aabb,xt.displacement)}xt=wt}}}};var st=function(){this.dt=0,this.invDt=0,this.dtRatio=1},rt=function(t,i){switch(null==t&&(t=2),t){case 1:this._broadPhase=new l;break;case 2:this._broadPhase=new c}this._contactManager=new ot(this._broadPhase),null==i&&(i=new F(0,-9.80665,0)),this._gravity=new F(i.x,i.y,i.z),this._rigidBodyList=null,this._rigidBodyListLast=null,this._jointList=null,this._jointListLast=null,this._numRigidBodies=0,this._numShapes=0,this._numJoints=0,this._numIslands=0,this._numVelocityIterations=10,this._numPositionIterations=5,this._rayCastWrapper=new et,this._convexCastWrapper=new _t,this._aabbTestWrapper=new ht,this._island=new nt;var a=W.islandInitialConstraintArraySize,o=new Array(a);this._solversInIslands=o;var n=W.islandInitialRigidBodyArraySize,s=new Array(n);this._rigidBodyStack=s,this._timeStep=new st,this._pool=new K,this._shapeIdCount=0};rt.prototype={_updateContacts:function(){var t=(new Date).getTime()/1e3;this._contactManager._updateContacts();var i=(new Date).getTime()/1e3;ft.broadPhaseCollisionTime=1e3*(i-t);for(var a=(new Date).getTime()/1e3,o=this._contactManager._contactList;null!=o;){var n=o._next;o._shouldBeSkipped||o._updateManifold(),o=n}var s=(new Date).getTime()/1e3;ft.narrowPhaseCollisionTime=1e3*(s-a)},_solveIslands:function(){var t=(new Date).getTime()/1e3;if(W.disableSleeping)for(var i=this._rigidBodyList;null!=i;){var a=i._next;i._sleeping=!1,i._sleepTime=0,i=a}if(this._rigidBodyStack.length<this._numRigidBodies){for(var o=this._rigidBodyStack.length<<1;o<this._numRigidBodies;)o<<=1;var n=new Array(o);this._rigidBodyStack=n}this._numIslands=0;var s=this._island,r=this._gravity;s.gravityX=r.x,s.gravityY=r.y,s.gravityZ=r.z;var e=this._rigidBodyList;for(this._numSolversInIslands=0;null!=e;){for(var _=e._next;!e._addedToIsland&&!e._sleeping&&1!=e._type;){if(0==e._numContactLinks&&0==e._numJointLinks){this._island._stepSingleRigidBody(this._timeStep,e),this._numIslands++;break}this.buildIsland(e),this._island._step(this._timeStep,this._numVelocityIterations,this._numPositionIterations),this._island._clear(),this._numIslands++;break}e=_}for(this._contactManager._postSolve(),e=this._rigidBodyList;null!=e;){var h=e._next;e._addedToIsland=!1,e=h}for(e=this._rigidBodyList;null!=e;){var l=e._next;e._forceX=0,e._forceY=0,e._forceZ=0,e._torqueX=0,e._torqueY=0,e._torqueZ=0,e=l}for(;this._numSolversInIslands>0;)this._solversInIslands[--this._numSolversInIslands]._addedToIsland=!1,this._solversInIslands[this._numSolversInIslands]=null;var c=(new Date).getTime()/1e3;ft.dynamicsTime=1e3*(c-t)},buildIsland:function(t){var i=1;for(this._island._addRigidBody(t),this._rigidBodyStack[0]=t;i>0;){var a=this._rigidBodyStack[--i];if(this._rigidBodyStack[i]=null,1!=a._type){for(var o=a._contactLinkList;null!=o;){var n=o._next,s=o._contact._contactConstraint,r=o._contact._contactConstraint._solver;if(s.isTouching()&&!r._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){for(var e=this._numSolversInIslands<<1,_=new Array(e),h=0,l=this._numSolversInIslands;h<l;){var c=h++;_[c]=this._solversInIslands[c],this._solversInIslands[c]=null}this._solversInIslands=_}this._solversInIslands[this._numSolversInIslands++]=r,this._island._addConstraintSolver(r,s._positionCorrectionAlgorithm);var p=o._other;p._addedToIsland||(this._island._addRigidBody(p),this._rigidBodyStack[i++]=p)}o=n}for(var v=a._jointLinkList;null!=v;){var m=v._next,b=v._joint,f=b._solver;if(!f._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){for(var x=this._numSolversInIslands<<1,u=new Array(x),y=0,g=this._numSolversInIslands;y<g;){var X=y++;u[X]=this._solversInIslands[X],this._solversInIslands[X]=null}this._solversInIslands=u}this._solversInIslands[this._numSolversInIslands++]=f,this._island._addConstraintSolver(f,b._positionCorrectionAlgorithm);var z=v._other;z._addedToIsland||(this._island._addRigidBody(z),this._rigidBodyStack[i++]=z)}v=m}}}},_drawBvh:function(t,i){t.drawBvh&&this._drawBvhNode(t,i._root,0,t.style.bvhNodeColor)},_drawBvhNode:function(t,i,a,o){if(null!=i){if(a>=t.drawBvhMinLevel&&a<=t.drawBvhMaxLevel){var n=this._pool,s=0==n.sizeVec3?new F:n.stackVec3[--n.sizeVec3],r=this._pool,e=0==r.sizeVec3?new F:r.stackVec3[--r.sizeVec3],_=s;_.x=i._aabbMinX,_.y=i._aabbMinY,_.z=i._aabbMinZ;var h=e;h.x=i._aabbMaxX,h.y=i._aabbMaxY,h.z=i._aabbMaxZ,t.aabb(s,e,o);var l=this._pool;if(null!=s){if(s.zero(),l.sizeVec3==l.stackVec3.length){for(var c=l.sizeVec3<<1,p=new Array(c),v=0,m=l.sizeVec3;v<m;){var b=v++;p[b]=l.stackVec3[b],l.stackVec3[b]=null}l.stackVec3=p}l.stackVec3[l.sizeVec3++]=s}var f=this._pool;if(null!=e){if(e.zero(),f.sizeVec3==f.stackVec3.length){for(var x=f.sizeVec3<<1,u=new Array(x),y=0,g=f.sizeVec3;y<g;){var X=y++;u[X]=f.stackVec3[X],f.stackVec3[X]=null}f.stackVec3=u}f.stackVec3[f.sizeVec3++]=e}}this._drawBvhNode(t,i._children[0],a+1,o),this._drawBvhNode(t,i._children[1],a+1,o)}},_drawRigidBodies:function(t){for(var i=t.style,a=this._rigidBodyList;null!=a;){var o=a._next;if(t.drawBases){var n=t.style;t.basis(a._transform,n.basisLength,n.basisColorX,n.basisColorY,n.basisColorZ)}var s=null,r=0==a._type;r||(s=2==a._type?i.kinematicShapeColor:i.staticShapeColor);for(var e=a._shapeList;null!=e;){var _=e._next;if(r&&(s=0==(1&e._id)?a._sleeping?i.sleepingShapeColor1:a._sleepTime>W.sleepingTimeThreshold?i.sleepyShapeColor1:i.shapeColor1:a._sleeping?i.sleepingShapeColor2:a._sleepTime>W.sleepingTimeThreshold?i.sleepyShapeColor2:i.shapeColor2),t.drawShapes){var h=e._geom,l=e._transform;switch(h._type){case 0:t.sphere(l,h._radius,s);break;case 1:var c=h,p=this._pool,v=0==p.sizeVec3?new F:p.stackVec3[--p.sizeVec3],m=v;m.x=c._halfExtentsX,m.y=c._halfExtentsY,m.z=c._halfExtentsZ,t.box(l,v,s);var b=this._pool;if(null!=v){if(v.zero(),b.sizeVec3==b.stackVec3.length){for(var f=b.sizeVec3<<1,x=new Array(f),u=0,y=b.sizeVec3;u<y;){var g=u++;x[g]=b.stackVec3[g],b.stackVec3[g]=null}b.stackVec3=x}b.stackVec3[b.sizeVec3++]=v}break;case 2:var X=h;t.cylinder(l,X._radius,X._halfHeight,s);break;case 3:var z=h;t.cone(l,z._radius,z._halfHeight,s);break;case 4:var M=h;t.capsule(l,M._radius,M._halfHeight,s);break;case 5:var Y=h,Z=Y._numVertices,d=this._pool,I=0==d.sizeVec3?new F:d.stackVec3[--d.sizeVec3],V=this._pool,L=0==V.sizeVec3?new F:V.stackVec3[--V.sizeVec3],w=this._pool,A=0==w.sizeVec3?new F:w.stackVec3[--w.sizeVec3],k=this._pool,B=0==k.sizeVec3?new F:k.stackVec3[--k.sizeVec3],P=this._pool,T=0==P.sizeVec3?new F:P.stackVec3[--P.sizeVec3],S=this._pool,C=0==S.sizeVec3?new F:S.stackVec3[--S.sizeVec3],q=this._pool,R=0==q.sizeMat3?new J:q.stackMat3[--q.sizeMat3],E=this._pool,j=0==E.sizeVec3?new F:E.stackVec3[--E.sizeVec3],N=R;N.e00=l._rotation00,N.e01=l._rotation01,N.e02=l._rotation02,N.e10=l._rotation10,N.e11=l._rotation11,N.e12=l._rotation12,N.e20=l._rotation20,N.e21=l._rotation21,N.e22=l._rotation22;var D=j;D.x=l._positionX,D.y=l._positionY,D.z=l._positionZ;for(var O=0,G=Z;O<G;){var H=O++,U=Y._tmpVertices[H],Q=Y._vertices[H];U.x=Q.x,U.y=Q.y,U.z=Q.z;var $=U,K=$.x*R.e00+$.y*R.e01+$.z*R.e02,tt=$.x*R.e10+$.y*R.e11+$.z*R.e12,it=$.x*R.e20+$.y*R.e21+$.z*R.e22;$.x=K,$.y=tt,$.z=it;var at=$,ot=at.x+j.x,nt=at.y+j.y,st=at.z+j.z;at.x=ot,at.y=nt,at.z=st}if(Z>30)for(var rt=0,et=Z;rt<et;){var _t=rt++,ht=Y._tmpVertices[_t];I.x=ht.x,I.y=ht.y,I.z=ht.z;var lt=Y._tmpVertices[(_t+1)%Z];L.x=lt.x,L.y=lt.y,L.z=lt.z,t.line(I,L,s)}else if(this._debugDraw.wireframe||Z>10)for(var ct=0,pt=Z;ct<pt;){var vt=ct++,mt=Y._tmpVertices[vt];I.x=mt.x,I.y=mt.y,I.z=mt.z;for(var bt=0,ft=vt;bt<ft;){var xt=bt++,ut=Y._tmpVertices[xt];L.x=ut.x,L.y=ut.y,L.z=ut.z,t.line(I,L,s)}}else for(var yt=0,gt=Z;yt<gt;){var Xt=yt++,zt=Y._tmpVertices[Xt];I.x=zt.x,I.y=zt.y,I.z=zt.z;for(var Mt=0,Yt=Xt;Mt<Yt;){var Zt=Mt++,dt=Y._tmpVertices[Zt];L.x=dt.x,L.y=dt.y,L.z=dt.z;for(var It=0,Vt=Zt;It<Vt;){var Lt=It++,wt=Y._tmpVertices[Lt];A.x=wt.x,A.y=wt.y,A.z=wt.z,B.x=L.x,B.y=L.y,B.z=L.z;var At=B,kt=At.x-I.x,Bt=At.y-I.y,Pt=At.z-I.z;At.x=kt,At.y=Bt,At.z=Pt,T.x=A.x,T.y=A.y,T.z=A.z;var Tt=T,St=Tt.x-I.x,Ct=Tt.y-I.y,qt=Tt.z-I.z;Tt.x=St,Tt.y=Ct,Tt.z=qt,C.x=B.x,C.y=B.y,C.z=B.z;var Rt=C,Et=Rt.y*T.z-Rt.z*T.y,jt=Rt.z*T.x-Rt.x*T.z,Nt=Rt.x*T.y-Rt.y*T.x;Rt.x=Et,Rt.y=jt,Rt.z=Nt;var Dt=Rt,Ft=Math.sqrt(Dt.x*Dt.x+Dt.y*Dt.y+Dt.z*Dt.z);Ft>0&&(Ft=1/Ft);var Ot=Dt.x*Ft,Wt=Dt.y*Ft,Gt=Dt.z*Ft;Dt.x=Ot,Dt.y=Wt,Dt.z=Gt,t.triangle(I,L,A,C,C,C,s);var Ht=-C.x,Ut=-C.y,Jt=-C.z;C.x=Ht,C.y=Ut,C.z=Jt,t.triangle(I,A,L,C,C,C,s)}}}var Qt=this._pool;if(null!=I){if(I.zero(),Qt.sizeVec3==Qt.stackVec3.length){for(var $t=Qt.sizeVec3<<1,Kt=new Array($t),ti=0,ii=Qt.sizeVec3;ti<ii;){var ai=ti++;Kt[ai]=Qt.stackVec3[ai],Qt.stackVec3[ai]=null}Qt.stackVec3=Kt}Qt.stackVec3[Qt.sizeVec3++]=I}var oi=this._pool;if(null!=L){if(L.zero(),oi.sizeVec3==oi.stackVec3.length){for(var ni=oi.sizeVec3<<1,si=new Array(ni),ri=0,ei=oi.sizeVec3;ri<ei;){var _i=ri++;si[_i]=oi.stackVec3[_i],oi.stackVec3[_i]=null}oi.stackVec3=si}oi.stackVec3[oi.sizeVec3++]=L}var hi=this._pool;if(null!=A){if(A.zero(),hi.sizeVec3==hi.stackVec3.length){for(var li=hi.sizeVec3<<1,ci=new Array(li),pi=0,vi=hi.sizeVec3;pi<vi;){var mi=pi++;ci[mi]=hi.stackVec3[mi],hi.stackVec3[mi]=null}hi.stackVec3=ci}hi.stackVec3[hi.sizeVec3++]=A}var bi=this._pool;if(null!=B){if(B.zero(),bi.sizeVec3==bi.stackVec3.length){for(var fi=bi.sizeVec3<<1,xi=new Array(fi),ui=0,yi=bi.sizeVec3;ui<yi;){var gi=ui++;xi[gi]=bi.stackVec3[gi],bi.stackVec3[gi]=null}bi.stackVec3=xi}bi.stackVec3[bi.sizeVec3++]=B}var Xi=this._pool;if(null!=T){if(T.zero(),Xi.sizeVec3==Xi.stackVec3.length){for(var zi=Xi.sizeVec3<<1,Mi=new Array(zi),Yi=0,Zi=Xi.sizeVec3;Yi<Zi;){var di=Yi++;Mi[di]=Xi.stackVec3[di],Xi.stackVec3[di]=null}Xi.stackVec3=Mi}Xi.stackVec3[Xi.sizeVec3++]=T}var Ii=this._pool;if(null!=C){if(C.zero(),Ii.sizeVec3==Ii.stackVec3.length){for(var Vi=Ii.sizeVec3<<1,Li=new Array(Vi),wi=0,Ai=Ii.sizeVec3;wi<Ai;){var ki=wi++;Li[ki]=Ii.stackVec3[ki],Ii.stackVec3[ki]=null}Ii.stackVec3=Li}Ii.stackVec3[Ii.sizeVec3++]=C}var Bi=this._pool;if(null!=R){if(R.e00=1,R.e01=0,R.e02=0,R.e10=0,R.e11=1,R.e12=0,R.e20=0,R.e21=0,R.e22=1,Bi.sizeMat3==Bi.stackMat3.length){for(var Pi=Bi.sizeMat3<<1,Ti=new Array(Pi),Si=0,Ci=Bi.sizeMat3;Si<Ci;){var qi=Si++;Ti[qi]=Bi.stackMat3[qi],Bi.stackMat3[qi]=null}Bi.stackMat3=Ti}Bi.stackMat3[Bi.sizeMat3++]=R}var Ri=this._pool;if(null!=j){if(j.zero(),Ri.sizeVec3==Ri.stackVec3.length){for(var Ei=Ri.sizeVec3<<1,ji=new Array(Ei),Ni=0,Di=Ri.sizeVec3;Ni<Di;){var Fi=Ni++;ji[Fi]=Ri.stackVec3[Fi],Ri.stackVec3[Fi]=null}Ri.stackVec3=ji}Ri.stackVec3[Ri.sizeVec3++]=j}}}if(t.drawAabbs){var Oi=e._aabb,Wi=i.aabbColor,Gi=this._pool,Hi=0==Gi.sizeVec3?new F:Gi.stackVec3[--Gi.sizeVec3],Ui=this._pool,Ji=0==Ui.sizeVec3?new F:Ui.stackVec3[--Ui.sizeVec3],Qi=Hi;Qi.x=Oi._minX,Qi.y=Oi._minY,Qi.z=Oi._minZ;var $i=Ji;$i.x=Oi._maxX,$i.y=Oi._maxY,$i.z=Oi._maxZ,t.aabb(Hi,Ji,Wi);var Ki=this._pool;if(null!=Hi){if(Hi.zero(),Ki.sizeVec3==Ki.stackVec3.length){for(var ta=Ki.sizeVec3<<1,ia=new Array(ta),aa=0,oa=Ki.sizeVec3;aa<oa;){var na=aa++;ia[na]=Ki.stackVec3[na],Ki.stackVec3[na]=null}Ki.stackVec3=ia}Ki.stackVec3[Ki.sizeVec3++]=Hi}var sa=this._pool;if(null!=Ji){if(Ji.zero(),sa.sizeVec3==sa.stackVec3.length){for(var ra=sa.sizeVec3<<1,ea=new Array(ra),_a=0,ha=sa.sizeVec3;_a<ha;){var la=_a++;ea[la]=sa.stackVec3[la],sa.stackVec3[la]=null}sa.stackVec3=ea}sa.stackVec3[sa.sizeVec3++]=Ji}}e=_}a=o}},_drawConstraints:function(t){var i=t.style;if(t.drawPairs||t.drawContacts)for(var a=this._contactManager._contactList;null!=a;){var o=a._next;if(t.drawPairs){var n=i.pairColor,s=this._pool,r=0==s.sizeVec3?new F:s.stackVec3[--s.sizeVec3],e=this._pool,_=0==e.sizeVec3?new F:e.stackVec3[--e.sizeVec3],h=r;h.x=a._s1._transform._positionX,h.y=a._s1._transform._positionY,h.z=a._s1._transform._positionZ;var l=_;l.x=a._s2._transform._positionX,l.y=a._s2._transform._positionY,l.z=a._s2._transform._positionZ,t.line(r,_,n);var c=this._pool;if(null!=r){if(r.zero(),c.sizeVec3==c.stackVec3.length){for(var p=c.sizeVec3<<1,v=new Array(p),m=0,b=c.sizeVec3;m<b;){var f=m++;v[f]=c.stackVec3[f],c.stackVec3[f]=null}c.stackVec3=v}c.stackVec3[c.sizeVec3++]=r}var x=this._pool;if(null!=_){if(_.zero(),x.sizeVec3==x.stackVec3.length){for(var u=x.sizeVec3<<1,y=new Array(u),g=0,X=x.sizeVec3;g<X;){var z=g++;y[z]=x.stackVec3[z],x.stackVec3[z]=null}x.stackVec3=y}x.stackVec3[x.sizeVec3++]=_}}if(t.drawContacts)for(var M=a._contactConstraint,Y=a._contactConstraint._manifold._points,Z=0,d=a._contactConstraint._manifold._numPoints;Z<d;){var I=Y[Z++],V=t.style,L=(M._s1._transform,M._s2._transform,this._pool),w=0==L.sizeVec3?new F:L.stackVec3[--L.sizeVec3],A=this._pool,k=0==A.sizeVec3?new F:A.stackVec3[--A.sizeVec3],B=this._pool,P=0==B.sizeVec3?new F:B.stackVec3[--B.sizeVec3],T=this._pool,S=0==T.sizeVec3?new F:T.stackVec3[--T.sizeVec3],C=this._pool,q=0==C.sizeVec3?new F:C.stackVec3[--C.sizeVec3],R=w;R.x=I._pos1X,R.y=I._pos1Y,R.z=I._pos1Z;var E=k;E.x=I._pos2X,E.y=I._pos2Y,E.z=I._pos2Z;var j=P;j.x=M._manifold._normalX,j.y=M._manifold._normalY,j.z=M._manifold._normalZ;var N=S;N.x=M._manifold._tangentX,N.y=M._manifold._tangentY,N.z=M._manifold._tangentZ;var D=q;if(D.x=M._manifold._binormalX,D.y=M._manifold._binormalY,D.z=M._manifold._binormalZ,I._disabled)t.point(w,V.disabledContactColor),t.point(k,V.disabledContactColor),t.line(w,k,V.disabledContactColor);else if(I._warmStarted){var O;switch(3&I._id){case 0:O=V.contactColor;break;case 1:O=V.contactColor2;break;case 2:O=V.contactColor3;break;default:O=V.contactColor4}t.point(w,O),t.point(k,O),t.line(w,k,V.contactColor)}else t.point(w,V.newContactColor),t.point(k,V.newContactColor),t.line(w,k,V.newContactColor);k.x=w.x,k.y=w.y,k.z=w.z;var W=k,G=V.contactNormalLength,H=W.x+P.x*G,U=W.y+P.y*G,J=W.z+P.z*G;if(W.x=H,W.y=U,W.z=J,t.line(w,k,V.contactNormalColor),t.drawContactBases){k.x=w.x,k.y=w.y,k.z=w.z;var Q=k,$=V.contactTangentLength,K=Q.x+S.x*$,tt=Q.y+S.y*$,it=Q.z+S.z*$;Q.x=K,Q.y=tt,Q.z=it,t.line(w,k,V.contactTangentColor),k.x=w.x,k.y=w.y,k.z=w.z;var at=k,ot=V.contactBinormalLength,nt=at.x+q.x*ot,st=at.y+q.y*ot,rt=at.z+q.z*ot;at.x=nt,at.y=st,at.z=rt,t.line(w,k,V.contactBinormalColor)}var et=this._pool;if(null!=w){if(w.zero(),et.sizeVec3==et.stackVec3.length){for(var _t=et.sizeVec3<<1,ht=new Array(_t),lt=0,ct=et.sizeVec3;lt<ct;){var pt=lt++;ht[pt]=et.stackVec3[pt],et.stackVec3[pt]=null}et.stackVec3=ht}et.stackVec3[et.sizeVec3++]=w}var vt=this._pool;if(null!=k){if(k.zero(),vt.sizeVec3==vt.stackVec3.length){for(var mt=vt.sizeVec3<<1,bt=new Array(mt),ft=0,xt=vt.sizeVec3;ft<xt;){var ut=ft++;bt[ut]=vt.stackVec3[ut],vt.stackVec3[ut]=null}vt.stackVec3=bt}vt.stackVec3[vt.sizeVec3++]=k}var yt=this._pool;if(null!=P){if(P.zero(),yt.sizeVec3==yt.stackVec3.length){for(var gt=yt.sizeVec3<<1,Xt=new Array(gt),zt=0,Mt=yt.sizeVec3;zt<Mt;){var Yt=zt++;Xt[Yt]=yt.stackVec3[Yt],yt.stackVec3[Yt]=null}yt.stackVec3=Xt}yt.stackVec3[yt.sizeVec3++]=P}var Zt=this._pool;if(null!=S){if(S.zero(),Zt.sizeVec3==Zt.stackVec3.length){for(var dt=Zt.sizeVec3<<1,It=new Array(dt),Vt=0,Lt=Zt.sizeVec3;Vt<Lt;){var wt=Vt++;It[wt]=Zt.stackVec3[wt],Zt.stackVec3[wt]=null}Zt.stackVec3=It}Zt.stackVec3[Zt.sizeVec3++]=S}var At=this._pool;if(null!=q){if(q.zero(),At.sizeVec3==At.stackVec3.length){for(var kt=At.sizeVec3<<1,Bt=new Array(kt),Pt=0,Tt=At.sizeVec3;Pt<Tt;){var St=Pt++;Bt[St]=At.stackVec3[St],At.stackVec3[St]=null}At.stackVec3=Bt}At.stackVec3[At.sizeVec3++]=q}}a=o}if(t.drawJoints)for(var Ct=this._jointList;null!=Ct;){var qt=Ct._next,Rt=this._pool,Et=0==Rt.sizeVec3?new F:Rt.stackVec3[--Rt.sizeVec3],jt=this._pool,Nt=0==jt.sizeVec3?new F:jt.stackVec3[--jt.sizeVec3],Dt=Et;Dt.x=Ct._b1._transform._positionX,Dt.y=Ct._b1._transform._positionY,Dt.z=Ct._b1._transform._positionZ;var Ft=Nt;Ft.x=Ct._b2._transform._positionX,Ft.y=Ct._b2._transform._positionY,Ft.z=Ct._b2._transform._positionZ;var Ot=this._pool,Wt=0==Ot.sizeVec3?new F:Ot.stackVec3[--Ot.sizeVec3],Gt=this._pool,Ht=0==Gt.sizeVec3?new F:Gt.stackVec3[--Gt.sizeVec3],Ut=this._pool,Jt=0==Ut.sizeVec3?new F:Ut.stackVec3[--Ut.sizeVec3],Qt=this._pool,$t=0==Qt.sizeVec3?new F:Qt.stackVec3[--Qt.sizeVec3],Kt=this._pool,ti=0==Kt.sizeVec3?new F:Kt.stackVec3[--Kt.sizeVec3],ii=this._pool,ai=0==ii.sizeVec3?new F:ii.stackVec3[--ii.sizeVec3],oi=this._pool,ni=0==oi.sizeVec3?new F:oi.stackVec3[--oi.sizeVec3],si=this._pool,ri=0==si.sizeVec3?new F:si.stackVec3[--si.sizeVec3],ei=Wt;ei.x=Ct._anchor1X,ei.y=Ct._anchor1Y,ei.z=Ct._anchor1Z;var _i=Ht;_i.x=Ct._anchor2X,_i.y=Ct._anchor2Y,_i.z=Ct._anchor2Z;var hi=Jt;hi.x=Ct._basisX1X,hi.y=Ct._basisX1Y,hi.z=Ct._basisX1Z;var li=$t;li.x=Ct._basisY1X,li.y=Ct._basisY1Y,li.z=Ct._basisY1Z;var ci=ti;ci.x=Ct._basisZ1X,ci.y=Ct._basisZ1Y,ci.z=Ct._basisZ1Z;var pi=ai;pi.x=Ct._basisX2X,pi.y=Ct._basisX2Y,pi.z=Ct._basisX2Z;var vi=ni;vi.x=Ct._basisY2X,vi.y=Ct._basisY2Y,vi.z=Ct._basisY2Z;var mi=ri;if(mi.x=Ct._basisZ2X,mi.y=Ct._basisZ2Y,mi.z=Ct._basisZ2Z,t.line(Et,Wt,t.style.jointLineColor),t.line(Nt,Ht,t.style.jointLineColor),t.drawJointLimits)switch(Ct._type){case 0:break;case 1:var bi=t.style.jointRotationalConstraintRadius,fi=t.style.jointLineColor,xi=Ct._lm;this._drawRotationalLimit(t,Wt,$t,ti,ni,bi,xi.lowerLimit,xi.upperLimit,fi);break;case 2:var ui=Ct,yi=t.style.jointRotationalConstraintRadius,gi=t.style.jointLineColor,Xi=ui._rotLm,zi=ui._translLm;this._drawRotationalLimit(t,Ht,$t,ti,ni,yi,Xi.lowerLimit,Xi.upperLimit,gi),this._drawTranslationalLimit(t,Wt,Jt,zi.lowerLimit,zi.upperLimit,gi);break;case 3:t.style.jointRotationalConstraintRadius;var Mi=t.style.jointLineColor,Yi=Ct._lm;this._drawTranslationalLimit(t,Wt,Jt,Yi.lowerLimit,Yi.upperLimit,Mi);break;case 4:var Zi=Ct,di=t.style.jointRotationalConstraintRadius,Ii=t.style.jointLineColor,Vi=Zi._lm1,Li=Zi._lm2;this._drawRotationalLimit(t,Wt,$t,ti,$t,di,Zi._angleX-Vi.upperLimit,Zi._angleX-Vi.lowerLimit,Ii),this._drawRotationalLimit(t,Ht,ai,ni,ai,di,Li.lowerLimit-Zi._angleZ,Li.upperLimit-Zi._angleZ,Ii);break;case 5:var wi=Ct,Ai=t.style.jointRotationalConstraintRadius,ki=t.style.jointLineColor,Bi=wi._twistLm;this._drawRotationalLimit(t,Ht,ni,ri,ni,Ai,Bi.lowerLimit-wi._twistAngle,Bi.upperLimit-wi._twistAngle,ki),this._drawEllipseOnSphere(t,Wt,Jt,$t,ti,wi._maxSwingAngle1,wi._maxSwingAngle2,Ai,ki);var Pi=this._pool,Ti=0==Pi.sizeVec3?new F:Pi.stackVec3[--Pi.sizeVec3];Ti.x=Ht.x,Ti.y=Ht.y,Ti.z=Ht.z;var Si=Ti,Ci=Si.x+ai.x*Ai,qi=Si.y+ai.y*Ai,Ri=Si.z+ai.z*Ai;Si.x=Ci,Si.y=qi,Si.z=Ri;var Ei=Si;t.line(Ht,Ei,ki);var ji=this._pool;if(null!=Ei){if(Ei.zero(),ji.sizeVec3==ji.stackVec3.length){for(var Ni=ji.sizeVec3<<1,Di=new Array(Ni),Fi=0,Oi=ji.sizeVec3;Fi<Oi;){var Wi=Fi++;Di[Wi]=ji.stackVec3[Wi],ji.stackVec3[Wi]=null}ji.stackVec3=Di}ji.stackVec3[ji.sizeVec3++]=Ei}}t.line(Wt,Ht,t.style.jointErrorColor);var Gi=this._pool;if(null!=Et){if(Et.zero(),Gi.sizeVec3==Gi.stackVec3.length){for(var Hi=Gi.sizeVec3<<1,Ui=new Array(Hi),Ji=0,Qi=Gi.sizeVec3;Ji<Qi;){var $i=Ji++;Ui[$i]=Gi.stackVec3[$i],Gi.stackVec3[$i]=null}Gi.stackVec3=Ui}Gi.stackVec3[Gi.sizeVec3++]=Et}var Ki=this._pool;if(null!=Nt){if(Nt.zero(),Ki.sizeVec3==Ki.stackVec3.length){for(var ta=Ki.sizeVec3<<1,ia=new Array(ta),aa=0,oa=Ki.sizeVec3;aa<oa;){var na=aa++;ia[na]=Ki.stackVec3[na],Ki.stackVec3[na]=null}Ki.stackVec3=ia}Ki.stackVec3[Ki.sizeVec3++]=Nt}var sa=this._pool;if(null!=Wt){if(Wt.zero(),sa.sizeVec3==sa.stackVec3.length){for(var ra=sa.sizeVec3<<1,ea=new Array(ra),_a=0,ha=sa.sizeVec3;_a<ha;){var la=_a++;ea[la]=sa.stackVec3[la],sa.stackVec3[la]=null}sa.stackVec3=ea}sa.stackVec3[sa.sizeVec3++]=Wt}var ca=this._pool;if(null!=Ht){if(Ht.zero(),ca.sizeVec3==ca.stackVec3.length){for(var pa=ca.sizeVec3<<1,va=new Array(pa),ma=0,ba=ca.sizeVec3;ma<ba;){var fa=ma++;va[fa]=ca.stackVec3[fa],ca.stackVec3[fa]=null}ca.stackVec3=va}ca.stackVec3[ca.sizeVec3++]=Ht}var xa=this._pool;if(null!=Jt){if(Jt.zero(),xa.sizeVec3==xa.stackVec3.length){for(var ua=xa.sizeVec3<<1,ya=new Array(ua),ga=0,Xa=xa.sizeVec3;ga<Xa;){var za=ga++;ya[za]=xa.stackVec3[za],xa.stackVec3[za]=null}xa.stackVec3=ya}xa.stackVec3[xa.sizeVec3++]=Jt}var Ma=this._pool;if(null!=$t){if($t.zero(),Ma.sizeVec3==Ma.stackVec3.length){for(var Ya=Ma.sizeVec3<<1,Za=new Array(Ya),da=0,Ia=Ma.sizeVec3;da<Ia;){var Va=da++;Za[Va]=Ma.stackVec3[Va],Ma.stackVec3[Va]=null}Ma.stackVec3=Za}Ma.stackVec3[Ma.sizeVec3++]=$t}var La=this._pool;if(null!=ti){if(ti.zero(),La.sizeVec3==La.stackVec3.length){for(var wa=La.sizeVec3<<1,Aa=new Array(wa),ka=0,Ba=La.sizeVec3;ka<Ba;){var Pa=ka++;Aa[Pa]=La.stackVec3[Pa],La.stackVec3[Pa]=null}La.stackVec3=Aa}La.stackVec3[La.sizeVec3++]=ti}var Ta=this._pool;if(null!=ai){if(ai.zero(),Ta.sizeVec3==Ta.stackVec3.length){for(var Sa=Ta.sizeVec3<<1,Ca=new Array(Sa),qa=0,Ra=Ta.sizeVec3;qa<Ra;){var Ea=qa++;Ca[Ea]=Ta.stackVec3[Ea],Ta.stackVec3[Ea]=null}Ta.stackVec3=Ca}Ta.stackVec3[Ta.sizeVec3++]=ai}var ja=this._pool;if(null!=ni){if(ni.zero(),ja.sizeVec3==ja.stackVec3.length){for(var Na=ja.sizeVec3<<1,Da=new Array(Na),Fa=0,Oa=ja.sizeVec3;Fa<Oa;){var Wa=Fa++;Da[Wa]=ja.stackVec3[Wa],ja.stackVec3[Wa]=null}ja.stackVec3=Da}ja.stackVec3[ja.sizeVec3++]=ni}var Ga=this._pool;if(null!=ri){if(ri.zero(),Ga.sizeVec3==Ga.stackVec3.length){for(var Ha=Ga.sizeVec3<<1,Ua=new Array(Ha),Ja=0,Qa=Ga.sizeVec3;Ja<Qa;){var $a=Ja++;Ua[$a]=Ga.stackVec3[$a],Ga.stackVec3[$a]=null}Ga.stackVec3=Ua}Ga.stackVec3[Ga.sizeVec3++]=ri}Ct=qt}},_drawRotationalLimit:function(t,i,a,o,n,s,r,e,_){if(r!=e){var h=this._pool,l=0==h.sizeVec3?new F:h.stackVec3[--h.sizeVec3];l.x=i.x,l.y=i.y,l.z=i.z;var c=l,p=c.x+n.x*s,v=c.y+n.y*s,m=c.z+n.z*s;c.x=p,c.y=v,c.z=m;var b=c;t.line(i,b,_);var f=this._pool;if(null!=b){if(b.zero(),f.sizeVec3==f.stackVec3.length){for(var x=f.sizeVec3<<1,u=new Array(x),y=0,g=f.sizeVec3;y<g;){var X=y++;u[X]=f.stackVec3[X],f.stackVec3[X]=null}f.stackVec3=u}f.stackVec3[f.sizeVec3++]=b}}r>e?t.ellipse(i,a,o,s,s,_):t.arc(i,a,o,s,s,r,e,!0,_)},_drawTranslationalLimit:function(t,i,a,o,n,s){if(o<n){var r=this._pool,e=0==r.sizeVec3?new F:r.stackVec3[--r.sizeVec3];e.x=i.x,e.y=i.y,e.z=i.z;var _=e,h=_.x+a.x*o,l=_.y+a.y*o,c=_.z+a.z*o;_.x=h,_.y=l,_.z=c;var p=_,v=this._pool,m=0==v.sizeVec3?new F:v.stackVec3[--v.sizeVec3];m.x=i.x,m.y=i.y,m.z=i.z;var b=m,f=b.x+a.x*n,x=b.y+a.y*n,u=b.z+a.z*n;b.x=f,b.y=x,b.z=u;var y=b;t.line(p,y,s);var g=this._pool;if(null!=p){if(p.zero(),g.sizeVec3==g.stackVec3.length){for(var X=g.sizeVec3<<1,z=new Array(X),M=0,Y=g.sizeVec3;M<Y;){var Z=M++;z[Z]=g.stackVec3[Z],g.stackVec3[Z]=null}g.stackVec3=z}g.stackVec3[g.sizeVec3++]=p}var d=this._pool;if(null!=y){if(y.zero(),d.sizeVec3==d.stackVec3.length){for(var I=d.sizeVec3<<1,V=new Array(I),L=0,w=d.sizeVec3;L<w;){var A=L++;V[A]=d.stackVec3[A],d.stackVec3[A]=null}d.stackVec3=V}d.stackVec3[d.sizeVec3++]=y}}},_drawEllipseOnSphere:function(t,i,a,o,n,s,r,e,_){for(var h=0,l=this._pool,c=0==l.sizeVec3?new F:l.stackVec3[--l.sizeVec3],p=this._pool,v=0==p.sizeQuat?new tt:p.stackQuat[--p.sizeQuat],m=this._pool,b=0==m.sizeMat3?new J:m.stackMat3[--m.sizeMat3],f=this._pool,x=0==f.sizeVec3?new F:f.stackVec3[--f.sizeVec3],u=0;u<17;){var y=u++,g=Math.cos(h)*s,X=Math.sin(h)*r,z=Math.sqrt(g*g+X*X),M=Math.sin(.5*z),Y=Math.cos(.5*z),Z=c.zero(),d=Z.x+o.x*g,I=Z.y+o.y*g,V=Z.z+o.z*g;Z.x=d,Z.y=I,Z.z=V;var L=Z,w=L.x+n.x*X,A=L.y+n.y*X,k=L.z+n.z*X;L.x=w,L.y=A,L.z=k;var B=1/z*M,P=c.x*B,T=c.y*B,S=c.z*B;c.x=P,c.y=T,c.z=S,v.x=c.x,v.y=c.y,v.z=c.z,v.w=Y;var C=v.x,q=v.y,R=v.z,E=v.w,j=2*C,N=2*q,D=2*R,O=C*j,W=q*N,G=R*D,H=C*N,U=q*D,Q=C*D,$=E*j,K=E*N,it=E*D;b.e00=1-W-G,b.e01=H-it,b.e02=Q+K,b.e10=H+it,b.e11=1-O-G,b.e12=U-$,b.e20=Q-K,b.e21=U+$,b.e22=1-O-W;var at=this._pool,ot=0==at.sizeVec3?new F:at.stackVec3[--at.sizeVec3],nt=ot.x+a.x*e,st=ot.y+a.y*e,rt=ot.z+a.z*e;ot.x=nt,ot.y=st,ot.z=rt;var et=ot,_t=et.x*b.e00+et.y*b.e01+et.z*b.e02,ht=et.x*b.e10+et.y*b.e11+et.z*b.e12,lt=et.x*b.e20+et.y*b.e21+et.z*b.e22;et.x=_t,et.y=ht,et.z=lt;var ct=et,pt=ct.x+i.x,vt=ct.y+i.y,mt=ct.z+i.z;ct.x=pt,ct.y=vt,ct.z=mt,y>=1&&t.line(x,et,_);var bt=this._pool;if(null!=x){if(x.zero(),bt.sizeVec3==bt.stackVec3.length){for(var ft=bt.sizeVec3<<1,xt=new Array(ft),ut=0,yt=bt.sizeVec3;ut<yt;){var gt=ut++;xt[gt]=bt.stackVec3[gt],bt.stackVec3[gt]=null}bt.stackVec3=xt}bt.stackVec3[bt.sizeVec3++]=x}x=et,h+=.39269908169872375}var Xt=this._pool;if(null!=c){if(c.zero(),Xt.sizeVec3==Xt.stackVec3.length){for(var zt=Xt.sizeVec3<<1,Mt=new Array(zt),Yt=0,Zt=Xt.sizeVec3;Yt<Zt;){var dt=Yt++;Mt[dt]=Xt.stackVec3[dt],Xt.stackVec3[dt]=null}Xt.stackVec3=Mt}Xt.stackVec3[Xt.sizeVec3++]=c}var It=this._pool;if(null!=v){if(v.x=0,v.y=0,v.z=0,v.w=1,It.sizeQuat==It.stackQuat.length){for(var Vt=It.sizeQuat<<1,Lt=new Array(Vt),wt=0,At=It.sizeQuat;wt<At;){var kt=wt++;Lt[kt]=It.stackQuat[kt],It.stackQuat[kt]=null}It.stackQuat=Lt}It.stackQuat[It.sizeQuat++]=v}var Bt=this._pool;if(null!=b){if(b.e00=1,b.e01=0,b.e02=0,b.e10=0,b.e11=1,b.e12=0,b.e20=0,b.e21=0,b.e22=1,Bt.sizeMat3==Bt.stackMat3.length){for(var Pt=Bt.sizeMat3<<1,Tt=new Array(Pt),St=0,Ct=Bt.sizeMat3;St<Ct;){var qt=St++;Tt[qt]=Bt.stackMat3[qt],Bt.stackMat3[qt]=null}Bt.stackMat3=Tt}Bt.stackMat3[Bt.sizeMat3++]=b}var Rt=this._pool;if(null!=x){if(x.zero(),Rt.sizeVec3==Rt.stackVec3.length){for(var Et=Rt.sizeVec3<<1,jt=new Array(Et),Nt=0,Dt=Rt.sizeVec3;Nt<Dt;){var Ft=Nt++;jt[Ft]=Rt.stackVec3[Ft],Rt.stackVec3[Ft]=null}Rt.stackVec3=jt}Rt.stackVec3[Rt.sizeVec3++]=x}},step:function(t){this._timeStep.dt>0&&(this._timeStep.dtRatio=t/this._timeStep.dt),this._timeStep.dt=t,this._timeStep.invDt=1/t;var i=(new Date).getTime()/1e3;this._updateContacts(),this._solveIslands();var a=(new Date).getTime()/1e3;ft.totalTime=1e3*(a-i)},addRigidBody:function(t){if(null!=t._world)throw new Error("A rigid body cannot belong to multiple worlds.");null==this._rigidBodyList?(this._rigidBodyList=t,this._rigidBodyListLast=t):(this._rigidBodyListLast._next=t,t._prev=this._rigidBodyListLast,this._rigidBodyListLast=t),t._world=this;for(var i=t._shapeList;null!=i;){var a=i._next;i._proxy=this._broadPhase.createProxy(i,i._aabb),i._id=this._shapeIdCount++,this._numShapes++,i=a}this._numRigidBodies++},removeRigidBody:function(t){if(t._world!=this)throw new Error("The rigid body doesn't belong to the world.");var i=t._prev,a=t._next;null!=i&&(i._next=a),null!=a&&(a._prev=i),t==this._rigidBodyList&&(this._rigidBodyList=this._rigidBodyList._next),t==this._rigidBodyListLast&&(this._rigidBodyListLast=this._rigidBodyListLast._prev),t._next=null,t._prev=null,t._world=null;for(var o=t._shapeList;null!=o;){var n=o._next;this._broadPhase.destroyProxy(o._proxy),o._proxy=null,o._id=-1;for(var s=o._rigidBody._contactLinkList;null!=s;){var r=s._next,e=s._contact;if(e._s1==o||e._s2==o){var _=s._other;_._sleeping=!1,_._sleepTime=0;var h=this._contactManager,l=e._prev,c=e._next;if(null!=l&&(l._next=c),null!=c&&(c._prev=l),e==h._contactList&&(h._contactList=h._contactList._next),e==h._contactListLast&&(h._contactListLast=h._contactListLast._prev),e._next=null,e._prev=null,e._touching){var p=e._s1._contactCallback,v=e._s2._contactCallback;p==v&&(v=null),null!=p&&p.endContact(e),null!=v&&v.endContact(e)}var m=e._link1._prev,b=e._link1._next;null!=m&&(m._next=b),null!=b&&(b._prev=m),e._link1==e._b1._contactLinkList&&(e._b1._contactLinkList=e._b1._contactLinkList._next),e._link1==e._b1._contactLinkListLast&&(e._b1._contactLinkListLast=e._b1._contactLinkListLast._prev),e._link1._next=null,e._link1._prev=null;var f=e._link2._prev,x=e._link2._next;null!=f&&(f._next=x),null!=x&&(x._prev=f),e._link2==e._b2._contactLinkList&&(e._b2._contactLinkList=e._b2._contactLinkList._next),e._link2==e._b2._contactLinkListLast&&(e._b2._contactLinkListLast=e._b2._contactLinkListLast._prev),e._link2._next=null,e._link2._prev=null,e._b1._numContactLinks--,e._b2._numContactLinks--,e._link1._other=null,e._link2._other=null,e._link1._contact=null,e._link2._contact=null,e._s1=null,e._s2=null,e._b1=null,e._b2=null,e._touching=!1,e._cachedDetectorData._clear(),e._manifold._clear(),e._detector=null;var u=e._contactConstraint;u._s1=null,u._s2=null,u._b1=null,u._b2=null,u._tf1=null,u._tf2=null,e._next=h._contactPool,h._contactPool=e,h._numContacts--}s=r}this._numShapes--,o=n}this._numRigidBodies--},addJoint:function(t){if(null!=t._world)throw new Error("A joint cannot belong to multiple worlds.");null==this._jointList?(this._jointList=t,this._jointListLast=t):(this._jointListLast._next=t,t._prev=this._jointListLast,this._jointListLast=t),t._world=this,t._link1._other=t._b2,t._link2._other=t._b1,null==t._b1._jointLinkList?(t._b1._jointLinkList=t._link1,t._b1._jointLinkListLast=t._link1):(t._b1._jointLinkListLast._next=t._link1,t._link1._prev=t._b1._jointLinkListLast,t._b1._jointLinkListLast=t._link1),null==t._b2._jointLinkList?(t._b2._jointLinkList=t._link2,t._b2._jointLinkListLast=t._link2):(t._b2._jointLinkListLast._next=t._link2,t._link2._prev=t._b2._jointLinkListLast,t._b2._jointLinkListLast=t._link2),t._b1._numJointLinks++,t._b2._numJointLinks++;var i=t._b1;i._sleeping=!1,i._sleepTime=0;var a=t._b2;a._sleeping=!1,a._sleepTime=0,t._syncAnchors(),this._numJoints++},removeJoint:function(t){if(t._world!=this)throw new Error("The joint doesn't belong to the world.");var i=t._prev,a=t._next;null!=i&&(i._next=a),null!=a&&(a._prev=i),t==this._jointList&&(this._jointList=this._jointList._next),t==this._jointListLast&&(this._jointListLast=this._jointListLast._prev),t._next=null,t._prev=null,t._world=null;var o=t._link1._prev,n=t._link1._next;null!=o&&(o._next=n),null!=n&&(n._prev=o),t._link1==t._b1._jointLinkList&&(t._b1._jointLinkList=t._b1._jointLinkList._next),t._link1==t._b1._jointLinkListLast&&(t._b1._jointLinkListLast=t._b1._jointLinkListLast._prev),t._link1._next=null,t._link1._prev=null;var s=t._link2._prev,r=t._link2._next;null!=s&&(s._next=r),null!=r&&(r._prev=s),t._link2==t._b2._jointLinkList&&(t._b2._jointLinkList=t._b2._jointLinkList._next),t._link2==t._b2._jointLinkListLast&&(t._b2._jointLinkListLast=t._b2._jointLinkListLast._prev),t._link2._next=null,t._link2._prev=null,t._link1._other=null,t._link2._other=null,t._b1._numJointLinks--,t._b2._numJointLinks--;var e=t._b1;e._sleeping=!1,e._sleepTime=0;var _=t._b2;_._sleeping=!1,_._sleepTime=0,this._numJoints--},setDebugDraw:function(t){this._debugDraw=t},getDebugDraw:function(){return this._debugDraw},debugDraw:function(){if(null!=this._debugDraw){if(2==this._broadPhase._type){var t=this._broadPhase;this._drawBvh(this._debugDraw,t._tree)}this._drawRigidBodies(this._debugDraw),this._drawConstraints(this._debugDraw)}},rayCast:function(t,i,a){var o=this._rayCastWrapper.begin;o.x=t.x,o.y=t.y,o.z=t.z;var n=this._rayCastWrapper.end;n.x=i.x,n.y=i.y,n.z=i.z,this._rayCastWrapper.callback=a,this._broadPhase.rayCast(t,i,this._rayCastWrapper)},convexCast:function(t,i,a,o){this._convexCastWrapper.convex=t;var n=this._convexCastWrapper.begin;n._positionX=i._positionX,n._positionY=i._positionY,n._positionZ=i._positionZ,n._rotation00=i._rotation00,n._rotation01=i._rotation01,n._rotation02=i._rotation02,n._rotation10=i._rotation10,n._rotation11=i._rotation11,n._rotation12=i._rotation12,n._rotation20=i._rotation20,n._rotation21=i._rotation21,n._rotation22=i._rotation22;var s=this._convexCastWrapper.translation;s.x=a.x,s.y=a.y,s.z=a.z,this._convexCastWrapper.callback=o,this._broadPhase.convexCast(t,i,a,this._convexCastWrapper)},aabbTest:function(t,i){this._aabbTestWrapper._aabb.copyFrom(t),this._aabbTestWrapper._callback=i,this._broadPhase.aabbTest(t,this._aabbTestWrapper)},getRigidBodyList:function(){return this._rigidBodyList},getJointList:function(){return this._jointList},getBroadPhase:function(){return this._broadPhase},getContactManager:function(){return this._contactManager},getNumRigidBodies:function(){return this._numRigidBodies},getNumJoints:function(){return this._numJoints},getNumShapes:function(){return this._numShapes},getNumIslands:function(){return this._numIslands},getNumVelocityIterations:function(){return this._numVelocityIterations},setNumVelocityIterations:function(t){this._numVelocityIterations=t},getNumPositionIterations:function(){return this._numPositionIterations},setNumPositionIterations:function(t){this._numPositionIterations=t},getGravity:function(){return this._gravity},setGravity:function(t){var i=this._gravity;i.x=t.x,i.y=t.y,i.z=t.z}};var et=function(){r.call(this),this.rayCastHit=new Y,this.begin=new F,this.end=new F,this.callback=null};et.__super__=r,et.prototype=$extend(r.prototype,{process:function(t){var i=t.userData;i._geom.rayCast(this.begin,this.end,i._transform,this.rayCastHit)&&this.callback.process(i,this.rayCastHit)}});var _t=function(){r.call(this),this.rayCastHit=new Y,this.begin=new O,this.translation=new F,this.zero=new F,this.callback=null,this.convex=null};_t.__super__=r,_t.prototype=$extend(r.prototype,{process:function(t){var i=t.userData,a=i._geom._type;if(!(a<0||a>5)){var o=i._geom;G.instance.convexCast(this.convex,o,this.begin,i._transform,this.translation,this.zero,this.rayCastHit)&&this.callback.process(i,this.rayCastHit)}}});var ht=function(){r.call(this),this._aabb=new x,this._callback=null};ht.__super__=r,ht.prototype=$extend(r.prototype,{process:function(t){var i=t.userData,a=i._aabb;a._minX<this._aabb._maxX&&a._maxX>this._aabb._minX&&a._minY<this._aabb._maxY&&a._maxY>this._aabb._minY&&a._minZ<this._aabb._maxZ&&a._maxZ>this._aabb._minZ&&this._callback.process(i)}});var lt=function(){};lt.prototype={process:function(t){}};var ct=function(){};ct.prototype={beginContact:function(t){},preSolve:function(t){},postSolve:function(t){},endContact:function(t){}};var pt=function(){};pt.prototype={process:function(t,i){}};var vt=function(){pt.call(this),this.position=new F,this.normal=new F,this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1};vt.__super__=pt,vt.prototype=$extend(pt.prototype,{clear:function(){this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1},process:function(t,i){if(i.fraction<this.fraction){this.shape=t,this.hit=!0,this.fraction=i.fraction;var a=this.position,o=i.position;a.x=o.x,a.y=o.y,a.z=o.z;var n=this.normal,s=i.normal;n.x=s.x,n.y=s.y,n.z=s.z}}});var mt=function(){this.p=new K,this.wireframe=!1,this.drawShapes=!0,this.drawBvh=!1,this.drawBvhMinLevel=0,this.drawBvhMaxLevel=65536,this.drawAabbs=!1,this.drawBases=!1,this.drawPairs=!1,this.drawContacts=!1,this.drawJoints=!0,this.drawJointLimits=!1;var t=new Array(5);this.sphereCoords=t;var i=new Array(5);this.tmpSphereVerts=i;var a=new Array(5);this.tmpSphereNorms=a;for(var o=0;o<5;){var n=o++,s=0==n||4==n?1:8,r=this.sphereCoords,e=new Array(s);r[n]=e;var _=this.tmpSphereVerts,h=new Array(s);_[n]=h;var l=this.tmpSphereNorms,c=new Array(s);l[n]=c;for(var p=0;p<8;){var v=p++,m=.7853981633974475*n,b=.7853981633974475*v;this.sphereCoords[n][v]=new F(Math.sin(m)*Math.cos(b),Math.cos(m),-Math.sin(m)*Math.sin(b)),this.tmpSphereVerts[n][v]=new F,this.tmpSphereNorms[n][v]=new F}}var f=new Array(8);this.circleCoords=f;var x=new Array(8);this.circleCoordsShift=x;var u=new Array(8);this.tmpCircleVerts1=u;var y=new Array(8);this.tmpCircleVerts2=y;var g=new Array(8);this.tmpCircleNorms=g;for(var X=.7853981633974475,z=0;z<8;){var M=z++;this.circleCoords[M]=new F(Math.cos(M*X),0,-Math.sin(M*X)),this.circleCoordsShift[M]=new F(Math.cos((M+.5)*X),0,-Math.sin((M+.5)*X)),this.tmpCircleVerts1[M]=new F,this.tmpCircleVerts2[M]=new F,this.tmpCircleNorms[M]=new F}this.style=new bt};mt.prototype={aabb:function(t,i,a){var o=this.p,n=(0==o.sizeVec3?new F:o.stackVec3[--o.sizeVec3]).init(t.x,t.y,t.z),s=this.p,r=(0==s.sizeVec3?new F:s.stackVec3[--s.sizeVec3]).init(t.x,t.y,i.z),e=this.p,_=(0==e.sizeVec3?new F:e.stackVec3[--e.sizeVec3]).init(t.x,i.y,t.z),h=this.p,l=(0==h.sizeVec3?new F:h.stackVec3[--h.sizeVec3]).init(t.x,i.y,i.z),c=this.p,p=(0==c.sizeVec3?new F:c.stackVec3[--c.sizeVec3]).init(i.x,t.y,t.z),v=this.p,m=(0==v.sizeVec3?new F:v.stackVec3[--v.sizeVec3]).init(i.x,t.y,i.z),b=this.p,f=(0==b.sizeVec3?new F:b.stackVec3[--b.sizeVec3]).init(i.x,i.y,t.z),x=this.p,u=(0==x.sizeVec3?new F:x.stackVec3[--x.sizeVec3]).init(i.x,i.y,i.z);this.line(n,r,a),this.line(_,l,a),this.line(p,m,a),this.line(f,u,a),this.line(n,_,a),this.line(r,l,a),this.line(p,f,a),this.line(m,u,a),this.line(n,p,a),this.line(r,m,a),this.line(_,f,a),this.line(l,u,a);var y=this.p;if(null!=n){if(n.zero(),y.sizeVec3==y.stackVec3.length){for(var g=y.sizeVec3<<1,X=new Array(g),z=0,M=y.sizeVec3;z<M;){var Y=z++;X[Y]=y.stackVec3[Y],y.stackVec3[Y]=null}y.stackVec3=X}y.stackVec3[y.sizeVec3++]=n}var Z=this.p;if(null!=r){if(r.zero(),Z.sizeVec3==Z.stackVec3.length){for(var d=Z.sizeVec3<<1,I=new Array(d),V=0,L=Z.sizeVec3;V<L;){var w=V++;I[w]=Z.stackVec3[w],Z.stackVec3[w]=null}Z.stackVec3=I}Z.stackVec3[Z.sizeVec3++]=r}var A=this.p;if(null!=_){if(_.zero(),A.sizeVec3==A.stackVec3.length){for(var k=A.sizeVec3<<1,B=new Array(k),P=0,T=A.sizeVec3;P<T;){var S=P++;B[S]=A.stackVec3[S],A.stackVec3[S]=null}A.stackVec3=B}A.stackVec3[A.sizeVec3++]=_}var C=this.p;if(null!=l){if(l.zero(),C.sizeVec3==C.stackVec3.length){for(var q=C.sizeVec3<<1,R=new Array(q),E=0,j=C.sizeVec3;E<j;){var N=E++;R[N]=C.stackVec3[N],C.stackVec3[N]=null}C.stackVec3=R}C.stackVec3[C.sizeVec3++]=l}var D=this.p;if(null!=p){if(p.zero(),D.sizeVec3==D.stackVec3.length){for(var O=D.sizeVec3<<1,W=new Array(O),G=0,H=D.sizeVec3;G<H;){var U=G++;W[U]=D.stackVec3[U],D.stackVec3[U]=null}D.stackVec3=W}D.stackVec3[D.sizeVec3++]=p}var J=this.p;if(null!=m){if(m.zero(),J.sizeVec3==J.stackVec3.length){for(var Q=J.sizeVec3<<1,$=new Array(Q),K=0,tt=J.sizeVec3;K<tt;){var it=K++;$[it]=J.stackVec3[it],J.stackVec3[it]=null}J.stackVec3=$}J.stackVec3[J.sizeVec3++]=m}var at=this.p;if(null!=f){if(f.zero(),at.sizeVec3==at.stackVec3.length){for(var ot=at.sizeVec3<<1,nt=new Array(ot),st=0,rt=at.sizeVec3;st<rt;){var et=st++;nt[et]=at.stackVec3[et],at.stackVec3[et]=null}at.stackVec3=nt}at.stackVec3[at.sizeVec3++]=f}var _t=this.p;if(null!=u){if(u.zero(),_t.sizeVec3==_t.stackVec3.length){for(var ht=_t.sizeVec3<<1,lt=new Array(ht),ct=0,pt=_t.sizeVec3;ct<pt;){var vt=ct++;lt[vt]=_t.stackVec3[vt],_t.stackVec3[vt]=null}_t.stackVec3=lt}_t.stackVec3[_t.sizeVec3++]=u}},basis:function(t,i,a,o,n){var s=this.p,r=0==s.sizeVec3?new F:s.stackVec3[--s.sizeVec3],e=this.p,_=0==e.sizeMat3?new J:e.stackMat3[--e.sizeMat3],h=this.p,l=0==h.sizeVec3?new F:h.stackVec3[--h.sizeVec3],c=this.p,p=0==c.sizeVec3?new F:c.stackVec3[--c.sizeVec3],v=this.p,m=0==v.sizeVec3?new F:v.stackVec3[--v.sizeVec3],b=r;b.x=t._positionX,b.y=t._positionY,b.z=t._positionZ;var f=_;f.e00=t._rotation00,f.e01=t._rotation01,f.e02=t._rotation02,f.e10=t._rotation10,f.e11=t._rotation11,f.e12=t._rotation12,f.e20=t._rotation20,f.e21=t._rotation21,f.e22=t._rotation22,l.init(_.e00,_.e10,_.e20),p.init(_.e01,_.e11,_.e21),m.init(_.e02,_.e12,_.e22);var x=l.x*i,u=l.y*i,y=l.z*i;l.x=x,l.y=u,l.z=y;var g=l,X=g.x+r.x,z=g.y+r.y,M=g.z+r.z;g.x=X,g.y=z,g.z=M;var Y=p.x*i,Z=p.y*i,d=p.z*i;p.x=Y,p.y=Z,p.z=d;var I=p,V=I.x+r.x,L=I.y+r.y,w=I.z+r.z;I.x=V,I.y=L,I.z=w;var A=m.x*i,k=m.y*i,B=m.z*i;m.x=A,m.y=k,m.z=B;var P=m,T=P.x+r.x,S=P.y+r.y,C=P.z+r.z;P.x=T,P.y=S,P.z=C,this.line(r,l,a),this.line(r,p,o),this.line(r,m,n);var q=this.p;if(null!=r){if(r.zero(),q.sizeVec3==q.stackVec3.length){for(var R=q.sizeVec3<<1,E=new Array(R),j=0,N=q.sizeVec3;j<N;){var D=j++;E[D]=q.stackVec3[D],q.stackVec3[D]=null}q.stackVec3=E}q.stackVec3[q.sizeVec3++]=r}var O=this.p;if(null!=_){if(_.e00=1,_.e01=0,_.e02=0,_.e10=0,_.e11=1,_.e12=0,_.e20=0,_.e21=0,_.e22=1,O.sizeMat3==O.stackMat3.length){for(var W=O.sizeMat3<<1,G=new Array(W),H=0,U=O.sizeMat3;H<U;){var Q=H++;G[Q]=O.stackMat3[Q],O.stackMat3[Q]=null}O.stackMat3=G}O.stackMat3[O.sizeMat3++]=_}var $=this.p;if(null!=l){if(l.zero(),$.sizeVec3==$.stackVec3.length){for(var K=$.sizeVec3<<1,tt=new Array(K),it=0,at=$.sizeVec3;it<at;){var ot=it++;tt[ot]=$.stackVec3[ot],$.stackVec3[ot]=null}$.stackVec3=tt}$.stackVec3[$.sizeVec3++]=l}var nt=this.p;if(null!=p){if(p.zero(),nt.sizeVec3==nt.stackVec3.length){for(var st=nt.sizeVec3<<1,rt=new Array(st),et=0,_t=nt.sizeVec3;et<_t;){var ht=et++;rt[ht]=nt.stackVec3[ht],nt.stackVec3[ht]=null}nt.stackVec3=rt}nt.stackVec3[nt.sizeVec3++]=p}var lt=this.p;if(null!=m){if(m.zero(),lt.sizeVec3==lt.stackVec3.length){for(var ct=lt.sizeVec3<<1,pt=new Array(ct),vt=0,mt=lt.sizeVec3;vt<mt;){var bt=vt++;pt[bt]=lt.stackVec3[bt],lt.stackVec3[bt]=null}lt.stackVec3=pt}lt.stackVec3[lt.sizeVec3++]=m}},ellipse:function(t,i,a,o,n,s){this.arc(t,i,a,o,n,0,6.28318530717958,!1,s)},arc:function(t,i,a,o,n,s,r,e,_){var h=this.p,l=0==h.sizeVec3?new F:h.stackVec3[--h.sizeVec3];l.x=i.x,l.y=i.y,l.z=i.z;var c=l,p=c.x*o,v=c.y*o,m=c.z*o;c.x=p,c.y=v,c.z=m,i=c;var b=this.p,f=0==b.sizeVec3?new F:b.stackVec3[--b.sizeVec3];f.x=a.x,f.y=a.y,f.z=a.z;var x=f,u=x.x*n,y=x.y*n,g=x.z*n;x.x=u,x.y=y,x.z=g,a=x;var X=r-s;X<0&&(X=-X);var z=X/.5235987755982984+.5|0;0==z&&(z=1);var M=s,Y=(r-s)/z,Z=this.p,d=0==Z.sizeVec3?new F:Z.stackVec3[--Z.sizeVec3];d.x=t.x,d.y=t.y,d.z=t.z;var I=d,V=Math.cos(M),L=I.x+i.x*V,w=I.y+i.y*V,A=I.z+i.z*V;I.x=L,I.y=w,I.z=A;var k=I,B=Math.sin(M),P=k.x+a.x*B,T=k.y+a.y*B,S=k.z+a.z*B;k.x=P,k.y=T,k.z=S;var C=k;e&&this.line(t,C,_);for(var q=0,R=z;q<R;){q++;M+=Y;var E=this.p,j=0==E.sizeVec3?new F:E.stackVec3[--E.sizeVec3];j.x=t.x,j.y=t.y,j.z=t.z;var N=j,D=Math.cos(M),O=N.x+i.x*D,W=N.y+i.y*D,G=N.z+i.z*D;N.x=O,N.y=W,N.z=G;var H=N,U=Math.sin(M),J=H.x+a.x*U,Q=H.y+a.y*U,$=H.z+a.z*U;H.x=J,H.y=Q,H.z=$;var K=H;this.line(C,K,_);var tt=this.p;if(null!=C){if(C.zero(),tt.sizeVec3==tt.stackVec3.length){for(var it=tt.sizeVec3<<1,at=new Array(it),ot=0,nt=tt.sizeVec3;ot<nt;){var st=ot++;at[st]=tt.stackVec3[st],tt.stackVec3[st]=null}tt.stackVec3=at}tt.stackVec3[tt.sizeVec3++]=C}C=K}e&&this.line(t,C,_);var rt=this.p;if(null!=C){if(C.zero(),rt.sizeVec3==rt.stackVec3.length){for(var et=rt.sizeVec3<<1,_t=new Array(et),ht=0,lt=rt.sizeVec3;ht<lt;){var ct=ht++;_t[ct]=rt.stackVec3[ct],rt.stackVec3[ct]=null}rt.stackVec3=_t}rt.stackVec3[rt.sizeVec3++]=C}var pt=this.p;if(null!=i){if(i.zero(),pt.sizeVec3==pt.stackVec3.length){for(var vt=pt.sizeVec3<<1,mt=new Array(vt),bt=0,ft=pt.sizeVec3;bt<ft;){var xt=bt++;mt[xt]=pt.stackVec3[xt],pt.stackVec3[xt]=null}pt.stackVec3=mt}pt.stackVec3[pt.sizeVec3++]=i}var ut=this.p;if(null!=a){if(a.zero(),ut.sizeVec3==ut.stackVec3.length){for(var yt=ut.sizeVec3<<1,gt=new Array(yt),Xt=0,zt=ut.sizeVec3;Xt<zt;){var Mt=Xt++;gt[Mt]=ut.stackVec3[Mt],ut.stackVec3[Mt]=null}ut.stackVec3=gt}ut.stackVec3[ut.sizeVec3++]=a}},cone:function(t,i,a,o){var n=this.p,s=0==n.sizeVec3?new F:n.stackVec3[--n.sizeVec3],r=this.p,e=0==r.sizeVec3?new F:r.stackVec3[--r.sizeVec3],_=this.p,h=0==_.sizeVec3?new F:_.stackVec3[--_.sizeVec3],l=this.p,c=0==l.sizeVec3?new F:l.stackVec3[--l.sizeVec3],p=this.p,v=0==p.sizeMat3?new J:p.stackMat3[--p.sizeMat3],m=c;m.x=t._positionX,m.y=t._positionY,m.z=t._positionZ;var b=v;b.e00=t._rotation00,b.e01=t._rotation01,b.e02=t._rotation02,b.e10=t._rotation10,b.e11=t._rotation11,b.e12=t._rotation12,b.e20=t._rotation20,b.e21=t._rotation21,b.e22=t._rotation22,s.init(v.e00,v.e10,v.e20),e.init(v.e01,v.e11,v.e21),h.init(v.e02,v.e12,v.e22);var f=this.p,x=0==f.sizeVec3?new F:f.stackVec3[--f.sizeVec3];x.x=c.x,x.y=c.y,x.z=c.z;var u=x,y=u.x+e.x*a,g=u.y+e.y*a,X=u.z+e.z*a;u.x=y,u.y=g,u.z=X;var z=u,M=this.p,Y=0==M.sizeVec3?new F:M.stackVec3[--M.sizeVec3];Y.x=c.x,Y.y=c.y,Y.z=c.z;var Z=Y,d=-a,I=Z.x+e.x*d,V=Z.y+e.y*d,L=Z.z+e.z*d;Z.x=I,Z.y=V,Z.z=L;var w=Z;if(this.wireframe){var A=this.p,k=0==A.sizeVec3?new F:A.stackVec3[--A.sizeVec3];k.x=w.x,k.y=w.y,k.z=w.z;var B=k,P=-i,T=B.x+s.x*P,S=B.y+s.y*P,C=B.z+s.z*P;B.x=T,B.y=S,B.z=C;var q=B,R=q.x+0*h.x,E=q.y+0*h.y,j=q.z+0*h.z;q.x=R,q.y=E,q.z=j;var N=q,D=this.p,O=0==D.sizeVec3?new F:D.stackVec3[--D.sizeVec3];O.x=w.x,O.y=w.y,O.z=w.z;var W=O,G=W.x+s.x*i,H=W.y+s.y*i,U=W.z+s.z*i;W.x=G,W.y=H,W.z=U;var Q=W,$=Q.x+0*h.x,K=Q.y+0*h.y,tt=Q.z+0*h.z;Q.x=$,Q.y=K,Q.z=tt;var it=Q,at=this.p,ot=0==at.sizeVec3?new F:at.stackVec3[--at.sizeVec3];ot.x=w.x,ot.y=w.y,ot.z=w.z;var nt=ot,st=nt.x+0*s.x,rt=nt.y+0*s.y,et=nt.z+0*s.z;nt.x=st,nt.y=rt,nt.z=et;var _t=nt,ht=-i,lt=_t.x+h.x*ht,ct=_t.y+h.y*ht,pt=_t.z+h.z*ht;_t.x=lt,_t.y=ct,_t.z=pt;var vt=_t,mt=this.p,bt=0==mt.sizeVec3?new F:mt.stackVec3[--mt.sizeVec3];bt.x=w.x,bt.y=w.y,bt.z=w.z;var ft=bt,xt=ft.x+0*s.x,ut=ft.y+0*s.y,yt=ft.z+0*s.z;ft.x=xt,ft.y=ut,ft.z=yt;var gt=ft,Xt=gt.x+h.x*i,zt=gt.y+h.y*i,Mt=gt.z+h.z*i;gt.x=Xt,gt.y=zt,gt.z=Mt;var Yt=gt;this.ellipse(w,s,h,i,i,o),this.line(z,N,o),this.line(z,it,o),this.line(z,vt,o),this.line(z,Yt,o);var Zt=this.p;if(null!=N){if(N.zero(),Zt.sizeVec3==Zt.stackVec3.length){for(var dt=Zt.sizeVec3<<1,It=new Array(dt),Vt=0,Lt=Zt.sizeVec3;Vt<Lt;){var wt=Vt++;It[wt]=Zt.stackVec3[wt],Zt.stackVec3[wt]=null}Zt.stackVec3=It}Zt.stackVec3[Zt.sizeVec3++]=N}var At=this.p;if(null!=it){if(it.zero(),At.sizeVec3==At.stackVec3.length){for(var kt=At.sizeVec3<<1,Bt=new Array(kt),Pt=0,Tt=At.sizeVec3;Pt<Tt;){var St=Pt++;Bt[St]=At.stackVec3[St],At.stackVec3[St]=null}At.stackVec3=Bt}At.stackVec3[At.sizeVec3++]=it}var Ct=this.p;if(null!=vt){if(vt.zero(),Ct.sizeVec3==Ct.stackVec3.length){for(var qt=Ct.sizeVec3<<1,Rt=new Array(qt),Et=0,jt=Ct.sizeVec3;Et<jt;){var Nt=Et++;Rt[Nt]=Ct.stackVec3[Nt],Ct.stackVec3[Nt]=null}Ct.stackVec3=Rt}Ct.stackVec3[Ct.sizeVec3++]=vt}var Dt=this.p;if(null!=Yt){if(Yt.zero(),Dt.sizeVec3==Dt.stackVec3.length){for(var Ft=Dt.sizeVec3<<1,Ot=new Array(Ft),Wt=0,Gt=Dt.sizeVec3;Wt<Gt;){var Ht=Wt++;Ot[Ht]=Dt.stackVec3[Ht],Dt.stackVec3[Ht]=null}Dt.stackVec3=Ot}Dt.stackVec3[Dt.sizeVec3++]=Yt}}else{for(var Ut=1/Math.sqrt(i*i+4*a*a),Jt=2*a*Ut,Qt=i*Ut,$t=(Math.sqrt(2*(1+Jt)),0);$t<8;){var Kt=$t++,ti=this.tmpCircleNorms[Kt],ii=this.circleCoords[Kt];ti.x=ii.x,ti.y=ii.y,ti.z=ii.z;var ai=ti,oi=ai.x*Jt,ni=ai.y*Jt,si=ai.z*Jt;ai.x=oi,ai.y=ni,ai.z=si,ai.y+=Qt;var ri=this.tmpCircleNorms[Kt],ei=ri.x*v.e00+ri.y*v.e01+ri.z*v.e02,_i=ri.x*v.e10+ri.y*v.e11+ri.z*v.e12,hi=ri.x*v.e20+ri.y*v.e21+ri.z*v.e22;ri.x=ei,ri.y=_i,ri.z=hi;var li=this.tmpCircleVerts1[Kt],ci=this.circleCoordsShift[Kt];li.x=ci.x,li.y=ci.y,li.z=ci.z;var pi=li,vi=pi.x*Jt,mi=pi.y*Jt,bi=pi.z*Jt;pi.x=vi,pi.y=mi,pi.z=bi,pi.y+=Qt;var fi=this.tmpCircleVerts1[Kt],xi=fi.x*v.e00+fi.y*v.e01+fi.z*v.e02,ui=fi.x*v.e10+fi.y*v.e11+fi.z*v.e12,yi=fi.x*v.e20+fi.y*v.e21+fi.z*v.e22;fi.x=xi,fi.y=ui,fi.z=yi;var gi=this.tmpCircleVerts2[Kt],Xi=this.circleCoords[Kt];gi.x=Xi.x,gi.y=Xi.y,gi.z=Xi.z;var zi=gi,Mi=zi.x*v.e00+zi.y*v.e01+zi.z*v.e02,Yi=zi.x*v.e10+zi.y*v.e11+zi.z*v.e12,Zi=zi.x*v.e20+zi.y*v.e21+zi.z*v.e22;zi.x=Mi,zi.y=Yi,zi.z=Zi;var di=zi,Ii=di.x*i,Vi=di.y*i,Li=di.z*i;di.x=Ii,di.y=Vi,di.z=Li;var wi=di,Ai=wi.x+c.x,ki=wi.y+c.y,Bi=wi.z+c.z;wi.x=Ai,wi.y=ki,wi.z=Bi;var Pi=this.tmpCircleVerts2[Kt],Ti=-a,Si=Pi.x+e.x*Ti,Ci=Pi.y+e.y*Ti,qi=Pi.z+e.z*Ti;Pi.x=Si,Pi.y=Ci,Pi.z=qi}for(var Ri=0;Ri<8;){var Ei=Ri++,ji=z,Ni=this.tmpCircleVerts2[Ei],Di=this.tmpCircleVerts2[(Ei+1)%8],Fi=this.tmpCircleVerts1[Ei],Oi=this.tmpCircleNorms[Ei],Wi=this.tmpCircleNorms[(Ei+1)%8];this.triangle(ji,Ni,Di,Fi,Oi,Wi,o),ji=w,Ni=this.tmpCircleVerts2[(Ei+1)%8],Di=this.tmpCircleVerts2[Ei];var Gi=this.p,Hi=0==Gi.sizeVec3?new F:Gi.stackVec3[--Gi.sizeVec3];Hi.x=e.x,Hi.y=e.y,Hi.z=e.z;var Ui=Hi,Ji=-Ui.x,Qi=-Ui.y,$i=-Ui.z;Ui.x=Ji,Ui.y=Qi,Ui.z=$i,Fi=Ui,this.triangle(ji,Ni,Di,Fi,Fi,Fi,o);var Ki=this.p;if(null!=Fi){if(Fi.zero(),Ki.sizeVec3==Ki.stackVec3.length){for(var ta=Ki.sizeVec3<<1,ia=new Array(ta),aa=0,oa=Ki.sizeVec3;aa<oa;){var na=aa++;ia[na]=Ki.stackVec3[na],Ki.stackVec3[na]=null}Ki.stackVec3=ia}Ki.stackVec3[Ki.sizeVec3++]=Fi}}}var sa=this.p;if(null!=z){if(z.zero(),sa.sizeVec3==sa.stackVec3.length){for(var ra=sa.sizeVec3<<1,ea=new Array(ra),_a=0,ha=sa.sizeVec3;_a<ha;){var la=_a++;ea[la]=sa.stackVec3[la],sa.stackVec3[la]=null}sa.stackVec3=ea}sa.stackVec3[sa.sizeVec3++]=z}var ca=this.p;if(null!=w){if(w.zero(),ca.sizeVec3==ca.stackVec3.length){for(var pa=ca.sizeVec3<<1,va=new Array(pa),ma=0,ba=ca.sizeVec3;ma<ba;){var fa=ma++;va[fa]=ca.stackVec3[fa],ca.stackVec3[fa]=null}ca.stackVec3=va}ca.stackVec3[ca.sizeVec3++]=w}var xa=this.p;if(null!=c){if(c.zero(),xa.sizeVec3==xa.stackVec3.length){for(var ua=xa.sizeVec3<<1,ya=new Array(ua),ga=0,Xa=xa.sizeVec3;ga<Xa;){var za=ga++;ya[za]=xa.stackVec3[za],xa.stackVec3[za]=null}xa.stackVec3=ya}xa.stackVec3[xa.sizeVec3++]=c}var Ma=this.p;if(null!=v){if(v.e00=1,v.e01=0,v.e02=0,v.e10=0,v.e11=1,v.e12=0,v.e20=0,v.e21=0,v.e22=1,Ma.sizeMat3==Ma.stackMat3.length){for(var Ya=Ma.sizeMat3<<1,Za=new Array(Ya),da=0,Ia=Ma.sizeMat3;da<Ia;){var Va=da++;Za[Va]=Ma.stackMat3[Va],Ma.stackMat3[Va]=null}Ma.stackMat3=Za}Ma.stackMat3[Ma.sizeMat3++]=v}var La=this.p;if(null!=s){if(s.zero(),La.sizeVec3==La.stackVec3.length){for(var wa=La.sizeVec3<<1,Aa=new Array(wa),ka=0,Ba=La.sizeVec3;ka<Ba;){var Pa=ka++;Aa[Pa]=La.stackVec3[Pa],La.stackVec3[Pa]=null}La.stackVec3=Aa}La.stackVec3[La.sizeVec3++]=s}var Ta=this.p;if(null!=e){if(e.zero(),Ta.sizeVec3==Ta.stackVec3.length){for(var Sa=Ta.sizeVec3<<1,Ca=new Array(Sa),qa=0,Ra=Ta.sizeVec3;qa<Ra;){var Ea=qa++;Ca[Ea]=Ta.stackVec3[Ea],Ta.stackVec3[Ea]=null}Ta.stackVec3=Ca}Ta.stackVec3[Ta.sizeVec3++]=e}var ja=this.p;if(null!=h){if(h.zero(),ja.sizeVec3==ja.stackVec3.length){for(var Na=ja.sizeVec3<<1,Da=new Array(Na),Fa=0,Oa=ja.sizeVec3;Fa<Oa;){var Wa=Fa++;Da[Wa]=ja.stackVec3[Wa],ja.stackVec3[Wa]=null}ja.stackVec3=Da}ja.stackVec3[ja.sizeVec3++]=h}},cylinder:function(t,i,a,o){var n=this.p,s=0==n.sizeVec3?new F:n.stackVec3[--n.sizeVec3],r=this.p,e=0==r.sizeVec3?new F:r.stackVec3[--r.sizeVec3],_=this.p,h=0==_.sizeVec3?new F:_.stackVec3[--_.sizeVec3],l=this.p,c=0==l.sizeVec3?new F:l.stackVec3[--l.sizeVec3],p=this.p,v=0==p.sizeMat3?new J:p.stackMat3[--p.sizeMat3],m=c;m.x=t._positionX,m.y=t._positionY,m.z=t._positionZ;var b=v;b.e00=t._rotation00,b.e01=t._rotation01,b.e02=t._rotation02,b.e10=t._rotation10,b.e11=t._rotation11,b.e12=t._rotation12,b.e20=t._rotation20,b.e21=t._rotation21,b.e22=t._rotation22,s.init(v.e00,v.e10,v.e20),e.init(v.e01,v.e11,v.e21),h.init(v.e02,v.e12,v.e22);var f=this.p,x=0==f.sizeVec3?new F:f.stackVec3[--f.sizeVec3];x.x=c.x,x.y=c.y,x.z=c.z;var u=x,y=u.x+e.x*a,g=u.y+e.y*a,X=u.z+e.z*a;u.x=y,u.y=g,u.z=X;var z=u,M=this.p,Y=0==M.sizeVec3?new F:M.stackVec3[--M.sizeVec3];Y.x=c.x,Y.y=c.y,Y.z=c.z;var Z=Y,d=-a,I=Z.x+e.x*d,V=Z.y+e.y*d,L=Z.z+e.z*d;Z.x=I,Z.y=V,Z.z=L;var w=Z;if(this.wireframe){var A=this.p,k=0==A.sizeVec3?new F:A.stackVec3[--A.sizeVec3];k.x=z.x,k.y=z.y,k.z=z.z;var B=k,P=-i,T=B.x+s.x*P,S=B.y+s.y*P,C=B.z+s.z*P;B.x=T,B.y=S,B.z=C;var q=B,R=q.x+0*h.x,E=q.y+0*h.y,j=q.z+0*h.z;q.x=R,q.y=E,q.z=j;var N=q,D=this.p,O=0==D.sizeVec3?new F:D.stackVec3[--D.sizeVec3];O.x=z.x,O.y=z.y,O.z=z.z;var W=O,G=W.x+s.x*i,H=W.y+s.y*i,U=W.z+s.z*i;W.x=G,W.y=H,W.z=U;var Q=W,$=Q.x+0*h.x,K=Q.y+0*h.y,tt=Q.z+0*h.z;Q.x=$,Q.y=K,Q.z=tt;var it=Q,at=this.p,ot=0==at.sizeVec3?new F:at.stackVec3[--at.sizeVec3];ot.x=z.x,ot.y=z.y,ot.z=z.z;var nt=ot,st=nt.x+0*s.x,rt=nt.y+0*s.y,et=nt.z+0*s.z;nt.x=st,nt.y=rt,nt.z=et;var _t=nt,ht=-i,lt=_t.x+h.x*ht,ct=_t.y+h.y*ht,pt=_t.z+h.z*ht;_t.x=lt,_t.y=ct,_t.z=pt;var vt=_t,mt=this.p,bt=0==mt.sizeVec3?new F:mt.stackVec3[--mt.sizeVec3];bt.x=z.x,bt.y=z.y,bt.z=z.z;var ft=bt,xt=ft.x+0*s.x,ut=ft.y+0*s.y,yt=ft.z+0*s.z;ft.x=xt,ft.y=ut,ft.z=yt;var gt=ft,Xt=gt.x+h.x*i,zt=gt.y+h.y*i,Mt=gt.z+h.z*i;gt.x=Xt,gt.y=zt,gt.z=Mt;var Yt=gt,Zt=this.p,dt=0==Zt.sizeVec3?new F:Zt.stackVec3[--Zt.sizeVec3];dt.x=w.x,dt.y=w.y,dt.z=w.z;var It=dt,Vt=-i,Lt=It.x+s.x*Vt,wt=It.y+s.y*Vt,At=It.z+s.z*Vt;It.x=Lt,It.y=wt,It.z=At;var kt=It,Bt=kt.x+0*h.x,Pt=kt.y+0*h.y,Tt=kt.z+0*h.z;kt.x=Bt,kt.y=Pt,kt.z=Tt;var St=kt,Ct=this.p,qt=0==Ct.sizeVec3?new F:Ct.stackVec3[--Ct.sizeVec3];qt.x=w.x,qt.y=w.y,qt.z=w.z;var Rt=qt,Et=Rt.x+s.x*i,jt=Rt.y+s.y*i,Nt=Rt.z+s.z*i;Rt.x=Et,Rt.y=jt,Rt.z=Nt;var Dt=Rt,Ft=Dt.x+0*h.x,Ot=Dt.y+0*h.y,Wt=Dt.z+0*h.z;Dt.x=Ft,Dt.y=Ot,Dt.z=Wt;var Gt=Dt,Ht=this.p,Ut=0==Ht.sizeVec3?new F:Ht.stackVec3[--Ht.sizeVec3];Ut.x=w.x,Ut.y=w.y,Ut.z=w.z;var Jt=Ut,Qt=Jt.x+0*s.x,$t=Jt.y+0*s.y,Kt=Jt.z+0*s.z;Jt.x=Qt,Jt.y=$t,Jt.z=Kt;var ti=Jt,ii=-i,ai=ti.x+h.x*ii,oi=ti.y+h.y*ii,ni=ti.z+h.z*ii;ti.x=ai,ti.y=oi,ti.z=ni;var si=ti,ri=this.p,ei=0==ri.sizeVec3?new F:ri.stackVec3[--ri.sizeVec3];ei.x=w.x,ei.y=w.y,ei.z=w.z;var _i=ei,hi=_i.x+0*s.x,li=_i.y+0*s.y,ci=_i.z+0*s.z;_i.x=hi,_i.y=li,_i.z=ci;var pi=_i,vi=pi.x+h.x*i,mi=pi.y+h.y*i,bi=pi.z+h.z*i;pi.x=vi,pi.y=mi,pi.z=bi;var fi=pi;this.ellipse(z,s,h,i,i,o),this.ellipse(w,s,h,i,i,o),this.line(N,St,o),this.line(it,Gt,o),this.line(vt,si,o),this.line(Yt,fi,o);var xi=this.p;if(null!=N){if(N.zero(),xi.sizeVec3==xi.stackVec3.length){for(var ui=xi.sizeVec3<<1,yi=new Array(ui),gi=0,Xi=xi.sizeVec3;gi<Xi;){var zi=gi++;yi[zi]=xi.stackVec3[zi],xi.stackVec3[zi]=null}xi.stackVec3=yi}xi.stackVec3[xi.sizeVec3++]=N}var Mi=this.p;if(null!=it){if(it.zero(),Mi.sizeVec3==Mi.stackVec3.length){for(var Yi=Mi.sizeVec3<<1,Zi=new Array(Yi),di=0,Ii=Mi.sizeVec3;di<Ii;){var Vi=di++;Zi[Vi]=Mi.stackVec3[Vi],Mi.stackVec3[Vi]=null}Mi.stackVec3=Zi}Mi.stackVec3[Mi.sizeVec3++]=it}var Li=this.p;if(null!=vt){if(vt.zero(),Li.sizeVec3==Li.stackVec3.length){for(var wi=Li.sizeVec3<<1,Ai=new Array(wi),ki=0,Bi=Li.sizeVec3;ki<Bi;){var Pi=ki++;Ai[Pi]=Li.stackVec3[Pi],Li.stackVec3[Pi]=null}Li.stackVec3=Ai}Li.stackVec3[Li.sizeVec3++]=vt}var Ti=this.p;if(null!=Yt){if(Yt.zero(),Ti.sizeVec3==Ti.stackVec3.length){for(var Si=Ti.sizeVec3<<1,Ci=new Array(Si),qi=0,Ri=Ti.sizeVec3;qi<Ri;){var Ei=qi++;Ci[Ei]=Ti.stackVec3[Ei],Ti.stackVec3[Ei]=null}Ti.stackVec3=Ci}Ti.stackVec3[Ti.sizeVec3++]=Yt}var ji=this.p;if(null!=St){if(St.zero(),ji.sizeVec3==ji.stackVec3.length){for(var Ni=ji.sizeVec3<<1,Di=new Array(Ni),Fi=0,Oi=ji.sizeVec3;Fi<Oi;){var Wi=Fi++;Di[Wi]=ji.stackVec3[Wi],ji.stackVec3[Wi]=null}ji.stackVec3=Di}ji.stackVec3[ji.sizeVec3++]=St}var Gi=this.p;if(null!=Gt){if(Gt.zero(),Gi.sizeVec3==Gi.stackVec3.length){for(var Hi=Gi.sizeVec3<<1,Ui=new Array(Hi),Ji=0,Qi=Gi.sizeVec3;Ji<Qi;){var $i=Ji++;Ui[$i]=Gi.stackVec3[$i],Gi.stackVec3[$i]=null}Gi.stackVec3=Ui}Gi.stackVec3[Gi.sizeVec3++]=Gt}var Ki=this.p;if(null!=si){if(si.zero(),Ki.sizeVec3==Ki.stackVec3.length){for(var ta=Ki.sizeVec3<<1,ia=new Array(ta),aa=0,oa=Ki.sizeVec3;aa<oa;){var na=aa++;ia[na]=Ki.stackVec3[na],Ki.stackVec3[na]=null}Ki.stackVec3=ia}Ki.stackVec3[Ki.sizeVec3++]=si}var sa=this.p;if(null!=fi){if(fi.zero(),sa.sizeVec3==sa.stackVec3.length){for(var ra=sa.sizeVec3<<1,ea=new Array(ra),_a=0,ha=sa.sizeVec3;_a<ha;){var la=_a++;ea[la]=sa.stackVec3[la],sa.stackVec3[la]=null}sa.stackVec3=ea}sa.stackVec3[sa.sizeVec3++]=fi}}else{for(var ca=0;ca<8;){var pa=ca++,va=this.tmpCircleNorms[pa],ma=this.circleCoords[pa];va.x=ma.x,va.y=ma.y,va.z=ma.z;var ba=va,fa=ba.x*v.e00+ba.y*v.e01+ba.z*v.e02,xa=ba.x*v.e10+ba.y*v.e11+ba.z*v.e12,ua=ba.x*v.e20+ba.y*v.e21+ba.z*v.e22;ba.x=fa,ba.y=xa,ba.z=ua;var ya=this.tmpCircleVerts1[pa],ga=this.tmpCircleNorms[pa];ya.x=ga.x,ya.y=ga.y,ya.z=ga.z;var Xa=ya,za=Xa.x*i,Ma=Xa.y*i,Ya=Xa.z*i;Xa.x=za,Xa.y=Ma,Xa.z=Ya;var Za=Xa,da=Za.x+c.x,Ia=Za.y+c.y,Va=Za.z+c.z;Za.x=da,Za.y=Ia,Za.z=Va;var La=this.tmpCircleVerts2[pa],wa=this.tmpCircleVerts1[pa];La.x=wa.x,La.y=wa.y,La.z=wa.z;var Aa=this.tmpCircleVerts1[pa],ka=Aa.x+e.x*a,Ba=Aa.y+e.y*a,Pa=Aa.z+e.z*a;Aa.x=ka,Aa.y=Ba,Aa.z=Pa;var Ta=this.tmpCircleVerts2[pa],Sa=-a,Ca=Ta.x+e.x*Sa,qa=Ta.y+e.y*Sa,Ra=Ta.z+e.z*Sa;Ta.x=Ca,Ta.y=qa,Ta.z=Ra}for(var Ea=0;Ea<8;){var ja=Ea++,Na=z,Da=this.tmpCircleVerts1[ja],Fa=this.tmpCircleVerts1[(ja+1)%8],Oa=e;this.triangle(Na,Da,Fa,Oa,Oa,Oa,o),Na=w,Da=this.tmpCircleVerts2[(ja+1)%8],Fa=this.tmpCircleVerts2[ja];var Wa=this.p,Ga=0==Wa.sizeVec3?new F:Wa.stackVec3[--Wa.sizeVec3];Ga.x=e.x,Ga.y=e.y,Ga.z=e.z;var Ha=Ga,Ua=-Ha.x,Ja=-Ha.y,Qa=-Ha.z;Ha.x=Ua,Ha.y=Ja,Ha.z=Qa,Oa=Ha,this.triangle(Na,Da,Fa,Oa,Oa,Oa,o);var $a=this.p;if(null!=Oa){if(Oa.zero(),$a.sizeVec3==$a.stackVec3.length){for(var Ka=$a.sizeVec3<<1,to=new Array(Ka),io=0,ao=$a.sizeVec3;io<ao;){var oo=io++;to[oo]=$a.stackVec3[oo],$a.stackVec3[oo]=null}$a.stackVec3=to}$a.stackVec3[$a.sizeVec3++]=Oa}Na=this.tmpCircleVerts1[ja],Da=this.tmpCircleVerts2[ja],Fa=this.tmpCircleVerts2[(ja+1)%8];var no=this.tmpCircleVerts1[(ja+1)%8];Oa=this.tmpCircleNorms[ja];var so=this.tmpCircleNorms[(ja+1)%8];this.rect(Na,Da,Fa,no,Oa,Oa,so,so,o)}}var ro=this.p;if(null!=z){if(z.zero(),ro.sizeVec3==ro.stackVec3.length){for(var eo=ro.sizeVec3<<1,_o=new Array(eo),ho=0,lo=ro.sizeVec3;ho<lo;){var co=ho++;_o[co]=ro.stackVec3[co],ro.stackVec3[co]=null}ro.stackVec3=_o}ro.stackVec3[ro.sizeVec3++]=z}var po=this.p;if(null!=w){if(w.zero(),po.sizeVec3==po.stackVec3.length){for(var vo=po.sizeVec3<<1,mo=new Array(vo),bo=0,fo=po.sizeVec3;bo<fo;){var xo=bo++;mo[xo]=po.stackVec3[xo],po.stackVec3[xo]=null}po.stackVec3=mo}po.stackVec3[po.sizeVec3++]=w}var uo=this.p;if(null!=c){if(c.zero(),uo.sizeVec3==uo.stackVec3.length){for(var yo=uo.sizeVec3<<1,go=new Array(yo),Xo=0,zo=uo.sizeVec3;Xo<zo;){var Mo=Xo++;go[Mo]=uo.stackVec3[Mo],uo.stackVec3[Mo]=null}uo.stackVec3=go}uo.stackVec3[uo.sizeVec3++]=c}var Yo=this.p;if(null!=v){if(v.e00=1,v.e01=0,v.e02=0,v.e10=0,v.e11=1,v.e12=0,v.e20=0,v.e21=0,v.e22=1,Yo.sizeMat3==Yo.stackMat3.length){for(var Zo=Yo.sizeMat3<<1,Io=new Array(Zo),Vo=0,Lo=Yo.sizeMat3;Vo<Lo;){var wo=Vo++;Io[wo]=Yo.stackMat3[wo],Yo.stackMat3[wo]=null}Yo.stackMat3=Io}Yo.stackMat3[Yo.sizeMat3++]=v}var Ao=this.p;if(null!=s){if(s.zero(),Ao.sizeVec3==Ao.stackVec3.length){for(var ko=Ao.sizeVec3<<1,Bo=new Array(ko),Po=0,To=Ao.sizeVec3;Po<To;){var So=Po++;Bo[So]=Ao.stackVec3[So],Ao.stackVec3[So]=null}Ao.stackVec3=Bo}Ao.stackVec3[Ao.sizeVec3++]=s}var Co=this.p;if(null!=e){if(e.zero(),Co.sizeVec3==Co.stackVec3.length){for(var qo=Co.sizeVec3<<1,Ro=new Array(qo),Eo=0,jo=Co.sizeVec3;Eo<jo;){var No=Eo++;Ro[No]=Co.stackVec3[No],Co.stackVec3[No]=null}Co.stackVec3=Ro}Co.stackVec3[Co.sizeVec3++]=e}var Do=this.p;if(null!=h){if(h.zero(),Do.sizeVec3==Do.stackVec3.length){for(var Fo=Do.sizeVec3<<1,Oo=new Array(Fo),Wo=0,Go=Do.sizeVec3;Wo<Go;){var Ho=Wo++;Oo[Ho]=Do.stackVec3[Ho],Do.stackVec3[Ho]=null}Do.stackVec3=Oo}Do.stackVec3[Do.sizeVec3++]=h}},capsule:function(t,i,a,o){var n=this.p,s=0==n.sizeVec3?new F:n.stackVec3[--n.sizeVec3],r=this.p,e=0==r.sizeVec3?new F:r.stackVec3[--r.sizeVec3],_=this.p,h=0==_.sizeVec3?new F:_.stackVec3[--_.sizeVec3],l=this.p,c=0==l.sizeVec3?new F:l.stackVec3[--l.sizeVec3],p=this.p,v=0==p.sizeMat3?new J:p.stackMat3[--p.sizeMat3],m=c;m.x=t._positionX,m.y=t._positionY,m.z=t._positionZ;var b=v;b.e00=t._rotation00,b.e01=t._rotation01,b.e02=t._rotation02,b.e10=t._rotation10,b.e11=t._rotation11,b.e12=t._rotation12,b.e20=t._rotation20,b.e21=t._rotation21,b.e22=t._rotation22,s.init(v.e00,v.e10,v.e20),e.init(v.e01,v.e11,v.e21),h.init(v.e02,v.e12,v.e22);for(var f=this.tmpSphereVerts,x=this.tmpSphereNorms,u=0;u<5;)for(var y=u++,g=0,X=this.tmpSphereVerts[y].length;g<X;){var z=g++,M=x[y][z],Y=this.sphereCoords[y][z];M.x=Y.x,M.y=Y.y,M.z=Y.z;var Z=M,d=Z.x*v.e00+Z.y*v.e01+Z.z*v.e02,I=Z.x*v.e10+Z.y*v.e11+Z.z*v.e12,V=Z.x*v.e20+Z.y*v.e21+Z.z*v.e22;Z.x=d,Z.y=I,Z.z=V}for(var L=0;L<4;){var w=L++;if(0==w)for(var A=0;A<3;)for(var k=A++,B=0,P=this.tmpSphereVerts[k].length;B<P;){var T=B++,S=f[k][T],C=x[k][T];S.x=C.x,S.y=C.y,S.z=C.z;var q=S,R=q.x*i,E=q.y*i,j=q.z*i;q.x=R,q.y=E,q.z=j;var N=q,D=N.x+c.x,O=N.y+c.y,W=N.z+c.z;N.x=D,N.y=O,N.z=W;var G=N,H=G.x+e.x*a,U=G.y+e.y*a,Q=G.z+e.z*a;G.x=H,G.y=U,G.z=Q}if(2==w)for(var $=2;$<5;)for(var K=$++,tt=0,it=this.tmpSphereVerts[K].length;tt<it;){var at=tt++,ot=f[K][at],nt=x[K][at];ot.x=nt.x,ot.y=nt.y,ot.z=nt.z;var st=ot,rt=st.x*i,et=st.y*i,_t=st.z*i;st.x=rt,st.y=et,st.z=_t;var ht=st,lt=ht.x+c.x,ct=ht.y+c.y,pt=ht.z+c.z;ht.x=lt,ht.y=ct,ht.z=pt;var vt=ht,mt=-a,bt=vt.x+e.x*mt,ft=vt.y+e.y*mt,xt=vt.z+e.z*mt;vt.x=bt,vt.y=ft,vt.z=xt}for(var ut=0;ut<8;){var yt,gt,Xt,zt,Mt,Yt,Zt,dt,It=ut++;0==w?this.wireframe?(yt=f[0][0],gt=f[1][It],this.line(yt,gt,o)):(yt=f[0][0],gt=f[1][It],Xt=f[1][(It+1)%8],Mt=x[0][0],Yt=x[1][It],Zt=x[1][(It+1)%8],this.triangle(yt,gt,Xt,Mt,Yt,Zt,o)):3==w?this.wireframe?(yt=f[4][0],gt=f[w][(It+1)%8],Xt=f[w][It],this.line(yt,gt,o),this.line(gt,Xt,o)):(yt=f[4][0],gt=f[w][(It+1)%8],Xt=f[w][It],Mt=x[4][0],Yt=x[w][(It+1)%8],Zt=x[w][It],this.triangle(yt,gt,Xt,Mt,Yt,Zt,o)):this.wireframe?(yt=f[w][It],gt=f[w][(It+1)%8],Xt=f[w+1][It],this.line(yt,gt,o),this.line(yt,Xt,o)):(yt=f[w][It],gt=f[w][(It+1)%8],Xt=f[w+1][It],zt=f[w+1][(It+1)%8],Mt=x[w][It],Yt=x[w][(It+1)%8],Zt=x[w+1][It],dt=x[w+1][(It+1)%8],this.rect(yt,Xt,zt,gt,Mt,Zt,dt,Yt,o))}}var Vt=this.p,Lt=0==Vt.sizeVec3?new F:Vt.stackVec3[--Vt.sizeVec3];Lt.x=c.x,Lt.y=c.y,Lt.z=c.z;var wt=Lt,At=wt.x+e.x*a,kt=wt.y+e.y*a,Bt=wt.z+e.z*a;wt.x=At,wt.y=kt,wt.z=Bt;var Pt=wt,Tt=this.p,St=0==Tt.sizeVec3?new F:Tt.stackVec3[--Tt.sizeVec3];St.x=c.x,St.y=c.y,St.z=c.z;var Ct=St,qt=-a,Rt=Ct.x+e.x*qt,Et=Ct.y+e.y*qt,jt=Ct.z+e.z*qt;Ct.x=Rt,Ct.y=Et,Ct.z=jt;var Nt=Ct;if(this.wireframe){var Dt=this.p,Ft=0==Dt.sizeVec3?new F:Dt.stackVec3[--Dt.sizeVec3];Ft.x=Pt.x,Ft.y=Pt.y,Ft.z=Pt.z;var Ot=Ft,Wt=-i,Gt=Ot.x+s.x*Wt,Ht=Ot.y+s.y*Wt,Ut=Ot.z+s.z*Wt;Ot.x=Gt,Ot.y=Ht,Ot.z=Ut;var Jt=Ot,Qt=Jt.x+0*h.x,$t=Jt.y+0*h.y,Kt=Jt.z+0*h.z;Jt.x=Qt,Jt.y=$t,Jt.z=Kt;var ti=Jt,ii=this.p,ai=0==ii.sizeVec3?new F:ii.stackVec3[--ii.sizeVec3];ai.x=Pt.x,ai.y=Pt.y,ai.z=Pt.z;var oi=ai,ni=oi.x+s.x*i,si=oi.y+s.y*i,ri=oi.z+s.z*i;oi.x=ni,oi.y=si,oi.z=ri;var ei=oi,_i=ei.x+0*h.x,hi=ei.y+0*h.y,li=ei.z+0*h.z;ei.x=_i,ei.y=hi,ei.z=li;var ci=ei,pi=this.p,vi=0==pi.sizeVec3?new F:pi.stackVec3[--pi.sizeVec3];vi.x=Pt.x,vi.y=Pt.y,vi.z=Pt.z;var mi=vi,bi=mi.x+0*s.x,fi=mi.y+0*s.y,xi=mi.z+0*s.z;mi.x=bi,mi.y=fi,mi.z=xi;var ui=mi,yi=-i,gi=ui.x+h.x*yi,Xi=ui.y+h.y*yi,zi=ui.z+h.z*yi;ui.x=gi,ui.y=Xi,ui.z=zi;var Mi=ui,Yi=this.p,Zi=0==Yi.sizeVec3?new F:Yi.stackVec3[--Yi.sizeVec3];Zi.x=Pt.x,Zi.y=Pt.y,Zi.z=Pt.z;var di=Zi,Ii=di.x+0*s.x,Vi=di.y+0*s.y,Li=di.z+0*s.z;di.x=Ii,di.y=Vi,di.z=Li;var wi=di,Ai=wi.x+h.x*i,ki=wi.y+h.y*i,Bi=wi.z+h.z*i;wi.x=Ai,wi.y=ki,wi.z=Bi;var Pi=wi,Ti=this.p,Si=0==Ti.sizeVec3?new F:Ti.stackVec3[--Ti.sizeVec3];Si.x=Nt.x,Si.y=Nt.y,Si.z=Nt.z;var Ci=Si,qi=-i,Ri=Ci.x+s.x*qi,Ei=Ci.y+s.y*qi,ji=Ci.z+s.z*qi;Ci.x=Ri,Ci.y=Ei,Ci.z=ji;var Ni=Ci,Di=Ni.x+0*h.x,Fi=Ni.y+0*h.y,Oi=Ni.z+0*h.z;Ni.x=Di,Ni.y=Fi,Ni.z=Oi;var Wi=Ni,Gi=this.p,Hi=0==Gi.sizeVec3?new F:Gi.stackVec3[--Gi.sizeVec3];Hi.x=Nt.x,Hi.y=Nt.y,Hi.z=Nt.z;var Ui=Hi,Ji=Ui.x+s.x*i,Qi=Ui.y+s.y*i,$i=Ui.z+s.z*i;Ui.x=Ji,Ui.y=Qi,Ui.z=$i;var Ki=Ui,ta=Ki.x+0*h.x,ia=Ki.y+0*h.y,aa=Ki.z+0*h.z;Ki.x=ta,Ki.y=ia,Ki.z=aa;var oa=Ki,na=this.p,sa=0==na.sizeVec3?new F:na.stackVec3[--na.sizeVec3];sa.x=Nt.x,sa.y=Nt.y,sa.z=Nt.z;var ra=sa,ea=ra.x+0*s.x,_a=ra.y+0*s.y,ha=ra.z+0*s.z;ra.x=ea,ra.y=_a,ra.z=ha;var la=ra,ca=-i,pa=la.x+h.x*ca,va=la.y+h.y*ca,ma=la.z+h.z*ca;la.x=pa,la.y=va,la.z=ma;var ba=la,fa=this.p,xa=0==fa.sizeVec3?new F:fa.stackVec3[--fa.sizeVec3];xa.x=Nt.x,xa.y=Nt.y,xa.z=Nt.z;var ua=xa,ya=ua.x+0*s.x,ga=ua.y+0*s.y,Xa=ua.z+0*s.z;ua.x=ya,ua.y=ga,ua.z=Xa;var za=ua,Ma=za.x+h.x*i,Ya=za.y+h.y*i,Za=za.z+h.z*i;za.x=Ma,za.y=Ya,za.z=Za;var da=za;this.ellipse(Pt,s,h,i,i,o),this.ellipse(Nt,s,h,i,i,o),this.line(ti,Wi,o),this.line(ci,oa,o),this.line(Mi,ba,o),this.line(Pi,da,o);var Ia=this.p;if(null!=ti){if(ti.zero(),Ia.sizeVec3==Ia.stackVec3.length){for(var Va=Ia.sizeVec3<<1,La=new Array(Va),wa=0,Aa=Ia.sizeVec3;wa<Aa;){var ka=wa++;La[ka]=Ia.stackVec3[ka],Ia.stackVec3[ka]=null}Ia.stackVec3=La}Ia.stackVec3[Ia.sizeVec3++]=ti}var Ba=this.p;if(null!=ci){if(ci.zero(),Ba.sizeVec3==Ba.stackVec3.length){for(var Pa=Ba.sizeVec3<<1,Ta=new Array(Pa),Sa=0,Ca=Ba.sizeVec3;Sa<Ca;){var qa=Sa++;Ta[qa]=Ba.stackVec3[qa],Ba.stackVec3[qa]=null}Ba.stackVec3=Ta}Ba.stackVec3[Ba.sizeVec3++]=ci}var Ra=this.p;if(null!=Mi){if(Mi.zero(),Ra.sizeVec3==Ra.stackVec3.length){for(var Ea=Ra.sizeVec3<<1,ja=new Array(Ea),Na=0,Da=Ra.sizeVec3;Na<Da;){var Fa=Na++;ja[Fa]=Ra.stackVec3[Fa],Ra.stackVec3[Fa]=null}Ra.stackVec3=ja}Ra.stackVec3[Ra.sizeVec3++]=Mi}var Oa=this.p;if(null!=Pi){if(Pi.zero(),Oa.sizeVec3==Oa.stackVec3.length){for(var Wa=Oa.sizeVec3<<1,Ga=new Array(Wa),Ha=0,Ua=Oa.sizeVec3;Ha<Ua;){var Ja=Ha++;Ga[Ja]=Oa.stackVec3[Ja],Oa.stackVec3[Ja]=null}Oa.stackVec3=Ga}Oa.stackVec3[Oa.sizeVec3++]=Pi}var Qa=this.p;if(null!=Wi){if(Wi.zero(),Qa.sizeVec3==Qa.stackVec3.length){for(var $a=Qa.sizeVec3<<1,Ka=new Array($a),to=0,io=Qa.sizeVec3;to<io;){var ao=to++;Ka[ao]=Qa.stackVec3[ao],Qa.stackVec3[ao]=null}Qa.stackVec3=Ka}Qa.stackVec3[Qa.sizeVec3++]=Wi}var oo=this.p;if(null!=oa){if(oa.zero(),oo.sizeVec3==oo.stackVec3.length){for(var no=oo.sizeVec3<<1,so=new Array(no),ro=0,eo=oo.sizeVec3;ro<eo;){var _o=ro++;so[_o]=oo.stackVec3[_o],oo.stackVec3[_o]=null}oo.stackVec3=so}oo.stackVec3[oo.sizeVec3++]=oa}var ho=this.p;if(null!=ba){if(ba.zero(),ho.sizeVec3==ho.stackVec3.length){for(var lo=ho.sizeVec3<<1,co=new Array(lo),po=0,vo=ho.sizeVec3;po<vo;){var mo=po++;co[mo]=ho.stackVec3[mo],ho.stackVec3[mo]=null}ho.stackVec3=co}ho.stackVec3[ho.sizeVec3++]=ba}var bo=this.p;if(null!=da){if(da.zero(),bo.sizeVec3==bo.stackVec3.length){for(var fo=bo.sizeVec3<<1,xo=new Array(fo),uo=0,yo=bo.sizeVec3;uo<yo;){var go=uo++;xo[go]=bo.stackVec3[go],bo.stackVec3[go]=null}bo.stackVec3=xo}bo.stackVec3[bo.sizeVec3++]=da}}else{for(var Xo=0;Xo<8;){var zo=Xo++,Mo=this.tmpCircleNorms[zo],Yo=this.circleCoords[zo];Mo.x=Yo.x,Mo.y=Yo.y,Mo.z=Yo.z;var Zo=Mo,Io=Zo.x*v.e00+Zo.y*v.e01+Zo.z*v.e02,Vo=Zo.x*v.e10+Zo.y*v.e11+Zo.z*v.e12,Lo=Zo.x*v.e20+Zo.y*v.e21+Zo.z*v.e22;Zo.x=Io,Zo.y=Vo,Zo.z=Lo;var wo=this.tmpCircleVerts1[zo],Ao=this.tmpCircleNorms[zo];wo.x=Ao.x,wo.y=Ao.y,wo.z=Ao.z;var ko=wo,Bo=ko.x*i,Po=ko.y*i,To=ko.z*i;ko.x=Bo,ko.y=Po,ko.z=To;var So=ko,Co=So.x+c.x,qo=So.y+c.y,Ro=So.z+c.z;So.x=Co,So.y=qo,So.z=Ro;var Eo=this.tmpCircleVerts2[zo],jo=this.tmpCircleVerts1[zo];Eo.x=jo.x,Eo.y=jo.y,Eo.z=jo.z;var No=this.tmpCircleVerts1[zo],Do=No.x+e.x*a,Fo=No.y+e.y*a,Oo=No.z+e.z*a;No.x=Do,No.y=Fo,No.z=Oo;var Wo=this.tmpCircleVerts2[zo],Go=-a,Ho=Wo.x+e.x*Go,Uo=Wo.y+e.y*Go,Jo=Wo.z+e.z*Go;Wo.x=Ho,Wo.y=Uo,Wo.z=Jo}for(var Qo=0;Qo<8;){var $o=Qo++,Ko=this.tmpCircleVerts1[$o],tn=this.tmpCircleVerts2[$o],an=this.tmpCircleVerts2[($o+1)%8],on=this.tmpCircleVerts1[($o+1)%8],nn=this.tmpCircleNorms[$o],sn=this.tmpCircleNorms[($o+1)%8];this.rect(Ko,tn,an,on,nn,nn,sn,sn,o)}}var rn=this.p;if(null!=Pt){if(Pt.zero(),rn.sizeVec3==rn.stackVec3.length){for(var en=rn.sizeVec3<<1,_n=new Array(en),hn=0,ln=rn.sizeVec3;hn<ln;){var cn=hn++;_n[cn]=rn.stackVec3[cn],rn.stackVec3[cn]=null}rn.stackVec3=_n}rn.stackVec3[rn.sizeVec3++]=Pt}var pn=this.p;if(null!=Nt){if(Nt.zero(),pn.sizeVec3==pn.stackVec3.length){for(var vn=pn.sizeVec3<<1,mn=new Array(vn),bn=0,fn=pn.sizeVec3;bn<fn;){var xn=bn++;mn[xn]=pn.stackVec3[xn],pn.stackVec3[xn]=null}pn.stackVec3=mn}pn.stackVec3[pn.sizeVec3++]=Nt}var un=this.p;if(null!=c){if(c.zero(),un.sizeVec3==un.stackVec3.length){for(var yn=un.sizeVec3<<1,gn=new Array(yn),Xn=0,zn=un.sizeVec3;Xn<zn;){var Mn=Xn++;gn[Mn]=un.stackVec3[Mn],un.stackVec3[Mn]=null}un.stackVec3=gn}un.stackVec3[un.sizeVec3++]=c}var Yn=this.p;if(null!=v){if(v.e00=1,v.e01=0,v.e02=0,v.e10=0,v.e11=1,v.e12=0,v.e20=0,v.e21=0,v.e22=1,Yn.sizeMat3==Yn.stackMat3.length){for(var Zn=Yn.sizeMat3<<1,dn=new Array(Zn),In=0,Vn=Yn.sizeMat3;In<Vn;){var Ln=In++;dn[Ln]=Yn.stackMat3[Ln],Yn.stackMat3[Ln]=null}Yn.stackMat3=dn}Yn.stackMat3[Yn.sizeMat3++]=v}var wn=this.p;if(null!=s){if(s.zero(),wn.sizeVec3==wn.stackVec3.length){for(var An=wn.sizeVec3<<1,kn=new Array(An),Bn=0,Pn=wn.sizeVec3;Bn<Pn;){var Tn=Bn++;kn[Tn]=wn.stackVec3[Tn],wn.stackVec3[Tn]=null}wn.stackVec3=kn}wn.stackVec3[wn.sizeVec3++]=s}var Sn=this.p;if(null!=e){if(e.zero(),Sn.sizeVec3==Sn.stackVec3.length){for(var Cn=Sn.sizeVec3<<1,qn=new Array(Cn),Rn=0,En=Sn.sizeVec3;Rn<En;){var jn=Rn++;qn[jn]=Sn.stackVec3[jn],Sn.stackVec3[jn]=null}Sn.stackVec3=qn}Sn.stackVec3[Sn.sizeVec3++]=e}var Nn=this.p;if(null!=h){if(h.zero(),Nn.sizeVec3==Nn.stackVec3.length){for(var Dn=Nn.sizeVec3<<1,Fn=new Array(Dn),On=0,Wn=Nn.sizeVec3;On<Wn;){var Gn=On++;Fn[Gn]=Nn.stackVec3[Gn],Nn.stackVec3[Gn]=null}Nn.stackVec3=Fn}Nn.stackVec3[Nn.sizeVec3++]=h}},sphere:function(t,i,a){var o=this.p,n=0==o.sizeVec3?new F:o.stackVec3[--o.sizeVec3],s=this.p,r=0==s.sizeMat3?new J:s.stackMat3[--s.sizeMat3],e=n;e.x=t._positionX,e.y=t._positionY,e.z=t._positionZ;var _=r;_.e00=t._rotation00,_.e01=t._rotation01,_.e02=t._rotation02,_.e10=t._rotation10,_.e11=t._rotation11,_.e12=t._rotation12,_.e20=t._rotation20,_.e21=t._rotation21,_.e22=t._rotation22;for(var h=this.tmpSphereVerts,l=this.tmpSphereNorms,c=0;c<5;)for(var p=c++,v=0,m=this.tmpSphereVerts[p].length;v<m;){var b=v++,f=l[p][b],x=this.sphereCoords[p][b];f.x=x.x,f.y=x.y,f.z=x.z;var u=f,y=u.x*r.e00+u.y*r.e01+u.z*r.e02,g=u.x*r.e10+u.y*r.e11+u.z*r.e12,X=u.x*r.e20+u.y*r.e21+u.z*r.e22;u.x=y,u.y=g,u.z=X;var z=h[p][b],M=l[p][b];z.x=M.x,z.y=M.y,z.z=M.z;var Y=z,Z=Y.x*i,d=Y.y*i,I=Y.z*i;Y.x=Z,Y.y=d,Y.z=I;var V=Y,L=V.x+n.x,w=V.y+n.y,A=V.z+n.z;V.x=L,V.y=w,V.z=A}for(var k=0;k<4;)for(var B=k++,P=0;P<8;){var T,S,C,q,R,E,j,N,D=P++;0==B?this.wireframe?(T=h[0][0],S=h[1][D],this.line(T,S,a)):(T=h[0][0],S=h[1][D],C=h[1][(D+1)%8],R=l[0][0],E=l[1][D],j=l[1][(D+1)%8],this.triangle(T,S,C,R,E,j,a)):3==B?this.wireframe?(T=h[4][0],S=h[B][(D+1)%8],C=h[B][D],this.line(T,S,a),this.line(S,C,a)):(T=h[4][0],S=h[B][(D+1)%8],C=h[B][D],R=l[4][0],E=l[B][(D+1)%8],j=l[B][D],this.triangle(T,S,C,R,E,j,a)):this.wireframe?(T=h[B][D],S=h[B][(D+1)%8],C=h[B+1][D],this.line(T,S,a),this.line(T,C,a)):(T=h[B][D],S=h[B][(D+1)%8],C=h[B+1][D],q=h[B+1][(D+1)%8],R=l[B][D],E=l[B][(D+1)%8],j=l[B+1][D],N=l[B+1][(D+1)%8],this.rect(T,C,q,S,R,j,N,E,a))}var O=this.p;if(null!=n){if(n.zero(),O.sizeVec3==O.stackVec3.length){for(var W=O.sizeVec3<<1,G=new Array(W),H=0,U=O.sizeVec3;H<U;){var Q=H++;G[Q]=O.stackVec3[Q],O.stackVec3[Q]=null}O.stackVec3=G}O.stackVec3[O.sizeVec3++]=n}var $=this.p;if(null!=r){if(r.e00=1,r.e01=0,r.e02=0,r.e10=0,r.e11=1,r.e12=0,r.e20=0,r.e21=0,r.e22=1,$.sizeMat3==$.stackMat3.length){for(var K=$.sizeMat3<<1,tt=new Array(K),it=0,at=$.sizeMat3;it<at;){var ot=it++;tt[ot]=$.stackMat3[ot],$.stackMat3[ot]=null}$.stackMat3=tt}$.stackMat3[$.sizeMat3++]=r}},box:function(t,i,a){var o=this.p,n=0==o.sizeVec3?new F:o.stackVec3[--o.sizeVec3],s=this.p,r=0==s.sizeVec3?new F:s.stackVec3[--s.sizeVec3],e=this.p,_=0==e.sizeVec3?new F:e.stackVec3[--e.sizeVec3],h=this.p,l=0==h.sizeVec3?new F:h.stackVec3[--h.sizeVec3],c=this.p,p=0==c.sizeMat3?new J:c.stackMat3[--c.sizeMat3],v=l;v.x=t._positionX,v.y=t._positionY,v.z=t._positionZ;var m=p;m.e00=t._rotation00,m.e01=t._rotation01,m.e02=t._rotation02,m.e10=t._rotation10,m.e11=t._rotation11,m.e12=t._rotation12,m.e20=t._rotation20,m.e21=t._rotation21,m.e22=t._rotation22,n.init(p.e00,p.e10,p.e20),r.init(p.e01,p.e11,p.e21),_.init(p.e02,p.e12,p.e22);var b=i.x,f=i.y,x=i.z,u=this.p,y=0==u.sizeVec3?new F:u.stackVec3[--u.sizeVec3];y.x=l.x,y.y=l.y,y.z=l.z;var g=y,X=-b,z=g.x+n.x*X,M=g.y+n.y*X,Y=g.z+n.z*X;g.x=z,g.y=M,g.z=Y;var Z=g,d=-f,I=Z.x+r.x*d,V=Z.y+r.y*d,L=Z.z+r.z*d;Z.x=I,Z.y=V,Z.z=L;var w=Z,A=-x,k=w.x+_.x*A,B=w.y+_.y*A,P=w.z+_.z*A;w.x=k,w.y=B,w.z=P;var T=w,S=this.p,C=0==S.sizeVec3?new F:S.stackVec3[--S.sizeVec3];C.x=l.x,C.y=l.y,C.z=l.z;var q=C,R=-b,E=q.x+n.x*R,j=q.y+n.y*R,N=q.z+n.z*R;q.x=E,q.y=j,q.z=N;var D=q,O=-f,W=D.x+r.x*O,G=D.y+r.y*O,H=D.z+r.z*O;D.x=W,D.y=G,D.z=H;var U=D,Q=U.x+_.x*x,$=U.y+_.y*x,K=U.z+_.z*x;U.x=Q,U.y=$,U.z=K;var tt=U,it=this.p,at=0==it.sizeVec3?new F:it.stackVec3[--it.sizeVec3];at.x=l.x,at.y=l.y,at.z=l.z;var ot=at,nt=-b,st=ot.x+n.x*nt,rt=ot.y+n.y*nt,et=ot.z+n.z*nt;ot.x=st,ot.y=rt,ot.z=et;var _t=ot,ht=_t.x+r.x*f,lt=_t.y+r.y*f,ct=_t.z+r.z*f;_t.x=ht,_t.y=lt,_t.z=ct;var pt=_t,vt=-x,mt=pt.x+_.x*vt,bt=pt.y+_.y*vt,ft=pt.z+_.z*vt;pt.x=mt,pt.y=bt,pt.z=ft;var xt=pt,ut=this.p,yt=0==ut.sizeVec3?new F:ut.stackVec3[--ut.sizeVec3];yt.x=l.x,yt.y=l.y,yt.z=l.z;var gt=yt,Xt=-b,zt=gt.x+n.x*Xt,Mt=gt.y+n.y*Xt,Yt=gt.z+n.z*Xt;gt.x=zt,gt.y=Mt,gt.z=Yt;var Zt=gt,dt=Zt.x+r.x*f,It=Zt.y+r.y*f,Vt=Zt.z+r.z*f;Zt.x=dt,Zt.y=It,Zt.z=Vt;var Lt=Zt,wt=Lt.x+_.x*x,At=Lt.y+_.y*x,kt=Lt.z+_.z*x;Lt.x=wt,Lt.y=At,Lt.z=kt;var Bt=Lt,Pt=this.p,Tt=0==Pt.sizeVec3?new F:Pt.stackVec3[--Pt.sizeVec3];Tt.x=l.x,Tt.y=l.y,Tt.z=l.z;var St=Tt,Ct=St.x+n.x*b,qt=St.y+n.y*b,Rt=St.z+n.z*b;St.x=Ct,St.y=qt,St.z=Rt;var Et=St,jt=-f,Nt=Et.x+r.x*jt,Dt=Et.y+r.y*jt,Ft=Et.z+r.z*jt;Et.x=Nt,Et.y=Dt,Et.z=Ft;var Ot=Et,Wt=-x,Gt=Ot.x+_.x*Wt,Ht=Ot.y+_.y*Wt,Ut=Ot.z+_.z*Wt;Ot.x=Gt,Ot.y=Ht,Ot.z=Ut;var Jt=Ot,Qt=this.p,$t=0==Qt.sizeVec3?new F:Qt.stackVec3[--Qt.sizeVec3];$t.x=l.x,$t.y=l.y,$t.z=l.z;var Kt=$t,ti=Kt.x+n.x*b,ii=Kt.y+n.y*b,ai=Kt.z+n.z*b;Kt.x=ti,Kt.y=ii,Kt.z=ai;var oi=Kt,ni=-f,si=oi.x+r.x*ni,ri=oi.y+r.y*ni,ei=oi.z+r.z*ni;oi.x=si,oi.y=ri,oi.z=ei;var _i=oi,hi=_i.x+_.x*x,li=_i.y+_.y*x,ci=_i.z+_.z*x;_i.x=hi,_i.y=li,_i.z=ci;var pi=_i,vi=this.p,mi=0==vi.sizeVec3?new F:vi.stackVec3[--vi.sizeVec3];mi.x=l.x,mi.y=l.y,mi.z=l.z;var bi=mi,fi=bi.x+n.x*b,xi=bi.y+n.y*b,ui=bi.z+n.z*b;bi.x=fi,bi.y=xi,bi.z=ui;var yi=bi,gi=yi.x+r.x*f,Xi=yi.y+r.y*f,zi=yi.z+r.z*f;yi.x=gi,yi.y=Xi,yi.z=zi;var Mi=yi,Yi=-x,Zi=Mi.x+_.x*Yi,di=Mi.y+_.y*Yi,Ii=Mi.z+_.z*Yi;Mi.x=Zi,Mi.y=di,Mi.z=Ii;var Vi=Mi,Li=this.p,wi=0==Li.sizeVec3?new F:Li.stackVec3[--Li.sizeVec3];wi.x=l.x,wi.y=l.y,wi.z=l.z;var Ai=wi,ki=Ai.x+n.x*b,Bi=Ai.y+n.y*b,Pi=Ai.z+n.z*b;Ai.x=ki,Ai.y=Bi,Ai.z=Pi;var Ti=Ai,Si=Ti.x+r.x*f,Ci=Ti.y+r.y*f,qi=Ti.z+r.z*f;Ti.x=Si,Ti.y=Ci,Ti.z=qi;var Ri=Ti,Ei=Ri.x+_.x*x,ji=Ri.y+_.y*x,Ni=Ri.z+_.z*x;Ri.x=Ei,Ri.y=ji,Ri.z=Ni;var Di=Ri;if(this.wireframe)this.line(T,tt,a),this.line(xt,Bt,a),this.line(Jt,pi,a),this.line(Vi,Di,a),this.line(T,xt,a),this.line(tt,Bt,a),this.line(Jt,Vi,a),this.line(pi,Di,a),this.line(T,Jt,a),this.line(tt,pi,a),this.line(xt,Vi,a),this.line(Bt,Di,a);else{var Fi=this.p,Oi=0==Fi.sizeVec3?new F:Fi.stackVec3[--Fi.sizeVec3];Oi.x=n.x,Oi.y=n.y,Oi.z=n.z;var Wi=Oi,Gi=-Wi.x,Hi=-Wi.y,Ui=-Wi.z;Wi.x=Gi,Wi.y=Hi,Wi.z=Ui;var Ji=Wi,Qi=this.p,$i=0==Qi.sizeVec3?new F:Qi.stackVec3[--Qi.sizeVec3];$i.x=r.x,$i.y=r.y,$i.z=r.z;var Ki=$i,ta=-Ki.x,ia=-Ki.y,aa=-Ki.z;Ki.x=ta,Ki.y=ia,Ki.z=aa;var oa=Ki,na=this.p,sa=0==na.sizeVec3?new F:na.stackVec3[--na.sizeVec3];sa.x=_.x,sa.y=_.y,sa.z=_.z;var ra=sa,ea=-ra.x,_a=-ra.y,ha=-ra.z;ra.x=ea,ra.y=_a,ra.z=ha;var la=ra;this.rect(T,tt,Bt,xt,Ji,Ji,Ji,Ji,a),this.rect(Jt,Vi,Di,pi,n,n,n,n,a),this.rect(T,Jt,pi,tt,oa,oa,oa,oa,a),this.rect(xt,Bt,Di,Vi,r,r,r,r,a),this.rect(T,xt,Vi,Jt,la,la,la,la,a),this.rect(tt,pi,Di,Bt,_,_,_,_,a);var ca=this.p;if(null!=Ji){if(Ji.zero(),ca.sizeVec3==ca.stackVec3.length){for(var pa=ca.sizeVec3<<1,va=new Array(pa),ma=0,ba=ca.sizeVec3;ma<ba;){var fa=ma++;va[fa]=ca.stackVec3[fa],ca.stackVec3[fa]=null}ca.stackVec3=va}ca.stackVec3[ca.sizeVec3++]=Ji}var xa=this.p;if(null!=oa){if(oa.zero(),xa.sizeVec3==xa.stackVec3.length){for(var ua=xa.sizeVec3<<1,ya=new Array(ua),ga=0,Xa=xa.sizeVec3;ga<Xa;){var za=ga++;ya[za]=xa.stackVec3[za],xa.stackVec3[za]=null}xa.stackVec3=ya}xa.stackVec3[xa.sizeVec3++]=oa}var Ma=this.p;if(null!=la){if(la.zero(),Ma.sizeVec3==Ma.stackVec3.length){for(var Ya=Ma.sizeVec3<<1,Za=new Array(Ya),da=0,Ia=Ma.sizeVec3;da<Ia;){var Va=da++;Za[Va]=Ma.stackVec3[Va],Ma.stackVec3[Va]=null}Ma.stackVec3=Za}Ma.stackVec3[Ma.sizeVec3++]=la}}var La=this.p;if(null!=T){if(T.zero(),La.sizeVec3==La.stackVec3.length){for(var wa=La.sizeVec3<<1,Aa=new Array(wa),ka=0,Ba=La.sizeVec3;ka<Ba;){var Pa=ka++;Aa[Pa]=La.stackVec3[Pa],La.stackVec3[Pa]=null}La.stackVec3=Aa}La.stackVec3[La.sizeVec3++]=T}var Ta=this.p;if(null!=tt){if(tt.zero(),Ta.sizeVec3==Ta.stackVec3.length){for(var Sa=Ta.sizeVec3<<1,Ca=new Array(Sa),qa=0,Ra=Ta.sizeVec3;qa<Ra;){var Ea=qa++;Ca[Ea]=Ta.stackVec3[Ea],Ta.stackVec3[Ea]=null}Ta.stackVec3=Ca}Ta.stackVec3[Ta.sizeVec3++]=tt}var ja=this.p;if(null!=xt){if(xt.zero(),ja.sizeVec3==ja.stackVec3.length){for(var Na=ja.sizeVec3<<1,Da=new Array(Na),Fa=0,Oa=ja.sizeVec3;Fa<Oa;){var Wa=Fa++;Da[Wa]=ja.stackVec3[Wa],ja.stackVec3[Wa]=null}ja.stackVec3=Da}ja.stackVec3[ja.sizeVec3++]=xt}var Ga=this.p;if(null!=Bt){if(Bt.zero(),Ga.sizeVec3==Ga.stackVec3.length){for(var Ha=Ga.sizeVec3<<1,Ua=new Array(Ha),Ja=0,Qa=Ga.sizeVec3;Ja<Qa;){var $a=Ja++;Ua[$a]=Ga.stackVec3[$a],Ga.stackVec3[$a]=null}Ga.stackVec3=Ua}Ga.stackVec3[Ga.sizeVec3++]=Bt}var Ka=this.p;if(null!=Jt){if(Jt.zero(),Ka.sizeVec3==Ka.stackVec3.length){for(var to=Ka.sizeVec3<<1,io=new Array(to),ao=0,oo=Ka.sizeVec3;ao<oo;){var no=ao++;io[no]=Ka.stackVec3[no],Ka.stackVec3[no]=null}Ka.stackVec3=io}Ka.stackVec3[Ka.sizeVec3++]=Jt}var so=this.p;if(null!=pi){if(pi.zero(),so.sizeVec3==so.stackVec3.length){for(var ro=so.sizeVec3<<1,eo=new Array(ro),_o=0,ho=so.sizeVec3;_o<ho;){var lo=_o++;eo[lo]=so.stackVec3[lo],so.stackVec3[lo]=null}so.stackVec3=eo}so.stackVec3[so.sizeVec3++]=pi}var co=this.p;if(null!=Vi){if(Vi.zero(),co.sizeVec3==co.stackVec3.length){for(var po=co.sizeVec3<<1,vo=new Array(po),mo=0,bo=co.sizeVec3;mo<bo;){var fo=mo++;vo[fo]=co.stackVec3[fo],co.stackVec3[fo]=null}co.stackVec3=vo}co.stackVec3[co.sizeVec3++]=Vi}var xo=this.p;if(null!=Di){if(Di.zero(),xo.sizeVec3==xo.stackVec3.length){for(var uo=xo.sizeVec3<<1,yo=new Array(uo),go=0,Xo=xo.sizeVec3;go<Xo;){var zo=go++;yo[zo]=xo.stackVec3[zo],xo.stackVec3[zo]=null}xo.stackVec3=yo}xo.stackVec3[xo.sizeVec3++]=Di}var Mo=this.p;if(null!=l){if(l.zero(),Mo.sizeVec3==Mo.stackVec3.length){for(var Yo=Mo.sizeVec3<<1,Zo=new Array(Yo),Io=0,Vo=Mo.sizeVec3;Io<Vo;){var Lo=Io++;Zo[Lo]=Mo.stackVec3[Lo],Mo.stackVec3[Lo]=null}Mo.stackVec3=Zo}Mo.stackVec3[Mo.sizeVec3++]=l}var wo=this.p;if(null!=p){if(p.e00=1,p.e01=0,p.e02=0,p.e10=0,p.e11=1,p.e12=0,p.e20=0,p.e21=0,p.e22=1,wo.sizeMat3==wo.stackMat3.length){for(var Ao=wo.sizeMat3<<1,ko=new Array(Ao),Bo=0,Po=wo.sizeMat3;Bo<Po;){var To=Bo++;ko[To]=wo.stackMat3[To],wo.stackMat3[To]=null}wo.stackMat3=ko}wo.stackMat3[wo.sizeMat3++]=p}var So=this.p;if(null!=n){if(n.zero(),So.sizeVec3==So.stackVec3.length){for(var Co=So.sizeVec3<<1,qo=new Array(Co),Ro=0,Eo=So.sizeVec3;Ro<Eo;){var jo=Ro++;qo[jo]=So.stackVec3[jo],So.stackVec3[jo]=null}So.stackVec3=qo}So.stackVec3[So.sizeVec3++]=n}var No=this.p;if(null!=r){if(r.zero(),No.sizeVec3==No.stackVec3.length){for(var Do=No.sizeVec3<<1,Fo=new Array(Do),Oo=0,Wo=No.sizeVec3;Oo<Wo;){var Go=Oo++;Fo[Go]=No.stackVec3[Go],No.stackVec3[Go]=null}No.stackVec3=Fo}No.stackVec3[No.sizeVec3++]=r}var Ho=this.p;if(null!=_){if(_.zero(),Ho.sizeVec3==Ho.stackVec3.length){for(var Uo=Ho.sizeVec3<<1,Jo=new Array(Uo),Qo=0,$o=Ho.sizeVec3;Qo<$o;){var Ko=Qo++;Jo[Ko]=Ho.stackVec3[Ko],Ho.stackVec3[Ko]=null}Ho.stackVec3=Jo}Ho.stackVec3[Ho.sizeVec3++]=_}},rect:function(t,i,a,o,n,s,r,e,_){this.triangle(t,i,a,n,s,r,_),this.triangle(t,a,o,n,r,e,_)},point:function(t,i){},triangle:function(t,i,a,o,n,s,r){},line:function(t,i,a){}};var bt=function(){this.basisColorZ=new F(0,0,1),this.basisColorY=new F(0,1,0),this.basisColorX=new F(1,0,0),this.basisLength=.5,this.jointRotationalConstraintRadius=.3,this.jointErrorColor=new F(1,.1,.1),this.jointLineColor=new F(.8,.8,.8),this.contactBinormalLength=.5,this.contactTangentLength=.5,this.contactNormalLength=.5,this.contactBinormalColor=new F(.2,.2,1),this.contactTangentColor=new F(.1,.8,.1),this.contactNormalColor=new F(1,.1,.1),this.disabledContactColor=new F(.5,.1,.1),this.newContactColor=new F(1,1,.1),this.contactColor4=new F(.8,.1,1),this.contactColor3=new F(.1,.8,.6),this.contactColor2=new F(1,.6,.1),this.contactColor=new F(1,.1,.1),this.pairColor=new F(1,1,.1),this.bvhNodeColor=new F(.4,.4,.4),this.aabbColor=new F(1,.1,.1),this.kinematicShapeColor=new F(1,.5,.1),this.staticShapeColor=new F(.7,.7,.7),this.sleepingShapeColor2=new F(.2,.8,.5),this.sleepingShapeColor1=new F(.3,.3,.8),this.sleepyShapeColor2=new F(.6,.8,.3),this.sleepyShapeColor1=new F(.5,.25,.6),this.shapeColor2=new F(1,.8,.1),this.shapeColor1=new F(.7,.2,.4)},ft=function(){},xt=function(){this._b1=null,this._b2=null,this._addedToIsland=!1};xt.prototype={preSolveVelocity:function(t){},warmStart:function(t){},solveVelocity:function(){},postSolveVelocity:function(t){},preSolvePosition:function(t){},solvePositionSplitImpulse:function(){},solvePositionNgs:function(t){},postSolve:function(){}};var ut=function(){},yt=function(t){this._solver=new si(this),this._manifold=t};yt.prototype={_getVelocitySolverInfo:function(t,i){var a,o,n,s,r,e,_,h,l;i.b1=this._b1,i.b2=this._b2,a=this._manifold._normalX,o=this._manifold._normalY,n=this._manifold._normalZ,s=this._manifold._tangentX,r=this._manifold._tangentY,e=this._manifold._tangentZ,_=this._manifold._binormalX,h=this._manifold._binormalY,l=this._manifold._binormalZ;var c=Math.sqrt(this._s1._friction*this._s2._friction),p=Math.sqrt(this._s1._restitution*this._s2._restitution),v=this._manifold._numPoints;i.numRows=0,this._tf1._positionX,this._tf2._positionX,this._tf1._positionY,this._tf2._positionY,this._tf1._positionZ,this._tf2._positionZ;for(var m=0,b=v;m<b;){var f=m++,x=this._manifold._points[f];if(x._depth<0){x._disabled=!0;var u=x._impulse;u.impulseN=0,u.impulseT=0,u.impulseB=0,u.impulseP=0,u.impulseLX=0,u.impulseLY=0,u.impulseLZ=0}else{x._disabled=!1;var y=i.rows[i.numRows++];y.friction=c,y.cfm=0;var g=y.jacobianN;g.lin1X=a,g.lin1Y=o,g.lin1Z=n,g.lin2X=a,g.lin2Y=o,g.lin2Z=n,g.ang1X=x._relPos1Y*n-x._relPos1Z*o,g.ang1Y=x._relPos1Z*a-x._relPos1X*n,g.ang1Z=x._relPos1X*o-x._relPos1Y*a,g.ang2X=x._relPos2Y*n-x._relPos2Z*o,g.ang2Y=x._relPos2Z*a-x._relPos2X*n,g.ang2Z=x._relPos2X*o-x._relPos2Y*a,(g=y.jacobianT).lin1X=s,g.lin1Y=r,g.lin1Z=e,g.lin2X=s,g.lin2Y=r,g.lin2Z=e,g.ang1X=x._relPos1Y*e-x._relPos1Z*r,g.ang1Y=x._relPos1Z*s-x._relPos1X*e,g.ang1Z=x._relPos1X*r-x._relPos1Y*s,g.ang2X=x._relPos2Y*e-x._relPos2Z*r,g.ang2Y=x._relPos2Z*s-x._relPos2X*e,g.ang2Z=x._relPos2X*r-x._relPos2Y*s,(g=y.jacobianB).lin1X=_,g.lin1Y=h,g.lin1Z=l,g.lin2X=_,g.lin2Y=h,g.lin2Z=l,g.ang1X=x._relPos1Y*l-x._relPos1Z*h,g.ang1Y=x._relPos1Z*_-x._relPos1X*l,g.ang1Z=x._relPos1X*h-x._relPos1Y*_,g.ang2X=x._relPos2Y*l-x._relPos2Z*h,g.ang2Y=x._relPos2Z*_-x._relPos2X*l,g.ang2Z=x._relPos2X*h-x._relPos2Y*_;var X=(g=y.jacobianN).lin1X*this._b1._velX+g.lin1Y*this._b1._velY+g.lin1Z*this._b1._velZ+(g.ang1X*this._b1._angVelX+g.ang1Y*this._b1._angVelY+g.ang1Z*this._b1._angVelZ)-(g.lin2X*this._b2._velX+g.lin2Y*this._b2._velY+g.lin2Z*this._b2._velZ+(g.ang2X*this._b2._angVelX+g.ang2Y*this._b2._angVelY+g.ang2Z*this._b2._angVelZ));if(X<-W.contactEnableBounceThreshold&&!x._warmStarted?y.rhs=-X*p:y.rhs=0,this._positionCorrectionAlgorithm==ut.BAUMGARTE&&x._depth>W.linearSlop){var z=(x._depth-W.linearSlop)*W.velocityBaumgarte*t.invDt;y.rhs<z&&(y.rhs=z)}if(!x._warmStarted){var M=x._impulse;M.impulseN=0,M.impulseT=0,M.impulseB=0,M.impulseP=0,M.impulseLX=0,M.impulseLY=0,M.impulseLZ=0}y.impulse=x._impulse}}},_getPositionSolverInfo:function(t){var i,a,o;t.b1=this._b1,t.b2=this._b2,i=this._manifold._normalX,a=this._manifold._normalY,o=this._manifold._normalZ;var n=this._manifold._numPoints;t.numRows=0;for(var s=0,r=n;s<r;){var e=s++,_=this._manifold._points[e];if(!_._disabled){var h=t.rows[t.numRows++],l=h.jacobianN;l.lin1X=i,l.lin1Y=a,l.lin1Z=o,l.lin2X=i,l.lin2Y=a,l.lin2Z=o,l.ang1X=_._relPos1Y*o-_._relPos1Z*a,l.ang1Y=_._relPos1Z*i-_._relPos1X*o,l.ang1Z=_._relPos1X*a-_._relPos1Y*i,l.ang2X=_._relPos2Y*o-_._relPos2Z*a,l.ang2Y=_._relPos2Z*i-_._relPos2X*o,l.ang2Z=_._relPos2X*a-_._relPos2Y*i,h.rhs=_._depth-W.linearSlop,h.rhs<0&&(h.rhs=0),h.impulse=_._impulse}}},_syncManifold:function(){this._manifold._updateDepthsAndPositions(this._tf1,this._tf2)},getShape1:function(){return this._s1},getShape2:function(){return this._s2},getManifold:function(){return this._manifold},isTouching:function(){for(var t=0,i=this._manifold._numPoints;t<i;){var a=t++;if(this._manifold._points[a]._depth>=0)return!0}return!1}};var gt=function(){this.impulseN=0,this.impulseT=0,this.impulseB=0,this.impulseP=0,this.impulseLX=0,this.impulseLY=0,this.impulseLZ=0};gt.prototype={copyFrom:function(t){this.impulseN=t.impulseN,this.impulseT=t.impulseT,this.impulseB=t.impulseB,this.impulseLX=t.impulseLX,this.impulseLY=t.impulseLY,this.impulseLZ=t.impulseLZ}};var Xt=function(){this._normalX=0,this._normalY=0,this._normalZ=0,this._tangentX=0,this._tangentY=0,this._tangentZ=0,this._binormalX=0,this._binormalY=0,this._binormalZ=0,this._numPoints=0;var t=W.maxManifoldPoints,i=new Array(t);this._points=i;for(var a=0,o=W.maxManifoldPoints;a<o;){var n=a++;this._points[n]=new zt}};Xt.prototype={_clear:function(){for(var t=0,i=this._numPoints;t<i;){var a=t++,o=this._points[a];o._localPos1X=0,o._localPos1Y=0,o._localPos1Z=0,o._localPos2X=0,o._localPos2Y=0,o._localPos2Z=0,o._relPos1X=0,o._relPos1Y=0,o._relPos1Z=0,o._relPos2X=0,o._relPos2Y=0,o._relPos2Z=0,o._pos1X=0,o._pos1Y=0,o._pos1Z=0,o._pos2X=0,o._pos2Y=0,o._pos2Z=0,o._depth=0;var n=o._impulse;n.impulseN=0,n.impulseT=0,n.impulseB=0,n.impulseP=0,n.impulseLX=0,n.impulseLY=0,n.impulseLZ=0,o._warmStarted=!1,o._disabled=!1,o._id=-1}this._numPoints=0},_buildBasis:function(t){var i=t;this._normalX=i.x,this._normalY=i.y,this._normalZ=i.z;var a,o,n,s,r,e,_=t.x,h=t.y,l=t.z,c=_*_,p=h*h,v=l*l;if(c<p)if(c<v){var m=1/Math.sqrt(p+v);a=0,s=h*(n=h*m)-l*(o=-l*m),r=-_*n,e=_*o}else{var b=1/Math.sqrt(c+p);n=0,s=-l*(o=_*b),r=l*(a=-h*b),e=_*o-h*a}else if(p<v){var f=1/Math.sqrt(c+v);o=0,s=h*(n=-_*f),r=l*(a=l*f)-_*n,e=-h*a}else{var x=1/Math.sqrt(c+p);n=0,s=-l*(o=_*x),r=l*(a=-h*x),e=_*o-h*a}this._tangentX=a,this._tangentY=o,this._tangentZ=n,this._binormalX=s,this._binormalY=r,this._binormalZ=e},_updateDepthsAndPositions:function(t,i){for(var a=0,o=this._numPoints;a<o;){var n,s,r,e,_,h,l,c,p,v=a++,m=this._points[v];n=t._rotation00*m._localPos1X+t._rotation01*m._localPos1Y+t._rotation02*m._localPos1Z,s=t._rotation10*m._localPos1X+t._rotation11*m._localPos1Y+t._rotation12*m._localPos1Z,r=t._rotation20*m._localPos1X+t._rotation21*m._localPos1Y+t._rotation22*m._localPos1Z,m._relPos1X=n,m._relPos1Y=s,m._relPos1Z=r,e=i._rotation00*m._localPos2X+i._rotation01*m._localPos2Y+i._rotation02*m._localPos2Z,_=i._rotation10*m._localPos2X+i._rotation11*m._localPos2Y+i._rotation12*m._localPos2Z,h=i._rotation20*m._localPos2X+i._rotation21*m._localPos2Y+i._rotation22*m._localPos2Z,m._relPos2X=e,m._relPos2Y=_,m._relPos2Z=h,m._pos1X=m._relPos1X+t._positionX,m._pos1Y=m._relPos1Y+t._positionY,m._pos1Z=m._relPos1Z+t._positionZ,m._pos2X=m._relPos2X+i._positionX,m._pos2Y=m._relPos2Y+i._positionY,m._pos2Z=m._relPos2Z+i._positionZ,l=m._pos1X-m._pos2X,c=m._pos1Y-m._pos2Y,p=m._pos1Z-m._pos2Z;var b=l*this._normalX+c*this._normalY+p*this._normalZ;m._depth=-b}},getNormal:function(){var t=new F,i=t;return i.x=this._normalX,i.y=this._normalY,i.z=this._normalZ,t},getNormalTo:function(t){var i=t;i.x=this._normalX,i.y=this._normalY,i.z=this._normalZ},getTangent:function(){var t=new F,i=t;return i.x=this._tangentX,i.y=this._tangentY,i.z=this._tangentZ,t},getTangentTo:function(t){var i=t;i.x=this._tangentX,i.y=this._tangentY,i.z=this._tangentZ},getBinormal:function(){var t=new F,i=t;return i.x=this._binormalX,i.y=this._binormalY,i.z=this._binormalZ,t},getBinormalTo:function(t){var i=t;i.x=this._binormalX,i.y=this._binormalY,i.z=this._binormalZ},getPoints:function(){return this._points},getNumPoints:function(){return this._numPoints}};var zt=function(){this._localPos1X=0,this._localPos1Y=0,this._localPos1Z=0,this._localPos2X=0,this._localPos2Y=0,this._localPos2Z=0,this._relPos1X=0,this._relPos1Y=0,this._relPos1Z=0,this._relPos2X=0,this._relPos2Y=0,this._relPos2Z=0,this._pos1X=0,this._pos1Y=0,this._pos1Z=0,this._pos2X=0,this._pos2Y=0,this._pos2Z=0,this._depth=0,this._impulse=new gt,this._warmStarted=!1,this._disabled=!1,this._id=-1};zt.prototype={getPosition1:function(){var t=new F,i=t;return i.x=this._pos1X,i.y=this._pos1Y,i.z=this._pos1Z,t},getPosition1To:function(t){var i=t;i.x=this._pos1X,i.y=this._pos1Y,i.z=this._pos1Z},getPosition2:function(){var t=new F,i=t;return i.x=this._pos2X,i.y=this._pos2Y,i.z=this._pos2Z,t},getPosition2To:function(t){var i=t;i.x=this._pos2X,i.y=this._pos2Y,i.z=this._pos2Z},getDepth:function(){return this._depth},isWarmStarted:function(){return this._warmStarted},getNormalImpulse:function(){return this._impulse.impulseN},getTangentImpulse:function(){return this._impulse.impulseT},getBinormalImpulse:function(){return this._impulse.impulseB},isEnabled:function(){return!this._disabled}};var Mt=function(t){this._manifold=t,this.numOldPoints=0;var i=W.maxManifoldPoints,a=new Array(i);this.oldPoints=a;for(var o=0,n=W.maxManifoldPoints;o<n;){var s=o++;this.oldPoints[s]=new zt}};Mt.prototype={removeOutdatedPoints:function(){for(var t=this._manifold._numPoints;--t>=0;){var i,a,o,n=this._manifold._points[t];i=n._pos1X-n._pos2X,a=n._pos1Y-n._pos2Y,o=n._pos1Z-n._pos2Z;var s=this._manifold._normalX*i+this._manifold._normalY*a+this._manifold._normalZ*o;s>W.contactPersistenceThreshold?this.removeManifoldPoint(t):(i+=this._manifold._normalX*-s)*i+(a+=this._manifold._normalY*-s)*a+(o+=this._manifold._normalZ*-s)*o>W.contactPersistenceThreshold*W.contactPersistenceThreshold&&this.removeManifoldPoint(t)}},removeManifoldPoint:function(t){var i=--this._manifold._numPoints;if(t!=i){var a=this._manifold._points[t];this._manifold._points[t]=this._manifold._points[i],this._manifold._points[i]=a}var o=this._manifold._points[i];o._localPos1X=0,o._localPos1Y=0,o._localPos1Z=0,o._localPos2X=0,o._localPos2Y=0,o._localPos2Z=0,o._relPos1X=0,o._relPos1Y=0,o._relPos1Z=0,o._relPos2X=0,o._relPos2Y=0,o._relPos2Z=0,o._pos1X=0,o._pos1Y=0,o._pos1Z=0,o._pos2X=0,o._pos2Y=0,o._pos2Z=0,o._depth=0;var n=o._impulse;n.impulseN=0,n.impulseT=0,n.impulseB=0,n.impulseP=0,n.impulseLX=0,n.impulseLY=0,n.impulseLZ=0,o._warmStarted=!1,o._disabled=!1,o._id=-1},addManifoldPoint:function(t,i,a){var o=this._manifold._numPoints;if(o==W.maxManifoldPoints){var n=this.computeTargetIndex(t,i,a),s=this._manifold._points[n],r=t.position1;s._pos1X=r.x,s._pos1Y=r.y,s._pos1Z=r.z;var e,_,h,l,c,p,v=t.position2;s._pos2X=v.x,s._pos2Y=v.y,s._pos2Z=v.z,s._relPos1X=s._pos1X-i._positionX,s._relPos1Y=s._pos1Y-i._positionY,s._relPos1Z=s._pos1Z-i._positionZ,s._relPos2X=s._pos2X-a._positionX,s._relPos2Y=s._pos2Y-a._positionY,s._relPos2Z=s._pos2Z-a._positionZ,e=i._rotation00*s._relPos1X+i._rotation10*s._relPos1Y+i._rotation20*s._relPos1Z,_=i._rotation01*s._relPos1X+i._rotation11*s._relPos1Y+i._rotation21*s._relPos1Z,h=i._rotation02*s._relPos1X+i._rotation12*s._relPos1Y+i._rotation22*s._relPos1Z,s._localPos1X=e,s._localPos1Y=_,s._localPos1Z=h,l=a._rotation00*s._relPos2X+a._rotation10*s._relPos2Y+a._rotation20*s._relPos2Z,c=a._rotation01*s._relPos2X+a._rotation11*s._relPos2Y+a._rotation21*s._relPos2Z,p=a._rotation02*s._relPos2X+a._rotation12*s._relPos2Y+a._rotation22*s._relPos2Z,s._localPos2X=l,s._localPos2Y=c,s._localPos2Z=p,s._depth=t.depth;var m=s._impulse;return m.impulseN=0,m.impulseT=0,m.impulseB=0,m.impulseP=0,m.impulseLX=0,m.impulseLY=0,m.impulseLZ=0,s._id=t.id,s._warmStarted=!1,void(s._disabled=!1)}var b=this._manifold._points[o],f=t.position1;b._pos1X=f.x,b._pos1Y=f.y,b._pos1Z=f.z;var x,u,y,g,X,z,M=t.position2;b._pos2X=M.x,b._pos2Y=M.y,b._pos2Z=M.z,b._relPos1X=b._pos1X-i._positionX,b._relPos1Y=b._pos1Y-i._positionY,b._relPos1Z=b._pos1Z-i._positionZ,b._relPos2X=b._pos2X-a._positionX,b._relPos2Y=b._pos2Y-a._positionY,b._relPos2Z=b._pos2Z-a._positionZ,x=i._rotation00*b._relPos1X+i._rotation10*b._relPos1Y+i._rotation20*b._relPos1Z,u=i._rotation01*b._relPos1X+i._rotation11*b._relPos1Y+i._rotation21*b._relPos1Z,y=i._rotation02*b._relPos1X+i._rotation12*b._relPos1Y+i._rotation22*b._relPos1Z,b._localPos1X=x,b._localPos1Y=u,b._localPos1Z=y,g=a._rotation00*b._relPos2X+a._rotation10*b._relPos2Y+a._rotation20*b._relPos2Z,X=a._rotation01*b._relPos2X+a._rotation11*b._relPos2Y+a._rotation21*b._relPos2Z,z=a._rotation02*b._relPos2X+a._rotation12*b._relPos2Y+a._rotation22*b._relPos2Z,b._localPos2X=g,b._localPos2Y=X,b._localPos2Z=z,b._depth=t.depth;var Y=b._impulse;Y.impulseN=0,Y.impulseT=0,Y.impulseB=0,Y.impulseP=0,Y.impulseLX=0,Y.impulseLY=0,Y.impulseLZ=0,b._id=t.id,b._warmStarted=!1,b._disabled=!1,this._manifold._numPoints++},computeTargetIndex:function(t,i,a){var o,n,s,r=this._manifold._points[0],e=this._manifold._points[1],_=this._manifold._points[2],h=this._manifold._points[3],l=r._depth,c=0;e._depth>l&&(l=e._depth,c=1),_._depth>l&&(l=_._depth,c=2),h._depth>l&&(l=h._depth,c=3);var p=t.position1;o=p.x,n=p.y,s=p.z,o-=i._positionX,n-=i._positionY,s-=i._positionZ;var v,m,b,f,x,u,y,g,X,z,M,Y,Z,d,I,V,L,w,A,k,B,P,T,S,C,q,R,E,j,N,D,F,O,W,G,H,U,J,Q,$,K,tt,it,at,ot,nt,st,rt,et,_t,ht,lt,ct,pt,vt,mt,bt,ft,xt,ut,yt,gt,Xt,zt,Mt,Yt,Zt,dt,It,Vt,Lt,wt,At,kt,Bt,Pt,Tt,St,Ct,qt,Rt,Et,jt,Nt,Dt,Ft,Ot,Wt,Gt,Ht,Ut,Jt,Qt,$t,Kt,ti,ii,ai,oi,ni,si,ri,ei,_i,hi,li,ci,pi,vi=e._relPos1X,mi=e._relPos1Y,bi=e._relPos1Z,fi=_._relPos1X,xi=_._relPos1Y,ui=_._relPos1Z,yi=h._relPos1X,gi=h._relPos1Y,Xi=h._relPos1Z,zi=(A=(m=xi-mi)*(u=s-Xi)-(b=ui-bi)*(x=n-gi))*A+(k=b*(f=o-yi)-(v=fi-vi)*u)*k+(B=v*x-m*f)*B,Mi=(P=(g=gi-mi)*(Y=s-ui)-(X=Xi-bi)*(M=n-xi))*P+(T=X*(z=o-fi)-(y=yi-vi)*Y)*T+(S=y*M-g*z)*S,Yi=(C=(d=n-mi)*(w=Xi-ui)-(I=s-bi)*(L=gi-xi))*C+(q=I*(V=yi-fi)-(Z=o-vi)*w)*q+(R=Z*L-d*V)*R,Zi=zi>Mi?zi>Yi?zi:Yi:Mi>Yi?Mi:Yi,di=r._relPos1X,Ii=r._relPos1Y,Vi=r._relPos1Z,Li=_._relPos1X,wi=_._relPos1Y,Ai=_._relPos1Z,ki=h._relPos1X,Bi=h._relPos1Y,Pi=h._relPos1Z,Ti=(nt=(j=wi-Ii)*(O=s-Pi)-(N=Ai-Vi)*(F=n-Bi))*nt+(st=N*(D=o-ki)-(E=Li-di)*O)*st+(rt=E*F-j*D)*rt,Si=(et=(G=Bi-Ii)*(Q=s-Ai)-(H=Pi-Vi)*(J=n-wi))*et+(_t=H*(U=o-Li)-(W=ki-di)*Q)*_t+(ht=W*J-G*U)*ht,Ci=(lt=(K=n-Ii)*(ot=Pi-Ai)-(tt=s-Vi)*(at=Bi-wi))*lt+(ct=tt*(it=ki-Li)-($=o-di)*ot)*ct+(pt=$*at-K*it)*pt,qi=Ti>Si?Ti>Ci?Ti:Ci:Si>Ci?Si:Ci,Ri=r._relPos1X,Ei=r._relPos1Y,ji=r._relPos1Z,Ni=e._relPos1X,Di=e._relPos1Y,Fi=e._relPos1Z,Oi=h._relPos1X,Wi=h._relPos1Y,Gi=h._relPos1Z,Hi=(At=(mt=Di-Ei)*(ut=s-Gi)-(bt=Fi-ji)*(xt=n-Wi))*At+(kt=bt*(ft=o-Oi)-(vt=Ni-Ri)*ut)*kt+(Bt=vt*xt-mt*ft)*Bt,Ui=(Pt=(gt=Wi-Ei)*(Yt=s-Fi)-(Xt=Gi-ji)*(Mt=n-Di))*Pt+(Tt=Xt*(zt=o-Ni)-(yt=Oi-Ri)*Yt)*Tt+(St=yt*Mt-gt*zt)*St,Ji=(Ct=(dt=n-Ei)*(wt=Gi-Fi)-(It=s-ji)*(Lt=Wi-Di))*Ct+(qt=It*(Vt=Oi-Ni)-(Zt=o-Ri)*wt)*qt+(Rt=Zt*Lt-dt*Vt)*Rt,Qi=Hi>Ui?Hi>Ji?Hi:Ji:Ui>Ji?Ui:Ji,$i=r._relPos1X,Ki=r._relPos1Y,ta=r._relPos1Z,ia=e._relPos1X,aa=e._relPos1Y,oa=e._relPos1Z,na=_._relPos1X,sa=_._relPos1Y,ra=_._relPos1Z,ea=(ni=(jt=aa-Ki)*(Ot=s-ra)-(Nt=oa-ta)*(Ft=n-sa))*ni+(si=Nt*(Dt=o-na)-(Et=ia-$i)*Ot)*si+(ri=Et*Ft-jt*Dt)*ri,_a=(ei=(Gt=sa-Ki)*(Qt=s-oa)-(Ht=ra-ta)*(Jt=n-aa))*ei+(_i=Ht*(Ut=o-ia)-(Wt=na-$i)*Qt)*_i+(hi=Wt*Jt-Gt*Ut)*hi,ha=(li=(Kt=n-Ki)*(oi=ra-oa)-(ti=s-ta)*(ai=sa-aa))*li+(ci=ti*(ii=na-ia)-($t=o-$i)*oi)*ci+(pi=$t*ai-Kt*ii)*pi,la=ea>_a?ea>ha?ea:ha:_a>ha?_a:ha,ca=Zi,pa=0;return(qi>ca&&1!=c||0==c)&&(ca=qi,pa=1),Qi>ca&&2!=c&&(ca=Qi,pa=2),la>ca&&3!=c&&(ca=la,pa=3),pa},computeRelativePositions:function(t,i){for(var a=0,o=this._manifold._numPoints;a<o;){var n,s,r,e,_,h,l=a++,c=this._manifold._points[l];n=t._rotation00*c._localPos1X+t._rotation01*c._localPos1Y+t._rotation02*c._localPos1Z,s=t._rotation10*c._localPos1X+t._rotation11*c._localPos1Y+t._rotation12*c._localPos1Z,r=t._rotation20*c._localPos1X+t._rotation21*c._localPos1Y+t._rotation22*c._localPos1Z,c._relPos1X=n,c._relPos1Y=s,c._relPos1Z=r,e=i._rotation00*c._localPos2X+i._rotation01*c._localPos2Y+i._rotation02*c._localPos2Z,_=i._rotation10*c._localPos2X+i._rotation11*c._localPos2Y+i._rotation12*c._localPos2Z,h=i._rotation20*c._localPos2X+i._rotation21*c._localPos2Y+i._rotation22*c._localPos2Z,c._relPos2X=e,c._relPos2Y=_,c._relPos2Z=h,c._warmStarted=!0}},findNearestContactPointIndex:function(t,i,a){for(var o=W.contactPersistenceThreshold*W.contactPersistenceThreshold,n=-1,s=0,r=this._manifold._numPoints;s<r;){var e,_,h,l,c,p,v=s++,m=this._manifold._points[v],b=t.position1;e=b.x,_=b.y,h=b.z;var f,x,u,y,g,X,z=t.position2;l=z.x,c=z.y,p=z.z,e-=i._positionX,_-=i._positionY,h-=i._positionZ,l-=a._positionX,c-=a._positionY,p-=a._positionZ;var M=(f=m._relPos1X-e)*f+(x=m._relPos1Y-_)*x+(u=m._relPos1Z-h)*u,Y=(y=m._relPos2X-l)*y+(g=m._relPos2Y-c)*g+(X=m._relPos2Z-p)*X,Z=M<Y?M:Y;Z<o&&(o=Z,n=v)}return n},totalUpdate:function(t,i,a){this.numOldPoints=this._manifold._numPoints;for(var o=0,n=this.numOldPoints;o<n;){var s=o++,r=this.oldPoints[s],e=this._manifold._points[s];r._localPos1X=e._localPos1X,r._localPos1Y=e._localPos1Y,r._localPos1Z=e._localPos1Z,r._localPos2X=e._localPos2X,r._localPos2Y=e._localPos2Y,r._localPos2Z=e._localPos2Z,r._relPos1X=e._relPos1X,r._relPos1Y=e._relPos1Y,r._relPos1Z=e._relPos1Z,r._relPos2X=e._relPos2X,r._relPos2Y=e._relPos2Y,r._relPos2Z=e._relPos2Z,r._pos1X=e._pos1X,r._pos1Y=e._pos1Y,r._pos1Z=e._pos1Z,r._pos2X=e._pos2X,r._pos2Y=e._pos2Y,r._pos2Z=e._pos2Z,r._depth=e._depth,r._impulse.copyFrom(e._impulse),r._id=e._id,r._warmStarted=e._warmStarted,r._disabled=!1}var _=t.numPoints;this._manifold._numPoints=_;for(var h=0,l=_;h<l;){var c=h++,p=this._manifold._points[c],v=t.points[c],m=v.position1;p._pos1X=m.x,p._pos1Y=m.y,p._pos1Z=m.z;var b,f,x,u,y,g,X=v.position2;p._pos2X=X.x,p._pos2Y=X.y,p._pos2Z=X.z,p._relPos1X=p._pos1X-i._positionX,p._relPos1Y=p._pos1Y-i._positionY,p._relPos1Z=p._pos1Z-i._positionZ,p._relPos2X=p._pos2X-a._positionX,p._relPos2Y=p._pos2Y-a._positionY,p._relPos2Z=p._pos2Z-a._positionZ,b=i._rotation00*p._relPos1X+i._rotation10*p._relPos1Y+i._rotation20*p._relPos1Z,f=i._rotation01*p._relPos1X+i._rotation11*p._relPos1Y+i._rotation21*p._relPos1Z,x=i._rotation02*p._relPos1X+i._rotation12*p._relPos1Y+i._rotation22*p._relPos1Z,p._localPos1X=b,p._localPos1Y=f,p._localPos1Z=x,u=a._rotation00*p._relPos2X+a._rotation10*p._relPos2Y+a._rotation20*p._relPos2Z,y=a._rotation01*p._relPos2X+a._rotation11*p._relPos2Y+a._rotation21*p._relPos2Z,g=a._rotation02*p._relPos2X+a._rotation12*p._relPos2Y+a._rotation22*p._relPos2Z,p._localPos2X=u,p._localPos2Y=y,p._localPos2Z=g,p._depth=v.depth;var z=p._impulse;z.impulseN=0,z.impulseT=0,z.impulseB=0,z.impulseP=0,z.impulseLX=0,z.impulseLY=0,z.impulseLZ=0,p._id=v.id,p._warmStarted=!1,p._disabled=!1;for(var M=0,Y=this.numOldPoints;M<Y;){var Z=M++,d=this.oldPoints[Z];if(p._id==d._id){p._impulse.copyFrom(d._impulse),p._warmStarted=!0;break}}}},incrementalUpdate:function(t,i,a){this._manifold._updateDepthsAndPositions(i,a);for(var o=0,n=this._manifold._numPoints;o<n;){var s=o++;this._manifold._points[s]._warmStarted=!0}var r=t.points[0],e=this.findNearestContactPointIndex(r,i,a);if(-1==e)this.addManifoldPoint(r,i,a);else{var _=this._manifold._points[e],h=r.position1;_._pos1X=h.x,_._pos1Y=h.y,_._pos1Z=h.z;var l,c,p,v,m,b,f=r.position2;_._pos2X=f.x,_._pos2Y=f.y,_._pos2Z=f.z,_._relPos1X=_._pos1X-i._positionX,_._relPos1Y=_._pos1Y-i._positionY,_._relPos1Z=_._pos1Z-i._positionZ,_._relPos2X=_._pos2X-a._positionX,_._relPos2Y=_._pos2Y-a._positionY,_._relPos2Z=_._pos2Z-a._positionZ,l=i._rotation00*_._relPos1X+i._rotation10*_._relPos1Y+i._rotation20*_._relPos1Z,c=i._rotation01*_._relPos1X+i._rotation11*_._relPos1Y+i._rotation21*_._relPos1Z,p=i._rotation02*_._relPos1X+i._rotation12*_._relPos1Y+i._rotation22*_._relPos1Z,_._localPos1X=l,_._localPos1Y=c,_._localPos1Z=p,v=a._rotation00*_._relPos2X+a._rotation10*_._relPos2Y+a._rotation20*_._relPos2Z,m=a._rotation01*_._relPos2X+a._rotation11*_._relPos2Y+a._rotation21*_._relPos2Z,b=a._rotation02*_._relPos2X+a._rotation12*_._relPos2Y+a._rotation22*_._relPos2Z,_._localPos2X=v,_._localPos2Y=m,_._localPos2Z=b,_._depth=r.depth}this.removeOutdatedPoints()}};var Yt=function(){this.lin1X=0,this.lin1Y=0,this.lin1Z=0,this.lin2X=0,this.lin2Y=0,this.lin2Z=0,this.ang1X=0,this.ang1Y=0,this.ang1Z=0,this.ang2X=0,this.ang2Y=0,this.ang2Z=0,this.flag=0};Yt.prototype={updateSparsity:function(){this.flag=0,0==this.lin1X&&0==this.lin1Y&&0==this.lin1Z&&0==this.lin2X&&0==this.lin2Y&&0==this.lin2Z||(this.flag|=1),0==this.ang1X&&0==this.ang1Y&&0==this.ang1Z&&0==this.ang2X&&0==this.ang2Y&&0==this.ang2Z||(this.flag|=2)}};var Zt=function(){this.b1=null,this.b2=null,this.numRows=0;var t=W.maxManifoldPoints,i=new Array(t);this.rows=i;for(var a=0,o=this.rows.length;a<o;){var n=a++;this.rows[n]=new dt}},dt=function(){this.jacobianN=new Yt,this.jacobianT=new Yt,this.jacobianB=new Yt,this.rhs=0,this.cfm=0,this.friction=0,this.impulse=null},It=function(){this.b1=null,this.b2=null,this.numRows=0;var t=W.maxJacobianRows,i=new Array(t);this.rows=i;for(var a=0,o=this.rows.length;a<o;){var n=a++;this.rows[n]=new Vt}},Vt=function(){this.jacobian=new Yt,this.rhs=0,this.cfm=0,this.minImpulse=0,this.maxImpulse=0,this.motorSpeed=0,this.motorMaxImpulse=0,this.impulse=null},Lt=function(t,i){switch(this._link1=new Tt(this),this._link2=new Tt(this),this._positionCorrectionAlgorithm=W.defaultJointPositionCorrectionAlgorithm,this._type=i,this._world=null,this._b1=t.rigidBody1,this._b2=t.rigidBody2,this._allowCollision=t.allowCollision,this._breakForce=t.breakForce,this._breakTorque=t.breakTorque,t.solverType){case 0:this._solver=new ri(this);break;case 1:this._solver=new oi(this)}var a=t.localAnchor1;this._localAnchor1X=a.x,this._localAnchor1Y=a.y,this._localAnchor1Z=a.z;var o=t.localAnchor2;this._localAnchor2X=o.x,this._localAnchor2Y=o.y,this._localAnchor2Z=o.z,this._relativeAnchor1X=0,this._relativeAnchor1Y=0,this._relativeAnchor1Z=0,this._relativeAnchor2X=0,this._relativeAnchor2Y=0,this._relativeAnchor2Z=0,this._anchor1X=0,this._anchor1Y=0,this._anchor1Z=0,this._anchor2X=0,this._anchor2Y=0,this._anchor2Z=0,this._localBasisX1X=0,this._localBasisX1Y=0,this._localBasisX1Z=0,this._localBasisY1X=0,this._localBasisY1Y=0,this._localBasisY1Z=0,this._localBasisZ1X=0,this._localBasisZ1Y=0,this._localBasisZ1Z=0,this._localBasisX2X=0,this._localBasisX2Y=0,this._localBasisX2Z=0,this._localBasisY2X=0,this._localBasisY2Y=0,this._localBasisY2Z=0,this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=0;var n=W.maxJacobianRows,s=new Array(n);this._impulses=s;for(var r=0,e=W.maxJacobianRows;r<e;){var _=r++;this._impulses[_]=new Pt}};Lt.prototype={_syncAnchors:function(){var t,i,a,o,n,s,r,e,_,h,l,c,p,v,m,b,f,x,u,y,g,X,z,M,Y=this._b1._transform,Z=this._b2._transform;t=Y._rotation00*this._localAnchor1X+Y._rotation01*this._localAnchor1Y+Y._rotation02*this._localAnchor1Z,i=Y._rotation10*this._localAnchor1X+Y._rotation11*this._localAnchor1Y+Y._rotation12*this._localAnchor1Z,a=Y._rotation20*this._localAnchor1X+Y._rotation21*this._localAnchor1Y+Y._rotation22*this._localAnchor1Z,this._relativeAnchor1X=t,this._relativeAnchor1Y=i,this._relativeAnchor1Z=a,o=Z._rotation00*this._localAnchor2X+Z._rotation01*this._localAnchor2Y+Z._rotation02*this._localAnchor2Z,n=Z._rotation10*this._localAnchor2X+Z._rotation11*this._localAnchor2Y+Z._rotation12*this._localAnchor2Z,s=Z._rotation20*this._localAnchor2X+Z._rotation21*this._localAnchor2Y+Z._rotation22*this._localAnchor2Z,this._relativeAnchor2X=o,this._relativeAnchor2Y=n,this._relativeAnchor2Z=s,this._anchor1X=this._relativeAnchor1X+Y._positionX,this._anchor1Y=this._relativeAnchor1Y+Y._positionY,this._anchor1Z=this._relativeAnchor1Z+Y._positionZ,this._anchor2X=this._relativeAnchor2X+Z._positionX,this._anchor2Y=this._relativeAnchor2Y+Z._positionY,this._anchor2Z=this._relativeAnchor2Z+Z._positionZ,r=Y._rotation00*this._localBasisX1X+Y._rotation01*this._localBasisX1Y+Y._rotation02*this._localBasisX1Z,e=Y._rotation10*this._localBasisX1X+Y._rotation11*this._localBasisX1Y+Y._rotation12*this._localBasisX1Z,_=Y._rotation20*this._localBasisX1X+Y._rotation21*this._localBasisX1Y+Y._rotation22*this._localBasisX1Z,this._basisX1X=r,this._basisX1Y=e,this._basisX1Z=_,h=Y._rotation00*this._localBasisY1X+Y._rotation01*this._localBasisY1Y+Y._rotation02*this._localBasisY1Z,l=Y._rotation10*this._localBasisY1X+Y._rotation11*this._localBasisY1Y+Y._rotation12*this._localBasisY1Z,c=Y._rotation20*this._localBasisY1X+Y._rotation21*this._localBasisY1Y+Y._rotation22*this._localBasisY1Z,this._basisY1X=h,this._basisY1Y=l,this._basisY1Z=c,p=Y._rotation00*this._localBasisZ1X+Y._rotation01*this._localBasisZ1Y+Y._rotation02*this._localBasisZ1Z,v=Y._rotation10*this._localBasisZ1X+Y._rotation11*this._localBasisZ1Y+Y._rotation12*this._localBasisZ1Z,m=Y._rotation20*this._localBasisZ1X+Y._rotation21*this._localBasisZ1Y+Y._rotation22*this._localBasisZ1Z,this._basisZ1X=p,this._basisZ1Y=v,this._basisZ1Z=m,b=Z._rotation00*this._localBasisX2X+Z._rotation01*this._localBasisX2Y+Z._rotation02*this._localBasisX2Z,f=Z._rotation10*this._localBasisX2X+Z._rotation11*this._localBasisX2Y+Z._rotation12*this._localBasisX2Z,x=Z._rotation20*this._localBasisX2X+Z._rotation21*this._localBasisX2Y+Z._rotation22*this._localBasisX2Z,this._basisX2X=b,this._basisX2Y=f,this._basisX2Z=x,u=Z._rotation00*this._localBasisY2X+Z._rotation01*this._localBasisY2Y+Z._rotation02*this._localBasisY2Z,y=Z._rotation10*this._localBasisY2X+Z._rotation11*this._localBasisY2Y+Z._rotation12*this._localBasisY2Z,g=Z._rotation20*this._localBasisY2X+Z._rotation21*this._localBasisY2Y+Z._rotation22*this._localBasisY2Z,this._basisY2X=u,this._basisY2Y=y,this._basisY2Z=g,X=Z._rotation00*this._localBasisZ2X+Z._rotation01*this._localBasisZ2Y+Z._rotation02*this._localBasisZ2Z,z=Z._rotation10*this._localBasisZ2X+Z._rotation11*this._localBasisZ2Y+Z._rotation12*this._localBasisZ2Z,M=Z._rotation20*this._localBasisZ2X+Z._rotation21*this._localBasisZ2Y+Z._rotation22*this._localBasisZ2Z,this._basisZ2X=X,this._basisZ2Y=z,this._basisZ2Z=M},_getVelocitySolverInfo:function(t,i){i.b1=this._b1,i.b2=this._b2,i.numRows=0},_getPositionSolverInfo:function(t){t.b1=this._b1,t.b2=this._b2,t.numRows=0},_checkDestruction:function(){var t=this._appliedForceX*this._appliedForceX+this._appliedForceY*this._appliedForceY+this._appliedForceZ*this._appliedForceZ,i=this._appliedTorqueX*this._appliedTorqueX+this._appliedTorqueY*this._appliedTorqueY+this._appliedTorqueZ*this._appliedTorqueZ;this._breakForce>0&&t>this._breakForce*this._breakForce?this._world.removeJoint(this):this._breakTorque>0&&i>this._breakTorque*this._breakTorque&&this._world.removeJoint(this)},getRigidBody1:function(){return this._b1},getRigidBody2:function(){return this._b2},getType:function(){return this._type},getAnchor1:function(){var t=new F,i=t;return i.x=this._anchor1X,i.y=this._anchor1Y,i.z=this._anchor1Z,t},getAnchor2:function(){var t=new F,i=t;return i.x=this._anchor2X,i.y=this._anchor2Y,i.z=this._anchor2Z,t},getAnchor1To:function(t){var i=t;i.x=this._anchor1X,i.y=this._anchor1Y,i.z=this._anchor1Z},getAnchor2To:function(t){var i=t;i.x=this._anchor2X,i.y=this._anchor2Y,i.z=this._anchor2Z},getLocalAnchor1:function(){var t=new F,i=t;return i.x=this._localAnchor1X,i.y=this._localAnchor1Y,i.z=this._localAnchor1Z,t},getLocalAnchor2:function(){var t=new F,i=t;return i.x=this._localAnchor2X,i.y=this._localAnchor2Y,i.z=this._localAnchor2Z,t},getLocalAnchor1To:function(t){var i=t;i.x=this._localAnchor1X,i.y=this._localAnchor1Y,i.z=this._localAnchor1Z},getLocalAnchor2To:function(t){var i=t;i.x=this._localAnchor2X,i.y=this._localAnchor2Y,i.z=this._localAnchor2Z},getBasis1:function(){var t,i,a,o,n,s,r,e,_,h=new J;t=this._basisX1X,i=this._basisY1X,a=this._basisZ1X,o=this._basisX1Y,n=this._basisY1Y,s=this._basisZ1Y,r=this._basisX1Z,e=this._basisY1Z,_=this._basisZ1Z;var l=h;return l.e00=t,l.e01=i,l.e02=a,l.e10=o,l.e11=n,l.e12=s,l.e20=r,l.e21=e,l.e22=_,h},getBasis2:function(){var t,i,a,o,n,s,r,e,_,h=new J;t=this._basisX2X,i=this._basisY2X,a=this._basisZ2X,o=this._basisX2Y,n=this._basisY2Y,s=this._basisZ2Y,r=this._basisX2Z,e=this._basisY2Z,_=this._basisZ2Z;var l=h;return l.e00=t,l.e01=i,l.e02=a,l.e10=o,l.e11=n,l.e12=s,l.e20=r,l.e21=e,l.e22=_,h},getBasis1To:function(t){var i,a,o,n,s,r,e,_,h;i=this._basisX1X,a=this._basisY1X,o=this._basisZ1X,n=this._basisX1Y,s=this._basisY1Y,r=this._basisZ1Y,e=this._basisX1Z,_=this._basisY1Z,h=this._basisZ1Z;var l=t;l.e00=i,l.e01=a,l.e02=o,l.e10=n,l.e11=s,l.e12=r,l.e20=e,l.e21=_,l.e22=h},getBasis2To:function(t){var i,a,o,n,s,r,e,_,h;i=this._basisX2X,a=this._basisY2X,o=this._basisZ2X,n=this._basisX2Y,s=this._basisY2Y,r=this._basisZ2Y,e=this._basisX2Z,_=this._basisY2Z,h=this._basisZ2Z;var l=t;l.e00=i,l.e01=a,l.e02=o,l.e10=n,l.e11=s,l.e12=r,l.e20=e,l.e21=_,l.e22=h},getAllowCollision:function(){return this._allowCollision},setAllowCollision:function(t){this._allowCollision=t},getBreakForce:function(){return this._breakForce},setBreakForce:function(t){this._breakForce=t},getBreakTorque:function(){return this._breakTorque},setBreakTorque:function(t){this._breakTorque=t},getPositionCorrectionAlgorithm:function(){return this._positionCorrectionAlgorithm},setPositionCorrectionAlgorithm:function(t){switch(t){case 0:case 1:case 2:break;default:throw new Error("invalid position correction algorithm id: "+t)}this._positionCorrectionAlgorithm=t},getAppliedForce:function(){var t=new F,i=t;return i.x=this._appliedForceX,i.y=this._appliedForceY,i.z=this._appliedForceZ,t},getAppliedForceTo:function(t){var i=t;i.x=this._appliedForceX,i.y=this._appliedForceY,i.z=this._appliedForceZ},getAppliedTorque:function(){var t=new F,i=t;return i.x=this._appliedTorqueX,i.y=this._appliedTorqueY,i.z=this._appliedTorqueZ,t},getAppliedTorqueTo:function(t){var i=t;i.x=this._appliedTorqueX,i.y=this._appliedTorqueY,i.z=this._appliedTorqueZ},getPrev:function(){return this._prev},getNext:function(){return this._next}};var wt=function(t){Lt.call(this,t,2);var i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;var a,o,n,s,r,e,_,h,l,c,p,v,m,b=t.localAxis2;if(this._localBasisX2X=b.x,this._localBasisX2Y=b.y,this._localBasisX2Z=b.z,this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var f=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;f>0&&(f=1/Math.sqrt(f)),this._localBasisX1X*=f,this._localBasisX1Y*=f,this._localBasisX1Z*=f}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{var x=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;x>0&&(x=1/Math.sqrt(x)),this._localBasisX2X*=x,this._localBasisX2Y*=x,this._localBasisX2Z*=x}var u=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(u<-.999999999){var y,g,X,z,M=this._localBasisX1X,Y=this._localBasisX1Y,Z=this._localBasisX1Z,d=M*M,I=Y*Y,V=Z*Z;d<I?d<V?(y=0,g=Z*(z=1/Math.sqrt(I+V)),X=-Y*z):(y=Y*(z=1/Math.sqrt(d+I)),g=-M*z,X=0):I<V?(y=-Z*(z=1/Math.sqrt(V+d)),g=0,X=M*z):(y=Y*(z=1/Math.sqrt(d+I)),g=-M*z,X=0),a=y,o=g,n=X,s=0}else{var L,w,A;L=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,w=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,A=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;var k=Math.sqrt(.5*(1+u));a=L*=u=.5/k,o=w*=u,n=A*=u,s=k}var B=2*a,P=2*o,T=2*n,S=a*B,C=o*P,q=n*T,R=a*P,E=o*T,j=a*T,N=s*B,D=s*P,F=s*T;r=1-C-q,e=R-F,_=j+D,h=R+F,l=1-S-q,c=E-N,p=j-D,v=E+N,m=1-S-C;var O,W,G,H,U,J,Q,$,K,tt,it=this._localBasisX1X,at=this._localBasisX1Y,ot=this._localBasisX1Z,nt=it*it,st=at*at,rt=ot*ot;nt<st?nt<rt?(O=1/Math.sqrt(st+rt),this._localBasisY1X=0,this._localBasisY1Y=ot*O,this._localBasisY1Z=-at*O):(O=1/Math.sqrt(nt+st),this._localBasisY1X=at*O,this._localBasisY1Y=-it*O,this._localBasisY1Z=0):st<rt?(O=1/Math.sqrt(rt+nt),this._localBasisY1X=-ot*O,this._localBasisY1Y=0,this._localBasisY1Z=it*O):(O=1/Math.sqrt(nt+st),this._localBasisY1X=at*O,this._localBasisY1Y=-it*O,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,W=r*this._localBasisX1X+e*this._localBasisX1Y+_*this._localBasisX1Z,G=h*this._localBasisX1X+l*this._localBasisX1Y+c*this._localBasisX1Z,H=p*this._localBasisX1X+v*this._localBasisX1Y+m*this._localBasisX1Z,this._localBasisX2X=W,this._localBasisX2Y=G,this._localBasisX2Z=H,U=r*this._localBasisY1X+e*this._localBasisY1Y+_*this._localBasisY1Z,J=h*this._localBasisY1X+l*this._localBasisY1Y+c*this._localBasisY1Z,Q=p*this._localBasisY1X+v*this._localBasisY1Y+m*this._localBasisY1Z,this._localBasisY2X=U,this._localBasisY2Y=J,this._localBasisY2Z=Q,$=r*this._localBasisZ1X+e*this._localBasisZ1Y+_*this._localBasisZ1Z,K=h*this._localBasisZ1X+l*this._localBasisZ1Y+c*this._localBasisZ1Z,tt=p*this._localBasisZ1X+v*this._localBasisZ1Y+m*this._localBasisZ1Z,this._localBasisZ2X=$,this._localBasisZ2Y=K,this._localBasisZ2Z=tt,this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this._basis=new Bt(this),this._translSd=t.translationalSpringDamper.clone(),this._translLm=t.translationalLimitMotor.clone(),this._rotSd=t.rotationalSpringDamper.clone(),this._rotLm=t.rotationalLimitMotor.clone()};wt.__super__=Lt,wt.prototype=$extend(Lt.prototype,{getInfo:function(t,i,a){var o,n,s,r,e,_,h,l,c,p,v,m,b,f,x,u,y,g,X,z,M=a?1:this._positionCorrectionAlgorithm==ut.BAUMGARTE?i.invDt*W.velocityBaumgarte:0,Y=this.linearErrorY*M,Z=this.linearErrorZ*M,d=this.angularErrorY*M,I=this.angularErrorZ*M;o=-(o=0),n=-(n=-this._relativeAnchor1Z),s=-(s=this._relativeAnchor1Y),r=-(r=this._relativeAnchor1Z),e=-(e=0),_=-(_=-this._relativeAnchor1X),h=-(h=-this._relativeAnchor1Y),l=-(l=this._relativeAnchor1X),c=-(c=0),p=-(p=0),v=-(v=-this._relativeAnchor2Z),m=-(m=this._relativeAnchor2Y),b=-(b=this._relativeAnchor2Z),f=-(f=0),x=-(x=-this._relativeAnchor2X),u=-(u=-this._relativeAnchor2Y),y=-(y=this._relativeAnchor2X),g=-(g=0);var V=1/(this._b1._invMass+this._b2._invMass),L=this._basis.xX,w=this._basis.xY,A=this._basis.xZ,k=(this._b1._invInertia00*L+this._b1._invInertia01*w+this._b1._invInertia02*A)*L+(this._b1._invInertia10*L+this._b1._invInertia11*w+this._b1._invInertia12*A)*w+(this._b1._invInertia20*L+this._b1._invInertia21*w+this._b1._invInertia22*A)*A,B=(this._b2._invInertia00*L+this._b2._invInertia01*w+this._b2._invInertia02*A)*L+(this._b2._invInertia10*L+this._b2._invInertia11*w+this._b2._invInertia12*A)*w+(this._b2._invInertia20*L+this._b2._invInertia21*w+this._b2._invInertia22*A)*A;if(k>0){var P=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,T=L*this._relativeAnchor1X+w*this._relativeAnchor1Y+A*this._relativeAnchor1Z,S=P-T*T;S>0&&(k=this._b1._invMass>0?1/(1/k+this._b1._mass*S):0)}if(B>0){var C=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,q=L*this._relativeAnchor2X+w*this._relativeAnchor2Y+A*this._relativeAnchor2Z,R=C-q*q;R>0&&(B=this._b2._invMass>0?1/(1/B+this._b2._mass*R):0)}var E=k+B==0?0:1/(k+B);if(this._translSd.frequency<=0||!a){var j=this._impulses[0],N=t.rows[t.numRows++],D=N.jacobian;D.lin1X=0,D.lin1Y=0,D.lin1Z=0,D.lin2X=0,D.lin2Y=0,D.lin2Z=0,D.ang1X=0,D.ang1Y=0,D.ang1Z=0,D.ang2X=0,D.ang2Y=0,D.ang2Z=0,N.rhs=0,N.cfm=0,N.minImpulse=0,N.maxImpulse=0,N.motorSpeed=0,N.motorMaxImpulse=0,N.impulse=null,N.impulse=j,X=N;var F,O,G=this.translation,H=this._translLm,U=this._translSd,J=W.linearSlop;if(a)F=0,O=1;else{if(U.frequency>0){J=0;var Q=6.28318530717958*U.frequency,$=U.dampingRatio;$<W.minSpringDamperDampingRatio&&($=W.minSpringDamperDampingRatio);var K=i.dt,tt=2*$*Q,it=Q*Q;U.useSymplecticEuler?(F=1/(K*tt),O=it/tt):(F=1/(K*(K*it+tt)),O=it/(K*it+tt))}else F=0,O=this._positionCorrectionAlgorithm==ut.BAUMGARTE?i.invDt*W.velocityBaumgarte:0;H.motorForce>0?(X.motorSpeed=H.motorSpeed,X.motorMaxImpulse=H.motorForce*i.dt):(X.motorSpeed=0,X.motorMaxImpulse=0)}var at,ot,nt,st=H.lowerLimit,rt=H.upperLimit;st>rt?(at=0,ot=0,nt=0):st==rt?(at=-1/0,ot=1/0,nt=G-st):G<st?(at=-1/0,ot=0,(nt=G-st+J)>0&&(nt=0)):G>rt?(at=0,ot=1/0,(nt=G-rt-J)<0&&(nt=0)):(at=0,ot=0,nt=0);var et=0==V?0:1/V;X.minImpulse=at,X.maxImpulse=ot,X.cfm=F*et,X.rhs=nt*O,(z=X.jacobian).lin1X=this._basis.xX,z.lin1Y=this._basis.xY,z.lin1Z=this._basis.xZ,z.lin2X=this._basis.xX,z.lin2Y=this._basis.xY,z.lin2Z=this._basis.xZ,z.ang1X=o,z.ang1Y=n,z.ang1Z=s,z.ang2X=p,z.ang2Y=v,z.ang2Z=m}var _t=this._impulses[1],ht=t.rows[t.numRows++],lt=ht.jacobian;lt.lin1X=0,lt.lin1Y=0,lt.lin1Z=0,lt.lin2X=0,lt.lin2Y=0,lt.lin2Z=0,lt.ang1X=0,lt.ang1Y=0,lt.ang1Z=0,lt.ang2X=0,lt.ang2Y=0,lt.ang2Z=0,ht.rhs=0,ht.cfm=0,ht.minImpulse=0,ht.maxImpulse=0,ht.motorSpeed=0,ht.motorMaxImpulse=0,ht.impulse=null,ht.impulse=_t,(X=ht).rhs=Y,X.cfm=0,X.minImpulse=-1/0,X.maxImpulse=1/0,(z=X.jacobian).lin1X=this._basis.yX,z.lin1Y=this._basis.yY,z.lin1Z=this._basis.yZ,z.lin2X=this._basis.yX,z.lin2Y=this._basis.yY,z.lin2Z=this._basis.yZ,z.ang1X=r,z.ang1Y=e,z.ang1Z=_,z.ang2X=b,z.ang2Y=f,z.ang2Z=x;var ct=this._impulses[2],pt=t.rows[t.numRows++],vt=pt.jacobian;if(vt.lin1X=0,vt.lin1Y=0,vt.lin1Z=0,vt.lin2X=0,vt.lin2Y=0,vt.lin2Z=0,vt.ang1X=0,vt.ang1Y=0,vt.ang1Z=0,vt.ang2X=0,vt.ang2Y=0,vt.ang2Z=0,pt.rhs=0,pt.cfm=0,pt.minImpulse=0,pt.maxImpulse=0,pt.motorSpeed=0,pt.motorMaxImpulse=0,pt.impulse=null,pt.impulse=ct,(X=pt).rhs=Z,X.cfm=0,X.minImpulse=-1/0,X.maxImpulse=1/0,(z=X.jacobian).lin1X=this._basis.zX,z.lin1Y=this._basis.zY,z.lin1Z=this._basis.zZ,z.lin2X=this._basis.zX,z.lin2Y=this._basis.zY,z.lin2Z=this._basis.zZ,z.ang1X=h,z.ang1Y=l,z.ang1Z=c,z.ang2X=u,z.ang2Y=y,z.ang2Z=g,this._rotSd.frequency<=0||!a){var mt=this._impulses[3],bt=t.rows[t.numRows++],ft=bt.jacobian;ft.lin1X=0,ft.lin1Y=0,ft.lin1Z=0,ft.lin2X=0,ft.lin2Y=0,ft.lin2Z=0,ft.ang1X=0,ft.ang1Y=0,ft.ang1Z=0,ft.ang2X=0,ft.ang2Y=0,ft.ang2Z=0,bt.rhs=0,bt.cfm=0,bt.minImpulse=0,bt.maxImpulse=0,bt.motorSpeed=0,bt.motorMaxImpulse=0,bt.impulse=null,bt.impulse=mt,X=bt;var xt,yt,gt=this.angle,Xt=this._rotLm,zt=this._rotSd,Mt=W.angularSlop;if(a)xt=0,yt=1;else{if(zt.frequency>0){Mt=0;var Yt=6.28318530717958*zt.frequency,Zt=zt.dampingRatio;Zt<W.minSpringDamperDampingRatio&&(Zt=W.minSpringDamperDampingRatio);var dt=i.dt,It=2*Zt*Yt,Vt=Yt*Yt;zt.useSymplecticEuler?(xt=1/(dt*It),yt=Vt/It):(xt=1/(dt*(dt*Vt+It)),yt=Vt/(dt*Vt+It))}else xt=0,yt=this._positionCorrectionAlgorithm==ut.BAUMGARTE?i.invDt*W.velocityBaumgarte:0;Xt.motorTorque>0?(X.motorSpeed=Xt.motorSpeed,X.motorMaxImpulse=Xt.motorTorque*i.dt):(X.motorSpeed=0,X.motorMaxImpulse=0)}var Lt,wt,At,kt=Xt.lowerLimit,Bt=Xt.upperLimit,Pt=.5*(kt+Bt);gt=(((gt-=Pt)+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,gt+=Pt,kt>Bt?(Lt=0,wt=0,At=0):kt==Bt?(Lt=-1/0,wt=1/0,At=gt-kt):gt<kt?(Lt=-1/0,wt=0,(At=gt-kt+Mt)>0&&(At=0)):gt>Bt?(Lt=0,wt=1/0,(At=gt-Bt-Mt)<0&&(At=0)):(Lt=0,wt=0,At=0);var Tt=0==E?0:1/E;X.minImpulse=Lt,X.maxImpulse=wt,X.cfm=xt*Tt,X.rhs=At*yt,(z=X.jacobian).ang1X=this._basis.xX,z.ang1Y=this._basis.xY,z.ang1Z=this._basis.xZ,z.ang2X=this._basis.xX,z.ang2Y=this._basis.xY,z.ang2Z=this._basis.xZ}var St=this._impulses[4],Ct=t.rows[t.numRows++],qt=Ct.jacobian;qt.lin1X=0,qt.lin1Y=0,qt.lin1Z=0,qt.lin2X=0,qt.lin2Y=0,qt.lin2Z=0,qt.ang1X=0,qt.ang1Y=0,qt.ang1Z=0,qt.ang2X=0,qt.ang2Y=0,qt.ang2Z=0,Ct.rhs=0,Ct.cfm=0,Ct.minImpulse=0,Ct.maxImpulse=0,Ct.motorSpeed=0,Ct.motorMaxImpulse=0,Ct.impulse=null,Ct.impulse=St,(X=Ct).rhs=d,X.cfm=0,X.minImpulse=-1/0,X.maxImpulse=1/0,(z=X.jacobian).ang1X=this._basis.yX,z.ang1Y=this._basis.yY,z.ang1Z=this._basis.yZ,z.ang2X=this._basis.yX,z.ang2Y=this._basis.yY,z.ang2Z=this._basis.yZ;var Rt=this._impulses[5],Et=t.rows[t.numRows++],jt=Et.jacobian;jt.lin1X=0,jt.lin1Y=0,jt.lin1Z=0,jt.lin2X=0,jt.lin2Y=0,jt.lin2Z=0,jt.ang1X=0,jt.ang1Y=0,jt.ang1Z=0,jt.ang2X=0,jt.ang2Y=0,jt.ang2Z=0,Et.rhs=0,Et.cfm=0,Et.minImpulse=0,Et.maxImpulse=0,Et.motorSpeed=0,Et.motorMaxImpulse=0,Et.impulse=null,Et.impulse=Rt,(X=Et).rhs=I,X.cfm=0,X.minImpulse=-1/0,X.maxImpulse=1/0,(z=X.jacobian).ang1X=this._basis.zX,z.ang1Y=this._basis.zY,z.ang1Z=this._basis.zZ,z.ang2X=this._basis.zX,z.ang2Y=this._basis.zY,z.ang2Z=this._basis.zZ},_syncAnchors:function(){Lt.prototype._syncAnchors.call(this);var t,i,a,o,n,s,r,e,_,h,l,c,p,v,m,b,f,x,u,y,g,X,z,M,Y,Z,d,I,V,L,w,A,k,B,P,T,S,C,q,R=this._basis,E=R.joint._b1._invMass,j=R.joint._b2._invMass,N=R.joint._basisX1X*R.joint._basisX2X+R.joint._basisX1Y*R.joint._basisX2Y+R.joint._basisX1Z*R.joint._basisX2Z;if(N<-.999999999){var D,F,O,W,G=R.joint._basisX1X,H=R.joint._basisX1Y,U=R.joint._basisX1Z,J=G*G,Q=H*H,$=U*U;J<Q?J<$?(D=0,F=U*(W=1/Math.sqrt(Q+$)),O=-H*W):(D=H*(W=1/Math.sqrt(J+Q)),F=-G*W,O=0):Q<$?(D=-U*(W=1/Math.sqrt($+J)),F=0,O=G*W):(D=H*(W=1/Math.sqrt(J+Q)),F=-G*W,O=0),t=D,i=F,a=O,o=0}else{var K,tt,it;K=R.joint._basisX1Y*R.joint._basisX2Z-R.joint._basisX1Z*R.joint._basisX2Y,tt=R.joint._basisX1Z*R.joint._basisX2X-R.joint._basisX1X*R.joint._basisX2Z,it=R.joint._basisX1X*R.joint._basisX2Y-R.joint._basisX1Y*R.joint._basisX2X;var at=Math.sqrt(.5*(1+N));t=K*=N=.5/at,i=tt*=N,a=it*=N,o=at}var ot=(A=0)*(T=t)+(k=0)*(S=i)+(B=0)*(C=a)+(P=1)*(q=o);if(ot<0&&(ot=-ot,T=-T,S=-S,C=-C,q=-q),ot>.999999){var nt=(T=A+(T-A)*(E/(E+j)))*T+(S=k+(S-k)*(E/(E+j)))*S+(C=B+(C-B)*(E/(E+j)))*C+(q=P+(q-P)*(E/(E+j)))*q;nt>1e-32&&(nt=1/Math.sqrt(nt)),n=T*nt,s=S*nt,r=C*nt,e=q*nt}else{var st=E/(E+j)*Math.acos(ot),rt=(T+=A*-ot)*T+(S+=k*-ot)*S+(C+=B*-ot)*C+(q+=P*-ot)*q;rt>1e-32&&(rt=1/Math.sqrt(rt)),T*=rt,S*=rt,C*=rt,q*=rt;var et=Math.sin(st),_t=Math.cos(st);n=(A*=_t)+T*et,s=(k*=_t)+S*et,r=(B*=_t)+C*et,e=(P*=_t)+q*et}var ht=2*n,lt=2*s,ct=2*r,pt=n*ht,vt=s*lt,mt=r*ct,bt=n*lt,ft=s*ct,xt=n*ct,ut=e*ht,yt=e*lt,gt=e*ct;_=bt-gt,h=xt+yt,l=bt+gt,c=1-pt-mt,p=ft-ut,v=xt-yt,m=ft+ut,b=1-pt-vt,f=(1-vt-mt)*R.joint._basisX1X+_*R.joint._basisX1Y+h*R.joint._basisX1Z,x=l*R.joint._basisX1X+c*R.joint._basisX1Y+p*R.joint._basisX1Z,u=v*R.joint._basisX1X+m*R.joint._basisX1Y+b*R.joint._basisX1Z,Z=R.xX,d=R.xY,I=R.xZ,V=R.yX,L=R.yY,w=R.yZ;var Xt=Z*f+d*x+I*u;if(Xt<-.999999999){var zt,Mt,Yt,Zt,dt=Z,It=d,Vt=I,wt=dt*dt,At=It*It,kt=Vt*Vt;wt<At?wt<kt?(zt=0,Mt=Vt*(Zt=1/Math.sqrt(At+kt)),Yt=-It*Zt):(zt=It*(Zt=1/Math.sqrt(wt+At)),Mt=-dt*Zt,Yt=0):At<kt?(zt=-Vt*(Zt=1/Math.sqrt(kt+wt)),Mt=0,Yt=dt*Zt):(zt=It*(Zt=1/Math.sqrt(wt+At)),Mt=-dt*Zt,Yt=0),n=zt,s=Mt,r=Yt,e=0}else{var Bt,Pt,Tt;Bt=d*u-I*x,Pt=I*f-Z*u,Tt=Z*x-d*f;var St=Math.sqrt(.5*(1+Xt));n=Bt*=Xt=.5/St,s=Pt*=Xt,r=Tt*=Xt,e=St}var Ct,qt,Rt,Et=2*n,jt=2*s,Nt=2*r,Dt=n*Et,Ft=s*jt,Ot=r*Nt,Wt=n*jt,Gt=s*Nt,Ht=n*Nt,Ut=e*Et,Jt=e*jt,Qt=e*Nt;if((z=x*(X=(v=Ht-Jt)*V+(m=Gt+Ut)*L+(b=1-Dt-Ft)*w)-u*(g=(l=Wt+Qt)*V+(c=1-Dt-Ot)*L+(p=Gt-Ut)*w))*z+(M=u*(y=(1-Ft-Ot)*V+(_=Wt-Qt)*L+(h=Ht+Jt)*w)-f*X)*M+(Y=f*g-x*y)*Y>1e-6){var $t=z*z+M*M+Y*Y;$t>0&&($t=1/Math.sqrt($t)),z*=$t,M*=$t,Y*=$t}else{var Kt,ti=f,ii=x,ai=u,oi=ti*ti,ni=ii*ii,si=ai*ai;oi<ni?oi<si?(z=0,M=ai*(Kt=1/Math.sqrt(ni+si)),Y=-ii*Kt):(z=ii*(Kt=1/Math.sqrt(oi+ni)),M=-ti*Kt,Y=0):ni<si?(z=-ai*(Kt=1/Math.sqrt(si+oi)),M=0,Y=ti*Kt):(z=ii*(Kt=1/Math.sqrt(oi+ni)),M=-ti*Kt,Y=0)}y=M*u-Y*x,g=Y*f-z*u,X=z*x-M*f,R.xX=f,R.xY=x,R.xZ=u,R.yX=y,R.yY=g,R.yZ=X,R.zX=z,R.zY=M,R.zZ=Y,Ct=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,qt=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,Rt=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;var ri,ei,_i,hi,li,ci,pi=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,vi=pi<=-1?3.14159265358979:pi>=1?0:Math.acos(pi),mi=Ct*Ct+qt*qt+Rt*Rt;mi>0&&(mi=1/Math.sqrt(mi)),Ct*=mi,qt*=mi,Rt*=mi,Ct*=vi,qt*=vi,Rt*=vi,this.angularErrorY=Ct*this._basis.yX+qt*this._basis.yY+Rt*this._basis.yZ,this.angularErrorZ=Ct*this._basis.zX+qt*this._basis.zY+Rt*this._basis.zZ,ri=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,ei=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,_i=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,pi=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=pi<=-1?3.14159265358979:pi>=1?0:Math.acos(pi),ri*this._basis.xX+ei*this._basis.xY+_i*this._basis.xZ<0&&(this.angle=-this.angle),hi=this._anchor2X-this._anchor1X,li=this._anchor2Y-this._anchor1Y,ci=this._anchor2Z-this._anchor1Z,this.translation=hi*this._basis.xX+li*this._basis.xY+ci*this._basis.xZ,this.linearErrorY=hi*this._basis.yX+li*this._basis.yY+ci*this._basis.yZ,this.linearErrorZ=hi*this._basis.zX+li*this._basis.zY+ci*this._basis.zZ},_getVelocitySolverInfo:function(t,i){Lt.prototype._getVelocitySolverInfo.call(this,t,i),this.getInfo(i,t,!1)},_getPositionSolverInfo:function(t){Lt.prototype._getPositionSolverInfo.call(this,t),this.getInfo(t,null,!0)},getAxis1:function(){var t=new F,i=t;return i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z,t},getAxis2:function(){var t=new F,i=t;return i.x=this._basisX2X,i.y=this._basisX2Y,i.z=this._basisX2Z,t},getAxis1To:function(t){var i=t;i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z},getAxis2To:function(t){var i=t;i.x=this._basisX2X,i.y=this._basisX2Y,i.z=this._basisX2Z},getLocalAxis1:function(){var t=new F,i=t;return i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z,t},getLocalAxis2:function(){var t=new F,i=t;return i.x=this._localBasisX2X,i.y=this._localBasisX2Y,i.z=this._localBasisX2Z,t},getLocalAxis1To:function(t){var i=t;i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z},getLocalAxis2To:function(t){var i=t;i.x=this._localBasisX2X,i.y=this._localBasisX2Y,i.z=this._localBasisX2Z},getTranslationalSpringDamper:function(){return this._translSd},getRotationalSpringDamper:function(){return this._rotSd},getTranslationalLimitMotor:function(){return this._translLm},getRotationalLimitMotor:function(){return this._rotLm},getAngle:function(){return this.angle},getTranslation:function(){return this.translation}});var At=function(){this.rigidBody1=null,this.rigidBody2=null,this.localAnchor1=new F,this.localAnchor2=new F,this.allowCollision=!1,this.solverType=W.defaultJointConstraintSolverType,this.positionCorrectionAlgorithm=W.defaultJointPositionCorrectionAlgorithm,this.breakForce=0,this.breakTorque=0};At.prototype={_init:function(t,i,a){this.rigidBody1=t,this.rigidBody2=i;var o,n,s,r,e,_,h=this.rigidBody1,l=a;o=l.x,n=l.y,s=l.z,o-=h._transform._positionX,n-=h._transform._positionY,s-=h._transform._positionZ,r=h._transform._rotation00*o+h._transform._rotation10*n+h._transform._rotation20*s,e=h._transform._rotation01*o+h._transform._rotation11*n+h._transform._rotation21*s,_=h._transform._rotation02*o+h._transform._rotation12*n+h._transform._rotation22*s,o=r,n=e,s=_;var c=this.localAnchor1;c.x=o,c.y=n,c.z=s;var p,v,m,b,f,x,u=this.rigidBody2,y=a;p=y.x,v=y.y,m=y.z,p-=u._transform._positionX,v-=u._transform._positionY,m-=u._transform._positionZ,b=u._transform._rotation00*p+u._transform._rotation10*v+u._transform._rotation20*m,f=u._transform._rotation01*p+u._transform._rotation11*v+u._transform._rotation21*m,x=u._transform._rotation02*p+u._transform._rotation12*v+u._transform._rotation22*m,p=b,v=f,m=x;var g=this.localAnchor2;g.x=p,g.y=v,g.z=m}};var kt=function(){At.call(this),this.localAxis1=new F(1,0,0),this.localAxis2=new F(1,0,0),this.translationalLimitMotor=new Gt,this.translationalSpringDamper=new Wt,this.rotationalLimitMotor=new Dt,this.rotationalSpringDamper=new Wt};kt.__super__=At,kt.prototype=$extend(At.prototype,{init:function(t,i,a,o){var n,s,r;this._init(t,i,a);var e,_,h,l=o;n=l.x,s=l.y,r=l.z,e=t._transform._rotation00*n+t._transform._rotation10*s+t._transform._rotation20*r,_=t._transform._rotation01*n+t._transform._rotation11*s+t._transform._rotation21*r,h=t._transform._rotation02*n+t._transform._rotation12*s+t._transform._rotation22*r,n=e,s=_,r=h;var c,p,v,m=this.localAxis1;m.x=n,m.y=s,m.z=r;var b,f,x,u=o;c=u.x,p=u.y,v=u.z,b=i._transform._rotation00*c+i._transform._rotation10*p+i._transform._rotation20*v,f=i._transform._rotation01*c+i._transform._rotation11*p+i._transform._rotation21*v,x=i._transform._rotation02*c+i._transform._rotation12*p+i._transform._rotation22*v,c=b,p=f,v=x;var y=this.localAxis2;return y.x=c,y.y=p,y.z=v,this}});var Bt=function(t){this.joint=t,this.xX=0,this.xY=0,this.xZ=0,this.yX=0,this.yY=0,this.yZ=0,this.zX=0,this.zY=0,this.zZ=0},Pt=function(){this.impulse=0,this.impulseM=0,this.impulseP=0},Tt=function(t){this._joint=t};Tt.prototype={getContact:function(){return this._joint},getOther:function(){return this._other},getPrev:function(){return this._prev},getNext:function(){return this._next}};var St=function(){},Ct=function(t){Lt.call(this,t,St.PRISMATIC);var i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;var a,o,n,s,r,e,_,h,l,c,p,v,m,b=t.localAxis2;if(this._localBasisX2X=b.x,this._localBasisX2Y=b.y,this._localBasisX2Z=b.z,this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var f=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;f>0&&(f=1/Math.sqrt(f)),this._localBasisX1X*=f,this._localBasisX1Y*=f,this._localBasisX1Z*=f}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{var x=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;x>0&&(x=1/Math.sqrt(x)),this._localBasisX2X*=x,this._localBasisX2Y*=x,this._localBasisX2Z*=x}var u=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(u<-.999999999){var y,g,X,z,M=this._localBasisX1X,Y=this._localBasisX1Y,Z=this._localBasisX1Z,d=M*M,I=Y*Y,V=Z*Z;d<I?d<V?(y=0,g=Z*(z=1/Math.sqrt(I+V)),X=-Y*z):(y=Y*(z=1/Math.sqrt(d+I)),g=-M*z,X=0):I<V?(y=-Z*(z=1/Math.sqrt(V+d)),g=0,X=M*z):(y=Y*(z=1/Math.sqrt(d+I)),g=-M*z,X=0),a=y,o=g,n=X,s=0}else{var L,w,A;L=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,w=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,A=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;var k=Math.sqrt(.5*(1+u));a=L*=u=.5/k,o=w*=u,n=A*=u,s=k}var B=2*a,P=2*o,T=2*n,S=a*B,C=o*P,q=n*T,R=a*P,E=o*T,j=a*T,N=s*B,D=s*P,F=s*T;r=1-C-q,e=R-F,_=j+D,h=R+F,l=1-S-q,c=E-N,p=j-D,v=E+N,m=1-S-C;var O,W,G,H,U,J,Q,$,K,tt,it=this._localBasisX1X,at=this._localBasisX1Y,ot=this._localBasisX1Z,nt=it*it,st=at*at,rt=ot*ot;nt<st?nt<rt?(O=1/Math.sqrt(st+rt),this._localBasisY1X=0,this._localBasisY1Y=ot*O,this._localBasisY1Z=-at*O):(O=1/Math.sqrt(nt+st),this._localBasisY1X=at*O,this._localBasisY1Y=-it*O,this._localBasisY1Z=0):st<rt?(O=1/Math.sqrt(rt+nt),this._localBasisY1X=-ot*O,this._localBasisY1Y=0,this._localBasisY1Z=it*O):(O=1/Math.sqrt(nt+st),this._localBasisY1X=at*O,this._localBasisY1Y=-it*O,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,W=r*this._localBasisX1X+e*this._localBasisX1Y+_*this._localBasisX1Z,G=h*this._localBasisX1X+l*this._localBasisX1Y+c*this._localBasisX1Z,H=p*this._localBasisX1X+v*this._localBasisX1Y+m*this._localBasisX1Z,this._localBasisX2X=W,this._localBasisX2Y=G,this._localBasisX2Z=H,U=r*this._localBasisY1X+e*this._localBasisY1Y+_*this._localBasisY1Z,J=h*this._localBasisY1X+l*this._localBasisY1Y+c*this._localBasisY1Z,Q=p*this._localBasisY1X+v*this._localBasisY1Y+m*this._localBasisY1Z,this._localBasisY2X=U,this._localBasisY2Y=J,this._localBasisY2Z=Q,$=r*this._localBasisZ1X+e*this._localBasisZ1Y+_*this._localBasisZ1Z,K=h*this._localBasisZ1X+l*this._localBasisZ1Y+c*this._localBasisZ1Z,tt=p*this._localBasisZ1X+v*this._localBasisZ1Y+m*this._localBasisZ1Z,this._localBasisZ2X=$,this._localBasisZ2Y=K,this._localBasisZ2Z=tt,this._basis=new Bt(this),this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this.angularErrorX=0,this.angularErrorY=0,this.angularErrorZ=0,this._sd=t.springDamper.clone(),this._lm=t.limitMotor.clone()};Ct.__super__=Lt,Ct.prototype=$extend(Lt.prototype,{getInfo:function(t,i,a){var o,n,s,r,e,_,h,l,c,p,v,m,b,f,x,u,y,g,X,z,M=a?1:this._positionCorrectionAlgorithm==ut.BAUMGARTE?i.invDt*W.velocityBaumgarte:0,Y=this.linearErrorY*M,Z=this.linearErrorZ*M,d=this.angularErrorX*M,I=this.angularErrorY*M,V=this.angularErrorZ*M;o=-(o=0),n=-(n=-this._relativeAnchor1Z),s=-(s=this._relativeAnchor1Y),r=-(r=this._relativeAnchor1Z),e=-(e=0),_=-(_=-this._relativeAnchor1X),h=-(h=-this._relativeAnchor1Y),l=-(l=this._relativeAnchor1X),c=-(c=0),p=-(p=0),v=-(v=-this._relativeAnchor2Z),m=-(m=this._relativeAnchor2Y),b=-(b=this._relativeAnchor2Z),f=-(f=0),x=-(x=-this._relativeAnchor2X),u=-(u=-this._relativeAnchor2Y),y=-(y=this._relativeAnchor2X),g=-(g=0);var L=1/(this._b1._invMass+this._b2._invMass);if(this._sd.frequency<=0||!a){var w=this._impulses[0],A=t.rows[t.numRows++],k=A.jacobian;k.lin1X=0,k.lin1Y=0,k.lin1Z=0,k.lin2X=0,k.lin2Y=0,k.lin2Z=0,k.ang1X=0,k.ang1Y=0,k.ang1Z=0,k.ang2X=0,k.ang2Y=0,k.ang2Z=0,A.rhs=0,A.cfm=0,A.minImpulse=0,A.maxImpulse=0,A.motorSpeed=0,A.motorMaxImpulse=0,A.impulse=null,A.impulse=w,X=A;var B,P,T=this.translation,S=this._lm,C=this._sd,q=W.linearSlop;if(a)B=0,P=1;else{if(C.frequency>0){q=0;var R=6.28318530717958*C.frequency,E=C.dampingRatio;E<W.minSpringDamperDampingRatio&&(E=W.minSpringDamperDampingRatio);var j=i.dt,N=2*E*R,D=R*R;C.useSymplecticEuler?(B=1/(j*N),P=D/N):(B=1/(j*(j*D+N)),P=D/(j*D+N))}else B=0,P=this._positionCorrectionAlgorithm==ut.BAUMGARTE?i.invDt*W.velocityBaumgarte:0;S.motorForce>0?(X.motorSpeed=S.motorSpeed,X.motorMaxImpulse=S.motorForce*i.dt):(X.motorSpeed=0,X.motorMaxImpulse=0)}var F,O,G,H=S.lowerLimit,U=S.upperLimit;H>U?(F=0,O=0,G=0):H==U?(F=-1/0,O=1/0,G=T-H):T<H?(F=-1/0,O=0,(G=T-H+q)>0&&(G=0)):T>U?(F=0,O=1/0,(G=T-U-q)<0&&(G=0)):(F=0,O=0,G=0);var J=0==L?0:1/L;X.minImpulse=F,X.maxImpulse=O,X.cfm=B*J,X.rhs=G*P,(z=X.jacobian).lin1X=this._basis.xX,z.lin1Y=this._basis.xY,z.lin1Z=this._basis.xZ,z.lin2X=this._basis.xX,z.lin2Y=this._basis.xY,z.lin2Z=this._basis.xZ,z.ang1X=o,z.ang1Y=n,z.ang1Z=s,z.ang2X=p,z.ang2Y=v,z.ang2Z=m}var Q=this._impulses[1],$=t.rows[t.numRows++],K=$.jacobian;K.lin1X=0,K.lin1Y=0,K.lin1Z=0,K.lin2X=0,K.lin2Y=0,K.lin2Z=0,K.ang1X=0,K.ang1Y=0,K.ang1Z=0,K.ang2X=0,K.ang2Y=0,K.ang2Z=0,$.rhs=0,$.cfm=0,$.minImpulse=0,$.maxImpulse=0,$.motorSpeed=0,$.motorMaxImpulse=0,$.impulse=null,$.impulse=Q,(X=$).rhs=Y,X.cfm=0,X.minImpulse=-1/0,X.maxImpulse=1/0,(z=X.jacobian).lin1X=this._basis.yX,z.lin1Y=this._basis.yY,z.lin1Z=this._basis.yZ,z.lin2X=this._basis.yX,z.lin2Y=this._basis.yY,z.lin2Z=this._basis.yZ,z.ang1X=r,z.ang1Y=e,z.ang1Z=_,z.ang2X=b,z.ang2Y=f,z.ang2Z=x;var tt=this._impulses[2],it=t.rows[t.numRows++],at=it.jacobian;at.lin1X=0,at.lin1Y=0,at.lin1Z=0,at.lin2X=0,at.lin2Y=0,at.lin2Z=0,at.ang1X=0,at.ang1Y=0,at.ang1Z=0,at.ang2X=0,at.ang2Y=0,at.ang2Z=0,it.rhs=0,it.cfm=0,it.minImpulse=0,it.maxImpulse=0,it.motorSpeed=0,it.motorMaxImpulse=0,it.impulse=null,it.impulse=tt,(X=it).rhs=Z,X.cfm=0,X.minImpulse=-1/0,X.maxImpulse=1/0,(z=X.jacobian).lin1X=this._basis.zX,z.lin1Y=this._basis.zY,z.lin1Z=this._basis.zZ,z.lin2X=this._basis.zX,z.lin2Y=this._basis.zY,z.lin2Z=this._basis.zZ,z.ang1X=h,z.ang1Y=l,z.ang1Z=c,z.ang2X=u,z.ang2Y=y,z.ang2Z=g;var ot=this._impulses[3],nt=t.rows[t.numRows++],st=nt.jacobian;st.lin1X=0,st.lin1Y=0,st.lin1Z=0,st.lin2X=0,st.lin2Y=0,st.lin2Z=0,st.ang1X=0,st.ang1Y=0,st.ang1Z=0,st.ang2X=0,st.ang2Y=0,st.ang2Z=0,nt.rhs=0,nt.cfm=0,nt.minImpulse=0,nt.maxImpulse=0,nt.motorSpeed=0,nt.motorMaxImpulse=0,nt.impulse=null,nt.impulse=ot,(X=nt).rhs=d,X.cfm=0,X.minImpulse=-1/0,X.maxImpulse=1/0,(z=X.jacobian).ang1X=1,z.ang1Y=0,z.ang1Z=0,z.ang2X=1,z.ang2Y=0,z.ang2Z=0;var rt=this._impulses[4],et=t.rows[t.numRows++],_t=et.jacobian;_t.lin1X=0,_t.lin1Y=0,_t.lin1Z=0,_t.lin2X=0,_t.lin2Y=0,_t.lin2Z=0,_t.ang1X=0,_t.ang1Y=0,_t.ang1Z=0,_t.ang2X=0,_t.ang2Y=0,_t.ang2Z=0,et.rhs=0,et.cfm=0,et.minImpulse=0,et.maxImpulse=0,et.motorSpeed=0,et.motorMaxImpulse=0,et.impulse=null,et.impulse=rt,(X=et).rhs=I,X.cfm=0,X.minImpulse=-1/0,X.maxImpulse=1/0,(z=X.jacobian).ang1X=0,z.ang1Y=1,z.ang1Z=0,z.ang2X=0,z.ang2Y=1,z.ang2Z=0;var ht=this._impulses[5],lt=t.rows[t.numRows++],ct=lt.jacobian;ct.lin1X=0,ct.lin1Y=0,ct.lin1Z=0,ct.lin2X=0,ct.lin2Y=0,ct.lin2Z=0,ct.ang1X=0,ct.ang1Y=0,ct.ang1Z=0,ct.ang2X=0,ct.ang2Y=0,ct.ang2Z=0,lt.rhs=0,lt.cfm=0,lt.minImpulse=0,lt.maxImpulse=0,lt.motorSpeed=0,lt.motorMaxImpulse=0,lt.impulse=null,lt.impulse=ht,(X=lt).rhs=V,X.cfm=0,X.minImpulse=-1/0,X.maxImpulse=1/0,(z=X.jacobian).ang1X=0,z.ang1Y=0,z.ang1Z=1,z.ang2X=0,z.ang2Y=0,z.ang2Z=1},_syncAnchors:function(){Lt.prototype._syncAnchors.call(this);var t,i,a,o,n,s,r,e,_,h,l,c,p,v,m,b,f,x,u,y,g,X,z,M,Y,Z,d,I,V,L,w,A,k,B,P,T,S,C,q,R=this._basis,E=R.joint._b1._invMass,j=R.joint._b2._invMass,N=R.joint._basisX1X*R.joint._basisX2X+R.joint._basisX1Y*R.joint._basisX2Y+R.joint._basisX1Z*R.joint._basisX2Z;if(N<-.999999999){var D,F,O,W,G=R.joint._basisX1X,H=R.joint._basisX1Y,U=R.joint._basisX1Z,J=G*G,Q=H*H,$=U*U;J<Q?J<$?(D=0,F=U*(W=1/Math.sqrt(Q+$)),O=-H*W):(D=H*(W=1/Math.sqrt(J+Q)),F=-G*W,O=0):Q<$?(D=-U*(W=1/Math.sqrt($+J)),F=0,O=G*W):(D=H*(W=1/Math.sqrt(J+Q)),F=-G*W,O=0),t=D,i=F,a=O,o=0}else{var K,tt,it;K=R.joint._basisX1Y*R.joint._basisX2Z-R.joint._basisX1Z*R.joint._basisX2Y,tt=R.joint._basisX1Z*R.joint._basisX2X-R.joint._basisX1X*R.joint._basisX2Z,it=R.joint._basisX1X*R.joint._basisX2Y-R.joint._basisX1Y*R.joint._basisX2X;var at=Math.sqrt(.5*(1+N));t=K*=N=.5/at,i=tt*=N,a=it*=N,o=at}var ot=(A=0)*(T=t)+(k=0)*(S=i)+(B=0)*(C=a)+(P=1)*(q=o);if(ot<0&&(ot=-ot,T=-T,S=-S,C=-C,q=-q),ot>.999999){var nt=(T=A+(T-A)*(E/(E+j)))*T+(S=k+(S-k)*(E/(E+j)))*S+(C=B+(C-B)*(E/(E+j)))*C+(q=P+(q-P)*(E/(E+j)))*q;nt>1e-32&&(nt=1/Math.sqrt(nt)),n=T*nt,s=S*nt,r=C*nt,e=q*nt}else{var st=E/(E+j)*Math.acos(ot),rt=(T+=A*-ot)*T+(S+=k*-ot)*S+(C+=B*-ot)*C+(q+=P*-ot)*q;rt>1e-32&&(rt=1/Math.sqrt(rt)),T*=rt,S*=rt,C*=rt,q*=rt;var et=Math.sin(st),_t=Math.cos(st);n=(A*=_t)+T*et,s=(k*=_t)+S*et,r=(B*=_t)+C*et,e=(P*=_t)+q*et}var ht=2*n,lt=2*s,ct=2*r,pt=n*ht,vt=s*lt,mt=r*ct,bt=n*lt,ft=s*ct,xt=n*ct,ut=e*ht,yt=e*lt,gt=e*ct;_=bt-gt,h=xt+yt,l=bt+gt,c=1-pt-mt,p=ft-ut,v=xt-yt,m=ft+ut,b=1-pt-vt,f=(1-vt-mt)*R.joint._basisX1X+_*R.joint._basisX1Y+h*R.joint._basisX1Z,x=l*R.joint._basisX1X+c*R.joint._basisX1Y+p*R.joint._basisX1Z,u=v*R.joint._basisX1X+m*R.joint._basisX1Y+b*R.joint._basisX1Z,Z=R.xX,d=R.xY,I=R.xZ,V=R.yX,L=R.yY,w=R.yZ;var Xt=Z*f+d*x+I*u;if(Xt<-.999999999){var zt,Mt,Yt,Zt,dt=Z,It=d,Vt=I,wt=dt*dt,At=It*It,kt=Vt*Vt;wt<At?wt<kt?(zt=0,Mt=Vt*(Zt=1/Math.sqrt(At+kt)),Yt=-It*Zt):(zt=It*(Zt=1/Math.sqrt(wt+At)),Mt=-dt*Zt,Yt=0):At<kt?(zt=-Vt*(Zt=1/Math.sqrt(kt+wt)),Mt=0,Yt=dt*Zt):(zt=It*(Zt=1/Math.sqrt(wt+At)),Mt=-dt*Zt,Yt=0),n=zt,s=Mt,r=Yt,e=0}else{var Bt,Pt,Tt;Bt=d*u-I*x,Pt=I*f-Z*u,Tt=Z*x-d*f;var St=Math.sqrt(.5*(1+Xt));n=Bt*=Xt=.5/St,s=Pt*=Xt,r=Tt*=Xt,e=St}var Ct,qt,Rt,Et,jt,Nt,Dt,Ft,Ot,Wt,Gt,Ht,Ut,Jt,Qt,$t,Kt,ti,ii,ai,oi,ni,si,ri,ei,_i,hi,li,ci=2*n,pi=2*s,vi=2*r,mi=n*ci,bi=s*pi,fi=r*vi,xi=n*pi,ui=s*vi,yi=n*vi,gi=e*ci,Xi=e*pi,zi=e*vi;if((z=x*(X=(v=yi-Xi)*V+(m=ui+gi)*L+(b=1-mi-bi)*w)-u*(g=(l=xi+zi)*V+(c=1-mi-fi)*L+(p=ui-gi)*w))*z+(M=u*(y=(1-bi-fi)*V+(_=xi-zi)*L+(h=yi+Xi)*w)-f*X)*M+(Y=f*g-x*y)*Y>1e-6){var Mi=z*z+M*M+Y*Y;Mi>0&&(Mi=1/Math.sqrt(Mi)),z*=Mi,M*=Mi,Y*=Mi}else{var Yi,Zi=f,di=x,Ii=u,Vi=Zi*Zi,Li=di*di,wi=Ii*Ii;Vi<Li?Vi<wi?(z=0,M=Ii*(Yi=1/Math.sqrt(Li+wi)),Y=-di*Yi):(z=di*(Yi=1/Math.sqrt(Vi+Li)),M=-Zi*Yi,Y=0):Li<wi?(z=-Ii*(Yi=1/Math.sqrt(wi+Vi)),M=0,Y=Zi*Yi):(z=di*(Yi=1/Math.sqrt(Vi+Li)),M=-Zi*Yi,Y=0)}y=M*u-Y*x,g=Y*f-z*u,X=z*x-M*f,R.xX=f,R.xY=x,R.xZ=u,R.yX=y,R.yY=g,R.yZ=X,R.zX=z,R.zY=M,R.zZ=Y,Ct=this._basisX1X,qt=this._basisY1X,Rt=this._basisZ1X,Et=this._basisX1Y,jt=this._basisY1Y,Nt=this._basisZ1Y,Dt=this._basisX1Z,Ft=this._basisY1Z,Ot=this._basisZ1Z,ii=(Wt=this._basisX2X)*Et+(Gt=this._basisY2X)*jt+(Ht=this._basisZ2X)*Nt,ai=Wt*Dt+Gt*Ft+Ht*Ot,oi=(Ut=this._basisX2Y)*Ct+(Jt=this._basisY2Y)*qt+(Qt=this._basisZ2Y)*Rt,ni=Ut*Dt+Jt*Ft+Qt*Ot,si=($t=this._basisX2Z)*Ct+(Kt=this._basisY2Z)*qt+(ti=this._basisZ2Z)*Rt,ri=$t*Et+Kt*jt+ti*Nt;var Ai,ki=Wt*Ct+Gt*qt+Ht*Rt,Bi=Ut*Et+Jt*jt+Qt*Nt,Pi=$t*Dt+Kt*Ft+ti*Ot,Ti=ki+Bi+Pi;Ti>0?(li=.5*(Ai=Math.sqrt(Ti+1)),ei=(ri-ni)*(Ai=.5/Ai),_i=(ai-si)*Ai,hi=(oi-ii)*Ai):ki>Bi?ki>Pi?(ei=.5*(Ai=Math.sqrt(ki-Bi-Pi+1)),_i=(ii+oi)*(Ai=.5/Ai),hi=(ai+si)*Ai,li=(ri-ni)*Ai):(hi=.5*(Ai=Math.sqrt(Pi-ki-Bi+1)),ei=(ai+si)*(Ai=.5/Ai),_i=(ni+ri)*Ai,li=(oi-ii)*Ai):Bi>Pi?(_i=.5*(Ai=Math.sqrt(Bi-Pi-ki+1)),ei=(ii+oi)*(Ai=.5/Ai),hi=(ni+ri)*Ai,li=(ai-si)*Ai):(hi=.5*(Ai=Math.sqrt(Pi-ki-Bi+1)),ei=(ai+si)*(Ai=.5/Ai),_i=(ni+ri)*Ai,li=(oi-ii)*Ai);var Si=li,Ci=2*(Si<=-1?3.14159265358979:Si>=1?0:Math.acos(Si));this.angularErrorX=ei,this.angularErrorY=_i,this.angularErrorZ=hi;var qi,Ri,Ei,ji=this.angularErrorX*this.angularErrorX+this.angularErrorY*this.angularErrorY+this.angularErrorZ*this.angularErrorZ;ji>0&&(ji=1/Math.sqrt(ji)),this.angularErrorX*=ji,this.angularErrorY*=ji,this.angularErrorZ*=ji,this.angularErrorX*=Ci,this.angularErrorY*=Ci,this.angularErrorZ*=Ci,qi=this._anchor2X-this._anchor1X,Ri=this._anchor2Y-this._anchor1Y,Ei=this._anchor2Z-this._anchor1Z,this.translation=qi*this._basis.xX+Ri*this._basis.xY+Ei*this._basis.xZ,this.linearErrorY=qi*this._basis.yX+Ri*this._basis.yY+Ei*this._basis.yZ,this.linearErrorZ=qi*this._basis.zX+Ri*this._basis.zY+Ei*this._basis.zZ},_getVelocitySolverInfo:function(t,i){Lt.prototype._getVelocitySolverInfo.call(this,t,i),this.getInfo(i,t,!1)},_getPositionSolverInfo:function(t){Lt.prototype._getPositionSolverInfo.call(this,t),this.getInfo(t,null,!0)},getAxis1:function(){var t=new F,i=t;return i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z,t},getAxis2:function(){var t=new F,i=t;return i.x=this._basisX2X,i.y=this._basisX2Y,i.z=this._basisX2Z,t},getAxis1To:function(t){var i=t;i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z},getAxis2To:function(t){var i=t;i.x=this._basisX2X,i.y=this._basisX2Y,i.z=this._basisX2Z},getLocalAxis1:function(){var t=new F,i=t;return i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z,t},getLocalAxis2:function(){var t=new F,i=t;return i.x=this._localBasisX2X,i.y=this._localBasisX2Y,i.z=this._localBasisX2Z,t},getLocalAxis1To:function(t){var i=t;i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z},getLocalAxis2To:function(t){var i=t;i.x=this._localBasisX2X,i.y=this._localBasisX2Y,i.z=this._localBasisX2Z},getSpringDamper:function(){return this._sd},getLimitMotor:function(){return this._lm},getTranslation:function(){return this.translation}});var qt=function(){At.call(this),this.localAxis1=new F(1,0,0),this.localAxis2=new F(1,0,0),this.limitMotor=new Gt,this.springDamper=new Wt};qt.__super__=At,qt.prototype=$extend(At.prototype,{init:function(t,i,a,o){var n,s,r;this._init(t,i,a);var e,_,h,l=o;n=l.x,s=l.y,r=l.z,e=t._transform._rotation00*n+t._transform._rotation10*s+t._transform._rotation20*r,_=t._transform._rotation01*n+t._transform._rotation11*s+t._transform._rotation21*r,h=t._transform._rotation02*n+t._transform._rotation12*s+t._transform._rotation22*r,n=e,s=_,r=h;var c,p,v,m=this.localAxis1;m.x=n,m.y=s,m.z=r;var b,f,x,u=o;c=u.x,p=u.y,v=u.z,b=i._transform._rotation00*c+i._transform._rotation10*p+i._transform._rotation20*v,f=i._transform._rotation01*c+i._transform._rotation11*p+i._transform._rotation21*v,x=i._transform._rotation02*c+i._transform._rotation12*p+i._transform._rotation22*v,c=b,p=f,v=x;var y=this.localAxis2;return y.x=c,y.y=p,y.z=v,this}});var Rt=function(t){Lt.call(this,t,St.RAGDOLL);var i=t.localTwistAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;var a=t.localSwingAxis1;this._localBasisY1X=a.x,this._localBasisY1Y=a.y,this._localBasisY1Z=a.z;var o,n,s,r,e,_,h,l,c,p,v,m,b,f=t.localTwistAxis2;if(this._localBasisX2X=f.x,this._localBasisX2Y=f.y,this._localBasisX2Z=f.z,this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var x=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;x>0&&(x=1/Math.sqrt(x)),this._localBasisX1X*=x,this._localBasisX1Y*=x,this._localBasisX1Z*=x}if(this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z==0){var u,y=this._localBasisX1X,g=this._localBasisX1Y,X=this._localBasisX1Z,z=y*y,M=g*g,Y=X*X;z<M?z<Y?(u=1/Math.sqrt(M+Y),this._localBasisY1X=0,this._localBasisY1Y=X*u,this._localBasisY1Z=-g*u):(u=1/Math.sqrt(z+M),this._localBasisY1X=g*u,this._localBasisY1Y=-y*u,this._localBasisY1Z=0):M<Y?(u=1/Math.sqrt(Y+z),this._localBasisY1X=-X*u,this._localBasisY1Y=0,this._localBasisY1Z=y*u):(u=1/Math.sqrt(z+M),this._localBasisY1X=g*u,this._localBasisY1Y=-y*u,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{var Z=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;Z>0&&(Z=1/Math.sqrt(Z)),this._localBasisZ1X*=Z,this._localBasisZ1Y*=Z,this._localBasisZ1Z*=Z,this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y,this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z,this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}var d=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(d<-.999999999){var I,V,L,w,A=this._localBasisX1X,k=this._localBasisX1Y,B=this._localBasisX1Z,P=A*A,T=k*k,S=B*B;P<T?P<S?(I=0,V=B*(w=1/Math.sqrt(T+S)),L=-k*w):(I=k*(w=1/Math.sqrt(P+T)),V=-A*w,L=0):T<S?(I=-B*(w=1/Math.sqrt(S+P)),V=0,L=A*w):(I=k*(w=1/Math.sqrt(P+T)),V=-A*w,L=0),o=I,n=V,s=L,r=0}else{var C,q,R;C=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,q=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,R=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;var E=Math.sqrt(.5*(1+d));o=C*=d=.5/E,n=q*=d,s=R*=d,r=E}var j,N,D,F,O,G,H,U,J,Q=2*o,$=2*n,K=2*s,tt=o*Q,it=n*$,at=s*K,ot=o*$,nt=n*K,st=o*K,rt=r*Q,et=r*$,_t=r*K;_=ot-_t,h=st+et,l=ot+_t,c=1-tt-at,p=nt-rt,v=st-et,m=nt+rt,b=1-tt-it,j=(e=1-it-at)*this._localBasisX1X+_*this._localBasisX1Y+h*this._localBasisX1Z,N=l*this._localBasisX1X+c*this._localBasisX1Y+p*this._localBasisX1Z,D=v*this._localBasisX1X+m*this._localBasisX1Y+b*this._localBasisX1Z,this._localBasisX2X=j,this._localBasisX2Y=N,this._localBasisX2Z=D,F=e*this._localBasisY1X+_*this._localBasisY1Y+h*this._localBasisY1Z,O=l*this._localBasisY1X+c*this._localBasisY1Y+p*this._localBasisY1Z,G=v*this._localBasisY1X+m*this._localBasisY1Y+b*this._localBasisY1Z,this._localBasisY2X=F,this._localBasisY2Y=O,this._localBasisY2Z=G,H=e*this._localBasisZ1X+_*this._localBasisZ1Y+h*this._localBasisZ1Z,U=l*this._localBasisZ1X+c*this._localBasisZ1Y+p*this._localBasisZ1Z,J=v*this._localBasisZ1X+m*this._localBasisZ1Y+b*this._localBasisZ1Z,this._localBasisZ2X=H,this._localBasisZ2Y=U,this._localBasisZ2Z=J,this._twistSd=t.twistSpringDamper.clone(),this._twistLm=t.twistLimitMotor.clone(),this._swingSd=t.swingSpringDamper.clone(),this._maxSwingAngle1=t.maxSwingAngle1,this._maxSwingAngle2=t.maxSwingAngle2,this._maxSwingAngle1<W.minRagdollMaxSwingAngle&&(this._maxSwingAngle1=W.minRagdollMaxSwingAngle),this._maxSwingAngle2<W.minRagdollMaxSwingAngle&&(this._maxSwingAngle2=W.minRagdollMaxSwingAngle),this.dummySwingLm=new Dt,this.dummySwingLm.lowerLimit=-1,this.dummySwingLm.upperLimit=0,this._swingAngle=0,this._twistAngle=0,this.swingError=0,this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.twistAxisX=0,this.twistAxisY=0,this.twistAxisZ=0};Rt.__super__=Lt,Rt.prototype=$extend(Lt.prototype,{getInfo:function(t,i,a){var o,n,s,r,e,_,h,l,c,p,v,m,b,f,x,u,y,g,X=a?1:this._positionCorrectionAlgorithm==ut.BAUMGARTE?i.invDt*W.velocityBaumgarte:0,z=this.linearErrorX*X,M=this.linearErrorY*X,Y=this.linearErrorZ*X;o=-(o=0),n=-(n=-this._relativeAnchor1Z),s=-(s=this._relativeAnchor1Y),r=-(r=this._relativeAnchor1Z),e=-(e=0),_=-(_=-this._relativeAnchor1X),h=-(h=-this._relativeAnchor1Y),l=-(l=this._relativeAnchor1X),c=-(c=0),p=-(p=0),v=-(v=-this._relativeAnchor2Z),m=-(m=this._relativeAnchor2Y),b=-(b=this._relativeAnchor2Z),f=-(f=0),x=-(x=-this._relativeAnchor2X),u=-(u=-this._relativeAnchor2Y),y=-(y=this._relativeAnchor2X),g=-(g=0);var Z=this.swingAxisX,d=this.swingAxisY,I=this.swingAxisZ,V=(this._b1._invInertia00*Z+this._b1._invInertia01*d+this._b1._invInertia02*I)*Z+(this._b1._invInertia10*Z+this._b1._invInertia11*d+this._b1._invInertia12*I)*d+(this._b1._invInertia20*Z+this._b1._invInertia21*d+this._b1._invInertia22*I)*I,L=(this._b2._invInertia00*Z+this._b2._invInertia01*d+this._b2._invInertia02*I)*Z+(this._b2._invInertia10*Z+this._b2._invInertia11*d+this._b2._invInertia12*I)*d+(this._b2._invInertia20*Z+this._b2._invInertia21*d+this._b2._invInertia22*I)*I;if(V>0){var w=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,A=Z*this._relativeAnchor1X+d*this._relativeAnchor1Y+I*this._relativeAnchor1Z,k=w-A*A;k>0&&(V=this._b1._invMass>0?1/(1/V+this._b1._mass*k):0)}if(L>0){var B=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,P=Z*this._relativeAnchor2X+d*this._relativeAnchor2Y+I*this._relativeAnchor2Z,T=B-P*P;T>0&&(L=this._b2._invMass>0?1/(1/L+this._b2._mass*T):0)}var S=V+L==0?0:1/(V+L),C=this._basisX2X,q=this._basisX2Y,R=this._basisX2Z,E=(this._b1._invInertia00*C+this._b1._invInertia01*q+this._b1._invInertia02*R)*C+(this._b1._invInertia10*C+this._b1._invInertia11*q+this._b1._invInertia12*R)*q+(this._b1._invInertia20*C+this._b1._invInertia21*q+this._b1._invInertia22*R)*R,j=(this._b2._invInertia00*C+this._b2._invInertia01*q+this._b2._invInertia02*R)*C+(this._b2._invInertia10*C+this._b2._invInertia11*q+this._b2._invInertia12*R)*q+(this._b2._invInertia20*C+this._b2._invInertia21*q+this._b2._invInertia22*R)*R;if(E>0){var N=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,D=C*this._relativeAnchor1X+q*this._relativeAnchor1Y+R*this._relativeAnchor1Z,F=N-D*D;F>0&&(E=this._b1._invMass>0?1/(1/E+this._b1._mass*F):0)}if(j>0){var O=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,G=C*this._relativeAnchor2X+q*this._relativeAnchor2Y+R*this._relativeAnchor2Z,H=O-G*G;H>0&&(j=this._b2._invMass>0?1/(1/j+this._b2._mass*H):0)}var U=E+j==0?0:1/(E+j),J=this._impulses[0],Q=t.rows[t.numRows++],$=Q.jacobian;$.lin1X=0,$.lin1Y=0,$.lin1Z=0,$.lin2X=0,$.lin2Y=0,$.lin2Z=0,$.ang1X=0,$.ang1Y=0,$.ang1Z=0,$.ang2X=0,$.ang2Y=0,$.ang2Z=0,Q.rhs=0,Q.cfm=0,Q.minImpulse=0,Q.maxImpulse=0,Q.motorSpeed=0,Q.motorMaxImpulse=0,Q.impulse=null,Q.impulse=J;var K=Q;K.rhs=z,K.cfm=0,K.minImpulse=-1/0,K.maxImpulse=1/0;var tt=K.jacobian;tt.lin1X=1,tt.lin1Y=0,tt.lin1Z=0,tt.lin2X=1,tt.lin2Y=0,tt.lin2Z=0,tt.ang1X=o,tt.ang1Y=n,tt.ang1Z=s,tt.ang2X=p,tt.ang2Y=v,tt.ang2Z=m;var it=this._impulses[1],at=t.rows[t.numRows++],ot=at.jacobian;ot.lin1X=0,ot.lin1Y=0,ot.lin1Z=0,ot.lin2X=0,ot.lin2Y=0,ot.lin2Z=0,ot.ang1X=0,ot.ang1Y=0,ot.ang1Z=0,ot.ang2X=0,ot.ang2Y=0,ot.ang2Z=0,at.rhs=0,at.cfm=0,at.minImpulse=0,at.maxImpulse=0,at.motorSpeed=0,at.motorMaxImpulse=0,at.impulse=null,at.impulse=it,(K=at).rhs=M,K.cfm=0,K.minImpulse=-1/0,K.maxImpulse=1/0,(tt=K.jacobian).lin1X=0,tt.lin1Y=1,tt.lin1Z=0,tt.lin2X=0,tt.lin2Y=1,tt.lin2Z=0,tt.ang1X=r,tt.ang1Y=e,tt.ang1Z=_,tt.ang2X=b,tt.ang2Y=f,tt.ang2Z=x;var nt=this._impulses[2],st=t.rows[t.numRows++],rt=st.jacobian;if(rt.lin1X=0,rt.lin1Y=0,rt.lin1Z=0,rt.lin2X=0,rt.lin2Y=0,rt.lin2Z=0,rt.ang1X=0,rt.ang1Y=0,rt.ang1Z=0,rt.ang2X=0,rt.ang2Y=0,rt.ang2Z=0,st.rhs=0,st.cfm=0,st.minImpulse=0,st.maxImpulse=0,st.motorSpeed=0,st.motorMaxImpulse=0,st.impulse=null,st.impulse=nt,(K=st).rhs=Y,K.cfm=0,K.minImpulse=-1/0,K.maxImpulse=1/0,(tt=K.jacobian).lin1X=0,tt.lin1Y=0,tt.lin1Z=1,tt.lin2X=0,tt.lin2Y=0,tt.lin2Z=1,tt.ang1X=h,tt.ang1Y=l,tt.ang1Z=c,tt.ang2X=u,tt.ang2Y=y,tt.ang2Z=g,this.swingError>0&&(this._swingSd.frequency<=0||!a)){var et=this._impulses[3],_t=t.rows[t.numRows++],ht=_t.jacobian;ht.lin1X=0,ht.lin1Y=0,ht.lin1Z=0,ht.lin2X=0,ht.lin2Y=0,ht.lin2Z=0,ht.ang1X=0,ht.ang1Y=0,ht.ang1Z=0,ht.ang2X=0,ht.ang2Y=0,ht.ang2Z=0,_t.rhs=0,_t.cfm=0,_t.minImpulse=0,_t.maxImpulse=0,_t.motorSpeed=0,_t.motorMaxImpulse=0,_t.impulse=null,_t.impulse=et,K=_t;var lt,ct,pt=this.swingError,vt=this.dummySwingLm,mt=this._swingSd,bt=W.angularSlop;if(a)lt=0,ct=1;else{if(mt.frequency>0){bt=0;var ft=6.28318530717958*mt.frequency,xt=mt.dampingRatio;xt<W.minSpringDamperDampingRatio&&(xt=W.minSpringDamperDampingRatio);var yt=i.dt,gt=2*xt*ft,Xt=ft*ft;mt.useSymplecticEuler?(lt=1/(yt*gt),ct=Xt/gt):(lt=1/(yt*(yt*Xt+gt)),ct=Xt/(yt*Xt+gt))}else lt=0,ct=this._positionCorrectionAlgorithm==ut.BAUMGARTE?i.invDt*W.velocityBaumgarte:0;vt.motorTorque>0?(K.motorSpeed=vt.motorSpeed,K.motorMaxImpulse=vt.motorTorque*i.dt):(K.motorSpeed=0,K.motorMaxImpulse=0)}var zt,Mt,Yt,Zt=vt.lowerLimit,dt=vt.upperLimit,It=.5*(Zt+dt);pt=(((pt-=It)+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,pt+=It,Zt>dt?(zt=0,Mt=0,Yt=0):Zt==dt?(zt=-1/0,Mt=1/0,Yt=pt-Zt):pt<Zt?(zt=-1/0,Mt=0,(Yt=pt-Zt+bt)>0&&(Yt=0)):pt>dt?(zt=0,Mt=1/0,(Yt=pt-dt-bt)<0&&(Yt=0)):(zt=0,Mt=0,Yt=0);var Vt=0==S?0:1/S;K.minImpulse=zt,K.maxImpulse=Mt,K.cfm=lt*Vt,K.rhs=Yt*ct,(tt=K.jacobian).ang1X=this.swingAxisX,tt.ang1Y=this.swingAxisY,tt.ang1Z=this.swingAxisZ,tt.ang2X=this.swingAxisX,tt.ang2Y=this.swingAxisY,tt.ang2Z=this.swingAxisZ}if(this._twistSd.frequency<=0||!a){var Lt=this._impulses[4],wt=t.rows[t.numRows++],At=wt.jacobian;At.lin1X=0,At.lin1Y=0,At.lin1Z=0,At.lin2X=0,At.lin2Y=0,At.lin2Z=0,At.ang1X=0,At.ang1Y=0,At.ang1Z=0,At.ang2X=0,At.ang2Y=0,At.ang2Z=0,wt.rhs=0,wt.cfm=0,wt.minImpulse=0,wt.maxImpulse=0,wt.motorSpeed=0,wt.motorMaxImpulse=0,wt.impulse=null,wt.impulse=Lt,K=wt;var kt,Bt,Pt=this._twistAngle,Tt=this._twistLm,St=this._twistSd,Ct=W.angularSlop;if(a)kt=0,Bt=1;else{if(St.frequency>0){Ct=0;var qt=6.28318530717958*St.frequency,Rt=St.dampingRatio;Rt<W.minSpringDamperDampingRatio&&(Rt=W.minSpringDamperDampingRatio);var Et=i.dt,jt=2*Rt*qt,Nt=qt*qt;St.useSymplecticEuler?(kt=1/(Et*jt),Bt=Nt/jt):(kt=1/(Et*(Et*Nt+jt)),Bt=Nt/(Et*Nt+jt))}else kt=0,Bt=this._positionCorrectionAlgorithm==ut.BAUMGARTE?i.invDt*W.velocityBaumgarte:0;Tt.motorTorque>0?(K.motorSpeed=Tt.motorSpeed,K.motorMaxImpulse=Tt.motorTorque*i.dt):(K.motorSpeed=0,K.motorMaxImpulse=0)}var Dt,Ft,Ot,Wt=Tt.lowerLimit,Gt=Tt.upperLimit,Ht=.5*(Wt+Gt);Pt=(((Pt-=Ht)+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,Pt+=Ht,Wt>Gt?(Dt=0,Ft=0,Ot=0):Wt==Gt?(Dt=-1/0,Ft=1/0,Ot=Pt-Wt):Pt<Wt?(Dt=-1/0,Ft=0,(Ot=Pt-Wt+Ct)>0&&(Ot=0)):Pt>Gt?(Dt=0,Ft=1/0,(Ot=Pt-Gt-Ct)<0&&(Ot=0)):(Dt=0,Ft=0,Ot=0);var Ut=0==U?0:1/U;K.minImpulse=Dt,K.maxImpulse=Ft,K.cfm=kt*Ut,K.rhs=Ot*Bt,(tt=K.jacobian).ang1X=this.twistAxisX,tt.ang1Y=this.twistAxisY,tt.ang1Z=this.twistAxisZ,tt.ang2X=this.twistAxisX,tt.ang2Y=this.twistAxisY,tt.ang2Z=this.twistAxisZ}},_syncAnchors:function(){Lt.prototype._syncAnchors.call(this);var t,i,a,o,n,s,r,e,_,h,l,c,p,v,m,b,f,x,u,y,g,X,z,M,Y,Z,d,I,V,L,w;this._b1._transform,this._b2._transform;t=this._basisX1X,i=this._basisX1Y,a=this._basisX1Z,o=this._basisX2X,n=this._basisX2Y,s=this._basisX2Z,r=this._basisX1X,e=this._basisY1X,_=this._basisZ1X,h=this._basisX1Y,l=this._basisY1Y,c=this._basisZ1Y,p=this._basisX1Z,v=this._basisY1Z,m=this._basisZ1Z,this._basisX2X,this._basisY2X,this._basisZ2X,this._basisX2Y,this._basisY2Y,this._basisZ2Y,this._basisX2Z,this._basisY2Z,this._basisZ2Z;var A=t*o+i*n+a*s;if(A<-.999999999){var k,B,P,T,S=t,C=i,q=a,R=S*S,E=C*C,j=q*q;R<E?R<j?(k=0,B=q*(T=1/Math.sqrt(E+j)),P=-C*T):(k=C*(T=1/Math.sqrt(R+E)),B=-S*T,P=0):E<j?(k=-q*(T=1/Math.sqrt(j+R)),B=0,P=S*T):(k=C*(T=1/Math.sqrt(R+E)),B=-S*T,P=0),b=k,f=B,x=P,u=0}else{var N,D,F;N=i*s-a*n,D=a*o-t*s,F=t*n-i*o;var O=Math.sqrt(.5*(1+A));b=N*=A=.5/O,f=D*=A,x=F*=A,u=O}var W,G,H,U=2*b,J=2*f,Q=2*x,$=b*U,K=f*J,tt=x*Q,it=b*J,at=f*Q,ot=b*Q,nt=u*U,st=u*J,rt=u*Q;y=1-K-tt,g=it-rt,X=ot+st,z=it+rt,M=1-$-tt,Y=at-nt,Z=ot-st,d=at+nt,I=1-$-K,this._swingAngle=2*(u<=-1?3.14159265358979:u>=1?0:Math.acos(u)),V=b,L=f,w=x,W=y*this._basisY2X+z*this._basisY2Y+Z*this._basisY2Z,G=g*this._basisY2X+M*this._basisY2Y+d*this._basisY2Z,H=X*this._basisY2X+Y*this._basisY2Y+I*this._basisY2Z;var et=this._basisY1X*W+this._basisY1Y*G+this._basisY1Z*H,_t=this._basisZ1X*W+this._basisZ1Y*G+this._basisZ1Z*H;this._twistAngle=Math.atan2(_t,et),this.twistAxisX=this._basisX1X+this._basisX2X,this.twistAxisY=this._basisX1Y+this._basisX2Y,this.twistAxisZ=this._basisX1Z+this._basisX2Z;var ht=this.twistAxisX*this.twistAxisX+this.twistAxisY*this.twistAxisY+this.twistAxisZ*this.twistAxisZ;ht>0&&(ht=1/Math.sqrt(ht)),this.twistAxisX*=ht,this.twistAxisY*=ht,this.twistAxisZ*=ht;var lt,ct,pt=Math.sqrt(V*V+L*L+w*w);pt>0&&(pt=1/pt),lt=e*(V*=pt*this._swingAngle)+l*(L*=pt*this._swingAngle)+v*(w*=pt*this._swingAngle),ct=_*V+c*L+m*w,V=r*V+h*L+p*w;var vt=L=lt,mt=w=ct,bt=this._maxSwingAngle1,ft=this._maxSwingAngle2,xt=1/(bt*bt),ut=1/(ft*ft),yt=vt*vt*xt+mt*mt*ut;if(0==yt)this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.swingError=0;else{var gt,Xt,zt,Mt,Yt,Zt,dt=Math.sqrt(1/yt),It=vt*dt,Vt=mt*dt,wt=It*xt,At=Vt*ut,kt=(vt-It)*(wt*=pt=1/Math.sqrt(wt*wt+At*At))+(mt-Vt)*(At*=pt);if(kt>0)this.swingError=kt,this.swingAxisX=0,this.swingAxisY=wt,this.swingAxisZ=At,gt=r*this.swingAxisX+e*this.swingAxisY+_*this.swingAxisZ,Xt=h*this.swingAxisX+l*this.swingAxisY+c*this.swingAxisZ,zt=p*this.swingAxisX+v*this.swingAxisY+m*this.swingAxisZ,this.swingAxisX=gt,this.swingAxisY=Xt,this.swingAxisZ=zt,Mt=y*this.swingAxisX+g*this.swingAxisY+X*this.swingAxisZ,Yt=z*this.swingAxisX+M*this.swingAxisY+Y*this.swingAxisZ,Zt=Z*this.swingAxisX+d*this.swingAxisY+I*this.swingAxisZ,this.swingAxisX=Mt,this.swingAxisY=Yt,this.swingAxisZ=Zt;else this.swingError=0}this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z},_getVelocitySolverInfo:function(t,i){Lt.prototype._getVelocitySolverInfo.call(this,t,i),this.getInfo(i,t,!1)},_getPositionSolverInfo:function(t){Lt.prototype._getPositionSolverInfo.call(this,t),this.getInfo(t,null,!0)},getAxis1:function(){var t=new F,i=t;return i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z,t},getAxis2:function(){var t=new F,i=t;return i.x=this._basisX2X,i.y=this._basisX2Y,i.z=this._basisX2Z,t},getAxis1To:function(t){var i=t;i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z},getAxis2To:function(t){var i=t;i.x=this._basisX2X,i.y=this._basisX2Y,i.z=this._basisX2Z},getLocalAxis1:function(){var t=new F,i=t;return i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z,t},getLocalAxis2:function(){var t=new F,i=t;return i.x=this._localBasisX2X,i.y=this._localBasisX2Y,i.z=this._localBasisX2Z,t},getLocalAxis1To:function(t){var i=t;i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z},getLocalAxis2To:function(t){var i=t;i.x=this._localBasisX2X,i.y=this._localBasisX2Y,i.z=this._localBasisX2Z},getTwistSpringDamper:function(){return this._twistSd},getTwistLimitMotor:function(){return this._twistLm},getSwingSpringDamper:function(){return this._swingSd},getSwingAxis:function(){var t=new F,i=t;return i.x=this.swingAxisX,i.y=this.swingAxisY,i.z=this.swingAxisZ,t},getSwingAxisTo:function(t){var i=t;i.x=this.swingAxisX,i.y=this.swingAxisY,i.z=this.swingAxisZ},getSwingAngle:function(){return this._swingAngle},getTwistAngle:function(){return this._twistAngle}});var Et=function(){At.call(this),this.localTwistAxis1=new F(1,0,0),this.localTwistAxis2=new F(1,0,0),this.localSwingAxis1=new F(0,1,0),this.twistSpringDamper=new Wt,this.swingSpringDamper=new Wt,this.twistLimitMotor=new Dt,this.maxSwingAngle1=3.14159265358979,this.maxSwingAngle2=3.14159265358979};Et.__super__=At,Et.prototype=$extend(At.prototype,{init:function(t,i,a,o,n){var s,r,e;this._init(t,i,a);var _,h,l,c=o;s=c.x,r=c.y,e=c.z,_=t._transform._rotation00*s+t._transform._rotation10*r+t._transform._rotation20*e,h=t._transform._rotation01*s+t._transform._rotation11*r+t._transform._rotation21*e,l=t._transform._rotation02*s+t._transform._rotation12*r+t._transform._rotation22*e,s=_,r=h,e=l;var p,v,m,b=this.localTwistAxis1;b.x=s,b.y=r,b.z=e;var f,x,u,y=o;p=y.x,v=y.y,m=y.z,f=i._transform._rotation00*p+i._transform._rotation10*v+i._transform._rotation20*m,x=i._transform._rotation01*p+i._transform._rotation11*v+i._transform._rotation21*m,u=i._transform._rotation02*p+i._transform._rotation12*v+i._transform._rotation22*m,p=f,v=x,m=u;var g,X,z,M=this.localTwistAxis2;M.x=p,M.y=v,M.z=m;var Y,Z,d,I=n;g=I.x,X=I.y,z=I.z,Y=t._transform._rotation00*g+t._transform._rotation10*X+t._transform._rotation20*z,Z=t._transform._rotation01*g+t._transform._rotation11*X+t._transform._rotation21*z,d=t._transform._rotation02*g+t._transform._rotation12*X+t._transform._rotation22*z,g=Y,X=Z,z=d;var V=this.localSwingAxis1;return V.x=g,V.y=X,V.z=z,this}});var jt=function(t){Lt.call(this,t,1);var i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;var a,o,n,s,r,e,_,h,l,c,p,v,m,b=t.localAxis2;if(this._localBasisX2X=b.x,this._localBasisX2Y=b.y,this._localBasisX2Z=b.z,this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var f=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;f>0&&(f=1/Math.sqrt(f)),this._localBasisX1X*=f,this._localBasisX1Y*=f,this._localBasisX1Z*=f}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{var x=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;x>0&&(x=1/Math.sqrt(x)),this._localBasisX2X*=x,this._localBasisX2Y*=x,this._localBasisX2Z*=x}var u=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(u<-.999999999){var y,g,X,z,M=this._localBasisX1X,Y=this._localBasisX1Y,Z=this._localBasisX1Z,d=M*M,I=Y*Y,V=Z*Z;d<I?d<V?(y=0,g=Z*(z=1/Math.sqrt(I+V)),X=-Y*z):(y=Y*(z=1/Math.sqrt(d+I)),g=-M*z,X=0):I<V?(y=-Z*(z=1/Math.sqrt(V+d)),g=0,X=M*z):(y=Y*(z=1/Math.sqrt(d+I)),g=-M*z,X=0),a=y,o=g,n=X,s=0}else{var L,w,A;L=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,w=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,A=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;var k=Math.sqrt(.5*(1+u));a=L*=u=.5/k,o=w*=u,n=A*=u,s=k}var B=2*a,P=2*o,T=2*n,S=a*B,C=o*P,q=n*T,R=a*P,E=o*T,j=a*T,N=s*B,D=s*P,F=s*T;r=1-C-q,e=R-F,_=j+D,h=R+F,l=1-S-q,c=E-N,p=j-D,v=E+N,m=1-S-C;var O,W,G,H,U,J,Q,$,K,tt,it=this._localBasisX1X,at=this._localBasisX1Y,ot=this._localBasisX1Z,nt=it*it,st=at*at,rt=ot*ot;nt<st?nt<rt?(O=1/Math.sqrt(st+rt),this._localBasisY1X=0,this._localBasisY1Y=ot*O,this._localBasisY1Z=-at*O):(O=1/Math.sqrt(nt+st),this._localBasisY1X=at*O,this._localBasisY1Y=-it*O,this._localBasisY1Z=0):st<rt?(O=1/Math.sqrt(rt+nt),this._localBasisY1X=-ot*O,this._localBasisY1Y=0,this._localBasisY1Z=it*O):(O=1/Math.sqrt(nt+st),this._localBasisY1X=at*O,this._localBasisY1Y=-it*O,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,W=r*this._localBasisX1X+e*this._localBasisX1Y+_*this._localBasisX1Z,G=h*this._localBasisX1X+l*this._localBasisX1Y+c*this._localBasisX1Z,H=p*this._localBasisX1X+v*this._localBasisX1Y+m*this._localBasisX1Z,this._localBasisX2X=W,this._localBasisX2Y=G,this._localBasisX2Z=H,U=r*this._localBasisY1X+e*this._localBasisY1Y+_*this._localBasisY1Z,J=h*this._localBasisY1X+l*this._localBasisY1Y+c*this._localBasisY1Z,Q=p*this._localBasisY1X+v*this._localBasisY1Y+m*this._localBasisY1Z,this._localBasisY2X=U,this._localBasisY2Y=J,this._localBasisY2Z=Q,$=r*this._localBasisZ1X+e*this._localBasisZ1Y+_*this._localBasisZ1Z,K=h*this._localBasisZ1X+l*this._localBasisZ1Y+c*this._localBasisZ1Z,tt=p*this._localBasisZ1X+v*this._localBasisZ1Y+m*this._localBasisZ1Z,this._localBasisZ2X=$,this._localBasisZ2Y=K,this._localBasisZ2Z=tt,this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this._basis=new Bt(this),this._sd=t.springDamper.clone(),this._lm=t.limitMotor.clone()};jt.__super__=Lt,jt.prototype=$extend(Lt.prototype,{getInfo:function(t,i,a){var o,n,s,r,e,_,h,l,c,p,v,m,b,f,x,u,y,g,X=a?1:this._positionCorrectionAlgorithm==ut.BAUMGARTE?i.invDt*W.velocityBaumgarte:0,z=this.linearErrorX*X,M=this.linearErrorY*X,Y=this.linearErrorZ*X,Z=this.angularErrorY*X,d=this.angularErrorZ*X;o=-(o=0),n=-(n=-this._relativeAnchor1Z),s=-(s=this._relativeAnchor1Y),r=-(r=this._relativeAnchor1Z),e=-(e=0),_=-(_=-this._relativeAnchor1X),h=-(h=-this._relativeAnchor1Y),l=-(l=this._relativeAnchor1X),c=-(c=0),p=-(p=0),v=-(v=-this._relativeAnchor2Z),m=-(m=this._relativeAnchor2Y),b=-(b=this._relativeAnchor2Z),f=-(f=0),x=-(x=-this._relativeAnchor2X),u=-(u=-this._relativeAnchor2Y),y=-(y=this._relativeAnchor2X),g=-(g=0);var I=this._basis.xX,V=this._basis.xY,L=this._basis.xZ,w=(this._b1._invInertia00*I+this._b1._invInertia01*V+this._b1._invInertia02*L)*I+(this._b1._invInertia10*I+this._b1._invInertia11*V+this._b1._invInertia12*L)*V+(this._b1._invInertia20*I+this._b1._invInertia21*V+this._b1._invInertia22*L)*L,A=(this._b2._invInertia00*I+this._b2._invInertia01*V+this._b2._invInertia02*L)*I+(this._b2._invInertia10*I+this._b2._invInertia11*V+this._b2._invInertia12*L)*V+(this._b2._invInertia20*I+this._b2._invInertia21*V+this._b2._invInertia22*L)*L;if(w>0){var k=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,B=I*this._relativeAnchor1X+V*this._relativeAnchor1Y+L*this._relativeAnchor1Z,P=k-B*B;P>0&&(w=this._b1._invMass>0?1/(1/w+this._b1._mass*P):0)}if(A>0){var T=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,S=I*this._relativeAnchor2X+V*this._relativeAnchor2Y+L*this._relativeAnchor2Z,C=T-S*S;C>0&&(A=this._b2._invMass>0?1/(1/A+this._b2._mass*C):0)}var q=w+A==0?0:1/(w+A),R=this._impulses[0],E=t.rows[t.numRows++],j=E.jacobian;j.lin1X=0,j.lin1Y=0,j.lin1Z=0,j.lin2X=0,j.lin2Y=0,j.lin2Z=0,j.ang1X=0,j.ang1Y=0,j.ang1Z=0,j.ang2X=0,j.ang2Y=0,j.ang2Z=0,E.rhs=0,E.cfm=0,E.minImpulse=0,E.maxImpulse=0,E.motorSpeed=0,E.motorMaxImpulse=0,E.impulse=null,E.impulse=R;var N=E;N.rhs=z,N.cfm=0,N.minImpulse=-1/0,N.maxImpulse=1/0;var D=N.jacobian;D.lin1X=1,D.lin1Y=0,D.lin1Z=0,D.lin2X=1,D.lin2Y=0,D.lin2Z=0,D.ang1X=o,D.ang1Y=n,D.ang1Z=s,D.ang2X=p,D.ang2Y=v,D.ang2Z=m;var F=this._impulses[1],O=t.rows[t.numRows++],G=O.jacobian;G.lin1X=0,G.lin1Y=0,G.lin1Z=0,G.lin2X=0,G.lin2Y=0,G.lin2Z=0,G.ang1X=0,G.ang1Y=0,G.ang1Z=0,G.ang2X=0,G.ang2Y=0,G.ang2Z=0,O.rhs=0,O.cfm=0,O.minImpulse=0,O.maxImpulse=0,O.motorSpeed=0,O.motorMaxImpulse=0,O.impulse=null,O.impulse=F,(N=O).rhs=M,N.cfm=0,N.minImpulse=-1/0,N.maxImpulse=1/0,(D=N.jacobian).lin1X=0,D.lin1Y=1,D.lin1Z=0,D.lin2X=0,D.lin2Y=1,D.lin2Z=0,D.ang1X=r,D.ang1Y=e,D.ang1Z=_,D.ang2X=b,D.ang2Y=f,D.ang2Z=x;var H=this._impulses[2],U=t.rows[t.numRows++],J=U.jacobian;if(J.lin1X=0,J.lin1Y=0,J.lin1Z=0,J.lin2X=0,J.lin2Y=0,J.lin2Z=0,J.ang1X=0,J.ang1Y=0,J.ang1Z=0,J.ang2X=0,J.ang2Y=0,J.ang2Z=0,U.rhs=0,U.cfm=0,U.minImpulse=0,U.maxImpulse=0,U.motorSpeed=0,U.motorMaxImpulse=0,U.impulse=null,U.impulse=H,(N=U).rhs=Y,N.cfm=0,N.minImpulse=-1/0,N.maxImpulse=1/0,(D=N.jacobian).lin1X=0,D.lin1Y=0,D.lin1Z=1,D.lin2X=0,D.lin2Y=0,D.lin2Z=1,D.ang1X=h,D.ang1Y=l,D.ang1Z=c,D.ang2X=u,D.ang2Y=y,D.ang2Z=g,this._sd.frequency<=0||!a){var Q=this._impulses[3],$=t.rows[t.numRows++],K=$.jacobian;K.lin1X=0,K.lin1Y=0,K.lin1Z=0,K.lin2X=0,K.lin2Y=0,K.lin2Z=0,K.ang1X=0,K.ang1Y=0,K.ang1Z=0,K.ang2X=0,K.ang2Y=0,K.ang2Z=0,$.rhs=0,$.cfm=0,$.minImpulse=0,$.maxImpulse=0,$.motorSpeed=0,$.motorMaxImpulse=0,$.impulse=null,$.impulse=Q,N=$;var tt,it,at=this.angle,ot=this._lm,nt=this._sd,st=W.angularSlop;if(a)tt=0,it=1;else{if(nt.frequency>0){st=0;var rt=6.28318530717958*nt.frequency,et=nt.dampingRatio;et<W.minSpringDamperDampingRatio&&(et=W.minSpringDamperDampingRatio);var _t=i.dt,ht=2*et*rt,lt=rt*rt;nt.useSymplecticEuler?(tt=1/(_t*ht),it=lt/ht):(tt=1/(_t*(_t*lt+ht)),it=lt/(_t*lt+ht))}else tt=0,it=this._positionCorrectionAlgorithm==ut.BAUMGARTE?i.invDt*W.velocityBaumgarte:0;ot.motorTorque>0?(N.motorSpeed=ot.motorSpeed,N.motorMaxImpulse=ot.motorTorque*i.dt):(N.motorSpeed=0,N.motorMaxImpulse=0)}var ct,pt,vt,mt=ot.lowerLimit,bt=ot.upperLimit,ft=.5*(mt+bt);at=(((at-=ft)+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,at+=ft,mt>bt?(ct=0,pt=0,vt=0):mt==bt?(ct=-1/0,pt=1/0,vt=at-mt):at<mt?(ct=-1/0,pt=0,(vt=at-mt+st)>0&&(vt=0)):at>bt?(ct=0,pt=1/0,(vt=at-bt-st)<0&&(vt=0)):(ct=0,pt=0,vt=0);var xt=0==q?0:1/q;N.minImpulse=ct,N.maxImpulse=pt,N.cfm=tt*xt,N.rhs=vt*it,(D=N.jacobian).ang1X=this._basis.xX,D.ang1Y=this._basis.xY,D.ang1Z=this._basis.xZ,D.ang2X=this._basis.xX,D.ang2Y=this._basis.xY,D.ang2Z=this._basis.xZ}var yt=this._impulses[4],gt=t.rows[t.numRows++],Xt=gt.jacobian;Xt.lin1X=0,Xt.lin1Y=0,Xt.lin1Z=0,Xt.lin2X=0,Xt.lin2Y=0,Xt.lin2Z=0,Xt.ang1X=0,Xt.ang1Y=0,Xt.ang1Z=0,Xt.ang2X=0,Xt.ang2Y=0,Xt.ang2Z=0,gt.rhs=0,gt.cfm=0,gt.minImpulse=0,gt.maxImpulse=0,gt.motorSpeed=0,gt.motorMaxImpulse=0,gt.impulse=null,gt.impulse=yt,(N=gt).rhs=Z,N.cfm=0,N.minImpulse=-1/0,N.maxImpulse=1/0,(D=N.jacobian).ang1X=this._basis.yX,D.ang1Y=this._basis.yY,D.ang1Z=this._basis.yZ,D.ang2X=this._basis.yX,D.ang2Y=this._basis.yY,D.ang2Z=this._basis.yZ;var zt=this._impulses[5],Mt=t.rows[t.numRows++],Yt=Mt.jacobian;Yt.lin1X=0,Yt.lin1Y=0,Yt.lin1Z=0,Yt.lin2X=0,Yt.lin2Y=0,Yt.lin2Z=0,Yt.ang1X=0,Yt.ang1Y=0,Yt.ang1Z=0,Yt.ang2X=0,Yt.ang2Y=0,Yt.ang2Z=0,Mt.rhs=0,Mt.cfm=0,Mt.minImpulse=0,Mt.maxImpulse=0,Mt.motorSpeed=0,Mt.motorMaxImpulse=0,Mt.impulse=null,Mt.impulse=zt,(N=Mt).rhs=d,N.cfm=0,N.minImpulse=-1/0,N.maxImpulse=1/0,(D=N.jacobian).ang1X=this._basis.zX,D.ang1Y=this._basis.zY,D.ang1Z=this._basis.zZ,D.ang2X=this._basis.zX,D.ang2Y=this._basis.zY,D.ang2Z=this._basis.zZ},_syncAnchors:function(){Lt.prototype._syncAnchors.call(this);var t,i,a,o,n,s,r,e,_,h,l,c,p,v,m,b,f,x,u,y,g,X,z,M,Y,Z,d,I,V,L,w,A,k,B,P,T,S,C,q,R=this._basis,E=R.joint._b1._invMass,j=R.joint._b2._invMass,N=R.joint._basisX1X*R.joint._basisX2X+R.joint._basisX1Y*R.joint._basisX2Y+R.joint._basisX1Z*R.joint._basisX2Z;if(N<-.999999999){var D,F,O,W,G=R.joint._basisX1X,H=R.joint._basisX1Y,U=R.joint._basisX1Z,J=G*G,Q=H*H,$=U*U;J<Q?J<$?(D=0,F=U*(W=1/Math.sqrt(Q+$)),O=-H*W):(D=H*(W=1/Math.sqrt(J+Q)),F=-G*W,O=0):Q<$?(D=-U*(W=1/Math.sqrt($+J)),F=0,O=G*W):(D=H*(W=1/Math.sqrt(J+Q)),F=-G*W,O=0),t=D,i=F,a=O,o=0}else{var K,tt,it;K=R.joint._basisX1Y*R.joint._basisX2Z-R.joint._basisX1Z*R.joint._basisX2Y,tt=R.joint._basisX1Z*R.joint._basisX2X-R.joint._basisX1X*R.joint._basisX2Z,it=R.joint._basisX1X*R.joint._basisX2Y-R.joint._basisX1Y*R.joint._basisX2X;var at=Math.sqrt(.5*(1+N));t=K*=N=.5/at,i=tt*=N,a=it*=N,o=at}var ot=(A=0)*(T=t)+(k=0)*(S=i)+(B=0)*(C=a)+(P=1)*(q=o);if(ot<0&&(ot=-ot,T=-T,S=-S,C=-C,q=-q),ot>.999999){var nt=(T=A+(T-A)*(E/(E+j)))*T+(S=k+(S-k)*(E/(E+j)))*S+(C=B+(C-B)*(E/(E+j)))*C+(q=P+(q-P)*(E/(E+j)))*q;nt>1e-32&&(nt=1/Math.sqrt(nt)),n=T*nt,s=S*nt,r=C*nt,e=q*nt}else{var st=E/(E+j)*Math.acos(ot),rt=(T+=A*-ot)*T+(S+=k*-ot)*S+(C+=B*-ot)*C+(q+=P*-ot)*q;rt>1e-32&&(rt=1/Math.sqrt(rt)),T*=rt,S*=rt,C*=rt,q*=rt;var et=Math.sin(st),_t=Math.cos(st);n=(A*=_t)+T*et,s=(k*=_t)+S*et,r=(B*=_t)+C*et,e=(P*=_t)+q*et}var ht=2*n,lt=2*s,ct=2*r,pt=n*ht,vt=s*lt,mt=r*ct,bt=n*lt,ft=s*ct,xt=n*ct,ut=e*ht,yt=e*lt,gt=e*ct;_=bt-gt,h=xt+yt,l=bt+gt,c=1-pt-mt,p=ft-ut,v=xt-yt,m=ft+ut,b=1-pt-vt,f=(1-vt-mt)*R.joint._basisX1X+_*R.joint._basisX1Y+h*R.joint._basisX1Z,x=l*R.joint._basisX1X+c*R.joint._basisX1Y+p*R.joint._basisX1Z,u=v*R.joint._basisX1X+m*R.joint._basisX1Y+b*R.joint._basisX1Z,Z=R.xX,d=R.xY,I=R.xZ,V=R.yX,L=R.yY,w=R.yZ;var Xt=Z*f+d*x+I*u;if(Xt<-.999999999){var zt,Mt,Yt,Zt,dt=Z,It=d,Vt=I,wt=dt*dt,At=It*It,kt=Vt*Vt;wt<At?wt<kt?(zt=0,Mt=Vt*(Zt=1/Math.sqrt(At+kt)),Yt=-It*Zt):(zt=It*(Zt=1/Math.sqrt(wt+At)),Mt=-dt*Zt,Yt=0):At<kt?(zt=-Vt*(Zt=1/Math.sqrt(kt+wt)),Mt=0,Yt=dt*Zt):(zt=It*(Zt=1/Math.sqrt(wt+At)),Mt=-dt*Zt,Yt=0),n=zt,s=Mt,r=Yt,e=0}else{var Bt,Pt,Tt;Bt=d*u-I*x,Pt=I*f-Z*u,Tt=Z*x-d*f;var St=Math.sqrt(.5*(1+Xt));n=Bt*=Xt=.5/St,s=Pt*=Xt,r=Tt*=Xt,e=St}var Ct,qt,Rt,Et=2*n,jt=2*s,Nt=2*r,Dt=n*Et,Ft=s*jt,Ot=r*Nt,Wt=n*jt,Gt=s*Nt,Ht=n*Nt,Ut=e*Et,Jt=e*jt,Qt=e*Nt;if((z=x*(X=(v=Ht-Jt)*V+(m=Gt+Ut)*L+(b=1-Dt-Ft)*w)-u*(g=(l=Wt+Qt)*V+(c=1-Dt-Ot)*L+(p=Gt-Ut)*w))*z+(M=u*(y=(1-Ft-Ot)*V+(_=Wt-Qt)*L+(h=Ht+Jt)*w)-f*X)*M+(Y=f*g-x*y)*Y>1e-6){var $t=z*z+M*M+Y*Y;$t>0&&($t=1/Math.sqrt($t)),z*=$t,M*=$t,Y*=$t}else{var Kt,ti=f,ii=x,ai=u,oi=ti*ti,ni=ii*ii,si=ai*ai;oi<ni?oi<si?(z=0,M=ai*(Kt=1/Math.sqrt(ni+si)),Y=-ii*Kt):(z=ii*(Kt=1/Math.sqrt(oi+ni)),M=-ti*Kt,Y=0):ni<si?(z=-ai*(Kt=1/Math.sqrt(si+oi)),M=0,Y=ti*Kt):(z=ii*(Kt=1/Math.sqrt(oi+ni)),M=-ti*Kt,Y=0)}y=M*u-Y*x,g=Y*f-z*u,X=z*x-M*f,R.xX=f,R.xY=x,R.xZ=u,R.yX=y,R.yY=g,R.yZ=X,R.zX=z,R.zY=M,R.zZ=Y,Ct=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,qt=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,Rt=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;var ri,ei,_i,hi=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,li=hi<=-1?3.14159265358979:hi>=1?0:Math.acos(hi),ci=Ct*Ct+qt*qt+Rt*Rt;ci>0&&(ci=1/Math.sqrt(ci)),Ct*=ci,qt*=ci,Rt*=ci,Ct*=li,qt*=li,Rt*=li,this.angularErrorY=Ct*this._basis.yX+qt*this._basis.yY+Rt*this._basis.yZ,this.angularErrorZ=Ct*this._basis.zX+qt*this._basis.zY+Rt*this._basis.zZ,ri=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,ei=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,_i=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,hi=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=hi<=-1?3.14159265358979:hi>=1?0:Math.acos(hi),ri*this._basis.xX+ei*this._basis.xY+_i*this._basis.xZ<0&&(this.angle=-this.angle),this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z},_getVelocitySolverInfo:function(t,i){Lt.prototype._getVelocitySolverInfo.call(this,t,i),this.getInfo(i,t,!1)},_getPositionSolverInfo:function(t){Lt.prototype._getPositionSolverInfo.call(this,t),this.getInfo(t,null,!0)},getAxis1:function(){var t=new F,i=t;return i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z,t},getAxis2:function(){var t=new F,i=t;return i.x=this._basisX2X,i.y=this._basisX2Y,i.z=this._basisX2Z,t},getAxis1To:function(t){var i=t;i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z},getAxis2To:function(t){var i=t;i.x=this._basisX2X,i.y=this._basisX2Y,i.z=this._basisX2Z},getLocalAxis1:function(){var t=new F,i=t;return i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z,t},getLocalAxis2:function(){var t=new F,i=t;return i.x=this._localBasisX2X,i.y=this._localBasisX2Y,i.z=this._localBasisX2Z,t},getLocalAxis1To:function(t){var i=t;i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z},getLocalAxis2To:function(t){var i=t;i.x=this._localBasisX2X,i.y=this._localBasisX2Y,i.z=this._localBasisX2Z},getSpringDamper:function(){return this._sd},getLimitMotor:function(){return this._lm},getAngle:function(){return this.angle}});var Nt=function(){At.call(this),this.localAxis1=new F(1,0,0),this.localAxis2=new F(1,0,0),this.springDamper=new Wt,this.limitMotor=new Dt};Nt.__super__=At,Nt.prototype=$extend(At.prototype,{init:function(t,i,a,o){var n,s,r;this._init(t,i,a);var e,_,h,l=o;n=l.x,s=l.y,r=l.z,e=t._transform._rotation00*n+t._transform._rotation10*s+t._transform._rotation20*r,_=t._transform._rotation01*n+t._transform._rotation11*s+t._transform._rotation21*r,h=t._transform._rotation02*n+t._transform._rotation12*s+t._transform._rotation22*r,n=e,s=_,r=h;var c,p,v,m=this.localAxis1;m.x=n,m.y=s,m.z=r;var b,f,x,u=o;c=u.x,p=u.y,v=u.z,b=i._transform._rotation00*c+i._transform._rotation10*p+i._transform._rotation20*v,f=i._transform._rotation01*c+i._transform._rotation11*p+i._transform._rotation21*v,x=i._transform._rotation02*c+i._transform._rotation12*p+i._transform._rotation22*v,c=b,p=f,v=x;var y=this.localAxis2;return y.x=c,y.y=p,y.z=v,this}});var Dt=function(){this.lowerLimit=1,this.upperLimit=0,this.motorTorque=0};Dt.prototype={setLimits:function(t,i){return this.lowerLimit=t,this.upperLimit=i,this},setMotor:function(t,i){return this.motorSpeed=t,this.motorTorque=i,this},clone:function(){var t=new Dt;return t.lowerLimit=this.lowerLimit,t.upperLimit=this.upperLimit,t.motorSpeed=this.motorSpeed,t.motorTorque=this.motorTorque,t}};var Ft=function(t){Lt.call(this,t,0),this._sd=t.springDamper.clone()};Ft.__super__=Lt,Ft.prototype=$extend(Lt.prototype,{getInfo:function(t,i,a){if(!(this._sd.frequency>0&&a)){var o,n,s,r,e;if(o=this._anchor2X-this._anchor1X,n=this._anchor2Y-this._anchor1Y,s=this._anchor2Z-this._anchor1Z,this._sd.frequency>0){var _=6.28318530717958*this._sd.frequency,h=this._sd.dampingRatio;h<W.minSpringDamperDampingRatio&&(h=W.minSpringDamperDampingRatio);var l=i.dt,c=2*h*_,p=_*_;this._sd.useSymplecticEuler?(r=1/(l*c),e=p/c):(r=1/(l*(l*p+c)),e=p/(l*p+c)),r*=this._b1._invMass+this._b2._invMass}else r=0,e=a?1:this._positionCorrectionAlgorithm==ut.BAUMGARTE?i.invDt*W.velocityBaumgarte:0;var v,m,b,f,x,u,y,g,X,z,M,Y,Z,d,I,V,L,w,A=o*e,k=n*e,B=s*e;v=-(v=0),m=-(m=-this._relativeAnchor1Z),b=-(b=this._relativeAnchor1Y),f=-(f=this._relativeAnchor1Z),x=-(x=0),u=-(u=-this._relativeAnchor1X),y=-(y=-this._relativeAnchor1Y),g=-(g=this._relativeAnchor1X),X=-(X=0),z=-(z=0),M=-(M=-this._relativeAnchor2Z),Y=-(Y=this._relativeAnchor2Y),Z=-(Z=this._relativeAnchor2Z),d=-(d=0),I=-(I=-this._relativeAnchor2X),V=-(V=-this._relativeAnchor2Y),L=-(L=this._relativeAnchor2X),w=-(w=0);var P=this._impulses[0],T=t.rows[t.numRows++],S=T.jacobian;S.lin1X=0,S.lin1Y=0,S.lin1Z=0,S.lin2X=0,S.lin2Y=0,S.lin2Z=0,S.ang1X=0,S.ang1Y=0,S.ang1Z=0,S.ang2X=0,S.ang2Y=0,S.ang2Z=0,T.rhs=0,T.cfm=0,T.minImpulse=0,T.maxImpulse=0,T.motorSpeed=0,T.motorMaxImpulse=0,T.impulse=null,T.impulse=P;var C=T;C.rhs=A,C.cfm=r,C.minImpulse=-1/0,C.maxImpulse=1/0;var q=C.jacobian;q.lin1X=1,q.lin1Y=0,q.lin1Z=0,q.lin2X=1,q.lin2Y=0,q.lin2Z=0,q.ang1X=v,q.ang1Y=m,q.ang1Z=b,q.ang2X=z,q.ang2Y=M,q.ang2Z=Y;var R=this._impulses[1],E=t.rows[t.numRows++],j=E.jacobian;j.lin1X=0,j.lin1Y=0,j.lin1Z=0,j.lin2X=0,j.lin2Y=0,j.lin2Z=0,j.ang1X=0,j.ang1Y=0,j.ang1Z=0,j.ang2X=0,j.ang2Y=0,j.ang2Z=0,E.rhs=0,E.cfm=0,E.minImpulse=0,E.maxImpulse=0,E.motorSpeed=0,E.motorMaxImpulse=0,E.impulse=null,E.impulse=R,(C=E).rhs=k,C.cfm=r,C.minImpulse=-1/0,C.maxImpulse=1/0,(q=C.jacobian).lin1X=0,q.lin1Y=1,q.lin1Z=0,q.lin2X=0,q.lin2Y=1,q.lin2Z=0,q.ang1X=f,q.ang1Y=x,q.ang1Z=u,q.ang2X=Z,q.ang2Y=d,q.ang2Z=I;var N=this._impulses[2],D=t.rows[t.numRows++],F=D.jacobian;F.lin1X=0,F.lin1Y=0,F.lin1Z=0,F.lin2X=0,F.lin2Y=0,F.lin2Z=0,F.ang1X=0,F.ang1Y=0,F.ang1Z=0,F.ang2X=0,F.ang2Y=0,F.ang2Z=0,D.rhs=0,D.cfm=0,D.minImpulse=0,D.maxImpulse=0,D.motorSpeed=0,D.motorMaxImpulse=0,D.impulse=null,D.impulse=N,(C=D).rhs=B,C.cfm=r,C.minImpulse=-1/0,C.maxImpulse=1/0,(q=C.jacobian).lin1X=0,q.lin1Y=0,q.lin1Z=1,q.lin2X=0,q.lin2Y=0,q.lin2Z=1,q.ang1X=y,q.ang1Y=g,q.ang1Z=X,q.ang2X=V,q.ang2Y=L,q.ang2Z=w}},_getVelocitySolverInfo:function(t,i){Lt.prototype._getVelocitySolverInfo.call(this,t,i),this.getInfo(i,t,!1)},_getPositionSolverInfo:function(t){Lt.prototype._getPositionSolverInfo.call(this,t),this.getInfo(t,null,!0)},getSpringDamper:function(){return this._sd}});var Ot=function(){At.call(this),this.springDamper=new Wt};Ot.__super__=At,Ot.prototype=$extend(At.prototype,{init:function(t,i,a){return this._init(t,i,a),this}});var Wt=function(){this.frequency=0,this.dampingRatio=0,this.useSymplecticEuler=!1};Wt.prototype={setSpring:function(t,i){return this.frequency=t,this.dampingRatio=i,this},setSymplecticEuler:function(t){return this.useSymplecticEuler=t,this},clone:function(){var t=new Wt;return t.frequency=this.frequency,t.dampingRatio=this.dampingRatio,t.useSymplecticEuler=this.useSymplecticEuler,t}};var Gt=function(){this.lowerLimit=1,this.upperLimit=0,this.motorForce=0};Gt.prototype={setLimits:function(t,i){return this.lowerLimit=t,this.upperLimit=i,this},setMotor:function(t,i){return this.motorSpeed=t,this.motorForce=i,this},clone:function(){var t=new Gt;return t.lowerLimit=this.lowerLimit,t.upperLimit=this.upperLimit,t.motorSpeed=this.motorSpeed,t.motorForce=this.motorForce,t}};var Ht=function(t){Lt.call(this,t,St.UNIVERSAL);var i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;var a=t.localAxis2;if(this._localBasisZ2X=a.x,this._localBasisZ2Y=a.y,this._localBasisZ2Z=a.z,this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var o=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;o>0&&(o=1/Math.sqrt(o)),this._localBasisX1X*=o,this._localBasisX1Y*=o,this._localBasisX1Z*=o}if(this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z==0)this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=1;else{var n=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;n>0&&(n=1/Math.sqrt(n)),this._localBasisZ2X*=n,this._localBasisZ2Y*=n,this._localBasisZ2Z*=n}var s,r,e,_,h,l,c,p,v,m,b,f,x,u,y,g,X,z,M,Y,Z,d,I,V,L,w,A,k,B,P,T,S,C,q,R=this._b1._transform,E=this._b2._transform;if(s=R._rotation00*this._localBasisX1X+R._rotation01*this._localBasisX1Y+R._rotation02*this._localBasisX1Z,r=R._rotation10*this._localBasisX1X+R._rotation11*this._localBasisX1Y+R._rotation12*this._localBasisX1Z,e=R._rotation20*this._localBasisX1X+R._rotation21*this._localBasisX1Y+R._rotation22*this._localBasisX1Z,g=E._rotation00*this._localBasisZ2X+E._rotation01*this._localBasisZ2Y+E._rotation02*this._localBasisZ2Z,(c=(u=E._rotation10*this._localBasisZ2X+E._rotation11*this._localBasisZ2Y+E._rotation12*this._localBasisZ2Z)*e-(y=E._rotation20*this._localBasisZ2X+E._rotation21*this._localBasisZ2Y+E._rotation22*this._localBasisZ2Z)*r)*c+(p=y*s-(x=g)*e)*p+(v=x*r-u*s)*v==0){var j,N=s,D=r,F=e,O=N*N,W=D*D,G=F*F;O<W?O<G?(c=0,p=F*(j=1/Math.sqrt(W+G)),v=-D*j):(c=D*(j=1/Math.sqrt(O+W)),p=-N*j,v=0):W<G?(c=-F*(j=1/Math.sqrt(G+O)),p=0,v=N*j):(c=D*(j=1/Math.sqrt(O+W)),p=-N*j,v=0)}_=r*v-e*p,h=e*c-s*v,l=s*p-r*c,m=p*y-v*u,b=v*x-c*y,f=c*u-p*x,X=R._rotation00*s+R._rotation10*r+R._rotation20*e,z=R._rotation01*s+R._rotation11*r+R._rotation21*e,M=R._rotation02*s+R._rotation12*r+R._rotation22*e,this._localBasisX1X=X,this._localBasisX1Y=z,this._localBasisX1Z=M,Y=R._rotation00*c+R._rotation10*p+R._rotation20*v,Z=R._rotation01*c+R._rotation11*p+R._rotation21*v,d=R._rotation02*c+R._rotation12*p+R._rotation22*v,this._localBasisY1X=Y,this._localBasisY1Y=Z,this._localBasisY1Z=d,I=R._rotation00*_+R._rotation10*h+R._rotation20*l,V=R._rotation01*_+R._rotation11*h+R._rotation21*l,L=R._rotation02*_+R._rotation12*h+R._rotation22*l,this._localBasisZ1X=I,this._localBasisZ1Y=V,this._localBasisZ1Z=L,w=E._rotation00*m+E._rotation10*b+E._rotation20*f,A=E._rotation01*m+E._rotation11*b+E._rotation21*f,k=E._rotation02*m+E._rotation12*b+E._rotation22*f,this._localBasisX2X=w,this._localBasisX2Y=A,this._localBasisX2Z=k,B=E._rotation00*c+E._rotation10*p+E._rotation20*v,P=E._rotation01*c+E._rotation11*p+E._rotation21*v,T=E._rotation02*c+E._rotation12*p+E._rotation22*v,this._localBasisY2X=B,this._localBasisY2Y=P,this._localBasisY2Z=T,S=E._rotation00*x+E._rotation10*u+E._rotation20*y,C=E._rotation01*x+E._rotation11*u+E._rotation21*y,q=E._rotation02*x+E._rotation12*u+E._rotation22*y,this._localBasisZ2X=S,this._localBasisZ2Y=C,this._localBasisZ2Z=q,this._angleX=0,this._angleY=0,this._angleZ=0,this.xSingular=!1,this.ySingular=!1,this.zSingular=!1,this._sd1=t.springDamper1.clone(),this._sd2=t.springDamper2.clone(),this._lm1=t.limitMotor1.clone(),this._lm2=t.limitMotor2.clone()};Ht.__super__=Lt,Ht.prototype=$extend(Lt.prototype,{getInfo:function(t,i,a){var o,n,s,r,e,_,h,l,c,p,v,m,b,f,x,u,y,g,X=a?1:this._positionCorrectionAlgorithm==ut.BAUMGARTE?i.invDt*W.velocityBaumgarte:0,z=this.linearErrorX*X,M=this.linearErrorY*X,Y=this.linearErrorZ*X,Z=this._angleY*X;o=-(o=0),n=-(n=-this._relativeAnchor1Z),s=-(s=this._relativeAnchor1Y),r=-(r=this._relativeAnchor1Z),e=-(e=0),_=-(_=-this._relativeAnchor1X),h=-(h=-this._relativeAnchor1Y),l=-(l=this._relativeAnchor1X),c=-(c=0),p=-(p=0),v=-(v=-this._relativeAnchor2Z),m=-(m=this._relativeAnchor2Y),b=-(b=this._relativeAnchor2Z),f=-(f=0),x=-(x=-this._relativeAnchor2X),u=-(u=-this._relativeAnchor2Y),y=-(y=this._relativeAnchor2X),g=-(g=0);var d=this._axisXX,I=this._axisXY,V=this._axisXZ,L=(this._b1._invInertia00*d+this._b1._invInertia01*I+this._b1._invInertia02*V)*d+(this._b1._invInertia10*d+this._b1._invInertia11*I+this._b1._invInertia12*V)*I+(this._b1._invInertia20*d+this._b1._invInertia21*I+this._b1._invInertia22*V)*V,w=(this._b2._invInertia00*d+this._b2._invInertia01*I+this._b2._invInertia02*V)*d+(this._b2._invInertia10*d+this._b2._invInertia11*I+this._b2._invInertia12*V)*I+(this._b2._invInertia20*d+this._b2._invInertia21*I+this._b2._invInertia22*V)*V;if(L>0){var A=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,k=d*this._relativeAnchor1X+I*this._relativeAnchor1Y+V*this._relativeAnchor1Z,B=A-k*k;B>0&&(L=this._b1._invMass>0?1/(1/L+this._b1._mass*B):0)}if(w>0){var P=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,T=d*this._relativeAnchor2X+I*this._relativeAnchor2Y+V*this._relativeAnchor2Z,S=P-T*T;S>0&&(w=this._b2._invMass>0?1/(1/w+this._b2._mass*S):0)}var C=L+w==0?0:1/(L+w),q=this._axisZX,R=this._axisZY,E=this._axisZZ,j=(this._b1._invInertia00*q+this._b1._invInertia01*R+this._b1._invInertia02*E)*q+(this._b1._invInertia10*q+this._b1._invInertia11*R+this._b1._invInertia12*E)*R+(this._b1._invInertia20*q+this._b1._invInertia21*R+this._b1._invInertia22*E)*E,N=(this._b2._invInertia00*q+this._b2._invInertia01*R+this._b2._invInertia02*E)*q+(this._b2._invInertia10*q+this._b2._invInertia11*R+this._b2._invInertia12*E)*R+(this._b2._invInertia20*q+this._b2._invInertia21*R+this._b2._invInertia22*E)*E;if(j>0){var D=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,F=q*this._relativeAnchor1X+R*this._relativeAnchor1Y+E*this._relativeAnchor1Z,O=D-F*F;O>0&&(j=this._b1._invMass>0?1/(1/j+this._b1._mass*O):0)}if(N>0){var G=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,H=q*this._relativeAnchor2X+R*this._relativeAnchor2Y+E*this._relativeAnchor2Z,U=G-H*H;U>0&&(N=this._b2._invMass>0?1/(1/N+this._b2._mass*U):0)}var J=j+N==0?0:1/(j+N),Q=this._impulses[0],$=t.rows[t.numRows++],K=$.jacobian;K.lin1X=0,K.lin1Y=0,K.lin1Z=0,K.lin2X=0,K.lin2Y=0,K.lin2Z=0,K.ang1X=0,K.ang1Y=0,K.ang1Z=0,K.ang2X=0,K.ang2Y=0,K.ang2Z=0,$.rhs=0,$.cfm=0,$.minImpulse=0,$.maxImpulse=0,$.motorSpeed=0,$.motorMaxImpulse=0,$.impulse=null,$.impulse=Q;var tt=$;tt.rhs=z,tt.cfm=0,tt.minImpulse=-1/0,tt.maxImpulse=1/0;var it=tt.jacobian;it.lin1X=1,it.lin1Y=0,it.lin1Z=0,it.lin2X=1,it.lin2Y=0,it.lin2Z=0,it.ang1X=o,it.ang1Y=n,it.ang1Z=s,it.ang2X=p,it.ang2Y=v,it.ang2Z=m;var at=this._impulses[1],ot=t.rows[t.numRows++],nt=ot.jacobian;nt.lin1X=0,nt.lin1Y=0,nt.lin1Z=0,nt.lin2X=0,nt.lin2Y=0,nt.lin2Z=0,nt.ang1X=0,nt.ang1Y=0,nt.ang1Z=0,nt.ang2X=0,nt.ang2Y=0,nt.ang2Z=0,ot.rhs=0,ot.cfm=0,ot.minImpulse=0,ot.maxImpulse=0,ot.motorSpeed=0,ot.motorMaxImpulse=0,ot.impulse=null,ot.impulse=at,(tt=ot).rhs=M,tt.cfm=0,tt.minImpulse=-1/0,tt.maxImpulse=1/0,(it=tt.jacobian).lin1X=0,it.lin1Y=1,it.lin1Z=0,it.lin2X=0,it.lin2Y=1,it.lin2Z=0,it.ang1X=r,it.ang1Y=e,it.ang1Z=_,it.ang2X=b,it.ang2Y=f,it.ang2Z=x;var st=this._impulses[2],rt=t.rows[t.numRows++],et=rt.jacobian;if(et.lin1X=0,et.lin1Y=0,et.lin1Z=0,et.lin2X=0,et.lin2Y=0,et.lin2Z=0,et.ang1X=0,et.ang1Y=0,et.ang1Z=0,et.ang2X=0,et.ang2Y=0,et.ang2Z=0,rt.rhs=0,rt.cfm=0,rt.minImpulse=0,rt.maxImpulse=0,rt.motorSpeed=0,rt.motorMaxImpulse=0,rt.impulse=null,rt.impulse=st,(tt=rt).rhs=Y,tt.cfm=0,tt.minImpulse=-1/0,tt.maxImpulse=1/0,(it=tt.jacobian).lin1X=0,it.lin1Y=0,it.lin1Z=1,it.lin2X=0,it.lin2Y=0,it.lin2Z=1,it.ang1X=h,it.ang1Y=l,it.ang1Z=c,it.ang2X=u,it.ang2Y=y,it.ang2Z=g,!this.xSingular&&(this._sd1.frequency<=0||!a)){var _t=this._impulses[3],ht=t.rows[t.numRows++],lt=ht.jacobian;lt.lin1X=0,lt.lin1Y=0,lt.lin1Z=0,lt.lin2X=0,lt.lin2Y=0,lt.lin2Z=0,lt.ang1X=0,lt.ang1Y=0,lt.ang1Z=0,lt.ang2X=0,lt.ang2Y=0,lt.ang2Z=0,ht.rhs=0,ht.cfm=0,ht.minImpulse=0,ht.maxImpulse=0,ht.motorSpeed=0,ht.motorMaxImpulse=0,ht.impulse=null,ht.impulse=_t,tt=ht;var ct,pt,vt=this._angleX,mt=this._lm1,bt=this._sd1,ft=W.angularSlop;if(a)ct=0,pt=1;else{if(bt.frequency>0){ft=0;var xt=6.28318530717958*bt.frequency,yt=bt.dampingRatio;yt<W.minSpringDamperDampingRatio&&(yt=W.minSpringDamperDampingRatio);var gt=i.dt,Xt=2*yt*xt,zt=xt*xt;bt.useSymplecticEuler?(ct=1/(gt*Xt),pt=zt/Xt):(ct=1/(gt*(gt*zt+Xt)),pt=zt/(gt*zt+Xt))}else ct=0,pt=this._positionCorrectionAlgorithm==ut.BAUMGARTE?i.invDt*W.velocityBaumgarte:0;mt.motorTorque>0?(tt.motorSpeed=mt.motorSpeed,tt.motorMaxImpulse=mt.motorTorque*i.dt):(tt.motorSpeed=0,tt.motorMaxImpulse=0)}var Mt,Yt,Zt,dt=mt.lowerLimit,It=mt.upperLimit,Vt=.5*(dt+It);vt=(((vt-=Vt)+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,vt+=Vt,dt>It?(Mt=0,Yt=0,Zt=0):dt==It?(Mt=-1/0,Yt=1/0,Zt=vt-dt):vt<dt?(Mt=-1/0,Yt=0,(Zt=vt-dt+ft)>0&&(Zt=0)):vt>It?(Mt=0,Yt=1/0,(Zt=vt-It-ft)<0&&(Zt=0)):(Mt=0,Yt=0,Zt=0);var Lt=0==C?0:1/C;tt.minImpulse=Mt,tt.maxImpulse=Yt,tt.cfm=ct*Lt,tt.rhs=Zt*pt,(it=tt.jacobian).ang1X=this._axisXX,it.ang1Y=this._axisXY,it.ang1Z=this._axisXZ,it.ang2X=this._axisXX,it.ang2Y=this._axisXY,it.ang2Z=this._axisXZ}if(!this.ySingular){var wt=this._impulses[4],At=t.rows[t.numRows++],kt=At.jacobian;kt.lin1X=0,kt.lin1Y=0,kt.lin1Z=0,kt.lin2X=0,kt.lin2Y=0,kt.lin2Z=0,kt.ang1X=0,kt.ang1Y=0,kt.ang1Z=0,kt.ang2X=0,kt.ang2Y=0,kt.ang2Z=0,At.rhs=0,At.cfm=0,At.minImpulse=0,At.maxImpulse=0,At.motorSpeed=0,At.motorMaxImpulse=0,At.impulse=null,At.impulse=wt,(tt=At).rhs=Z,tt.cfm=0,tt.minImpulse=-1/0,tt.maxImpulse=1/0,(it=tt.jacobian).ang1X=this._axisYX,it.ang1Y=this._axisYY,it.ang1Z=this._axisYZ,it.ang2X=this._axisYX,it.ang2Y=this._axisYY,it.ang2Z=this._axisYZ}if(!this.zSingular&&(this._sd2.frequency<=0||!a)){var Bt=this._impulses[5],Pt=t.rows[t.numRows++],Tt=Pt.jacobian;Tt.lin1X=0,Tt.lin1Y=0,Tt.lin1Z=0,Tt.lin2X=0,Tt.lin2Y=0,Tt.lin2Z=0,Tt.ang1X=0,Tt.ang1Y=0,Tt.ang1Z=0,Tt.ang2X=0,Tt.ang2Y=0,Tt.ang2Z=0,Pt.rhs=0,Pt.cfm=0,Pt.minImpulse=0,Pt.maxImpulse=0,Pt.motorSpeed=0,Pt.motorMaxImpulse=0,Pt.impulse=null,Pt.impulse=Bt,tt=Pt;var St,Ct,qt=this._angleZ,Rt=this._lm2,Et=this._sd2,jt=W.angularSlop;if(a)St=0,Ct=1;else{if(Et.frequency>0){jt=0;var Nt=6.28318530717958*Et.frequency,Dt=Et.dampingRatio;Dt<W.minSpringDamperDampingRatio&&(Dt=W.minSpringDamperDampingRatio);var Ft=i.dt,Ot=2*Dt*Nt,Wt=Nt*Nt;Et.useSymplecticEuler?(St=1/(Ft*Ot),Ct=Wt/Ot):(St=1/(Ft*(Ft*Wt+Ot)),Ct=Wt/(Ft*Wt+Ot))}else St=0,Ct=this._positionCorrectionAlgorithm==ut.BAUMGARTE?i.invDt*W.velocityBaumgarte:0;Rt.motorTorque>0?(tt.motorSpeed=Rt.motorSpeed,tt.motorMaxImpulse=Rt.motorTorque*i.dt):(tt.motorSpeed=0,tt.motorMaxImpulse=0)}var Gt,Ht,Ut,Jt=Rt.lowerLimit,Qt=Rt.upperLimit,$t=.5*(Jt+Qt);qt=(((qt-=$t)+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,qt+=$t,Jt>Qt?(Gt=0,Ht=0,Ut=0):Jt==Qt?(Gt=-1/0,Ht=1/0,Ut=qt-Jt):qt<Jt?(Gt=-1/0,Ht=0,(Ut=qt-Jt+jt)>0&&(Ut=0)):qt>Qt?(Gt=0,Ht=1/0,(Ut=qt-Qt-jt)<0&&(Ut=0)):(Gt=0,Ht=0,Ut=0);var Kt=0==J?0:1/J;tt.minImpulse=Gt,tt.maxImpulse=Ht,tt.cfm=St*Kt,tt.rhs=Ut*Ct,(it=tt.jacobian).ang1X=this._axisZX,it.ang1Y=this._axisZY,it.ang1Z=this._axisZZ,it.ang2X=this._axisZX,it.ang2Y=this._axisZY,it.ang2Z=this._axisZZ}},_syncAnchors:function(){var t,i,a,o,n,s,r,e,_,h,l,c,p,v,m,b,f,x,u,y,g,X,z,M,Y,Z,d;Lt.prototype._syncAnchors.call(this),t=this._basisX1X,i=this._basisY1X,a=this._basisZ1X,o=this._basisX1Y,n=this._basisY1Y,s=this._basisZ1Y,r=this._basisX1Z,e=this._basisY1Z,_=this._basisZ1Z,h=this._basisX2X,l=this._basisY2X,c=this._basisZ2X,p=this._basisX2Y,v=this._basisY2Y,m=this._basisZ2Y,b=this._basisX2Z,f=this._basisY2Z,x=this._basisZ2Z,u=this._basisX1X,y=this._basisX1Y,g=this._basisX1Z,Y=this._basisZ2X,X=(Z=this._basisZ2Y)*g-(d=this._basisZ2Z)*y,z=d*u-Y*g,M=Y*y-Z*u,this._axisXX=z*d-M*Z,this._axisXY=M*Y-X*d,this._axisXZ=X*Z-z*Y,this._axisYX=X,this._axisYY=z,this._axisYZ=M,this._axisZX=y*M-g*z,this._axisZY=g*X-u*M,this._axisZZ=u*z-y*X;var I=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;I>0&&(I=1/Math.sqrt(I)),this._axisXX*=I,this._axisXY*=I,this._axisXZ*=I;var V=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;V>0&&(V=1/Math.sqrt(V)),this._axisYX*=V,this._axisYY*=V,this._axisYZ*=V;var L,w,A,k,B,P,T,S,C,q,R,E,j,N,D,F,O,W,G,H,U,J,Q,$,K,tt,it,at=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ;at>0&&(at=1/Math.sqrt(at)),this._axisZX*=at,this._axisZY*=at,this._axisZZ*=at,this.xSingular=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ==0,this.ySingular=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ==0,this.zSingular=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ==0,L=this._basisX1X,w=this._basisY1X,A=this._basisZ1X,k=this._basisX1Y,B=this._basisY1Y,P=this._basisZ1Y,T=this._basisX1Z,S=this._basisY1Z,C=this._basisZ1Z,q=this._basisX2X,R=this._basisY2X,E=this._basisZ2X,j=this._basisX2Y,N=this._basisY2Y,D=this._basisZ2Y,G=L*q+k*j+T*(F=this._basisX2Z),H=L*R+k*N+T*(O=this._basisY2Z),U=w*R+B*N+S*O,J=w*E+B*D+S*(W=this._basisZ2Z),Q=A*R+P*N+C*O,$=A*E+P*D+C*W;var ot=L*E+k*D+T*W;if(ot<=-1){var nt=Math.atan2(Q,U);K=.5*nt,tt=-1.570796326794895,it=.5*-nt}else if(ot>=1){var st=Math.atan2(Q,U);K=.5*st,tt=1.570796326794895,it=.5*st}else{var rt=Math.asin(ot);K=Math.atan2(-J,$),tt=rt,it=Math.atan2(-H,G)}this._angleX=K,this._angleY=tt,this._angleZ=it,this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z},_getVelocitySolverInfo:function(t,i){Lt.prototype._getVelocitySolverInfo.call(this,t,i),this.getInfo(i,t,!1)},_getPositionSolverInfo:function(t){Lt.prototype._getPositionSolverInfo.call(this,t),this.getInfo(t,null,!0)},getAxis1:function(){var t=new F,i=t;return i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z,t},getAxis2:function(){var t=new F,i=t;return i.x=this._basisZ2X,i.y=this._basisZ2Y,i.z=this._basisZ2Z,t},getAxis1To:function(t){var i=t;i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z},getAxis2To:function(t){var i=t;i.x=this._basisZ2X,i.y=this._basisZ2Y,i.z=this._basisZ2Z},getLocalAxis1:function(){var t=new F,i=t;return i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z,t},getLocalAxis2:function(){var t=new F,i=t;return i.x=this._localBasisZ2X,i.y=this._localBasisZ2Y,i.z=this._localBasisZ2Z,t},getLocalAxis1To:function(t){var i=t;i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z},getLocalAxis2To:function(t){var i=t;i.x=this._localBasisZ2X,i.y=this._localBasisZ2Y,i.z=this._localBasisZ2Z},getSpringDamper1:function(){return this._sd1},getSpringDamper2:function(){return this._sd2},getLimitMotor1:function(){return this._lm1},getLimitMotor2:function(){return this._lm2},getAngle1:function(){return this._angleX},getAngle2:function(){return this._angleZ}});var Ut=function(){At.call(this),this.localAxis1=new F(1,0,0),this.localAxis2=new F(1,0,0),this.springDamper1=new Wt,this.springDamper2=new Wt,this.limitMotor1=new Dt,this.limitMotor2=new Dt};Ut.__super__=At,Ut.prototype=$extend(At.prototype,{init:function(t,i,a,o,n){var s,r,e;this._init(t,i,a);var _,h,l,c=o;s=c.x,r=c.y,e=c.z,_=t._transform._rotation00*s+t._transform._rotation10*r+t._transform._rotation20*e,h=t._transform._rotation01*s+t._transform._rotation11*r+t._transform._rotation21*e,l=t._transform._rotation02*s+t._transform._rotation12*r+t._transform._rotation22*e,s=_,r=h,e=l;var p,v,m,b=this.localAxis1;b.x=s,b.y=r,b.z=e;var f,x,u,y=n;p=y.x,v=y.y,m=y.z,f=i._transform._rotation00*p+i._transform._rotation10*v+i._transform._rotation20*m,x=i._transform._rotation01*p+i._transform._rotation11*v+i._transform._rotation21*m,u=i._transform._rotation02*p+i._transform._rotation12*v+i._transform._rotation22*m,p=f,v=x,m=u;var g=this.localAxis2;return g.x=p,g.y=v,g.z=m,this}});var Jt=function(){},Qt=function(){this.invMLinN1X=0,this.invMLinN1Y=0,this.invMLinN1Z=0,this.invMLinN2X=0,this.invMLinN2Y=0,this.invMLinN2Z=0,this.invMAngN1X=0,this.invMAngN1Y=0,this.invMAngN1Z=0,this.invMAngN2X=0,this.invMAngN2Y=0,this.invMAngN2Z=0,this.invMLinT1X=0,this.invMLinT1Y=0,this.invMLinT1Z=0,this.invMLinT2X=0,this.invMLinT2Y=0,this.invMLinT2Z=0,this.invMAngT1X=0,this.invMAngT1Y=0,this.invMAngT1Z=0,this.invMAngT2X=0,this.invMAngT2Y=0,this.invMAngT2Z=0,this.invMLinB1X=0,this.invMLinB1Y=0,this.invMLinB1Z=0,this.invMLinB2X=0,this.invMLinB2Y=0,this.invMLinB2Z=0,this.invMAngB1X=0,this.invMAngB1Y=0,this.invMAngB1Z=0,this.invMAngB2X=0,this.invMAngB2Y=0,this.invMAngB2Z=0,this.massN=0,this.massTB00=0,this.massTB01=0,this.massTB10=0,this.massTB11=0},$t=function(){this.invMLin1X=0,this.invMLin1Y=0,this.invMLin1Z=0,this.invMLin2X=0,this.invMLin2Y=0,this.invMLin2Z=0,this.invMAng1X=0,this.invMAng1Y=0,this.invMAng1Z=0,this.invMAng2X=0,this.invMAng2Y=0,this.invMAng2Z=0,this.mass=0,this.massWithoutCfm=0},Kt=function(t){var i=new Array(t);this.iBounded=i;var a=new Array(t);this.iUnbounded=a;var o=new Array(t);this.signs=o;var n=new Array(t);this.b=n,this.numBounded=0,this.numUnbounded=0,this.matrixId=0};Kt.prototype={init:function(t){this.numBounded=t.numBounded;for(var i=0,a=this.numBounded;i<a;){var o=i++;this.iBounded[o]=t.iBounded[o],this.signs[o]=t.signs[o]}this.numUnbounded=t.numUnbounded,this.matrixId=0;for(var n=0,s=this.numUnbounded;n<s;){var r=n++,e=t.iUnbounded[r];this.iUnbounded[r]=e,this.matrixId|=1<<e}},computeImpulses:function(t,i,a,o,n,s,r){for(var e=0,_=this.numUnbounded;e<_;){var h=e++,l=this.iUnbounded[h],c=t.rows[l],p=a[l];this.b[l]=c.rhs*s-p-c.cfm*o[l]}for(var v=i._invMassWithoutCfm,m=0,b=this.numBounded;m<b;){var f=m++,x=this.iBounded[f],u=this.signs[f],y=t.rows[x],g=o[x],X=(u<0?y.minImpulse:u>0?y.maxImpulse:0)-g;if(n[x]=X,0!=X)for(var z=0,M=this.numUnbounded;z<M;){var Y=z++,Z=this.iUnbounded[Y],d=v[x][Z]*X,I=Z,V=this.b;V[I]=V[I]-d}}for(var L,w=this.iUnbounded,A=this.numUnbounded,k=0,B=0,P=A;B<P;){k|=1<<w[B++]}i._cacheComputed[k]?L=i._cachedSubmatrices[k]:(i.computeSubmatrix(k,w,A),i._cacheComputed[k]=!0,L=i._cachedSubmatrices[k]);for(var T=!0,S=0,C=this.numUnbounded;S<C;){for(var q=S++,R=this.iUnbounded[q],E=t.rows[R],j=o[R],N=j,D=0,F=this.numUnbounded;D<F;){var O=D++,G=this.iUnbounded[O];N+=this.b[G]*L[q][O]}if(N<E.minImpulse-W.directMlcpSolverEps||N>E.maxImpulse+W.directMlcpSolverEps){T=!1;break}n[R]=N-j}if(r)return!0;if(!T)return!1;for(var H=0,U=this.numBounded;H<U;){for(var J,Q=H++,$=this.iBounded[Q],K=t.rows[$],tt=this.signs[Q],it=o[$]+n[$],at=a[$],ot=0,nt=t.numRows;ot<nt;){var st=ot++;at+=v[$][st]*n[st]}if(J=K.rhs*s-at-K.cfm*it,tt<0&&J>W.directMlcpSolverEps||tt>0&&J<-W.directMlcpSolverEps){T=!1;break}}return T}};var ti=function(t){this.size=t,this.numBounded=0;var i=new Array(t);this.iBounded=i;var a=new Array(t);this.signs=a,this.numUnbounded=0;var o=new Array(t);this.iUnbounded=o},ii=function(t){this.maxRows=t,this.numBoundaries=0;var i=new Array(1<<t);this.boundaries=i,this.bbInfo=new ti(t)};ii.prototype={buildBoundariesRecursive:function(t,i){if(i==t.numRows)return null==this.boundaries[this.numBoundaries]&&(this.boundaries[this.numBoundaries]=new Kt(this.maxRows)),void this.boundaries[this.numBoundaries++].init(this.bbInfo);var a=t.rows[i],o=a.minImpulse>-1/0,n=a.maxImpulse<1/0;if(0==a.minImpulse&&0==a.maxImpulse){var s=this.bbInfo;return s.iBounded[s.numBounded]=i,s.signs[s.numBounded]=0,s.numBounded++,this.buildBoundariesRecursive(t,i+1),void this.bbInfo.numBounded--}var r=this.bbInfo;if(r.iUnbounded[r.numUnbounded]=i,r.numUnbounded++,this.buildBoundariesRecursive(t,i+1),this.bbInfo.numUnbounded--,o){var e=this.bbInfo;e.iBounded[e.numBounded]=i,e.signs[e.numBounded]=-1,e.numBounded++,this.buildBoundariesRecursive(t,i+1),this.bbInfo.numBounded--}if(n){var _=this.bbInfo;_.iBounded[_.numBounded]=i,_.signs[_.numBounded]=1,_.numBounded++,this.buildBoundariesRecursive(t,i+1),this.bbInfo.numBounded--}},buildBoundaries:function(t){this.numBoundaries=0;var i=this.bbInfo;i.numBounded=0,i.numUnbounded=0,this.buildBoundariesRecursive(t,0)}};var ai=function(t){this.n=t;var i=new Array(t);this.indices=i;var a=new Array(t);this.tmpIndices=a;for(var o=0,n=t;o<n;){var s=o++;this.indices[s]=s}};ai.prototype={getIndex:function(t){return this.indices[t]},select:function(t){for(var i=0;this.indices[i]!=t;)++i;for(;i>0;){var a=this.indices[i];this.indices[i]=this.indices[i-1],this.indices[i-1]=a,--i}},setSize:function(t){for(var i=0,a=0,o=0,n=this.n;o<n;){var s=o++,r=this.indices[s];r<t?(this.tmpIndices[i]=r,++i):(this.tmpIndices[t+a]=r,++a)}var e=this.indices;this.indices=this.tmpIndices,this.tmpIndices=e}};var oi=function(t){xt.call(this),this.joint=t,this.info=new It;var i=W.maxJacobianRows;this.massMatrix=new ni(i),this.boundaryBuilder=new ii(i);var a=new Array(i);this.massData=a;for(var o=0,n=this.massData.length;o<n;){var s=o++;this.massData[s]=new $t}var r=this.boundaryBuilder.boundaries.length;this.velBoundarySelector=new ai(r),this.posBoundarySelector=new ai(r);var e=new Array(i);this.relVels=e;var _=new Array(i);this.impulses=_;var h=new Array(i);this.dImpulses=h;var l=new Array(i);this.dTotalImpulses=l;for(var c=0,p=i;c<p;){var v=c++;this.relVels[v]=0,this.impulses[v]=0,this.dImpulses[v]=0,this.dTotalImpulses[v]=0}};oi.__super__=xt,oi.prototype=$extend(xt.prototype,{preSolveVelocity:function(t){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);var i=this.boundaryBuilder;i.numBoundaries=0;var a=i.bbInfo;a.numBounded=0,a.numUnbounded=0,i.buildBoundariesRecursive(this.info,0);for(var o=this.velBoundarySelector,n=this.boundaryBuilder.numBoundaries,s=0,r=0,e=0,_=o.n;e<_;){var h=e++,l=o.indices[h];l<n?(o.tmpIndices[s]=l,++s):(o.tmpIndices[n+r]=l,++r)}var c=o.indices;o.indices=o.tmpIndices,o.tmpIndices=c},warmStart:function(t){var i=this.joint._positionCorrectionAlgorithm==ut.BAUMGARTE?W.jointWarmStartingFactorForBaungarte:W.jointWarmStartingFactor;if((i*=t.dtRatio)<=0)for(var a=0,o=this.info.numRows;a<o;){var n=a++,s=this.info.rows[n].impulse;s.impulse=0,s.impulseM=0,s.impulseP=0}else{for(var r=0,e=this.info.numRows;r<e;){var _=r++,h=this.info.rows[_],l=h.impulse,c=l.impulse*i;if(c<h.minImpulse?c=h.minImpulse:c>h.maxImpulse&&(c=h.maxImpulse),l.impulse=c,h.motorMaxImpulse>0){var p=l.impulseM*i,v=h.motorMaxImpulse;p<-v?p=-v:p>v&&(p=v),l.impulseM=p}else l.impulseM=0;this.dImpulses[_]=l.impulse+l.impulseM}var m,b,f,x,u,y,g,X,z,M,Y,Z,d=this.dImpulses,I=!1,V=!1;m=this._b1._velX,b=this._b1._velY,f=this._b1._velZ,x=this._b2._velX,u=this._b2._velY,y=this._b2._velZ,g=this._b1._angVelX,X=this._b1._angVelY,z=this._b1._angVelZ,M=this._b2._angVelX,Y=this._b2._angVelY,Z=this._b2._angVelZ;for(var L=0,w=this.info.numRows;L<w;){var A=L++,k=this.info.rows[A].jacobian,B=this.massData[A],P=d[A];0!=(1&k.flag)&&(m+=B.invMLin1X*P,b+=B.invMLin1Y*P,f+=B.invMLin1Z*P,x+=B.invMLin2X*-P,u+=B.invMLin2Y*-P,y+=B.invMLin2Z*-P,I=!0),0!=(2&k.flag)&&(g+=B.invMAng1X*P,X+=B.invMAng1Y*P,z+=B.invMAng1Z*P,M+=B.invMAng2X*-P,Y+=B.invMAng2Y*-P,Z+=B.invMAng2Z*-P,V=!0)}I&&(this._b1._velX=m,this._b1._velY=b,this._b1._velZ=f,this._b2._velX=x,this._b2._velY=u,this._b2._velZ=y),V&&(this._b1._angVelX=g,this._b1._angVelY=X,this._b1._angVelZ=z,this._b2._angVelX=M,this._b2._angVelY=Y,this._b2._angVelZ=Z)}},solveVelocity:function(){var t,i,a,o,n,s,r,e,_,h,l,c,p=this.info.numRows;t=this._b1._velX,i=this._b1._velY,a=this._b1._velZ,o=this._b2._velX,n=this._b2._velY,s=this._b2._velZ,r=this._b1._angVelX,e=this._b1._angVelY,_=this._b1._angVelZ,h=this._b2._angVelX,l=this._b2._angVelY,c=this._b2._angVelZ;for(var v=0,m=p;v<m;){var b=v++,f=this.info.rows[b],x=f.impulse,u=f.jacobian,y=0;y+=t*u.lin1X+i*u.lin1Y+a*u.lin1Z,y-=o*u.lin2X+n*u.lin2Y+s*u.lin2Z,y+=r*u.ang1X+e*u.ang1Y+_*u.ang1Z,y-=h*u.ang2X+l*u.ang2Y+c*u.ang2Z,this.relVels[b]=y,this.impulses[b]=x.impulse,this.dTotalImpulses[b]=0}for(var g=this.massMatrix._invMassWithoutCfm,X=0,z=p;X<z;){var M=X++,Y=this.info.rows[M],Z=Y.impulse,d=this.massData[M];if(Y.motorMaxImpulse>0){var I=Z.impulseM,V=I+d.massWithoutCfm*(-Y.motorSpeed-this.relVels[M]),L=Z.impulseM;V<-L?V=-L:V>L&&(V=L),Z.impulseM=V;var w=V-I;this.dTotalImpulses[M]=w;for(var A=0,k=p;A<k;){var B=A++,P=B,T=this.relVels;T[P]=T[P]+w*g[M][B]}}}for(var S=!1,C=0,q=this.boundaryBuilder.numBoundaries;C<q;){var R=C++,E=this.velBoundarySelector.indices[R];if(this.boundaryBuilder.boundaries[E].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,1,!1)){for(var j=0,N=p;j<N;){var D=j++,F=this.info.rows[D].impulse,O=this.dImpulses[D];F.impulse+=O;var W=D,G=this.dTotalImpulses;G[W]=G[W]+O}var H,U,J,Q,$,K,tt,it,at,ot,nt,st,rt=this.dTotalImpulses,et=!1,_t=!1;H=this._b1._velX,U=this._b1._velY,J=this._b1._velZ,Q=this._b2._velX,$=this._b2._velY,K=this._b2._velZ,tt=this._b1._angVelX,it=this._b1._angVelY,at=this._b1._angVelZ,ot=this._b2._angVelX,nt=this._b2._angVelY,st=this._b2._angVelZ;for(var ht=0,lt=this.info.numRows;ht<lt;){var ct=ht++,pt=this.info.rows[ct].jacobian,vt=this.massData[ct],mt=rt[ct];0!=(1&pt.flag)&&(H+=vt.invMLin1X*mt,U+=vt.invMLin1Y*mt,J+=vt.invMLin1Z*mt,Q+=vt.invMLin2X*-mt,$+=vt.invMLin2Y*-mt,K+=vt.invMLin2Z*-mt,et=!0),0!=(2&pt.flag)&&(tt+=vt.invMAng1X*mt,it+=vt.invMAng1Y*mt,at+=vt.invMAng1Z*mt,ot+=vt.invMAng2X*-mt,nt+=vt.invMAng2Y*-mt,st+=vt.invMAng2Z*-mt,_t=!0)}et&&(this._b1._velX=H,this._b1._velY=U,this._b1._velZ=J,this._b2._velX=Q,this._b2._velY=$,this._b2._velZ=K),_t&&(this._b1._angVelX=tt,this._b1._angVelY=it,this._b1._angVelZ=at,this._b2._angVelX=ot,this._b2._angVelY=nt,this._b2._angVelZ=st);for(var bt=this.velBoundarySelector,ft=0;bt.indices[ft]!=E;)++ft;for(;ft>0;){var xt=bt.indices[ft];bt.indices[ft]=bt.indices[ft-1],bt.indices[ft-1]=xt,--ft}S=!0;break}}S||console.log("DirectJointConstraintSolver.hx:338:","could not find solution. (velocity)")},postSolveVelocity:function(t){var i,a,o,n,s,r;i=0,a=0,o=0,n=0,s=0,r=0;for(var e=0,_=this.info.numRows;e<_;){var h=e++,l=this.info.rows[h],c=l.impulse,p=l.jacobian;0!=(1&p.flag)?(i+=p.lin1X*c.impulse,a+=p.lin1Y*c.impulse,o+=p.lin1Z*c.impulse):0!=(2&p.flag)&&(n+=p.ang1X*c.impulse,s+=p.ang1Y*c.impulse,r+=p.ang1Z*c.impulse)}this.joint._appliedForceX=i*t.invDt,this.joint._appliedForceY=a*t.invDt,this.joint._appliedForceZ=o*t.invDt,this.joint._appliedTorqueX=n*t.invDt,this.joint._appliedTorqueY=s*t.invDt,this.joint._appliedTorqueZ=r*t.invDt},preSolvePosition:function(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);var i=this.boundaryBuilder;i.numBoundaries=0;var a=i.bbInfo;a.numBounded=0,a.numUnbounded=0,i.buildBoundariesRecursive(this.info,0);for(var o=this.posBoundarySelector,n=this.boundaryBuilder.numBoundaries,s=0,r=0,e=0,_=o.n;e<_;){var h=e++,l=o.indices[h];l<n?(o.tmpIndices[s]=l,++s):(o.tmpIndices[n+r]=l,++r)}var c=o.indices;o.indices=o.tmpIndices,o.tmpIndices=c;for(var p=0,v=this.info.numRows;p<v;){var m=p++;this.info.rows[m].impulse.impulseP=0}},solvePositionSplitImpulse:function(){var t,i,a,o,n,s,r,e,_,h,l,c,p=this.info.numRows;t=this._b1._pseudoVelX,i=this._b1._pseudoVelY,a=this._b1._pseudoVelZ,o=this._b2._pseudoVelX,n=this._b2._pseudoVelY,s=this._b2._pseudoVelZ,r=this._b1._angPseudoVelX,e=this._b1._angPseudoVelY,_=this._b1._angPseudoVelZ,h=this._b2._angPseudoVelX,l=this._b2._angPseudoVelY,c=this._b2._angPseudoVelZ;for(var v=0,m=p;v<m;){var b=v++,f=this.info.rows[b],x=f.impulse,u=f.jacobian,y=0;y+=t*u.lin1X+i*u.lin1Y+a*u.lin1Z,y-=o*u.lin2X+n*u.lin2Y+s*u.lin2Z,y+=r*u.ang1X+e*u.ang1Y+_*u.ang1Z,y-=h*u.ang2X+l*u.ang2Y+c*u.ang2Z,this.relVels[b]=y,this.impulses[b]=x.impulseP}for(var g=!1,X=0,z=this.boundaryBuilder.numBoundaries;X<z;){var M=X++,Y=this.posBoundarySelector.indices[M];if(this.boundaryBuilder.boundaries[Y].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,W.positionSplitImpulseBaumgarte,!1)){for(var Z=0,d=p;Z<d;){var I=Z++,V=this.info.rows[I].impulse,L=this.dImpulses[I];V.impulseP+=L}var w,A,k,B,P,T,S,C,q,R,E,j,N=this.dImpulses,D=!1,F=!1;w=this._b1._pseudoVelX,A=this._b1._pseudoVelY,k=this._b1._pseudoVelZ,B=this._b2._pseudoVelX,P=this._b2._pseudoVelY,T=this._b2._pseudoVelZ,S=this._b1._angPseudoVelX,C=this._b1._angPseudoVelY,q=this._b1._angPseudoVelZ,R=this._b2._angPseudoVelX,E=this._b2._angPseudoVelY,j=this._b2._angPseudoVelZ;for(var O=0,G=this.info.numRows;O<G;){var H=O++,U=this.info.rows[H].jacobian,J=this.massData[H],Q=N[H];0!=(1&U.flag)&&(w+=J.invMLin1X*Q,A+=J.invMLin1Y*Q,k+=J.invMLin1Z*Q,B+=J.invMLin2X*-Q,P+=J.invMLin2Y*-Q,T+=J.invMLin2Z*-Q,D=!0),0!=(2&U.flag)&&(S+=J.invMAng1X*Q,C+=J.invMAng1Y*Q,q+=J.invMAng1Z*Q,R+=J.invMAng2X*-Q,E+=J.invMAng2Y*-Q,j+=J.invMAng2Z*-Q,F=!0)}D&&(this._b1._pseudoVelX=w,this._b1._pseudoVelY=A,this._b1._pseudoVelZ=k,this._b2._pseudoVelX=B,this._b2._pseudoVelY=P,this._b2._pseudoVelZ=T),F&&(this._b1._angPseudoVelX=S,this._b1._angPseudoVelY=C,this._b1._angPseudoVelZ=q,this._b2._angPseudoVelX=R,this._b2._angPseudoVelY=E,this._b2._angPseudoVelZ=j);for(var $=this.posBoundarySelector,K=0;$.indices[K]!=Y;)++K;for(;K>0;){var tt=$.indices[K];$.indices[K]=$.indices[K-1],$.indices[K-1]=tt,--K}g=!0;break}}g||console.log("DirectJointConstraintSolver.hx:454:","could not find solution. (split impulse)")},solvePositionNgs:function(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);var i=this.boundaryBuilder;i.numBoundaries=0;var a=i.bbInfo;a.numBounded=0,a.numUnbounded=0,i.buildBoundariesRecursive(this.info,0);for(var o=this.posBoundarySelector,n=this.boundaryBuilder.numBoundaries,s=0,r=0,e=0,_=o.n;e<_;){var h=e++,l=o.indices[h];l<n?(o.tmpIndices[s]=l,++s):(o.tmpIndices[n+r]=l,++r)}var c=o.indices;o.indices=o.tmpIndices,o.tmpIndices=c;for(var p=this.info.numRows,v=0,m=p;v<m;){var b=v++,f=this.info.rows[b],x=f.impulse;f.jacobian;this.relVels[b]=0,this.impulses[b]=x.impulseP}for(var u=!1,y=0,g=this.boundaryBuilder.numBoundaries;y<g;){var X=y++,z=this.posBoundarySelector.indices[X];if(this.boundaryBuilder.boundaries[z].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,W.positionNgsBaumgarte,!1)){for(var M=0,Y=p;M<Y;){var Z=M++,d=this.info.rows[Z].impulse,I=this.dImpulses[Z];d.impulseP+=I}var V,L,w,A,k,B,P,T,S,C,q,R,E=this.dImpulses,j=!1,N=!1;V=0,L=0,w=0,A=0,k=0,B=0,P=0,T=0,S=0,C=0,q=0,R=0;for(var D=0,F=this.info.numRows;D<F;){var O=D++,G=this.info.rows[O].jacobian,H=this.massData[O],U=E[O];0!=(1&G.flag)&&(V+=H.invMLin1X*U,L+=H.invMLin1Y*U,w+=H.invMLin1Z*U,A+=H.invMLin2X*-U,k+=H.invMLin2Y*-U,B+=H.invMLin2Z*-U,j=!0),0!=(2&G.flag)&&(P+=H.invMAng1X*U,T+=H.invMAng1Y*U,S+=H.invMAng1Z*U,C+=H.invMAng2X*-U,q+=H.invMAng2Y*-U,R+=H.invMAng2Z*-U,N=!0)}if(j){var J=this._b1;J._transform._positionX+=V,J._transform._positionY+=L,J._transform._positionZ+=w;var Q=this._b2;Q._transform._positionX+=A,Q._transform._positionY+=k,Q._transform._positionZ+=B}if(N){var $,K,tt,it,at,ot,nt,st,rt,et,_t=this._b1,ht=Math.sqrt(P*P+T*T+S*S),lt=.5*ht;if(lt<.5){var ct=lt*lt;$=.5*(1-.16666666666666666*ct+ct*ct*.008333333333333333),K=1-.5*ct+ct*ct*.041666666666666664}else $=Math.sin(lt)/ht,K=Math.cos(lt);tt=P*$,it=T*$,at=S*$,ot=K;var pt,vt=_t._transform._rotation00,mt=_t._transform._rotation11,bt=_t._transform._rotation22,ft=vt+mt+bt;ft>0?(et=.5*(pt=Math.sqrt(ft+1)),pt=.5/pt,nt=(_t._transform._rotation21-_t._transform._rotation12)*pt,st=(_t._transform._rotation02-_t._transform._rotation20)*pt,rt=(_t._transform._rotation10-_t._transform._rotation01)*pt):vt>mt?vt>bt?(nt=.5*(pt=Math.sqrt(vt-mt-bt+1)),pt=.5/pt,st=(_t._transform._rotation01+_t._transform._rotation10)*pt,rt=(_t._transform._rotation02+_t._transform._rotation20)*pt,et=(_t._transform._rotation21-_t._transform._rotation12)*pt):(rt=.5*(pt=Math.sqrt(bt-vt-mt+1)),pt=.5/pt,nt=(_t._transform._rotation02+_t._transform._rotation20)*pt,st=(_t._transform._rotation12+_t._transform._rotation21)*pt,et=(_t._transform._rotation10-_t._transform._rotation01)*pt):mt>bt?(st=.5*(pt=Math.sqrt(mt-bt-vt+1)),pt=.5/pt,nt=(_t._transform._rotation01+_t._transform._rotation10)*pt,rt=(_t._transform._rotation12+_t._transform._rotation21)*pt,et=(_t._transform._rotation02-_t._transform._rotation20)*pt):(rt=.5*(pt=Math.sqrt(bt-vt-mt+1)),pt=.5/pt,nt=(_t._transform._rotation02+_t._transform._rotation20)*pt,st=(_t._transform._rotation12+_t._transform._rotation21)*pt,et=(_t._transform._rotation10-_t._transform._rotation01)*pt);var xt=(nt=ot*nt+tt*et+it*rt-at*st)*nt+(st=ot*st-tt*rt+it*et+at*nt)*st+(rt=ot*rt+tt*st-it*nt+at*et)*rt+(et=ot*et-tt*nt-it*st-at*rt)*et;xt>1e-32&&(xt=1/Math.sqrt(xt));nt*=xt,st*=xt,rt*=xt,et*=xt;var ut,yt,gt,Xt,zt,Mt,Yt,Zt,dt,It,Vt,Lt,wt,At,kt,Bt,Pt,Tt,St=2*nt,Ct=2*st,qt=2*rt,Rt=nt*St,Et=st*Ct,jt=rt*qt,Nt=nt*Ct,Dt=st*qt,Ft=nt*qt,Ot=et*St,Wt=et*Ct,Gt=et*qt;_t._transform._rotation00=1-Et-jt,_t._transform._rotation01=Nt-Gt,_t._transform._rotation02=Ft+Wt,_t._transform._rotation10=Nt+Gt,_t._transform._rotation11=1-Rt-jt,_t._transform._rotation12=Dt-Ot,_t._transform._rotation20=Ft-Wt,_t._transform._rotation21=Dt+Ot,_t._transform._rotation22=1-Rt-Et,ut=_t._transform._rotation00*_t._invLocalInertia00+_t._transform._rotation01*_t._invLocalInertia10+_t._transform._rotation02*_t._invLocalInertia20,yt=_t._transform._rotation00*_t._invLocalInertia01+_t._transform._rotation01*_t._invLocalInertia11+_t._transform._rotation02*_t._invLocalInertia21,gt=_t._transform._rotation00*_t._invLocalInertia02+_t._transform._rotation01*_t._invLocalInertia12+_t._transform._rotation02*_t._invLocalInertia22,Xt=_t._transform._rotation10*_t._invLocalInertia00+_t._transform._rotation11*_t._invLocalInertia10+_t._transform._rotation12*_t._invLocalInertia20,zt=_t._transform._rotation10*_t._invLocalInertia01+_t._transform._rotation11*_t._invLocalInertia11+_t._transform._rotation12*_t._invLocalInertia21,Mt=_t._transform._rotation10*_t._invLocalInertia02+_t._transform._rotation11*_t._invLocalInertia12+_t._transform._rotation12*_t._invLocalInertia22,Yt=_t._transform._rotation20*_t._invLocalInertia00+_t._transform._rotation21*_t._invLocalInertia10+_t._transform._rotation22*_t._invLocalInertia20,Zt=_t._transform._rotation20*_t._invLocalInertia01+_t._transform._rotation21*_t._invLocalInertia11+_t._transform._rotation22*_t._invLocalInertia21,dt=_t._transform._rotation20*_t._invLocalInertia02+_t._transform._rotation21*_t._invLocalInertia12+_t._transform._rotation22*_t._invLocalInertia22,_t._invInertia00=ut,_t._invInertia01=yt,_t._invInertia02=gt,_t._invInertia10=Xt,_t._invInertia11=zt,_t._invInertia12=Mt,_t._invInertia20=Yt,_t._invInertia21=Zt,_t._invInertia22=dt,It=_t._invInertia00*_t._transform._rotation00+_t._invInertia01*_t._transform._rotation01+_t._invInertia02*_t._transform._rotation02,Vt=_t._invInertia00*_t._transform._rotation10+_t._invInertia01*_t._transform._rotation11+_t._invInertia02*_t._transform._rotation12,Lt=_t._invInertia00*_t._transform._rotation20+_t._invInertia01*_t._transform._rotation21+_t._invInertia02*_t._transform._rotation22,wt=_t._invInertia10*_t._transform._rotation00+_t._invInertia11*_t._transform._rotation01+_t._invInertia12*_t._transform._rotation02,At=_t._invInertia10*_t._transform._rotation10+_t._invInertia11*_t._transform._rotation11+_t._invInertia12*_t._transform._rotation12,kt=_t._invInertia10*_t._transform._rotation20+_t._invInertia11*_t._transform._rotation21+_t._invInertia12*_t._transform._rotation22,Bt=_t._invInertia20*_t._transform._rotation00+_t._invInertia21*_t._transform._rotation01+_t._invInertia22*_t._transform._rotation02,Pt=_t._invInertia20*_t._transform._rotation10+_t._invInertia21*_t._transform._rotation11+_t._invInertia22*_t._transform._rotation12,Tt=_t._invInertia20*_t._transform._rotation20+_t._invInertia21*_t._transform._rotation21+_t._invInertia22*_t._transform._rotation22,_t._invInertia00=It,_t._invInertia01=Vt,_t._invInertia02=Lt,_t._invInertia10=wt,_t._invInertia11=At,_t._invInertia12=kt,_t._invInertia20=Bt,_t._invInertia21=Pt,_t._invInertia22=Tt,_t._invInertia00*=_t._rotFactor.x,_t._invInertia01*=_t._rotFactor.x,_t._invInertia02*=_t._rotFactor.x,_t._invInertia10*=_t._rotFactor.y,_t._invInertia11*=_t._rotFactor.y,_t._invInertia12*=_t._rotFactor.y,_t._invInertia20*=_t._rotFactor.z,_t._invInertia21*=_t._rotFactor.z,_t._invInertia22*=_t._rotFactor.z;var Ht,Ut,Jt,Qt,$t,Kt,ti,ii,ai,oi,ni=this._b2,si=Math.sqrt(C*C+q*q+R*R),ri=.5*si;if(ri<.5){var ei=ri*ri;Ht=.5*(1-.16666666666666666*ei+ei*ei*.008333333333333333),Ut=1-.5*ei+ei*ei*.041666666666666664}else Ht=Math.sin(ri)/si,Ut=Math.cos(ri);Jt=C*Ht,Qt=q*Ht,$t=R*Ht,Kt=Ut;var _i,hi=ni._transform._rotation00,li=ni._transform._rotation11,ci=ni._transform._rotation22,pi=hi+li+ci;pi>0?(oi=.5*(_i=Math.sqrt(pi+1)),_i=.5/_i,ti=(ni._transform._rotation21-ni._transform._rotation12)*_i,ii=(ni._transform._rotation02-ni._transform._rotation20)*_i,ai=(ni._transform._rotation10-ni._transform._rotation01)*_i):hi>li?hi>ci?(ti=.5*(_i=Math.sqrt(hi-li-ci+1)),_i=.5/_i,ii=(ni._transform._rotation01+ni._transform._rotation10)*_i,ai=(ni._transform._rotation02+ni._transform._rotation20)*_i,oi=(ni._transform._rotation21-ni._transform._rotation12)*_i):(ai=.5*(_i=Math.sqrt(ci-hi-li+1)),_i=.5/_i,ti=(ni._transform._rotation02+ni._transform._rotation20)*_i,ii=(ni._transform._rotation12+ni._transform._rotation21)*_i,oi=(ni._transform._rotation10-ni._transform._rotation01)*_i):li>ci?(ii=.5*(_i=Math.sqrt(li-ci-hi+1)),_i=.5/_i,ti=(ni._transform._rotation01+ni._transform._rotation10)*_i,ai=(ni._transform._rotation12+ni._transform._rotation21)*_i,oi=(ni._transform._rotation02-ni._transform._rotation20)*_i):(ai=.5*(_i=Math.sqrt(ci-hi-li+1)),_i=.5/_i,ti=(ni._transform._rotation02+ni._transform._rotation20)*_i,ii=(ni._transform._rotation12+ni._transform._rotation21)*_i,oi=(ni._transform._rotation10-ni._transform._rotation01)*_i);var vi=(ti=Kt*ti+Jt*oi+Qt*ai-$t*ii)*ti+(ii=Kt*ii-Jt*ai+Qt*oi+$t*ti)*ii+(ai=Kt*ai+Jt*ii-Qt*ti+$t*oi)*ai+(oi=Kt*oi-Jt*ti-Qt*ii-$t*ai)*oi;vi>1e-32&&(vi=1/Math.sqrt(vi));ti*=vi,ii*=vi,ai*=vi,oi*=vi;var mi,bi,fi,xi,ui,yi,gi,Xi,zi,Mi,Yi,Zi,di,Ii,Vi,Li,wi,Ai,ki=2*ti,Bi=2*ii,Pi=2*ai,Ti=ti*ki,Si=ii*Bi,Ci=ai*Pi,qi=ti*Bi,Ri=ii*Pi,Ei=ti*Pi,ji=oi*ki,Ni=oi*Bi,Di=oi*Pi;ni._transform._rotation00=1-Si-Ci,ni._transform._rotation01=qi-Di,ni._transform._rotation02=Ei+Ni,ni._transform._rotation10=qi+Di,ni._transform._rotation11=1-Ti-Ci,ni._transform._rotation12=Ri-ji,ni._transform._rotation20=Ei-Ni,ni._transform._rotation21=Ri+ji,ni._transform._rotation22=1-Ti-Si,mi=ni._transform._rotation00*ni._invLocalInertia00+ni._transform._rotation01*ni._invLocalInertia10+ni._transform._rotation02*ni._invLocalInertia20,bi=ni._transform._rotation00*ni._invLocalInertia01+ni._transform._rotation01*ni._invLocalInertia11+ni._transform._rotation02*ni._invLocalInertia21,fi=ni._transform._rotation00*ni._invLocalInertia02+ni._transform._rotation01*ni._invLocalInertia12+ni._transform._rotation02*ni._invLocalInertia22,xi=ni._transform._rotation10*ni._invLocalInertia00+ni._transform._rotation11*ni._invLocalInertia10+ni._transform._rotation12*ni._invLocalInertia20,ui=ni._transform._rotation10*ni._invLocalInertia01+ni._transform._rotation11*ni._invLocalInertia11+ni._transform._rotation12*ni._invLocalInertia21,yi=ni._transform._rotation10*ni._invLocalInertia02+ni._transform._rotation11*ni._invLocalInertia12+ni._transform._rotation12*ni._invLocalInertia22,gi=ni._transform._rotation20*ni._invLocalInertia00+ni._transform._rotation21*ni._invLocalInertia10+ni._transform._rotation22*ni._invLocalInertia20,Xi=ni._transform._rotation20*ni._invLocalInertia01+ni._transform._rotation21*ni._invLocalInertia11+ni._transform._rotation22*ni._invLocalInertia21,zi=ni._transform._rotation20*ni._invLocalInertia02+ni._transform._rotation21*ni._invLocalInertia12+ni._transform._rotation22*ni._invLocalInertia22,ni._invInertia00=mi,ni._invInertia01=bi,ni._invInertia02=fi,ni._invInertia10=xi,ni._invInertia11=ui,ni._invInertia12=yi,ni._invInertia20=gi,ni._invInertia21=Xi,ni._invInertia22=zi,Mi=ni._invInertia00*ni._transform._rotation00+ni._invInertia01*ni._transform._rotation01+ni._invInertia02*ni._transform._rotation02,Yi=ni._invInertia00*ni._transform._rotation10+ni._invInertia01*ni._transform._rotation11+ni._invInertia02*ni._transform._rotation12,Zi=ni._invInertia00*ni._transform._rotation20+ni._invInertia01*ni._transform._rotation21+ni._invInertia02*ni._transform._rotation22,di=ni._invInertia10*ni._transform._rotation00+ni._invInertia11*ni._transform._rotation01+ni._invInertia12*ni._transform._rotation02,Ii=ni._invInertia10*ni._transform._rotation10+ni._invInertia11*ni._transform._rotation11+ni._invInertia12*ni._transform._rotation12,Vi=ni._invInertia10*ni._transform._rotation20+ni._invInertia11*ni._transform._rotation21+ni._invInertia12*ni._transform._rotation22,Li=ni._invInertia20*ni._transform._rotation00+ni._invInertia21*ni._transform._rotation01+ni._invInertia22*ni._transform._rotation02,wi=ni._invInertia20*ni._transform._rotation10+ni._invInertia21*ni._transform._rotation11+ni._invInertia22*ni._transform._rotation12,Ai=ni._invInertia20*ni._transform._rotation20+ni._invInertia21*ni._transform._rotation21+ni._invInertia22*ni._transform._rotation22,ni._invInertia00=Mi,ni._invInertia01=Yi,ni._invInertia02=Zi,ni._invInertia10=di,ni._invInertia11=Ii,ni._invInertia12=Vi,ni._invInertia20=Li,ni._invInertia21=wi,ni._invInertia22=Ai,ni._invInertia00*=ni._rotFactor.x,ni._invInertia01*=ni._rotFactor.x,ni._invInertia02*=ni._rotFactor.x,ni._invInertia10*=ni._rotFactor.y,ni._invInertia11*=ni._rotFactor.y,ni._invInertia12*=ni._rotFactor.y,ni._invInertia20*=ni._rotFactor.z,ni._invInertia21*=ni._rotFactor.z,ni._invInertia22*=ni._rotFactor.z}for(var Fi=this.posBoundarySelector,Oi=0;Fi.indices[Oi]!=z;)++Oi;for(;Oi>0;){var Wi=Fi.indices[Oi];Fi.indices[Oi]=Fi.indices[Oi-1],Fi.indices[Oi-1]=Wi,--Oi}u=!0;break}}u||console.log("DirectJointConstraintSolver.hx:506:","could not find solution. (NGS)")},postSolve:function(){this.joint._syncAnchors(),this.joint._checkDestruction()}});var ni=function(t){this._size=t;var i=this._size,a=new Array(i);this.tmpMatrix=a;var o=this._size,n=new Array(o);this._invMass=n;var s=this._size,r=new Array(s);this._invMassWithoutCfm=r;for(var e=0,_=this._size;e<_;){var h=e++,l=this.tmpMatrix,c=this._size,p=new Array(c);l[h]=p;var v=this._invMass,m=this._size,b=new Array(m);v[h]=b;var f=this._invMassWithoutCfm,x=this._size,u=new Array(x);f[h]=u;for(var y=0,g=this._size;y<g;){var X=y++;this.tmpMatrix[h][X]=0,this._invMass[h][X]=0,this._invMassWithoutCfm[h][X]=0}}this._maxSubmatrixId=1<<this._size;var z=this._maxSubmatrixId,M=new Array(z);this._cacheComputed=M;var Y=this._maxSubmatrixId,Z=new Array(Y);this._cachedSubmatrices=Z;for(var d=0,I=this._maxSubmatrixId;d<I;){for(var V=d++,L=V,w=L=(15&(L=(51&(L=(85&L)+(L>>1&85)))+(L>>2&51)))+(L>>4&15),A=new Array(w),k=0,B=w;k<B;){var P=k++,T=new Array(w);A[P]=T;for(var S=0,C=w;S<C;){var q=S++;A[P][q]=0}}this._cacheComputed[V]=!1,this._cachedSubmatrices[V]=A}};ni.prototype={computeSubmatrix:function(t,i,a){for(var o=0,n=a;o<n;)for(var s=o++,r=i[s],e=0,_=a;e<_;){var h=e++;this.tmpMatrix[s][h]=this._invMass[r][i[h]]}var l,c,p,v,m,b=this.tmpMatrix,f=this._cachedSubmatrices[t];switch(a){case 4:l=b[0],c=f[0],m=1/l[0],c[0]=m,l[1]=l[1]*m,l[2]=l[2]*m,l[3]=l[3]*m,p=b[1],(v=f[1])[0]=-m*p[0],p[1]=p[1]-l[1]*p[0],p[2]=p[2]-l[2]*p[0],p[3]=p[3]-l[3]*p[0],p=b[2],(v=f[2])[0]=-m*p[0],p[1]=p[1]-l[1]*p[0],p[2]=p[2]-l[2]*p[0],p[3]=p[3]-l[3]*p[0],p=b[3],(v=f[3])[0]=-m*p[0],p[1]=p[1]-l[1]*p[0],p[2]=p[2]-l[2]*p[0],p[3]=p[3]-l[3]*p[0],l=b[1],c=f[1],m=1/l[1],c[1]=m,c[0]=c[0]*m,l[2]=l[2]*m,l[3]=l[3]*m,p=b[0],(v=f[0])[0]=v[0]-c[0]*p[1],p[2]=p[2]-l[2]*p[1],p[3]=p[3]-l[3]*p[1],p=b[2],(v=f[2])[0]=v[0]-c[0]*p[1],v[1]=-m*p[1],p[2]=p[2]-l[2]*p[1],p[3]=p[3]-l[3]*p[1],p=b[3],(v=f[3])[0]=v[0]-c[0]*p[1],v[1]=-m*p[1],p[2]=p[2]-l[2]*p[1],p[3]=p[3]-l[3]*p[1],l=b[2],c=f[2],m=1/l[2],c[2]=m,c[0]=c[0]*m,c[1]=c[1]*m,l[3]=l[3]*m,p=b[0],(v=f[0])[0]=v[0]-c[0]*p[2],p[3]=p[3]-l[3]*p[2],p=b[1],(v=f[1])[0]=v[0]-c[0]*p[2],v[1]=v[1]-c[1]*p[2],p[3]=p[3]-l[3]*p[2],p=b[3],(v=f[3])[0]=v[0]-c[0]*p[2],v[1]=v[1]-c[1]*p[2],v[2]=-m*p[2],p[3]=p[3]-l[3]*p[2],l=b[3],c=f[3],m=1/l[3],c[3]=m,c[0]=c[0]*m,c[1]=c[1]*m,c[2]=c[2]*m,p=b[0],(v=f[0])[0]=v[0]-c[0]*p[3],p=b[1],(v=f[1])[0]=v[0]-c[0]*p[3],v[1]=v[1]-c[1]*p[3],p=b[2],(v=f[2])[0]=v[0]-c[0]*p[3],v[1]=v[1]-c[1]*p[3],v[2]=v[2]-c[2]*p[3],c=f[1],f[0][1]=c[0],c=f[2],f[0][2]=c[0],f[1][2]=c[1],c=f[3],f[0][3]=c[0],f[1][3]=c[1],f[2][3]=c[2];break;case 5:l=b[0],c=f[0],m=1/l[0],c[0]=m,l[1]=l[1]*m,l[2]=l[2]*m,l[3]=l[3]*m,l[4]=l[4]*m,p=b[1],(v=f[1])[0]=-m*p[0],p[1]=p[1]-l[1]*p[0],p[2]=p[2]-l[2]*p[0],p[3]=p[3]-l[3]*p[0],p[4]=p[4]-l[4]*p[0],p=b[2],(v=f[2])[0]=-m*p[0],p[1]=p[1]-l[1]*p[0],p[2]=p[2]-l[2]*p[0],p[3]=p[3]-l[3]*p[0],p[4]=p[4]-l[4]*p[0],p=b[3],(v=f[3])[0]=-m*p[0],p[1]=p[1]-l[1]*p[0],p[2]=p[2]-l[2]*p[0],p[3]=p[3]-l[3]*p[0],p[4]=p[4]-l[4]*p[0],p=b[4],(v=f[4])[0]=-m*p[0],p[1]=p[1]-l[1]*p[0],p[2]=p[2]-l[2]*p[0],p[3]=p[3]-l[3]*p[0],p[4]=p[4]-l[4]*p[0],l=b[1],c=f[1],m=1/l[1],c[1]=m,c[0]=c[0]*m,l[2]=l[2]*m,l[3]=l[3]*m,l[4]=l[4]*m,p=b[0],(v=f[0])[0]=v[0]-c[0]*p[1],p[2]=p[2]-l[2]*p[1],p[3]=p[3]-l[3]*p[1],p[4]=p[4]-l[4]*p[1],p=b[2],(v=f[2])[0]=v[0]-c[0]*p[1],v[1]=-m*p[1],p[2]=p[2]-l[2]*p[1],p[3]=p[3]-l[3]*p[1],p[4]=p[4]-l[4]*p[1],p=b[3],(v=f[3])[0]=v[0]-c[0]*p[1],v[1]=-m*p[1],p[2]=p[2]-l[2]*p[1],p[3]=p[3]-l[3]*p[1],p[4]=p[4]-l[4]*p[1],p=b[4],(v=f[4])[0]=v[0]-c[0]*p[1],v[1]=-m*p[1],p[2]=p[2]-l[2]*p[1],p[3]=p[3]-l[3]*p[1],p[4]=p[4]-l[4]*p[1],l=b[2],c=f[2],m=1/l[2],c[2]=m,c[0]=c[0]*m,c[1]=c[1]*m,l[3]=l[3]*m,l[4]=l[4]*m,p=b[0],(v=f[0])[0]=v[0]-c[0]*p[2],p[3]=p[3]-l[3]*p[2],p[4]=p[4]-l[4]*p[2],p=b[1],(v=f[1])[0]=v[0]-c[0]*p[2],v[1]=v[1]-c[1]*p[2],p[3]=p[3]-l[3]*p[2],p[4]=p[4]-l[4]*p[2],p=b[3],(v=f[3])[0]=v[0]-c[0]*p[2],v[1]=v[1]-c[1]*p[2],v[2]=-m*p[2],p[3]=p[3]-l[3]*p[2],p[4]=p[4]-l[4]*p[2],p=b[4],(v=f[4])[0]=v[0]-c[0]*p[2],v[1]=v[1]-c[1]*p[2],v[2]=-m*p[2],p[3]=p[3]-l[3]*p[2],p[4]=p[4]-l[4]*p[2],l=b[3],c=f[3],m=1/l[3],c[3]=m,c[0]=c[0]*m,c[1]=c[1]*m,c[2]=c[2]*m,l[4]=l[4]*m,p=b[0],(v=f[0])[0]=v[0]-c[0]*p[3],p[4]=p[4]-l[4]*p[3],p=b[1],(v=f[1])[0]=v[0]-c[0]*p[3],v[1]=v[1]-c[1]*p[3],p[4]=p[4]-l[4]*p[3],p=b[2],(v=f[2])[0]=v[0]-c[0]*p[3],v[1]=v[1]-c[1]*p[3],v[2]=v[2]-c[2]*p[3],p[4]=p[4]-l[4]*p[3],p=b[4],(v=f[4])[0]=v[0]-c[0]*p[3],v[1]=v[1]-c[1]*p[3],v[2]=v[2]-c[2]*p[3],v[3]=-m*p[3],p[4]=p[4]-l[4]*p[3],l=b[4],c=f[4],m=1/l[4],c[4]=m,c[0]=c[0]*m,c[1]=c[1]*m,c[2]=c[2]*m,c[3]=c[3]*m,p=b[0],(v=f[0])[0]=v[0]-c[0]*p[4],p=b[1],(v=f[1])[0]=v[0]-c[0]*p[4],v[1]=v[1]-c[1]*p[4],p=b[2],(v=f[2])[0]=v[0]-c[0]*p[4],v[1]=v[1]-c[1]*p[4],v[2]=v[2]-c[2]*p[4],p=b[3],(v=f[3])[0]=v[0]-c[0]*p[4],v[1]=v[1]-c[1]*p[4],v[2]=v[2]-c[2]*p[4],v[3]=v[3]-c[3]*p[4],c=f[1],f[0][1]=c[0],c=f[2],f[0][2]=c[0],f[1][2]=c[1],c=f[3],f[0][3]=c[0],f[1][3]=c[1],f[2][3]=c[2],c=f[4],f[0][4]=c[0],f[1][4]=c[1],f[2][4]=c[2],f[3][4]=c[3];break;case 6:l=b[0],c=f[0],m=1/l[0],c[0]=m,l[1]=l[1]*m,l[2]=l[2]*m,l[3]=l[3]*m,l[4]=l[4]*m,l[5]=l[5]*m,p=b[1],(v=f[1])[0]=-m*p[0],p[1]=p[1]-l[1]*p[0],p[2]=p[2]-l[2]*p[0],p[3]=p[3]-l[3]*p[0],p[4]=p[4]-l[4]*p[0],p[5]=p[5]-l[5]*p[0],p=b[2],(v=f[2])[0]=-m*p[0],p[1]=p[1]-l[1]*p[0],p[2]=p[2]-l[2]*p[0],p[3]=p[3]-l[3]*p[0],p[4]=p[4]-l[4]*p[0],p[5]=p[5]-l[5]*p[0],p=b[3],(v=f[3])[0]=-m*p[0],p[1]=p[1]-l[1]*p[0],p[2]=p[2]-l[2]*p[0],p[3]=p[3]-l[3]*p[0],p[4]=p[4]-l[4]*p[0],p[5]=p[5]-l[5]*p[0],p=b[4],(v=f[4])[0]=-m*p[0],p[1]=p[1]-l[1]*p[0],p[2]=p[2]-l[2]*p[0],p[3]=p[3]-l[3]*p[0],p[4]=p[4]-l[4]*p[0],p[5]=p[5]-l[5]*p[0],p=b[5],(v=f[5])[0]=-m*p[0],p[1]=p[1]-l[1]*p[0],p[2]=p[2]-l[2]*p[0],p[3]=p[3]-l[3]*p[0],p[4]=p[4]-l[4]*p[0],p[5]=p[5]-l[5]*p[0],l=b[1],c=f[1],m=1/l[1],c[1]=m,c[0]=c[0]*m,l[2]=l[2]*m,l[3]=l[3]*m,l[4]=l[4]*m,l[5]=l[5]*m,p=b[0],(v=f[0])[0]=v[0]-c[0]*p[1],p[2]=p[2]-l[2]*p[1],p[3]=p[3]-l[3]*p[1],p[4]=p[4]-l[4]*p[1],p[5]=p[5]-l[5]*p[1],p=b[2],(v=f[2])[0]=v[0]-c[0]*p[1],v[1]=-m*p[1],p[2]=p[2]-l[2]*p[1],p[3]=p[3]-l[3]*p[1],p[4]=p[4]-l[4]*p[1],p[5]=p[5]-l[5]*p[1],p=b[3],(v=f[3])[0]=v[0]-c[0]*p[1],v[1]=-m*p[1],p[2]=p[2]-l[2]*p[1],p[3]=p[3]-l[3]*p[1],p[4]=p[4]-l[4]*p[1],p[5]=p[5]-l[5]*p[1],p=b[4],(v=f[4])[0]=v[0]-c[0]*p[1],v[1]=-m*p[1],p[2]=p[2]-l[2]*p[1],p[3]=p[3]-l[3]*p[1],p[4]=p[4]-l[4]*p[1],p[5]=p[5]-l[5]*p[1],p=b[5],(v=f[5])[0]=v[0]-c[0]*p[1],v[1]=-m*p[1],p[2]=p[2]-l[2]*p[1],p[3]=p[3]-l[3]*p[1],p[4]=p[4]-l[4]*p[1],p[5]=p[5]-l[5]*p[1],l=b[2],c=f[2],m=1/l[2],c[2]=m,c[0]=c[0]*m,c[1]=c[1]*m,l[3]=l[3]*m,l[4]=l[4]*m,l[5]=l[5]*m,p=b[0],(v=f[0])[0]=v[0]-c[0]*p[2],p[3]=p[3]-l[3]*p[2],p[4]=p[4]-l[4]*p[2],p[5]=p[5]-l[5]*p[2],p=b[1],(v=f[1])[0]=v[0]-c[0]*p[2],v[1]=v[1]-c[1]*p[2],p[3]=p[3]-l[3]*p[2],p[4]=p[4]-l[4]*p[2],p[5]=p[5]-l[5]*p[2],p=b[3],(v=f[3])[0]=v[0]-c[0]*p[2],v[1]=v[1]-c[1]*p[2],v[2]=-m*p[2],p[3]=p[3]-l[3]*p[2],p[4]=p[4]-l[4]*p[2],p[5]=p[5]-l[5]*p[2],p=b[4],(v=f[4])[0]=v[0]-c[0]*p[2],v[1]=v[1]-c[1]*p[2],v[2]=-m*p[2],p[3]=p[3]-l[3]*p[2],p[4]=p[4]-l[4]*p[2],p[5]=p[5]-l[5]*p[2],p=b[5],(v=f[5])[0]=v[0]-c[0]*p[2],v[1]=v[1]-c[1]*p[2],v[2]=-m*p[2],p[3]=p[3]-l[3]*p[2],p[4]=p[4]-l[4]*p[2],p[5]=p[5]-l[5]*p[2],l=b[3],c=f[3],m=1/l[3],c[3]=m,c[0]=c[0]*m,c[1]=c[1]*m,c[2]=c[2]*m,l[4]=l[4]*m,l[5]=l[5]*m,p=b[0],(v=f[0])[0]=v[0]-c[0]*p[3],p[4]=p[4]-l[4]*p[3],p[5]=p[5]-l[5]*p[3],p=b[1],(v=f[1])[0]=v[0]-c[0]*p[3],v[1]=v[1]-c[1]*p[3],p[4]=p[4]-l[4]*p[3],p[5]=p[5]-l[5]*p[3],p=b[2],(v=f[2])[0]=v[0]-c[0]*p[3],v[1]=v[1]-c[1]*p[3],v[2]=v[2]-c[2]*p[3],p[4]=p[4]-l[4]*p[3],p[5]=p[5]-l[5]*p[3],p=b[4],(v=f[4])[0]=v[0]-c[0]*p[3],v[1]=v[1]-c[1]*p[3],v[2]=v[2]-c[2]*p[3],v[3]=-m*p[3],p[4]=p[4]-l[4]*p[3],p[5]=p[5]-l[5]*p[3],p=b[5],(v=f[5])[0]=v[0]-c[0]*p[3],v[1]=v[1]-c[1]*p[3],v[2]=v[2]-c[2]*p[3],v[3]=-m*p[3],p[4]=p[4]-l[4]*p[3],p[5]=p[5]-l[5]*p[3],l=b[4],c=f[4],m=1/l[4],c[4]=m,c[0]=c[0]*m,c[1]=c[1]*m,c[2]=c[2]*m,c[3]=c[3]*m,l[5]=l[5]*m,p=b[0],(v=f[0])[0]=v[0]-c[0]*p[4],p[5]=p[5]-l[5]*p[4],p=b[1],(v=f[1])[0]=v[0]-c[0]*p[4],v[1]=v[1]-c[1]*p[4],p[5]=p[5]-l[5]*p[4],p=b[2],(v=f[2])[0]=v[0]-c[0]*p[4],v[1]=v[1]-c[1]*p[4],v[2]=v[2]-c[2]*p[4],p[5]=p[5]-l[5]*p[4],p=b[3],(v=f[3])[0]=v[0]-c[0]*p[4],v[1]=v[1]-c[1]*p[4],v[2]=v[2]-c[2]*p[4],v[3]=v[3]-c[3]*p[4],p[5]=p[5]-l[5]*p[4],p=b[5],(v=f[5])[0]=v[0]-c[0]*p[4],v[1]=v[1]-c[1]*p[4],v[2]=v[2]-c[2]*p[4],v[3]=v[3]-c[3]*p[4],v[4]=-m*p[4],p[5]=p[5]-l[5]*p[4],l=b[5],c=f[5],m=1/l[5],c[5]=m,c[0]=c[0]*m,c[1]=c[1]*m,c[2]=c[2]*m,c[3]=c[3]*m,c[4]=c[4]*m,p=b[0],(v=f[0])[0]=v[0]-c[0]*p[5],p=b[1],(v=f[1])[0]=v[0]-c[0]*p[5],v[1]=v[1]-c[1]*p[5],p=b[2],(v=f[2])[0]=v[0]-c[0]*p[5],v[1]=v[1]-c[1]*p[5],v[2]=v[2]-c[2]*p[5],p=b[3],(v=f[3])[0]=v[0]-c[0]*p[5],v[1]=v[1]-c[1]*p[5],v[2]=v[2]-c[2]*p[5],v[3]=v[3]-c[3]*p[5],p=b[4],(v=f[4])[0]=v[0]-c[0]*p[5],v[1]=v[1]-c[1]*p[5],v[2]=v[2]-c[2]*p[5],v[3]=v[3]-c[3]*p[5],v[4]=v[4]-c[4]*p[5],c=f[1],f[0][1]=c[0],c=f[2],f[0][2]=c[0],f[1][2]=c[1],c=f[3],f[0][3]=c[0],f[1][3]=c[1],f[2][3]=c[2],c=f[4],f[0][4]=c[0],f[1][4]=c[1],f[2][4]=c[2],f[3][4]=c[3],c=f[5],f[0][5]=c[0],f[1][5]=c[1],f[2][5]=c[2],f[3][5]=c[3],f[4][5]=c[4];break;default:for(var x=0,u=a;x<u;){var y=x++;l=b[y],c=f[y];var g=1/l[y];c[y]=g;for(var X=0,z=y;X<z;){var M=X++;c[M]=c[M]*g}for(var Y=y+1,Z=a;Y<Z;){var d=Y++;l[d]=l[d]*g}for(var I=0,V=y;I<V;){var L=I++;p=b[L],v=f[L];for(var w=0,A=L+1;w<A;){var k=w++;v[k]=v[k]-c[k]*p[y]}for(var B=y+1,P=a;B<P;){var T=B++;p[T]=p[T]-l[T]*p[y]}}for(var S=y+1,C=a;S<C;){var q=S++;p=b[q],v=f[q];for(var R=0,E=y;R<E;){var j=R++;v[j]=v[j]-c[j]*p[y]}v[y]=-g*p[y];for(var N=y+1,D=a;N<D;){var F=N++;p[F]=p[F]-l[F]*p[y]}}}for(var O=1,W=a;O<W;){var G=O++;c=f[G];for(var H=0,U=G;H<U;){var J=H++;f[J][G]=c[J]}}}},computeInvMass:function(t,i){var a,o,n,s,r,e,_,h,l,c,p,v,m,b,f,x,u,y,g=this._invMass,X=this._invMassWithoutCfm,z=t.numRows,M=t.b1,Y=t.b2,Z=M._invMass,d=Y._invMass;a=M._invInertia00,o=M._invInertia01,n=M._invInertia02,s=M._invInertia10,r=M._invInertia11,e=M._invInertia12,_=M._invInertia20,h=M._invInertia21,l=M._invInertia22,c=Y._invInertia00,p=Y._invInertia01,v=Y._invInertia02,m=Y._invInertia10,b=Y._invInertia11,f=Y._invInertia12,x=Y._invInertia20,u=Y._invInertia21,y=Y._invInertia22;for(var I=0,V=z;I<V;){var L,w,A,k,B,P,T=I++,S=t.rows[T].jacobian,C=i[T];if(S.updateSparsity(),0!=(1&S.flag)?(C.invMLin1X=S.lin1X*Z,C.invMLin1Y=S.lin1Y*Z,C.invMLin1Z=S.lin1Z*Z,C.invMLin2X=S.lin2X*d,C.invMLin2Y=S.lin2Y*d,C.invMLin2Z=S.lin2Z*d):(C.invMLin1X=0,C.invMLin1Y=0,C.invMLin1Z=0,C.invMLin2X=0,C.invMLin2Y=0,C.invMLin2Z=0),0!=(2&S.flag))L=a*S.ang1X+o*S.ang1Y+n*S.ang1Z,w=s*S.ang1X+r*S.ang1Y+e*S.ang1Z,A=_*S.ang1X+h*S.ang1Y+l*S.ang1Z,C.invMAng1X=L,C.invMAng1Y=w,C.invMAng1Z=A,k=c*S.ang2X+p*S.ang2Y+v*S.ang2Z,B=m*S.ang2X+b*S.ang2Y+f*S.ang2Z,P=x*S.ang2X+u*S.ang2Y+y*S.ang2Z,C.invMAng2X=k,C.invMAng2Y=B,C.invMAng2Z=P;else C.invMAng1X=0,C.invMAng1Y=0,C.invMAng1Z=0,C.invMAng2X=0,C.invMAng2Y=0,C.invMAng2Z=0}for(var q=0,R=z;q<R;)for(var E=q++,j=t.rows[E].jacobian,N=E,D=z;N<D;){var F=N++,O=(t.rows[F].jacobian,i[F]),W=j.lin1X*O.invMLin1X+j.lin1Y*O.invMLin1Y+j.lin1Z*O.invMLin1Z+(j.ang1X*O.invMAng1X+j.ang1Y*O.invMAng1Y+j.ang1Z*O.invMAng1Z)+(j.lin2X*O.invMLin2X+j.lin2Y*O.invMLin2Y+j.lin2Z*O.invMLin2Z)+(j.ang2X*O.invMAng2X+j.ang2Y*O.invMAng2Y+j.ang2Z*O.invMAng2Z);E==F?(g[E][F]=W+t.rows[E].cfm,X[E][F]=W,O.mass=W+t.rows[E].cfm,O.massWithoutCfm=W,0!=O.mass&&(O.mass=1/O.mass),0!=O.massWithoutCfm&&(O.massWithoutCfm=1/O.massWithoutCfm)):(g[E][F]=W,g[F][E]=W,X[E][F]=W,X[F][E]=W)}for(var G=0,H=this._maxSubmatrixId;G<H;){var U=G++;this._cacheComputed[U]=!1}}};var si=function(t){xt.call(this),this.constraint=t,this.info=new Zt;var i=W.maxManifoldPoints,a=new Array(i);this.massData=a;for(var o=0,n=this.massData.length;o<n;){var s=o++;this.massData[s]=new Qt}};si.__super__=xt,si.prototype=$extend(xt.prototype,{preSolveVelocity:function(t){this.constraint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2;var i,a,o,n,s,r,e,_,h,l,c,p,v,m,b,f,x,u,y=this._b1._invMass,g=this._b2._invMass;i=this._b1._invInertia00,a=this._b1._invInertia01,o=this._b1._invInertia02,n=this._b1._invInertia10,s=this._b1._invInertia11,r=this._b1._invInertia12,e=this._b1._invInertia20,_=this._b1._invInertia21,h=this._b1._invInertia22,l=this._b2._invInertia00,c=this._b2._invInertia01,p=this._b2._invInertia02,v=this._b2._invInertia10,m=this._b2._invInertia11,b=this._b2._invInertia12,f=this._b2._invInertia20,x=this._b2._invInertia21,u=this._b2._invInertia22;for(var X=0,z=this.info.numRows;X<z;){var M,Y,Z,d,I,V,L=X++,w=this.info.rows[L],A=this.massData[L],k=w.jacobianN;A.invMLinN1X=k.lin1X*y,A.invMLinN1Y=k.lin1Y*y,A.invMLinN1Z=k.lin1Z*y,A.invMLinN2X=k.lin2X*g,A.invMLinN2Y=k.lin2Y*g,A.invMLinN2Z=k.lin2Z*g,M=i*k.ang1X+a*k.ang1Y+o*k.ang1Z,Y=n*k.ang1X+s*k.ang1Y+r*k.ang1Z,Z=e*k.ang1X+_*k.ang1Y+h*k.ang1Z,A.invMAngN1X=M,A.invMAngN1Y=Y,A.invMAngN1Z=Z,d=l*k.ang2X+c*k.ang2Y+p*k.ang2Z,I=v*k.ang2X+m*k.ang2Y+b*k.ang2Z,V=f*k.ang2X+x*k.ang2Y+u*k.ang2Z,A.invMAngN2X=d,A.invMAngN2Y=I,A.invMAngN2Z=V,A.massN=y+g+(A.invMAngN1X*k.ang1X+A.invMAngN1Y*k.ang1Y+A.invMAngN1Z*k.ang1Z)+(A.invMAngN2X*k.ang2X+A.invMAngN2Y*k.ang2Y+A.invMAngN2Z*k.ang2Z),0!=A.massN&&(A.massN=1/A.massN);var B,P,T,S,C,q,R,E,j,N,D,F,O=w.jacobianT,W=w.jacobianB;A.invMLinT1X=O.lin1X*y,A.invMLinT1Y=O.lin1Y*y,A.invMLinT1Z=O.lin1Z*y,A.invMLinT2X=O.lin2X*g,A.invMLinT2Y=O.lin2Y*g,A.invMLinT2Z=O.lin2Z*g,A.invMLinB1X=W.lin1X*y,A.invMLinB1Y=W.lin1Y*y,A.invMLinB1Z=W.lin1Z*y,A.invMLinB2X=W.lin2X*g,A.invMLinB2Y=W.lin2Y*g,A.invMLinB2Z=W.lin2Z*g,B=i*O.ang1X+a*O.ang1Y+o*O.ang1Z,P=n*O.ang1X+s*O.ang1Y+r*O.ang1Z,T=e*O.ang1X+_*O.ang1Y+h*O.ang1Z,A.invMAngT1X=B,A.invMAngT1Y=P,A.invMAngT1Z=T,S=l*O.ang2X+c*O.ang2Y+p*O.ang2Z,C=v*O.ang2X+m*O.ang2Y+b*O.ang2Z,q=f*O.ang2X+x*O.ang2Y+u*O.ang2Z,A.invMAngT2X=S,A.invMAngT2Y=C,A.invMAngT2Z=q,R=i*W.ang1X+a*W.ang1Y+o*W.ang1Z,E=n*W.ang1X+s*W.ang1Y+r*W.ang1Z,j=e*W.ang1X+_*W.ang1Y+h*W.ang1Z,A.invMAngB1X=R,A.invMAngB1Y=E,A.invMAngB1Z=j,N=l*W.ang2X+c*W.ang2Y+p*W.ang2Z,D=v*W.ang2X+m*W.ang2Y+b*W.ang2Z,F=f*W.ang2X+x*W.ang2Y+u*W.ang2Z,A.invMAngB2X=N,A.invMAngB2Y=D,A.invMAngB2Z=F;var G=y+g+(A.invMAngT1X*O.ang1X+A.invMAngT1Y*O.ang1Y+A.invMAngT1Z*O.ang1Z)+(A.invMAngT2X*O.ang2X+A.invMAngT2Y*O.ang2Y+A.invMAngT2Z*O.ang2Z),H=A.invMAngT1X*W.ang1X+A.invMAngT1Y*W.ang1Y+A.invMAngT1Z*W.ang1Z+(A.invMAngT2X*W.ang2X+A.invMAngT2Y*W.ang2Y+A.invMAngT2Z*W.ang2Z),U=H,J=y+g+(A.invMAngB1X*W.ang1X+A.invMAngB1Y*W.ang1Y+A.invMAngB1Z*W.ang1Z)+(A.invMAngB2X*W.ang2X+A.invMAngB2Y*W.ang2Y+A.invMAngB2Z*W.ang2Z),Q=G*J-H*U;0!=Q&&(Q=1/Q),A.massTB00=J*Q,A.massTB01=-H*Q,A.massTB10=-U*Q,A.massTB11=G*Q}},warmStart:function(t){var i,a,o,n,s,r,e,_,h,l,c,p;i=this._b1._velX,a=this._b1._velY,o=this._b1._velZ,n=this._b2._velX,s=this._b2._velY,r=this._b2._velZ,e=this._b1._angVelX,_=this._b1._angVelY,h=this._b1._angVelZ,l=this._b2._angVelX,c=this._b2._angVelY,p=this._b2._angVelZ;for(var v=0,m=this.info.numRows;v<m;){var b=v++,f=this.info.rows[b],x=f.impulse,u=this.massData[b],y=f.jacobianT,g=f.jacobianB,X=x.impulseN,z=x.impulseLX*y.lin1X+x.impulseLY*y.lin1Y+x.impulseLZ*y.lin1Z,M=x.impulseLX*g.lin1X+x.impulseLY*g.lin1Y+x.impulseLZ*g.lin1Z;x.impulseT=z,x.impulseB=M,x.impulseN*=t.dtRatio,x.impulseT*=t.dtRatio,x.impulseB*=t.dtRatio,i+=u.invMLinN1X*X,a+=u.invMLinN1Y*X,o+=u.invMLinN1Z*X,i+=u.invMLinT1X*z,a+=u.invMLinT1Y*z,o+=u.invMLinT1Z*z,i+=u.invMLinB1X*M,a+=u.invMLinB1Y*M,o+=u.invMLinB1Z*M,n+=u.invMLinN2X*-X,s+=u.invMLinN2Y*-X,r+=u.invMLinN2Z*-X,n+=u.invMLinT2X*-z,s+=u.invMLinT2Y*-z,r+=u.invMLinT2Z*-z,n+=u.invMLinB2X*-M,s+=u.invMLinB2Y*-M,r+=u.invMLinB2Z*-M,e+=u.invMAngN1X*X,_+=u.invMAngN1Y*X,h+=u.invMAngN1Z*X,e+=u.invMAngT1X*z,_+=u.invMAngT1Y*z,h+=u.invMAngT1Z*z,e+=u.invMAngB1X*M,_+=u.invMAngB1Y*M,h+=u.invMAngB1Z*M,l+=u.invMAngN2X*-X,c+=u.invMAngN2Y*-X,p+=u.invMAngN2Z*-X,l+=u.invMAngT2X*-z,c+=u.invMAngT2Y*-z,p+=u.invMAngT2Z*-z,l+=u.invMAngB2X*-M,c+=u.invMAngB2Y*-M,p+=u.invMAngB2Z*-M}this._b1._velX=i,this._b1._velY=a,this._b1._velZ=o,this._b2._velX=n,this._b2._velY=s,this._b2._velZ=r,this._b1._angVelX=e,this._b1._angVelY=_,this._b1._angVelZ=h,this._b2._angVelX=l,this._b2._angVelY=c,this._b2._angVelZ=p},solveVelocity:function(){var t,i,a,o,n,s,r,e,_,h,l,c;t=this._b1._velX,i=this._b1._velY,a=this._b1._velZ,o=this._b2._velX,n=this._b2._velY,s=this._b2._velZ,r=this._b1._angVelX,e=this._b1._angVelY,_=this._b1._angVelZ,h=this._b2._angVelX,l=this._b2._angVelY,c=this._b2._angVelZ;for(var p=0,v=this.info.numRows;p<v;){var m=p++,b=this.info.rows[m],f=this.massData[m],x=b.impulse,u=0,y=b.jacobianT;u+=t*y.lin1X+i*y.lin1Y+a*y.lin1Z,u-=o*y.lin2X+n*y.lin2Y+s*y.lin2Z,u+=r*y.ang1X+e*y.ang1Y+_*y.ang1Z,u-=h*y.ang2X+l*y.ang2Y+c*y.ang2Z;var g=0;g+=t*(y=b.jacobianB).lin1X+i*y.lin1Y+a*y.lin1Z,g-=o*y.lin2X+n*y.lin2Y+s*y.lin2Z,g+=r*y.ang1X+e*y.ang1Y+_*y.ang1Z,g-=h*y.ang2X+l*y.ang2Y+c*y.ang2Z;var X=-(u*f.massTB00+g*f.massTB01),z=-(u*f.massTB10+g*f.massTB11),M=x.impulseT,Y=x.impulseB;x.impulseT+=X,x.impulseB+=z;var Z=b.friction*x.impulseN;if(0==Z)x.impulseT=0,x.impulseB=0;else{var d=x.impulseT*x.impulseT+x.impulseB*x.impulseB;if(d>Z*Z){var I=Z/Math.sqrt(d);x.impulseT*=I,x.impulseB*=I}}X=x.impulseT-M,z=x.impulseB-Y,t+=f.invMLinT1X*X,i+=f.invMLinT1Y*X,a+=f.invMLinT1Z*X,t+=f.invMLinB1X*z,i+=f.invMLinB1Y*z,a+=f.invMLinB1Z*z,o+=f.invMLinT2X*-X,n+=f.invMLinT2Y*-X,s+=f.invMLinT2Z*-X,o+=f.invMLinB2X*-z,n+=f.invMLinB2Y*-z,s+=f.invMLinB2Z*-z,r+=f.invMAngT1X*X,e+=f.invMAngT1Y*X,_+=f.invMAngT1Z*X,r+=f.invMAngB1X*z,e+=f.invMAngB1Y*z,_+=f.invMAngB1Z*z,h+=f.invMAngT2X*-X,l+=f.invMAngT2Y*-X,c+=f.invMAngT2Z*-X,h+=f.invMAngB2X*-z,l+=f.invMAngB2Y*-z,c+=f.invMAngB2Z*-z}for(var V=0,L=this.info.numRows;V<L;){var w=V++,A=this.info.rows[w],k=this.massData[w],B=A.impulse,P=0,T=A.jacobianN;P+=t*T.lin1X+i*T.lin1Y+a*T.lin1Z,P-=o*T.lin2X+n*T.lin2Y+s*T.lin2Z,P+=r*T.ang1X+e*T.ang1Y+_*T.ang1Z,P-=h*T.ang2X+l*T.ang2Y+c*T.ang2Z;var S=(A.rhs-P)*k.massN,C=B.impulseN;B.impulseN+=S,B.impulseN<0&&(B.impulseN=0),S=B.impulseN-C,t+=k.invMLinN1X*S,i+=k.invMLinN1Y*S,a+=k.invMLinN1Z*S,o+=k.invMLinN2X*-S,n+=k.invMLinN2Y*-S,s+=k.invMLinN2Z*-S,r+=k.invMAngN1X*S,e+=k.invMAngN1Y*S,_+=k.invMAngN1Z*S,h+=k.invMAngN2X*-S,l+=k.invMAngN2Y*-S,c+=k.invMAngN2Z*-S}this._b1._velX=t,this._b1._velY=i,this._b1._velZ=a,this._b2._velX=o,this._b2._velY=n,this._b2._velZ=s,this._b1._angVelX=r,this._b1._angVelY=e,this._b1._angVelZ=_,this._b2._angVelX=h,this._b2._angVelY=l,this._b2._angVelZ=c},preSolvePosition:function(t){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);var i,a,o,n,s,r,e,_,h,l,c,p,v,m,b,f,x,u,y=this._b1._invMass,g=this._b2._invMass;i=this._b1._invInertia00,a=this._b1._invInertia01,o=this._b1._invInertia02,n=this._b1._invInertia10,s=this._b1._invInertia11,r=this._b1._invInertia12,e=this._b1._invInertia20,_=this._b1._invInertia21,h=this._b1._invInertia22,l=this._b2._invInertia00,c=this._b2._invInertia01,p=this._b2._invInertia02,v=this._b2._invInertia10,m=this._b2._invInertia11,b=this._b2._invInertia12,f=this._b2._invInertia20,x=this._b2._invInertia21,u=this._b2._invInertia22;for(var X=0,z=this.info.numRows;X<z;){var M,Y,Z,d,I,V,L=X++,w=this.info.rows[L],A=this.massData[L],k=w.jacobianN;A.invMLinN1X=k.lin1X*y,A.invMLinN1Y=k.lin1Y*y,A.invMLinN1Z=k.lin1Z*y,A.invMLinN2X=k.lin2X*g,A.invMLinN2Y=k.lin2Y*g,A.invMLinN2Z=k.lin2Z*g,M=i*k.ang1X+a*k.ang1Y+o*k.ang1Z,Y=n*k.ang1X+s*k.ang1Y+r*k.ang1Z,Z=e*k.ang1X+_*k.ang1Y+h*k.ang1Z,A.invMAngN1X=M,A.invMAngN1Y=Y,A.invMAngN1Z=Z,d=l*k.ang2X+c*k.ang2Y+p*k.ang2Z,I=v*k.ang2X+m*k.ang2Y+b*k.ang2Z,V=f*k.ang2X+x*k.ang2Y+u*k.ang2Z,A.invMAngN2X=d,A.invMAngN2Y=I,A.invMAngN2Z=V,A.massN=y+g+(A.invMAngN1X*k.ang1X+A.invMAngN1Y*k.ang1Y+A.invMAngN1Z*k.ang1Z)+(A.invMAngN2X*k.ang2X+A.invMAngN2Y*k.ang2Y+A.invMAngN2Z*k.ang2Z),0!=A.massN&&(A.massN=1/A.massN)}for(var B=0,P=this.info.numRows;B<P;){var T=B++;this.info.rows[T].impulse.impulseP=0}},solvePositionSplitImpulse:function(){var t,i,a,o,n,s,r,e,_,h,l,c;t=this._b1._pseudoVelX,i=this._b1._pseudoVelY,a=this._b1._pseudoVelZ,o=this._b2._pseudoVelX,n=this._b2._pseudoVelY,s=this._b2._pseudoVelZ,r=this._b1._angPseudoVelX,e=this._b1._angPseudoVelY,_=this._b1._angPseudoVelZ,h=this._b2._angPseudoVelX,l=this._b2._angPseudoVelY,c=this._b2._angPseudoVelZ;for(var p=0,v=this.info.numRows;p<v;){var m=p++,b=this.info.rows[m],f=this.massData[m],x=b.impulse,u=b.jacobianN,y=0;y+=t*u.lin1X+i*u.lin1Y+a*u.lin1Z,y-=o*u.lin2X+n*u.lin2Y+s*u.lin2Z,y+=r*u.ang1X+e*u.ang1Y+_*u.ang1Z,y-=h*u.ang2X+l*u.ang2Y+c*u.ang2Z;var g=(b.rhs-y)*f.massN*W.positionSplitImpulseBaumgarte,X=x.impulseP;x.impulseP+=g,x.impulseP<0&&(x.impulseP=0),g=x.impulseP-X,t+=f.invMLinN1X*g,i+=f.invMLinN1Y*g,a+=f.invMLinN1Z*g,o+=f.invMLinN2X*-g,n+=f.invMLinN2Y*-g,s+=f.invMLinN2Z*-g,r+=f.invMAngN1X*g,e+=f.invMAngN1Y*g,_+=f.invMAngN1Z*g,h+=f.invMAngN2X*-g,l+=f.invMAngN2Y*-g,c+=f.invMAngN2Z*-g}this._b1._pseudoVelX=t,this._b1._pseudoVelY=i,this._b1._pseudoVelZ=a,this._b2._pseudoVelX=o,this._b2._pseudoVelY=n,this._b2._pseudoVelZ=s,this._b1._angPseudoVelX=r,this._b1._angPseudoVelY=e,this._b1._angPseudoVelZ=_,this._b2._angPseudoVelX=h,this._b2._angPseudoVelY=l,this._b2._angPseudoVelZ=c},solvePositionNgs:function(t){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);var i,a,o,n,s,r,e,_,h,l,c,p,v,m,b,f,x,u,y=this._b1._invMass,g=this._b2._invMass;i=this._b1._invInertia00,a=this._b1._invInertia01,o=this._b1._invInertia02,n=this._b1._invInertia10,s=this._b1._invInertia11,r=this._b1._invInertia12,e=this._b1._invInertia20,_=this._b1._invInertia21,h=this._b1._invInertia22,l=this._b2._invInertia00,c=this._b2._invInertia01,p=this._b2._invInertia02,v=this._b2._invInertia10,m=this._b2._invInertia11,b=this._b2._invInertia12,f=this._b2._invInertia20,x=this._b2._invInertia21,u=this._b2._invInertia22;for(var X,z,M,Y,Z,d,I,V,L,w,A,k,B=0,P=this.info.numRows;B<P;){var T,S,C,q,R,E,j=B++,N=this.info.rows[j],D=this.massData[j],F=N.jacobianN;D.invMLinN1X=F.lin1X*y,D.invMLinN1Y=F.lin1Y*y,D.invMLinN1Z=F.lin1Z*y,D.invMLinN2X=F.lin2X*g,D.invMLinN2Y=F.lin2Y*g,D.invMLinN2Z=F.lin2Z*g,T=i*F.ang1X+a*F.ang1Y+o*F.ang1Z,S=n*F.ang1X+s*F.ang1Y+r*F.ang1Z,C=e*F.ang1X+_*F.ang1Y+h*F.ang1Z,D.invMAngN1X=T,D.invMAngN1Y=S,D.invMAngN1Z=C,q=l*F.ang2X+c*F.ang2Y+p*F.ang2Z,R=v*F.ang2X+m*F.ang2Y+b*F.ang2Z,E=f*F.ang2X+x*F.ang2Y+u*F.ang2Z,D.invMAngN2X=q,D.invMAngN2Y=R,D.invMAngN2Z=E,D.massN=y+g+(D.invMAngN1X*F.ang1X+D.invMAngN1Y*F.ang1Y+D.invMAngN1Z*F.ang1Z)+(D.invMAngN2X*F.ang2X+D.invMAngN2Y*F.ang2Y+D.invMAngN2Z*F.ang2Z),0!=D.massN&&(D.massN=1/D.massN)}X=0,z=0,M=0,Y=0,Z=0,d=0,I=0,V=0,L=0,w=0,A=0,k=0;for(var O=0,G=this.info.numRows;O<G;){var H=O++,U=this.info.rows[H],J=this.massData[H],Q=U.impulse,$=U.jacobianN,K=0;K+=X*$.lin1X+z*$.lin1Y+M*$.lin1Z,K-=Y*$.lin2X+Z*$.lin2Y+d*$.lin2Z,K+=I*$.ang1X+V*$.ang1Y+L*$.ang1Z,K-=w*$.ang2X+A*$.ang2Y+k*$.ang2Z;var tt=(U.rhs-K)*J.massN*W.positionNgsBaumgarte,it=Q.impulseP;Q.impulseP+=tt,Q.impulseP<0&&(Q.impulseP=0),tt=Q.impulseP-it,X+=J.invMLinN1X*tt,z+=J.invMLinN1Y*tt,M+=J.invMLinN1Z*tt,Y+=J.invMLinN2X*-tt,Z+=J.invMLinN2Y*-tt,d+=J.invMLinN2Z*-tt,I+=J.invMAngN1X*tt,V+=J.invMAngN1Y*tt,L+=J.invMAngN1Z*tt,w+=J.invMAngN2X*-tt,A+=J.invMAngN2Y*-tt,k+=J.invMAngN2Z*-tt}var at=this._b1;at._transform._positionX+=X,at._transform._positionY+=z,at._transform._positionZ+=M;var ot=this._b2;ot._transform._positionX+=Y,ot._transform._positionY+=Z,ot._transform._positionZ+=d;var nt,st,rt,et,_t,ht,lt,ct,pt,vt,mt=this._b1,bt=Math.sqrt(I*I+V*V+L*L),ft=.5*bt;if(ft<.5){var xt=ft*ft;nt=.5*(1-.16666666666666666*xt+xt*xt*.008333333333333333),st=1-.5*xt+xt*xt*.041666666666666664}else nt=Math.sin(ft)/bt,st=Math.cos(ft);rt=I*nt,et=V*nt,_t=L*nt,ht=st;var ut,yt=mt._transform._rotation00,gt=mt._transform._rotation11,Xt=mt._transform._rotation22,zt=yt+gt+Xt;zt>0?(vt=.5*(ut=Math.sqrt(zt+1)),ut=.5/ut,lt=(mt._transform._rotation21-mt._transform._rotation12)*ut,ct=(mt._transform._rotation02-mt._transform._rotation20)*ut,pt=(mt._transform._rotation10-mt._transform._rotation01)*ut):yt>gt?yt>Xt?(lt=.5*(ut=Math.sqrt(yt-gt-Xt+1)),ut=.5/ut,ct=(mt._transform._rotation01+mt._transform._rotation10)*ut,pt=(mt._transform._rotation02+mt._transform._rotation20)*ut,vt=(mt._transform._rotation21-mt._transform._rotation12)*ut):(pt=.5*(ut=Math.sqrt(Xt-yt-gt+1)),ut=.5/ut,lt=(mt._transform._rotation02+mt._transform._rotation20)*ut,ct=(mt._transform._rotation12+mt._transform._rotation21)*ut,vt=(mt._transform._rotation10-mt._transform._rotation01)*ut):gt>Xt?(ct=.5*(ut=Math.sqrt(gt-Xt-yt+1)),ut=.5/ut,lt=(mt._transform._rotation01+mt._transform._rotation10)*ut,pt=(mt._transform._rotation12+mt._transform._rotation21)*ut,vt=(mt._transform._rotation02-mt._transform._rotation20)*ut):(pt=.5*(ut=Math.sqrt(Xt-yt-gt+1)),ut=.5/ut,lt=(mt._transform._rotation02+mt._transform._rotation20)*ut,ct=(mt._transform._rotation12+mt._transform._rotation21)*ut,vt=(mt._transform._rotation10-mt._transform._rotation01)*ut);var Mt=(lt=ht*lt+rt*vt+et*pt-_t*ct)*lt+(ct=ht*ct-rt*pt+et*vt+_t*lt)*ct+(pt=ht*pt+rt*ct-et*lt+_t*vt)*pt+(vt=ht*vt-rt*lt-et*ct-_t*pt)*vt;Mt>1e-32&&(Mt=1/Math.sqrt(Mt));lt*=Mt,ct*=Mt,pt*=Mt,vt*=Mt;var Yt,Zt,dt,It,Vt,Lt,wt,At,kt,Bt,Pt,Tt,St,Ct,qt,Rt,Et,jt,Nt=2*lt,Dt=2*ct,Ft=2*pt,Ot=lt*Nt,Wt=ct*Dt,Gt=pt*Ft,Ht=lt*Dt,Ut=ct*Ft,Jt=lt*Ft,Qt=vt*Nt,$t=vt*Dt,Kt=vt*Ft;mt._transform._rotation00=1-Wt-Gt,mt._transform._rotation01=Ht-Kt,mt._transform._rotation02=Jt+$t,mt._transform._rotation10=Ht+Kt,mt._transform._rotation11=1-Ot-Gt,mt._transform._rotation12=Ut-Qt,mt._transform._rotation20=Jt-$t,mt._transform._rotation21=Ut+Qt,mt._transform._rotation22=1-Ot-Wt,Yt=mt._transform._rotation00*mt._invLocalInertia00+mt._transform._rotation01*mt._invLocalInertia10+mt._transform._rotation02*mt._invLocalInertia20,Zt=mt._transform._rotation00*mt._invLocalInertia01+mt._transform._rotation01*mt._invLocalInertia11+mt._transform._rotation02*mt._invLocalInertia21,dt=mt._transform._rotation00*mt._invLocalInertia02+mt._transform._rotation01*mt._invLocalInertia12+mt._transform._rotation02*mt._invLocalInertia22,It=mt._transform._rotation10*mt._invLocalInertia00+mt._transform._rotation11*mt._invLocalInertia10+mt._transform._rotation12*mt._invLocalInertia20,Vt=mt._transform._rotation10*mt._invLocalInertia01+mt._transform._rotation11*mt._invLocalInertia11+mt._transform._rotation12*mt._invLocalInertia21,Lt=mt._transform._rotation10*mt._invLocalInertia02+mt._transform._rotation11*mt._invLocalInertia12+mt._transform._rotation12*mt._invLocalInertia22,wt=mt._transform._rotation20*mt._invLocalInertia00+mt._transform._rotation21*mt._invLocalInertia10+mt._transform._rotation22*mt._invLocalInertia20,At=mt._transform._rotation20*mt._invLocalInertia01+mt._transform._rotation21*mt._invLocalInertia11+mt._transform._rotation22*mt._invLocalInertia21,kt=mt._transform._rotation20*mt._invLocalInertia02+mt._transform._rotation21*mt._invLocalInertia12+mt._transform._rotation22*mt._invLocalInertia22,mt._invInertia00=Yt,mt._invInertia01=Zt,mt._invInertia02=dt,mt._invInertia10=It,mt._invInertia11=Vt,mt._invInertia12=Lt,mt._invInertia20=wt,mt._invInertia21=At,mt._invInertia22=kt,Bt=mt._invInertia00*mt._transform._rotation00+mt._invInertia01*mt._transform._rotation01+mt._invInertia02*mt._transform._rotation02,Pt=mt._invInertia00*mt._transform._rotation10+mt._invInertia01*mt._transform._rotation11+mt._invInertia02*mt._transform._rotation12,Tt=mt._invInertia00*mt._transform._rotation20+mt._invInertia01*mt._transform._rotation21+mt._invInertia02*mt._transform._rotation22,St=mt._invInertia10*mt._transform._rotation00+mt._invInertia11*mt._transform._rotation01+mt._invInertia12*mt._transform._rotation02,Ct=mt._invInertia10*mt._transform._rotation10+mt._invInertia11*mt._transform._rotation11+mt._invInertia12*mt._transform._rotation12,qt=mt._invInertia10*mt._transform._rotation20+mt._invInertia11*mt._transform._rotation21+mt._invInertia12*mt._transform._rotation22,Rt=mt._invInertia20*mt._transform._rotation00+mt._invInertia21*mt._transform._rotation01+mt._invInertia22*mt._transform._rotation02,Et=mt._invInertia20*mt._transform._rotation10+mt._invInertia21*mt._transform._rotation11+mt._invInertia22*mt._transform._rotation12,jt=mt._invInertia20*mt._transform._rotation20+mt._invInertia21*mt._transform._rotation21+mt._invInertia22*mt._transform._rotation22,mt._invInertia00=Bt,mt._invInertia01=Pt,mt._invInertia02=Tt,mt._invInertia10=St,mt._invInertia11=Ct,mt._invInertia12=qt,mt._invInertia20=Rt,mt._invInertia21=Et,mt._invInertia22=jt,mt._invInertia00*=mt._rotFactor.x,mt._invInertia01*=mt._rotFactor.x,mt._invInertia02*=mt._rotFactor.x,mt._invInertia10*=mt._rotFactor.y,mt._invInertia11*=mt._rotFactor.y,mt._invInertia12*=mt._rotFactor.y,mt._invInertia20*=mt._rotFactor.z,mt._invInertia21*=mt._rotFactor.z,mt._invInertia22*=mt._rotFactor.z;var ti,ii,ai,oi,ni,si,ri,ei,_i,hi,li=this._b2,ci=Math.sqrt(w*w+A*A+k*k),pi=.5*ci;if(pi<.5){var vi=pi*pi;ti=.5*(1-.16666666666666666*vi+vi*vi*.008333333333333333),ii=1-.5*vi+vi*vi*.041666666666666664}else ti=Math.sin(pi)/ci,ii=Math.cos(pi);ai=w*ti,oi=A*ti,ni=k*ti,si=ii;var mi,bi=li._transform._rotation00,fi=li._transform._rotation11,xi=li._transform._rotation22,ui=bi+fi+xi;ui>0?(hi=.5*(mi=Math.sqrt(ui+1)),mi=.5/mi,ri=(li._transform._rotation21-li._transform._rotation12)*mi,ei=(li._transform._rotation02-li._transform._rotation20)*mi,_i=(li._transform._rotation10-li._transform._rotation01)*mi):bi>fi?bi>xi?(ri=.5*(mi=Math.sqrt(bi-fi-xi+1)),mi=.5/mi,ei=(li._transform._rotation01+li._transform._rotation10)*mi,_i=(li._transform._rotation02+li._transform._rotation20)*mi,hi=(li._transform._rotation21-li._transform._rotation12)*mi):(_i=.5*(mi=Math.sqrt(xi-bi-fi+1)),mi=.5/mi,ri=(li._transform._rotation02+li._transform._rotation20)*mi,ei=(li._transform._rotation12+li._transform._rotation21)*mi,hi=(li._transform._rotation10-li._transform._rotation01)*mi):fi>xi?(ei=.5*(mi=Math.sqrt(fi-xi-bi+1)),mi=.5/mi,ri=(li._transform._rotation01+li._transform._rotation10)*mi,_i=(li._transform._rotation12+li._transform._rotation21)*mi,hi=(li._transform._rotation02-li._transform._rotation20)*mi):(_i=.5*(mi=Math.sqrt(xi-bi-fi+1)),mi=.5/mi,ri=(li._transform._rotation02+li._transform._rotation20)*mi,ei=(li._transform._rotation12+li._transform._rotation21)*mi,hi=(li._transform._rotation10-li._transform._rotation01)*mi);var yi=(ri=si*ri+ai*hi+oi*_i-ni*ei)*ri+(ei=si*ei-ai*_i+oi*hi+ni*ri)*ei+(_i=si*_i+ai*ei-oi*ri+ni*hi)*_i+(hi=si*hi-ai*ri-oi*ei-ni*_i)*hi;yi>1e-32&&(yi=1/Math.sqrt(yi));ri*=yi,ei*=yi,_i*=yi,hi*=yi;var gi,Xi,zi,Mi,Yi,Zi,di,Ii,Vi,Li,wi,Ai,ki,Bi,Pi,Ti,Si,Ci,qi=2*ri,Ri=2*ei,Ei=2*_i,ji=ri*qi,Ni=ei*Ri,Di=_i*Ei,Fi=ri*Ri,Oi=ei*Ei,Wi=ri*Ei,Gi=hi*qi,Hi=hi*Ri,Ui=hi*Ei;li._transform._rotation00=1-Ni-Di,li._transform._rotation01=Fi-Ui,li._transform._rotation02=Wi+Hi,li._transform._rotation10=Fi+Ui,li._transform._rotation11=1-ji-Di,li._transform._rotation12=Oi-Gi,li._transform._rotation20=Wi-Hi,li._transform._rotation21=Oi+Gi,li._transform._rotation22=1-ji-Ni,gi=li._transform._rotation00*li._invLocalInertia00+li._transform._rotation01*li._invLocalInertia10+li._transform._rotation02*li._invLocalInertia20,Xi=li._transform._rotation00*li._invLocalInertia01+li._transform._rotation01*li._invLocalInertia11+li._transform._rotation02*li._invLocalInertia21,zi=li._transform._rotation00*li._invLocalInertia02+li._transform._rotation01*li._invLocalInertia12+li._transform._rotation02*li._invLocalInertia22,Mi=li._transform._rotation10*li._invLocalInertia00+li._transform._rotation11*li._invLocalInertia10+li._transform._rotation12*li._invLocalInertia20,Yi=li._transform._rotation10*li._invLocalInertia01+li._transform._rotation11*li._invLocalInertia11+li._transform._rotation12*li._invLocalInertia21,Zi=li._transform._rotation10*li._invLocalInertia02+li._transform._rotation11*li._invLocalInertia12+li._transform._rotation12*li._invLocalInertia22,di=li._transform._rotation20*li._invLocalInertia00+li._transform._rotation21*li._invLocalInertia10+li._transform._rotation22*li._invLocalInertia20,Ii=li._transform._rotation20*li._invLocalInertia01+li._transform._rotation21*li._invLocalInertia11+li._transform._rotation22*li._invLocalInertia21,Vi=li._transform._rotation20*li._invLocalInertia02+li._transform._rotation21*li._invLocalInertia12+li._transform._rotation22*li._invLocalInertia22,li._invInertia00=gi,li._invInertia01=Xi,li._invInertia02=zi,li._invInertia10=Mi,li._invInertia11=Yi,li._invInertia12=Zi,li._invInertia20=di,li._invInertia21=Ii,li._invInertia22=Vi,Li=li._invInertia00*li._transform._rotation00+li._invInertia01*li._transform._rotation01+li._invInertia02*li._transform._rotation02,wi=li._invInertia00*li._transform._rotation10+li._invInertia01*li._transform._rotation11+li._invInertia02*li._transform._rotation12,Ai=li._invInertia00*li._transform._rotation20+li._invInertia01*li._transform._rotation21+li._invInertia02*li._transform._rotation22,ki=li._invInertia10*li._transform._rotation00+li._invInertia11*li._transform._rotation01+li._invInertia12*li._transform._rotation02,Bi=li._invInertia10*li._transform._rotation10+li._invInertia11*li._transform._rotation11+li._invInertia12*li._transform._rotation12,Pi=li._invInertia10*li._transform._rotation20+li._invInertia11*li._transform._rotation21+li._invInertia12*li._transform._rotation22,Ti=li._invInertia20*li._transform._rotation00+li._invInertia21*li._transform._rotation01+li._invInertia22*li._transform._rotation02,Si=li._invInertia20*li._transform._rotation10+li._invInertia21*li._transform._rotation11+li._invInertia22*li._transform._rotation12,Ci=li._invInertia20*li._transform._rotation20+li._invInertia21*li._transform._rotation21+li._invInertia22*li._transform._rotation22,li._invInertia00=Li,li._invInertia01=wi,li._invInertia02=Ai,li._invInertia10=ki,li._invInertia11=Bi,li._invInertia12=Pi,li._invInertia20=Ti,li._invInertia21=Si,li._invInertia22=Ci,li._invInertia00*=li._rotFactor.x,li._invInertia01*=li._rotFactor.x,li._invInertia02*=li._rotFactor.x,li._invInertia10*=li._rotFactor.y,li._invInertia11*=li._rotFactor.y,li._invInertia12*=li._rotFactor.y,li._invInertia20*=li._rotFactor.z,li._invInertia21*=li._rotFactor.z,li._invInertia22*=li._rotFactor.z},postSolve:function(){for(var t=0,i=this.info.numRows;t<i;){var a,o,n,s=t++,r=this.info.rows[s],e=r.impulse,_=r.jacobianT,h=r.jacobianB;a=0,o=0,n=0,a+=_.lin1X*e.impulseT,o+=_.lin1Y*e.impulseT,n+=_.lin1Z*e.impulseT,a+=h.lin1X*e.impulseB,o+=h.lin1Y*e.impulseB,n+=h.lin1Z*e.impulseB,e.impulseLX=a,e.impulseLY=o,e.impulseLZ=n}this.constraint._syncManifold()}});var ri=function(t){xt.call(this),this.joint=t,this.info=new It;var i=W.maxJacobianRows,a=new Array(i);this.massData=a;for(var o=0,n=this.massData.length;o<n;){var s=o++;this.massData[s]=new $t}};ri.__super__=xt,ri.prototype=$extend(xt.prototype,{preSolveVelocity:function(t){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2;var i,a,o,n,s,r,e,_,h,l,c,p,v,m,b,f,x,u,y=this._b1._invMass,g=this._b2._invMass;i=this._b1._invInertia00,a=this._b1._invInertia01,o=this._b1._invInertia02,n=this._b1._invInertia10,s=this._b1._invInertia11,r=this._b1._invInertia12,e=this._b1._invInertia20,_=this._b1._invInertia21,h=this._b1._invInertia22,l=this._b2._invInertia00,c=this._b2._invInertia01,p=this._b2._invInertia02,v=this._b2._invInertia10,m=this._b2._invInertia11,b=this._b2._invInertia12,f=this._b2._invInertia20,x=this._b2._invInertia21,u=this._b2._invInertia22;for(var X=0,z=this.info.numRows;X<z;){var M,Y,Z,d,I,V,L=X++,w=this.info.rows[L],A=this.massData[L],k=w.jacobian;if(k.updateSparsity(),0!=(1&k.flag)?(A.invMLin1X=k.lin1X*y,A.invMLin1Y=k.lin1Y*y,A.invMLin1Z=k.lin1Z*y,A.invMLin2X=k.lin2X*g,A.invMLin2Y=k.lin2Y*g,A.invMLin2Z=k.lin2Z*g):(A.invMLin1X=0,A.invMLin1Y=0,A.invMLin1Z=0,A.invMLin2X=0,A.invMLin2Y=0,A.invMLin2Z=0),0!=(2&k.flag))M=i*k.ang1X+a*k.ang1Y+o*k.ang1Z,Y=n*k.ang1X+s*k.ang1Y+r*k.ang1Z,Z=e*k.ang1X+_*k.ang1Y+h*k.ang1Z,A.invMAng1X=M,A.invMAng1Y=Y,A.invMAng1Z=Z,d=l*k.ang2X+c*k.ang2Y+p*k.ang2Z,I=v*k.ang2X+m*k.ang2Y+b*k.ang2Z,V=f*k.ang2X+x*k.ang2Y+u*k.ang2Z,A.invMAng2X=d,A.invMAng2Y=I,A.invMAng2Z=V;else A.invMAng1X=0,A.invMAng1Y=0,A.invMAng1Z=0,A.invMAng2X=0,A.invMAng2Y=0,A.invMAng2Z=0;A.massWithoutCfm=A.invMLin1X*k.lin1X+A.invMLin1Y*k.lin1Y+A.invMLin1Z*k.lin1Z+(A.invMLin2X*k.lin2X+A.invMLin2Y*k.lin2Y+A.invMLin2Z*k.lin2Z)+(A.invMAng1X*k.ang1X+A.invMAng1Y*k.ang1Y+A.invMAng1Z*k.ang1Z)+(A.invMAng2X*k.ang2X+A.invMAng2Y*k.ang2Y+A.invMAng2Z*k.ang2Z),A.mass=A.massWithoutCfm+w.cfm,0!=A.massWithoutCfm&&(A.massWithoutCfm=1/A.massWithoutCfm),0!=A.mass&&(A.mass=1/A.mass)}},warmStart:function(t){var i=this.joint._positionCorrectionAlgorithm==ut.BAUMGARTE?W.jointWarmStartingFactorForBaungarte:W.jointWarmStartingFactor;if((i*=t.dtRatio)<=0)for(var a=0,o=this.info.numRows;a<o;){var n=a++,s=this.info.rows[n].impulse;s.impulse=0,s.impulseM=0,s.impulseP=0}else{var r,e,_,h,l,c,p,v,m,b,f,x;r=this._b1._velX,e=this._b1._velY,_=this._b1._velZ,h=this._b2._velX,l=this._b2._velY,c=this._b2._velZ,p=this._b1._angVelX,v=this._b1._angVelY,m=this._b1._angVelZ,b=this._b2._angVelX,f=this._b2._angVelY,x=this._b2._angVelZ;for(var u=0,y=this.info.numRows;u<y;){var g=u++,X=this.info.rows[g],z=this.massData[g],M=X.impulse;X.jacobian;M.impulse*=i,M.impulseM*=i;var Y=M.impulse+M.impulseM;r+=z.invMLin1X*Y,e+=z.invMLin1Y*Y,_+=z.invMLin1Z*Y,h+=z.invMLin2X*-Y,l+=z.invMLin2Y*-Y,c+=z.invMLin2Z*-Y,p+=z.invMAng1X*Y,v+=z.invMAng1Y*Y,m+=z.invMAng1Z*Y,b+=z.invMAng2X*-Y,f+=z.invMAng2Y*-Y,x+=z.invMAng2Z*-Y}this._b1._velX=r,this._b1._velY=e,this._b1._velZ=_,this._b2._velX=h,this._b2._velY=l,this._b2._velZ=c,this._b1._angVelX=p,this._b1._angVelY=v,this._b1._angVelZ=m,this._b2._angVelX=b,this._b2._angVelY=f,this._b2._angVelZ=x}},solveVelocity:function(){var t,i,a,o,n,s,r,e,_,h,l,c;t=this._b1._velX,i=this._b1._velY,a=this._b1._velZ,o=this._b2._velX,n=this._b2._velY,s=this._b2._velZ,r=this._b1._angVelX,e=this._b1._angVelY,_=this._b1._angVelZ,h=this._b2._angVelX,l=this._b2._angVelY,c=this._b2._angVelZ;for(var p=0,v=this.info.numRows;p<v;){var m=p++,b=this.info.rows[m],f=this.massData[m],x=b.impulse,u=b.jacobian;if(0!=b.motorMaxImpulse){var y=0;y+=t*u.lin1X+i*u.lin1Y+a*u.lin1Z,y-=o*u.lin2X+n*u.lin2Y+s*u.lin2Z,y+=r*u.ang1X+e*u.ang1Y+_*u.ang1Z,y-=h*u.ang2X+l*u.ang2Y+c*u.ang2Z;var g=(-b.motorSpeed-y)*f.massWithoutCfm,X=x.impulseM;x.impulseM+=g,x.impulseM<-b.motorMaxImpulse?x.impulseM=-b.motorMaxImpulse:x.impulseM>b.motorMaxImpulse&&(x.impulseM=b.motorMaxImpulse),g=x.impulseM-X,0!=(1&u.flag)&&(t+=f.invMLin1X*g,i+=f.invMLin1Y*g,a+=f.invMLin1Z*g,o+=f.invMLin2X*-g,n+=f.invMLin2Y*-g,s+=f.invMLin2Z*-g),0!=(2&u.flag)&&(r+=f.invMAng1X*g,e+=f.invMAng1Y*g,_+=f.invMAng1Z*g,h+=f.invMAng2X*-g,l+=f.invMAng2Y*-g,c+=f.invMAng2Z*-g)}}for(var z=0,M=this.info.numRows;z<M;){var Y=z++,Z=this.info.rows[Y],d=this.massData[Y],I=Z.impulse,V=Z.jacobian,L=0;L+=t*V.lin1X+i*V.lin1Y+a*V.lin1Z,L-=o*V.lin2X+n*V.lin2Y+s*V.lin2Z,L+=r*V.ang1X+e*V.ang1Y+_*V.ang1Z,L-=h*V.ang2X+l*V.ang2Y+c*V.ang2Z;var w=(Z.rhs-L-I.impulse*Z.cfm)*d.mass,A=I.impulse;I.impulse+=w,I.impulse<Z.minImpulse?I.impulse=Z.minImpulse:I.impulse>Z.maxImpulse&&(I.impulse=Z.maxImpulse),w=I.impulse-A,0!=(1&V.flag)&&(t+=d.invMLin1X*w,i+=d.invMLin1Y*w,a+=d.invMLin1Z*w,o+=d.invMLin2X*-w,n+=d.invMLin2Y*-w,s+=d.invMLin2Z*-w),0!=(2&V.flag)&&(r+=d.invMAng1X*w,e+=d.invMAng1Y*w,_+=d.invMAng1Z*w,h+=d.invMAng2X*-w,l+=d.invMAng2Y*-w,c+=d.invMAng2Z*-w)}this._b1._velX=t,this._b1._velY=i,this._b1._velZ=a,this._b2._velX=o,this._b2._velY=n,this._b2._velZ=s,this._b1._angVelX=r,this._b1._angVelY=e,this._b1._angVelZ=_,this._b2._angVelX=h,this._b2._angVelY=l,this._b2._angVelZ=c},postSolveVelocity:function(t){var i,a,o,n,s,r;i=0,a=0,o=0,n=0,s=0,r=0;for(var e=0,_=this.info.numRows;e<_;){var h=e++,l=this.info.rows[h],c=l.impulse,p=l.jacobian;0!=(1&p.flag)?(i+=p.lin1X*c.impulse,a+=p.lin1Y*c.impulse,o+=p.lin1Z*c.impulse):0!=(2&p.flag)&&(n+=p.ang1X*c.impulse,s+=p.ang1Y*c.impulse,r+=p.ang1Z*c.impulse)}this.joint._appliedForceX=i*t.invDt,this.joint._appliedForceY=a*t.invDt,this.joint._appliedForceZ=o*t.invDt,this.joint._appliedTorqueX=n*t.invDt,this.joint._appliedTorqueY=s*t.invDt,this.joint._appliedTorqueZ=r*t.invDt},preSolvePosition:function(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;var i,a,o,n,s,r,e,_,h,l,c,p,v,m,b,f,x,u,y=this._b1._invMass,g=this._b2._invMass;i=this._b1._invInertia00,a=this._b1._invInertia01,o=this._b1._invInertia02,n=this._b1._invInertia10,s=this._b1._invInertia11,r=this._b1._invInertia12,e=this._b1._invInertia20,_=this._b1._invInertia21,h=this._b1._invInertia22,l=this._b2._invInertia00,c=this._b2._invInertia01,p=this._b2._invInertia02,v=this._b2._invInertia10,m=this._b2._invInertia11,b=this._b2._invInertia12,f=this._b2._invInertia20,x=this._b2._invInertia21,u=this._b2._invInertia22;for(var X=0,z=this.info.numRows;X<z;){var M,Y,Z,d,I,V,L=X++,w=this.info.rows[L],A=this.massData[L],k=(w.impulse,w.jacobian);A.invMLin1X=k.lin1X*y,A.invMLin1Y=k.lin1Y*y,A.invMLin1Z=k.lin1Z*y,A.invMLin2X=k.lin2X*g,A.invMLin2Y=k.lin2Y*g,A.invMLin2Z=k.lin2Z*g,M=i*k.ang1X+a*k.ang1Y+o*k.ang1Z,Y=n*k.ang1X+s*k.ang1Y+r*k.ang1Z,Z=e*k.ang1X+_*k.ang1Y+h*k.ang1Z,A.invMAng1X=M,A.invMAng1Y=Y,A.invMAng1Z=Z,d=l*k.ang2X+c*k.ang2Y+p*k.ang2Z,I=v*k.ang2X+m*k.ang2Y+b*k.ang2Z,V=f*k.ang2X+x*k.ang2Y+u*k.ang2Z,A.invMAng2X=d,A.invMAng2Y=I,A.invMAng2Z=V,A.mass=A.invMLin1X*k.lin1X+A.invMLin1Y*k.lin1Y+A.invMLin1Z*k.lin1Z+(A.invMLin2X*k.lin2X+A.invMLin2Y*k.lin2Y+A.invMLin2Z*k.lin2Z)+(A.invMAng1X*k.ang1X+A.invMAng1Y*k.ang1Y+A.invMAng1Z*k.ang1Z)+(A.invMAng2X*k.ang2X+A.invMAng2Y*k.ang2Y+A.invMAng2Z*k.ang2Z),0!=A.mass&&(A.mass=1/A.mass)}for(var B=0,P=this.info.numRows;B<P;){var T=B++;this.info.rows[T].impulse.impulseP=0}},solvePositionSplitImpulse:function(){var t,i,a,o,n,s,r,e,_,h,l,c;t=this._b1._pseudoVelX,i=this._b1._pseudoVelY,a=this._b1._pseudoVelZ,o=this._b2._pseudoVelX,n=this._b2._pseudoVelY,s=this._b2._pseudoVelZ,r=this._b1._angPseudoVelX,e=this._b1._angPseudoVelY,_=this._b1._angPseudoVelZ,h=this._b2._angPseudoVelX,l=this._b2._angPseudoVelY,c=this._b2._angPseudoVelZ;for(var p=0,v=this.info.numRows;p<v;){var m=p++,b=this.info.rows[m],f=this.massData[m],x=b.impulse,u=b.jacobian,y=0;y+=t*u.lin1X+i*u.lin1Y+a*u.lin1Z,y-=o*u.lin2X+n*u.lin2Y+s*u.lin2Z,y+=r*u.ang1X+e*u.ang1Y+_*u.ang1Z,y-=h*u.ang2X+l*u.ang2Y+c*u.ang2Z;var g=(b.rhs*W.positionSplitImpulseBaumgarte-y)*f.mass,X=x.impulseP;x.impulseP+=g,x.impulseP<b.minImpulse?x.impulseP=b.minImpulse:x.impulseP>b.maxImpulse&&(x.impulseP=b.maxImpulse),g=x.impulseP-X,t+=f.invMLin1X*g,i+=f.invMLin1Y*g,a+=f.invMLin1Z*g,o+=f.invMLin2X*-g,n+=f.invMLin2Y*-g,s+=f.invMLin2Z*-g,r+=f.invMAng1X*g,e+=f.invMAng1Y*g,_+=f.invMAng1Z*g,h+=f.invMAng2X*-g,l+=f.invMAng2Y*-g,c+=f.invMAng2Z*-g}this._b1._pseudoVelX=t,this._b1._pseudoVelY=i,this._b1._pseudoVelZ=a,this._b2._pseudoVelX=o,this._b2._pseudoVelY=n,this._b2._pseudoVelZ=s,this._b1._angPseudoVelX=r,this._b1._angPseudoVelY=e,this._b1._angPseudoVelZ=_,this._b2._angPseudoVelX=h,this._b2._angPseudoVelY=l,this._b2._angPseudoVelZ=c},solvePositionNgs:function(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;var i,a,o,n,s,r,e,_,h,l,c,p,v,m,b,f,x,u,y=this._b1._invMass,g=this._b2._invMass;i=this._b1._invInertia00,a=this._b1._invInertia01,o=this._b1._invInertia02,n=this._b1._invInertia10,s=this._b1._invInertia11,r=this._b1._invInertia12,e=this._b1._invInertia20,_=this._b1._invInertia21,h=this._b1._invInertia22,l=this._b2._invInertia00,c=this._b2._invInertia01,p=this._b2._invInertia02,v=this._b2._invInertia10,m=this._b2._invInertia11,b=this._b2._invInertia12,f=this._b2._invInertia20,x=this._b2._invInertia21,u=this._b2._invInertia22;for(var X,z,M,Y,Z,d,I,V,L,w,A,k,B=0,P=this.info.numRows;B<P;){var T,S,C,q,R,E,j=B++,N=this.info.rows[j],D=this.massData[j],F=(N.impulse,N.jacobian);D.invMLin1X=F.lin1X*y,D.invMLin1Y=F.lin1Y*y,D.invMLin1Z=F.lin1Z*y,D.invMLin2X=F.lin2X*g,D.invMLin2Y=F.lin2Y*g,D.invMLin2Z=F.lin2Z*g,T=i*F.ang1X+a*F.ang1Y+o*F.ang1Z,S=n*F.ang1X+s*F.ang1Y+r*F.ang1Z,C=e*F.ang1X+_*F.ang1Y+h*F.ang1Z,D.invMAng1X=T,D.invMAng1Y=S,D.invMAng1Z=C,q=l*F.ang2X+c*F.ang2Y+p*F.ang2Z,R=v*F.ang2X+m*F.ang2Y+b*F.ang2Z,E=f*F.ang2X+x*F.ang2Y+u*F.ang2Z,D.invMAng2X=q,D.invMAng2Y=R,D.invMAng2Z=E,D.mass=D.invMLin1X*F.lin1X+D.invMLin1Y*F.lin1Y+D.invMLin1Z*F.lin1Z+(D.invMLin2X*F.lin2X+D.invMLin2Y*F.lin2Y+D.invMLin2Z*F.lin2Z)+(D.invMAng1X*F.ang1X+D.invMAng1Y*F.ang1Y+D.invMAng1Z*F.ang1Z)+(D.invMAng2X*F.ang2X+D.invMAng2Y*F.ang2Y+D.invMAng2Z*F.ang2Z),0!=D.mass&&(D.mass=1/D.mass)}X=0,z=0,M=0,Y=0,Z=0,d=0,I=0,V=0,L=0,w=0,A=0,k=0;for(var O=0,G=this.info.numRows;O<G;){var H=O++,U=this.info.rows[H],J=this.massData[H],Q=U.impulse,$=U.jacobian,K=0;K+=X*$.lin1X+z*$.lin1Y+M*$.lin1Z,K-=Y*$.lin2X+Z*$.lin2Y+d*$.lin2Z,K+=I*$.ang1X+V*$.ang1Y+L*$.ang1Z,K-=w*$.ang2X+A*$.ang2Y+k*$.ang2Z;var tt=(U.rhs*W.positionNgsBaumgarte-K)*J.mass,it=Q.impulseP;Q.impulseP+=tt,Q.impulseP<U.minImpulse?Q.impulseP=U.minImpulse:Q.impulseP>U.maxImpulse&&(Q.impulseP=U.maxImpulse),tt=Q.impulseP-it,X+=J.invMLin1X*tt,z+=J.invMLin1Y*tt,M+=J.invMLin1Z*tt,Y+=J.invMLin2X*-tt,Z+=J.invMLin2Y*-tt,d+=J.invMLin2Z*-tt,I+=J.invMAng1X*tt,V+=J.invMAng1Y*tt,L+=J.invMAng1Z*tt,w+=J.invMAng2X*-tt,A+=J.invMAng2Y*-tt,k+=J.invMAng2Z*-tt}var at=this._b1;at._transform._positionX+=X,at._transform._positionY+=z,at._transform._positionZ+=M;var ot=this._b2;ot._transform._positionX+=Y,ot._transform._positionY+=Z,ot._transform._positionZ+=d;var nt,st,rt,et,_t,ht,lt,ct,pt,vt,mt=this._b1,bt=Math.sqrt(I*I+V*V+L*L),ft=.5*bt;if(ft<.5){var xt=ft*ft;nt=.5*(1-.16666666666666666*xt+xt*xt*.008333333333333333),st=1-.5*xt+xt*xt*.041666666666666664}else nt=Math.sin(ft)/bt,st=Math.cos(ft);rt=I*nt,et=V*nt,_t=L*nt,ht=st;var ut,yt=mt._transform._rotation00,gt=mt._transform._rotation11,Xt=mt._transform._rotation22,zt=yt+gt+Xt;zt>0?(vt=.5*(ut=Math.sqrt(zt+1)),ut=.5/ut,lt=(mt._transform._rotation21-mt._transform._rotation12)*ut,ct=(mt._transform._rotation02-mt._transform._rotation20)*ut,pt=(mt._transform._rotation10-mt._transform._rotation01)*ut):yt>gt?yt>Xt?(lt=.5*(ut=Math.sqrt(yt-gt-Xt+1)),ut=.5/ut,ct=(mt._transform._rotation01+mt._transform._rotation10)*ut,pt=(mt._transform._rotation02+mt._transform._rotation20)*ut,vt=(mt._transform._rotation21-mt._transform._rotation12)*ut):(pt=.5*(ut=Math.sqrt(Xt-yt-gt+1)),ut=.5/ut,lt=(mt._transform._rotation02+mt._transform._rotation20)*ut,ct=(mt._transform._rotation12+mt._transform._rotation21)*ut,vt=(mt._transform._rotation10-mt._transform._rotation01)*ut):gt>Xt?(ct=.5*(ut=Math.sqrt(gt-Xt-yt+1)),ut=.5/ut,lt=(mt._transform._rotation01+mt._transform._rotation10)*ut,pt=(mt._transform._rotation12+mt._transform._rotation21)*ut,vt=(mt._transform._rotation02-mt._transform._rotation20)*ut):(pt=.5*(ut=Math.sqrt(Xt-yt-gt+1)),ut=.5/ut,lt=(mt._transform._rotation02+mt._transform._rotation20)*ut,ct=(mt._transform._rotation12+mt._transform._rotation21)*ut,vt=(mt._transform._rotation10-mt._transform._rotation01)*ut);var Mt=(lt=ht*lt+rt*vt+et*pt-_t*ct)*lt+(ct=ht*ct-rt*pt+et*vt+_t*lt)*ct+(pt=ht*pt+rt*ct-et*lt+_t*vt)*pt+(vt=ht*vt-rt*lt-et*ct-_t*pt)*vt;Mt>1e-32&&(Mt=1/Math.sqrt(Mt));lt*=Mt,ct*=Mt,pt*=Mt,vt*=Mt;var Yt,Zt,dt,It,Vt,Lt,wt,At,kt,Bt,Pt,Tt,St,Ct,qt,Rt,Et,jt,Nt=2*lt,Dt=2*ct,Ft=2*pt,Ot=lt*Nt,Wt=ct*Dt,Gt=pt*Ft,Ht=lt*Dt,Ut=ct*Ft,Jt=lt*Ft,Qt=vt*Nt,$t=vt*Dt,Kt=vt*Ft;mt._transform._rotation00=1-Wt-Gt,mt._transform._rotation01=Ht-Kt,mt._transform._rotation02=Jt+$t,mt._transform._rotation10=Ht+Kt,mt._transform._rotation11=1-Ot-Gt,mt._transform._rotation12=Ut-Qt,mt._transform._rotation20=Jt-$t,mt._transform._rotation21=Ut+Qt,mt._transform._rotation22=1-Ot-Wt,Yt=mt._transform._rotation00*mt._invLocalInertia00+mt._transform._rotation01*mt._invLocalInertia10+mt._transform._rotation02*mt._invLocalInertia20,Zt=mt._transform._rotation00*mt._invLocalInertia01+mt._transform._rotation01*mt._invLocalInertia11+mt._transform._rotation02*mt._invLocalInertia21,dt=mt._transform._rotation00*mt._invLocalInertia02+mt._transform._rotation01*mt._invLocalInertia12+mt._transform._rotation02*mt._invLocalInertia22,It=mt._transform._rotation10*mt._invLocalInertia00+mt._transform._rotation11*mt._invLocalInertia10+mt._transform._rotation12*mt._invLocalInertia20,Vt=mt._transform._rotation10*mt._invLocalInertia01+mt._transform._rotation11*mt._invLocalInertia11+mt._transform._rotation12*mt._invLocalInertia21,Lt=mt._transform._rotation10*mt._invLocalInertia02+mt._transform._rotation11*mt._invLocalInertia12+mt._transform._rotation12*mt._invLocalInertia22,wt=mt._transform._rotation20*mt._invLocalInertia00+mt._transform._rotation21*mt._invLocalInertia10+mt._transform._rotation22*mt._invLocalInertia20,At=mt._transform._rotation20*mt._invLocalInertia01+mt._transform._rotation21*mt._invLocalInertia11+mt._transform._rotation22*mt._invLocalInertia21,kt=mt._transform._rotation20*mt._invLocalInertia02+mt._transform._rotation21*mt._invLocalInertia12+mt._transform._rotation22*mt._invLocalInertia22,mt._invInertia00=Yt,mt._invInertia01=Zt,mt._invInertia02=dt,mt._invInertia10=It,mt._invInertia11=Vt,mt._invInertia12=Lt,mt._invInertia20=wt,mt._invInertia21=At,mt._invInertia22=kt,Bt=mt._invInertia00*mt._transform._rotation00+mt._invInertia01*mt._transform._rotation01+mt._invInertia02*mt._transform._rotation02,Pt=mt._invInertia00*mt._transform._rotation10+mt._invInertia01*mt._transform._rotation11+mt._invInertia02*mt._transform._rotation12,Tt=mt._invInertia00*mt._transform._rotation20+mt._invInertia01*mt._transform._rotation21+mt._invInertia02*mt._transform._rotation22,St=mt._invInertia10*mt._transform._rotation00+mt._invInertia11*mt._transform._rotation01+mt._invInertia12*mt._transform._rotation02,Ct=mt._invInertia10*mt._transform._rotation10+mt._invInertia11*mt._transform._rotation11+mt._invInertia12*mt._transform._rotation12,qt=mt._invInertia10*mt._transform._rotation20+mt._invInertia11*mt._transform._rotation21+mt._invInertia12*mt._transform._rotation22,Rt=mt._invInertia20*mt._transform._rotation00+mt._invInertia21*mt._transform._rotation01+mt._invInertia22*mt._transform._rotation02,Et=mt._invInertia20*mt._transform._rotation10+mt._invInertia21*mt._transform._rotation11+mt._invInertia22*mt._transform._rotation12,jt=mt._invInertia20*mt._transform._rotation20+mt._invInertia21*mt._transform._rotation21+mt._invInertia22*mt._transform._rotation22,mt._invInertia00=Bt,mt._invInertia01=Pt,mt._invInertia02=Tt,mt._invInertia10=St,mt._invInertia11=Ct,mt._invInertia12=qt,mt._invInertia20=Rt,mt._invInertia21=Et,mt._invInertia22=jt,mt._invInertia00*=mt._rotFactor.x,mt._invInertia01*=mt._rotFactor.x,mt._invInertia02*=mt._rotFactor.x,mt._invInertia10*=mt._rotFactor.y,mt._invInertia11*=mt._rotFactor.y,mt._invInertia12*=mt._rotFactor.y,mt._invInertia20*=mt._rotFactor.z,mt._invInertia21*=mt._rotFactor.z,mt._invInertia22*=mt._rotFactor.z;var ti,ii,ai,oi,ni,si,ri,ei,_i,hi,li=this._b2,ci=Math.sqrt(w*w+A*A+k*k),pi=.5*ci;if(pi<.5){var vi=pi*pi;ti=.5*(1-.16666666666666666*vi+vi*vi*.008333333333333333),ii=1-.5*vi+vi*vi*.041666666666666664}else ti=Math.sin(pi)/ci,ii=Math.cos(pi);ai=w*ti,oi=A*ti,ni=k*ti,si=ii;var mi,bi=li._transform._rotation00,fi=li._transform._rotation11,xi=li._transform._rotation22,ui=bi+fi+xi;ui>0?(hi=.5*(mi=Math.sqrt(ui+1)),mi=.5/mi,ri=(li._transform._rotation21-li._transform._rotation12)*mi,ei=(li._transform._rotation02-li._transform._rotation20)*mi,_i=(li._transform._rotation10-li._transform._rotation01)*mi):bi>fi?bi>xi?(ri=.5*(mi=Math.sqrt(bi-fi-xi+1)),mi=.5/mi,ei=(li._transform._rotation01+li._transform._rotation10)*mi,_i=(li._transform._rotation02+li._transform._rotation20)*mi,hi=(li._transform._rotation21-li._transform._rotation12)*mi):(_i=.5*(mi=Math.sqrt(xi-bi-fi+1)),mi=.5/mi,ri=(li._transform._rotation02+li._transform._rotation20)*mi,ei=(li._transform._rotation12+li._transform._rotation21)*mi,hi=(li._transform._rotation10-li._transform._rotation01)*mi):fi>xi?(ei=.5*(mi=Math.sqrt(fi-xi-bi+1)),mi=.5/mi,ri=(li._transform._rotation01+li._transform._rotation10)*mi,_i=(li._transform._rotation12+li._transform._rotation21)*mi,hi=(li._transform._rotation02-li._transform._rotation20)*mi):(_i=.5*(mi=Math.sqrt(xi-bi-fi+1)),mi=.5/mi,ri=(li._transform._rotation02+li._transform._rotation20)*mi,ei=(li._transform._rotation12+li._transform._rotation21)*mi,hi=(li._transform._rotation10-li._transform._rotation01)*mi);var yi=(ri=si*ri+ai*hi+oi*_i-ni*ei)*ri+(ei=si*ei-ai*_i+oi*hi+ni*ri)*ei+(_i=si*_i+ai*ei-oi*ri+ni*hi)*_i+(hi=si*hi-ai*ri-oi*ei-ni*_i)*hi;yi>1e-32&&(yi=1/Math.sqrt(yi));ri*=yi,ei*=yi,_i*=yi,hi*=yi;var gi,Xi,zi,Mi,Yi,Zi,di,Ii,Vi,Li,wi,Ai,ki,Bi,Pi,Ti,Si,Ci,qi=2*ri,Ri=2*ei,Ei=2*_i,ji=ri*qi,Ni=ei*Ri,Di=_i*Ei,Fi=ri*Ri,Oi=ei*Ei,Wi=ri*Ei,Gi=hi*qi,Hi=hi*Ri,Ui=hi*Ei;li._transform._rotation00=1-Ni-Di,li._transform._rotation01=Fi-Ui,li._transform._rotation02=Wi+Hi,li._transform._rotation10=Fi+Ui,li._transform._rotation11=1-ji-Di,li._transform._rotation12=Oi-Gi,li._transform._rotation20=Wi-Hi,li._transform._rotation21=Oi+Gi,li._transform._rotation22=1-ji-Ni,gi=li._transform._rotation00*li._invLocalInertia00+li._transform._rotation01*li._invLocalInertia10+li._transform._rotation02*li._invLocalInertia20,Xi=li._transform._rotation00*li._invLocalInertia01+li._transform._rotation01*li._invLocalInertia11+li._transform._rotation02*li._invLocalInertia21,zi=li._transform._rotation00*li._invLocalInertia02+li._transform._rotation01*li._invLocalInertia12+li._transform._rotation02*li._invLocalInertia22,Mi=li._transform._rotation10*li._invLocalInertia00+li._transform._rotation11*li._invLocalInertia10+li._transform._rotation12*li._invLocalInertia20,Yi=li._transform._rotation10*li._invLocalInertia01+li._transform._rotation11*li._invLocalInertia11+li._transform._rotation12*li._invLocalInertia21,Zi=li._transform._rotation10*li._invLocalInertia02+li._transform._rotation11*li._invLocalInertia12+li._transform._rotation12*li._invLocalInertia22,di=li._transform._rotation20*li._invLocalInertia00+li._transform._rotation21*li._invLocalInertia10+li._transform._rotation22*li._invLocalInertia20,Ii=li._transform._rotation20*li._invLocalInertia01+li._transform._rotation21*li._invLocalInertia11+li._transform._rotation22*li._invLocalInertia21,Vi=li._transform._rotation20*li._invLocalInertia02+li._transform._rotation21*li._invLocalInertia12+li._transform._rotation22*li._invLocalInertia22,li._invInertia00=gi,li._invInertia01=Xi,li._invInertia02=zi,li._invInertia10=Mi,li._invInertia11=Yi,li._invInertia12=Zi,li._invInertia20=di,li._invInertia21=Ii,li._invInertia22=Vi,Li=li._invInertia00*li._transform._rotation00+li._invInertia01*li._transform._rotation01+li._invInertia02*li._transform._rotation02,wi=li._invInertia00*li._transform._rotation10+li._invInertia01*li._transform._rotation11+li._invInertia02*li._transform._rotation12,Ai=li._invInertia00*li._transform._rotation20+li._invInertia01*li._transform._rotation21+li._invInertia02*li._transform._rotation22,ki=li._invInertia10*li._transform._rotation00+li._invInertia11*li._transform._rotation01+li._invInertia12*li._transform._rotation02,Bi=li._invInertia10*li._transform._rotation10+li._invInertia11*li._transform._rotation11+li._invInertia12*li._transform._rotation12,Pi=li._invInertia10*li._transform._rotation20+li._invInertia11*li._transform._rotation21+li._invInertia12*li._transform._rotation22,Ti=li._invInertia20*li._transform._rotation00+li._invInertia21*li._transform._rotation01+li._invInertia22*li._transform._rotation02,Si=li._invInertia20*li._transform._rotation10+li._invInertia21*li._transform._rotation11+li._invInertia22*li._transform._rotation12,Ci=li._invInertia20*li._transform._rotation20+li._invInertia21*li._transform._rotation21+li._invInertia22*li._transform._rotation22,li._invInertia00=Li,li._invInertia01=wi,li._invInertia02=Ai,li._invInertia10=ki,li._invInertia11=Bi,li._invInertia12=Pi,li._invInertia20=Ti,li._invInertia21=Si,li._invInertia22=Ci,li._invInertia00*=li._rotFactor.x,li._invInertia01*=li._rotFactor.x,li._invInertia02*=li._rotFactor.x,li._invInertia10*=li._rotFactor.y,li._invInertia11*=li._rotFactor.y,li._invInertia12*=li._rotFactor.y,li._invInertia20*=li._rotFactor.z,li._invInertia21*=li._rotFactor.z,li._invInertia22*=li._rotFactor.z},postSolve:function(){this.joint._syncAnchors(),this.joint._checkDestruction()}});var ei=function(){this.mass=0,this.localInertia=new J},_i=function(t){this._next=null,this._prev=null,this._shapeList=null,this._shapeListLast=null,this._numShapes=0,this._contactLinkList=null,this._contactLinkListLast=null,this._numContactLinks=0,this._jointLinkList=null,this._jointLinkListLast=null,this._numJointLinks=0;var i=t.linearVelocity;this._velX=i.x,this._velY=i.y,this._velZ=i.z;var a=t.angularVelocity;this._angVelX=a.x,this._angVelY=a.y,this._angVelZ=a.z,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._ptransform=new O,this._transform=new O;var o=t.position;this._ptransform._positionX=o.x,this._ptransform._positionY=o.y,this._ptransform._positionZ=o.z;var n=t.rotation;this._ptransform._rotation00=n.e00,this._ptransform._rotation01=n.e01,this._ptransform._rotation02=n.e02,this._ptransform._rotation10=n.e10,this._ptransform._rotation11=n.e11,this._ptransform._rotation12=n.e12,this._ptransform._rotation20=n.e20,this._ptransform._rotation21=n.e21,this._ptransform._rotation22=n.e22;var s=this._transform,r=this._ptransform;s._positionX=r._positionX,s._positionY=r._positionY,s._positionZ=r._positionZ,s._rotation00=r._rotation00,s._rotation01=r._rotation01,s._rotation02=r._rotation02,s._rotation10=r._rotation10,s._rotation11=r._rotation11,s._rotation12=r._rotation12,s._rotation20=r._rotation20,s._rotation21=r._rotation21,s._rotation22=r._rotation22,this._type=t.type,this._sleepTime=0,this._sleeping=!1,this._autoSleep=t.autoSleep,this._mass=0,this._invMass=0,this._localInertia00=0,this._localInertia01=0,this._localInertia02=0,this._localInertia10=0,this._localInertia11=0,this._localInertia12=0,this._localInertia20=0,this._localInertia21=0,this._localInertia22=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._invInertia00=0,this._invInertia01=0,this._invInertia02=0,this._invInertia10=0,this._invInertia11=0,this._invInertia12=0,this._invInertia20=0,this._invInertia21=0,this._invInertia22=0,this._linearDamping=t.linearDamping,this._angularDamping=t.angularDamping,this._forceX=0,this._forceY=0,this._forceZ=0,this._torqueX=0,this._torqueY=0,this._torqueZ=0,this._rotFactor=new F(1,1,1),this._addedToIsland=!1,this._gravityScale=1,this._world=null};_i.prototype={_integrate:function(t){switch(this._type){case 1:this._velX=0,this._velY=0,this._velZ=0,this._angVelX=0,this._angVelY=0,this._angVelZ=0,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:var i,a,o,n,s,r,e=(i=this._velX*t)*i+(a=this._velY*t)*a+(o=this._velZ*t)*o,_=(n=this._angVelX*t)*n+(s=this._angVelY*t)*s+(r=this._angVelZ*t)*r;if(0==e&&0==_)return;if(e>W.maxTranslationPerStep*W.maxTranslationPerStep){var h=W.maxTranslationPerStep/Math.sqrt(e);this._velX*=h,this._velY*=h,this._velZ*=h,i*=h,a*=h,o*=h}if(_>W.maxRotationPerStep*W.maxRotationPerStep){var l=W.maxRotationPerStep/Math.sqrt(_);this._angVelX*=l,this._angVelY*=l,this._angVelZ*=l,n*=l,s*=l,r*=l}this._transform._positionX+=i,this._transform._positionY+=a,this._transform._positionZ+=o;var c,p,v,m,b,f,x,u,y,g,X=Math.sqrt(n*n+s*s+r*r),z=.5*X;if(z<.5){var M=z*z;c=.5*(1-.16666666666666666*M+M*M*.008333333333333333),p=1-.5*M+M*M*.041666666666666664}else c=Math.sin(z)/X,p=Math.cos(z);v=n*c,m=s*c,b=r*c,f=p;var Y,Z=this._transform._rotation00,d=this._transform._rotation11,I=this._transform._rotation22,V=Z+d+I;V>0?(g=.5*(Y=Math.sqrt(V+1)),Y=.5/Y,x=(this._transform._rotation21-this._transform._rotation12)*Y,u=(this._transform._rotation02-this._transform._rotation20)*Y,y=(this._transform._rotation10-this._transform._rotation01)*Y):Z>d?Z>I?(x=.5*(Y=Math.sqrt(Z-d-I+1)),Y=.5/Y,u=(this._transform._rotation01+this._transform._rotation10)*Y,y=(this._transform._rotation02+this._transform._rotation20)*Y,g=(this._transform._rotation21-this._transform._rotation12)*Y):(y=.5*(Y=Math.sqrt(I-Z-d+1)),Y=.5/Y,x=(this._transform._rotation02+this._transform._rotation20)*Y,u=(this._transform._rotation12+this._transform._rotation21)*Y,g=(this._transform._rotation10-this._transform._rotation01)*Y):d>I?(u=.5*(Y=Math.sqrt(d-I-Z+1)),Y=.5/Y,x=(this._transform._rotation01+this._transform._rotation10)*Y,y=(this._transform._rotation12+this._transform._rotation21)*Y,g=(this._transform._rotation02-this._transform._rotation20)*Y):(y=.5*(Y=Math.sqrt(I-Z-d+1)),Y=.5/Y,x=(this._transform._rotation02+this._transform._rotation20)*Y,u=(this._transform._rotation12+this._transform._rotation21)*Y,g=(this._transform._rotation10-this._transform._rotation01)*Y);var L=(x=f*x+v*g+m*y-b*u)*x+(u=f*u-v*y+m*g+b*x)*u+(y=f*y+v*u-m*x+b*g)*y+(g=f*g-v*x-m*u-b*y)*g;L>1e-32&&(L=1/Math.sqrt(L));x*=L,u*=L,y*=L,g*=L;var w,A,k,B,P,T,S,C,q,R,E,j,N,D,F,O,G,H,U=2*x,J=2*u,Q=2*y,$=x*U,K=u*J,tt=y*Q,it=x*J,at=u*Q,ot=x*Q,nt=g*U,st=g*J,rt=g*Q;this._transform._rotation00=1-K-tt,this._transform._rotation01=it-rt,this._transform._rotation02=ot+st,this._transform._rotation10=it+rt,this._transform._rotation11=1-$-tt,this._transform._rotation12=at-nt,this._transform._rotation20=ot-st,this._transform._rotation21=at+nt,this._transform._rotation22=1-$-K,w=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,A=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,k=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,B=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,P=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,T=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,S=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,C=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,q=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=w,this._invInertia01=A,this._invInertia02=k,this._invInertia10=B,this._invInertia11=P,this._invInertia12=T,this._invInertia20=S,this._invInertia21=C,this._invInertia22=q,R=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,E=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,j=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,N=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,D=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,F=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,O=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,G=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,H=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=R,this._invInertia01=E,this._invInertia02=j,this._invInertia10=N,this._invInertia11=D,this._invInertia12=F,this._invInertia20=O,this._invInertia21=G,this._invInertia22=H,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z}},_integratePseudoVelocity:function(){var t=this._pseudoVelX*this._pseudoVelX+this._pseudoVelY*this._pseudoVelY+this._pseudoVelZ*this._pseudoVelZ,i=this._angPseudoVelX*this._angPseudoVelX+this._angPseudoVelY*this._angPseudoVelY+this._angPseudoVelZ*this._angPseudoVelZ;if(0!=t||0!=i)switch(this._type){case 1:this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:var a,o,n,s,r,e;a=this._pseudoVelX,o=this._pseudoVelY,n=this._pseudoVelZ,s=this._angPseudoVelX,r=this._angPseudoVelY,e=this._angPseudoVelZ,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._transform._positionX+=a,this._transform._positionY+=o,this._transform._positionZ+=n;var _,h,l,c,p,v,m,b,f,x,u=Math.sqrt(s*s+r*r+e*e),y=.5*u;if(y<.5){var g=y*y;_=.5*(1-.16666666666666666*g+g*g*.008333333333333333),h=1-.5*g+g*g*.041666666666666664}else _=Math.sin(y)/u,h=Math.cos(y);l=s*_,c=r*_,p=e*_,v=h;var X,z=this._transform._rotation00,M=this._transform._rotation11,Y=this._transform._rotation22,Z=z+M+Y;Z>0?(x=.5*(X=Math.sqrt(Z+1)),X=.5/X,m=(this._transform._rotation21-this._transform._rotation12)*X,b=(this._transform._rotation02-this._transform._rotation20)*X,f=(this._transform._rotation10-this._transform._rotation01)*X):z>M?z>Y?(m=.5*(X=Math.sqrt(z-M-Y+1)),X=.5/X,b=(this._transform._rotation01+this._transform._rotation10)*X,f=(this._transform._rotation02+this._transform._rotation20)*X,x=(this._transform._rotation21-this._transform._rotation12)*X):(f=.5*(X=Math.sqrt(Y-z-M+1)),X=.5/X,m=(this._transform._rotation02+this._transform._rotation20)*X,b=(this._transform._rotation12+this._transform._rotation21)*X,x=(this._transform._rotation10-this._transform._rotation01)*X):M>Y?(b=.5*(X=Math.sqrt(M-Y-z+1)),X=.5/X,m=(this._transform._rotation01+this._transform._rotation10)*X,f=(this._transform._rotation12+this._transform._rotation21)*X,x=(this._transform._rotation02-this._transform._rotation20)*X):(f=.5*(X=Math.sqrt(Y-z-M+1)),X=.5/X,m=(this._transform._rotation02+this._transform._rotation20)*X,b=(this._transform._rotation12+this._transform._rotation21)*X,x=(this._transform._rotation10-this._transform._rotation01)*X);var d=(m=v*m+l*x+c*f-p*b)*m+(b=v*b-l*f+c*x+p*m)*b+(f=v*f+l*b-c*m+p*x)*f+(x=v*x-l*m-c*b-p*f)*x;d>1e-32&&(d=1/Math.sqrt(d));m*=d,b*=d,f*=d,x*=d;var I,V,L,w,A,k,B,P,T,S,C,q,R,E,j,N,D,F,O=2*m,W=2*b,G=2*f,H=m*O,U=b*W,J=f*G,Q=m*W,$=b*G,K=m*G,tt=x*O,it=x*W,at=x*G;this._transform._rotation00=1-U-J,this._transform._rotation01=Q-at,this._transform._rotation02=K+it,this._transform._rotation10=Q+at,this._transform._rotation11=1-H-J,this._transform._rotation12=$-tt,this._transform._rotation20=K-it,this._transform._rotation21=$+tt,this._transform._rotation22=1-H-U,I=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,V=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,L=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,w=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,A=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,k=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,B=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,P=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,T=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=I,this._invInertia01=V,this._invInertia02=L,this._invInertia10=w,this._invInertia11=A,this._invInertia12=k,this._invInertia20=B,this._invInertia21=P,this._invInertia22=T,S=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,C=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,q=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,R=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,E=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,j=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,N=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,D=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,F=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=S,this._invInertia01=C,this._invInertia02=q,this._invInertia10=R,this._invInertia11=E,this._invInertia12=j,this._invInertia20=N,this._invInertia21=D,this._invInertia22=F,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z}},updateMass:function(){var t,i,a,o,n,s,r,e,_;t=0,i=0,a=0,o=0,n=0,s=0,r=0,e=0,_=0;for(var h=0,l=this._shapeList;null!=l;){var c=l._next,p=l._geom;p._updateMass();var v,m,b,f,x,u,y,g,X,z,M,Y,Z,d,I,V,L,w,A,k=l._density*p._volume;z=l._localTransform._rotation00*p._inertiaCoeff00+l._localTransform._rotation01*p._inertiaCoeff10+l._localTransform._rotation02*p._inertiaCoeff20,m=l._localTransform._rotation00*p._inertiaCoeff01+l._localTransform._rotation01*p._inertiaCoeff11+l._localTransform._rotation02*p._inertiaCoeff21,b=l._localTransform._rotation00*p._inertiaCoeff02+l._localTransform._rotation01*p._inertiaCoeff12+l._localTransform._rotation02*p._inertiaCoeff22,f=l._localTransform._rotation10*p._inertiaCoeff00+l._localTransform._rotation11*p._inertiaCoeff10+l._localTransform._rotation12*p._inertiaCoeff20,x=l._localTransform._rotation10*p._inertiaCoeff01+l._localTransform._rotation11*p._inertiaCoeff11+l._localTransform._rotation12*p._inertiaCoeff21,u=l._localTransform._rotation10*p._inertiaCoeff02+l._localTransform._rotation11*p._inertiaCoeff12+l._localTransform._rotation12*p._inertiaCoeff22,y=l._localTransform._rotation20*p._inertiaCoeff00+l._localTransform._rotation21*p._inertiaCoeff10+l._localTransform._rotation22*p._inertiaCoeff20,g=l._localTransform._rotation20*p._inertiaCoeff01+l._localTransform._rotation21*p._inertiaCoeff11+l._localTransform._rotation22*p._inertiaCoeff21,X=l._localTransform._rotation20*p._inertiaCoeff02+l._localTransform._rotation21*p._inertiaCoeff12+l._localTransform._rotation22*p._inertiaCoeff22,M=(v=z)*l._localTransform._rotation00+m*l._localTransform._rotation01+b*l._localTransform._rotation02,Y=v*l._localTransform._rotation10+m*l._localTransform._rotation11+b*l._localTransform._rotation12,Z=v*l._localTransform._rotation20+m*l._localTransform._rotation21+b*l._localTransform._rotation22,d=f*l._localTransform._rotation00+x*l._localTransform._rotation01+u*l._localTransform._rotation02,I=f*l._localTransform._rotation10+x*l._localTransform._rotation11+u*l._localTransform._rotation12,V=f*l._localTransform._rotation20+x*l._localTransform._rotation21+u*l._localTransform._rotation22,L=y*l._localTransform._rotation00+g*l._localTransform._rotation01+X*l._localTransform._rotation02,w=y*l._localTransform._rotation10+g*l._localTransform._rotation11+X*l._localTransform._rotation12,A=y*l._localTransform._rotation20+g*l._localTransform._rotation21+X*l._localTransform._rotation22,v=M,m=Y,b=Z,f=d,x=I,u=V,y=L,g=w,X=A,v*=k,m*=k,b*=k,f*=k,x*=k,u*=k,y*=k,g*=k,X*=k;var B=l._localTransform._positionX*l._localTransform._positionX,P=l._localTransform._positionY*l._localTransform._positionY,T=l._localTransform._positionZ*l._localTransform._positionZ,S=-l._localTransform._positionX*l._localTransform._positionY,C=-l._localTransform._positionY*l._localTransform._positionZ,q=-l._localTransform._positionZ*l._localTransform._positionX;h+=k,t+=v+=(P+T)*k,i+=m+=S*k,a+=b+=q*k,o+=f+=S*k,n+=x+=(B+T)*k,s+=u+=C*k,r+=y+=q*k,e+=g+=C*k,_+=X+=(B+P)*k,l=c}this._mass=h,this._localInertia00=t,this._localInertia01=i,this._localInertia02=a,this._localInertia10=o,this._localInertia11=n,this._localInertia12=s,this._localInertia20=r,this._localInertia21=e,this._localInertia22=_;var R,E,j,N,D,F,O,W,G,H,U,J,Q,$,K,tt,it,at,ot=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,nt=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,st=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,rt=this._localInertia00*ot-this._localInertia01*nt+this._localInertia02*st;if(this._mass>0&&rt>0&&0==this._type){this._invMass=1/this._mass;var et=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,_t=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,ht=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,lt=this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21,ct=this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20,pt=this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20,vt=this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11,mt=this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10,bt=this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10,ft=this._localInertia00*et-this._localInertia01*_t+this._localInertia02*ht;(ft<-1e-32||ft>1e-32)&&(ft=1/ft),this._invLocalInertia00=et*ft,this._invLocalInertia01=-lt*ft,this._invLocalInertia02=vt*ft,this._invLocalInertia10=-_t*ft,this._invLocalInertia11=ct*ft,this._invLocalInertia12=-mt*ft,this._invLocalInertia20=ht*ft,this._invLocalInertia21=-pt*ft,this._invLocalInertia22=bt*ft,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,0==this._type&&(this._type=1);R=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,E=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,j=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,N=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,D=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,F=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,O=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,W=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,G=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=R,this._invInertia01=E,this._invInertia02=j,this._invInertia10=N,this._invInertia11=D,this._invInertia12=F,this._invInertia20=O,this._invInertia21=W,this._invInertia22=G,H=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,U=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,J=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,Q=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,$=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,K=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,tt=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,it=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,at=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=H,this._invInertia01=U,this._invInertia02=J,this._invInertia10=Q,this._invInertia11=$,this._invInertia12=K,this._invInertia20=tt,this._invInertia21=it,this._invInertia22=at,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0},getPosition:function(){var t=new F,i=t;return i.x=this._transform._positionX,i.y=this._transform._positionY,i.z=this._transform._positionZ,t},getPositionTo:function(t){var i=t;i.x=this._transform._positionX,i.y=this._transform._positionY,i.z=this._transform._positionZ},setPosition:function(t){var i=t;this._transform._positionX=i.x,this._transform._positionY=i.y,this._transform._positionZ=i.z;var a=this._ptransform,o=this._transform;a._positionX=o._positionX,a._positionY=o._positionY,a._positionZ=o._positionZ,a._rotation00=o._rotation00,a._rotation01=o._rotation01,a._rotation02=o._rotation02,a._rotation10=o._rotation10,a._rotation11=o._rotation11,a._rotation12=o._rotation12,a._rotation20=o._rotation20,a._rotation21=o._rotation21,a._rotation22=o._rotation22;for(var n=this._shapeList;null!=n;){var s,r,e,_,h,l,c,p,v,m,b,f,x=n._next,u=n._ptransform,y=n._localTransform,g=this._ptransform;s=g._rotation00*y._rotation00+g._rotation01*y._rotation10+g._rotation02*y._rotation20,r=g._rotation00*y._rotation01+g._rotation01*y._rotation11+g._rotation02*y._rotation21,e=g._rotation00*y._rotation02+g._rotation01*y._rotation12+g._rotation02*y._rotation22,_=g._rotation10*y._rotation00+g._rotation11*y._rotation10+g._rotation12*y._rotation20,h=g._rotation10*y._rotation01+g._rotation11*y._rotation11+g._rotation12*y._rotation21,l=g._rotation10*y._rotation02+g._rotation11*y._rotation12+g._rotation12*y._rotation22,c=g._rotation20*y._rotation00+g._rotation21*y._rotation10+g._rotation22*y._rotation20,p=g._rotation20*y._rotation01+g._rotation21*y._rotation11+g._rotation22*y._rotation21,v=g._rotation20*y._rotation02+g._rotation21*y._rotation12+g._rotation22*y._rotation22,u._rotation00=s,u._rotation01=r,u._rotation02=e,u._rotation10=_,u._rotation11=h,u._rotation12=l,u._rotation20=c,u._rotation21=p,u._rotation22=v,m=g._rotation00*y._positionX+g._rotation01*y._positionY+g._rotation02*y._positionZ,b=g._rotation10*y._positionX+g._rotation11*y._positionY+g._rotation12*y._positionZ,f=g._rotation20*y._positionX+g._rotation21*y._positionY+g._rotation22*y._positionZ,u._positionX=m,u._positionY=b,u._positionZ=f,u._positionX+=g._positionX,u._positionY+=g._positionY,u._positionZ+=g._positionZ;var X,z,M,Y,Z,d,I,V,L,w,A,k,B,P,T,S,C,q,R=n._transform,E=n._localTransform,j=this._transform;if(X=j._rotation00*E._rotation00+j._rotation01*E._rotation10+j._rotation02*E._rotation20,z=j._rotation00*E._rotation01+j._rotation01*E._rotation11+j._rotation02*E._rotation21,M=j._rotation00*E._rotation02+j._rotation01*E._rotation12+j._rotation02*E._rotation22,Y=j._rotation10*E._rotation00+j._rotation11*E._rotation10+j._rotation12*E._rotation20,Z=j._rotation10*E._rotation01+j._rotation11*E._rotation11+j._rotation12*E._rotation21,d=j._rotation10*E._rotation02+j._rotation11*E._rotation12+j._rotation12*E._rotation22,I=j._rotation20*E._rotation00+j._rotation21*E._rotation10+j._rotation22*E._rotation20,V=j._rotation20*E._rotation01+j._rotation21*E._rotation11+j._rotation22*E._rotation21,L=j._rotation20*E._rotation02+j._rotation21*E._rotation12+j._rotation22*E._rotation22,R._rotation00=X,R._rotation01=z,R._rotation02=M,R._rotation10=Y,R._rotation11=Z,R._rotation12=d,R._rotation20=I,R._rotation21=V,R._rotation22=L,w=j._rotation00*E._positionX+j._rotation01*E._positionY+j._rotation02*E._positionZ,A=j._rotation10*E._positionX+j._rotation11*E._positionY+j._rotation12*E._positionZ,k=j._rotation20*E._positionX+j._rotation21*E._positionY+j._rotation22*E._positionZ,R._positionX=w,R._positionY=A,R._positionZ=k,R._positionX+=j._positionX,R._positionY+=j._positionY,R._positionZ+=j._positionZ,n._geom._computeAabb(n._aabb,n._ptransform),B=n._aabb._minX,P=n._aabb._minY,T=n._aabb._minZ,S=n._aabb._maxX,C=n._aabb._maxY,q=n._aabb._maxZ,n._geom._computeAabb(n._aabb,n._transform),n._aabb._minX=B<n._aabb._minX?B:n._aabb._minX,n._aabb._minY=P<n._aabb._minY?P:n._aabb._minY,n._aabb._minZ=T<n._aabb._minZ?T:n._aabb._minZ,n._aabb._maxX=S>n._aabb._maxX?S:n._aabb._maxX,n._aabb._maxY=C>n._aabb._maxY?C:n._aabb._maxY,n._aabb._maxZ=q>n._aabb._maxZ?q:n._aabb._maxZ,null!=n._proxy){var N,D,F;N=n._transform._positionX-n._ptransform._positionX,D=n._transform._positionY-n._ptransform._positionY,F=n._transform._positionZ-n._ptransform._positionZ;var O=n.displacement;O.x=N,O.y=D,O.z=F,n._rigidBody._world._broadPhase.moveProxy(n._proxy,n._aabb,n.displacement)}n=x}this._sleeping=!1,this._sleepTime=0},translate:function(t){var i,a,o,n=t;i=n.x,a=n.y,o=n.z,this._transform._positionX+=i,this._transform._positionY+=a,this._transform._positionZ+=o;var s=this._ptransform,r=this._transform;s._positionX=r._positionX,s._positionY=r._positionY,s._positionZ=r._positionZ,s._rotation00=r._rotation00,s._rotation01=r._rotation01,s._rotation02=r._rotation02,s._rotation10=r._rotation10,s._rotation11=r._rotation11,s._rotation12=r._rotation12,s._rotation20=r._rotation20,s._rotation21=r._rotation21,s._rotation22=r._rotation22;for(var e=this._shapeList;null!=e;){var _,h,l,c,p,v,m,b,f,x,u,y,g=e._next,X=e._ptransform,z=e._localTransform,M=this._ptransform;_=M._rotation00*z._rotation00+M._rotation01*z._rotation10+M._rotation02*z._rotation20,h=M._rotation00*z._rotation01+M._rotation01*z._rotation11+M._rotation02*z._rotation21,l=M._rotation00*z._rotation02+M._rotation01*z._rotation12+M._rotation02*z._rotation22,c=M._rotation10*z._rotation00+M._rotation11*z._rotation10+M._rotation12*z._rotation20,p=M._rotation10*z._rotation01+M._rotation11*z._rotation11+M._rotation12*z._rotation21,v=M._rotation10*z._rotation02+M._rotation11*z._rotation12+M._rotation12*z._rotation22,m=M._rotation20*z._rotation00+M._rotation21*z._rotation10+M._rotation22*z._rotation20,b=M._rotation20*z._rotation01+M._rotation21*z._rotation11+M._rotation22*z._rotation21,f=M._rotation20*z._rotation02+M._rotation21*z._rotation12+M._rotation22*z._rotation22,X._rotation00=_,X._rotation01=h,X._rotation02=l,X._rotation10=c,X._rotation11=p,X._rotation12=v,X._rotation20=m,X._rotation21=b,X._rotation22=f,x=M._rotation00*z._positionX+M._rotation01*z._positionY+M._rotation02*z._positionZ,u=M._rotation10*z._positionX+M._rotation11*z._positionY+M._rotation12*z._positionZ,y=M._rotation20*z._positionX+M._rotation21*z._positionY+M._rotation22*z._positionZ,X._positionX=x,X._positionY=u,X._positionZ=y,X._positionX+=M._positionX,X._positionY+=M._positionY,X._positionZ+=M._positionZ;var Y,Z,d,I,V,L,w,A,k,B,P,T,S,C,q,R,E,j,N=e._transform,D=e._localTransform,F=this._transform;if(Y=F._rotation00*D._rotation00+F._rotation01*D._rotation10+F._rotation02*D._rotation20,Z=F._rotation00*D._rotation01+F._rotation01*D._rotation11+F._rotation02*D._rotation21,d=F._rotation00*D._rotation02+F._rotation01*D._rotation12+F._rotation02*D._rotation22,I=F._rotation10*D._rotation00+F._rotation11*D._rotation10+F._rotation12*D._rotation20,V=F._rotation10*D._rotation01+F._rotation11*D._rotation11+F._rotation12*D._rotation21,L=F._rotation10*D._rotation02+F._rotation11*D._rotation12+F._rotation12*D._rotation22,w=F._rotation20*D._rotation00+F._rotation21*D._rotation10+F._rotation22*D._rotation20,A=F._rotation20*D._rotation01+F._rotation21*D._rotation11+F._rotation22*D._rotation21,k=F._rotation20*D._rotation02+F._rotation21*D._rotation12+F._rotation22*D._rotation22,N._rotation00=Y,N._rotation01=Z,N._rotation02=d,N._rotation10=I,N._rotation11=V,N._rotation12=L,N._rotation20=w,N._rotation21=A,N._rotation22=k,B=F._rotation00*D._positionX+F._rotation01*D._positionY+F._rotation02*D._positionZ,P=F._rotation10*D._positionX+F._rotation11*D._positionY+F._rotation12*D._positionZ,T=F._rotation20*D._positionX+F._rotation21*D._positionY+F._rotation22*D._positionZ,N._positionX=B,N._positionY=P,N._positionZ=T,N._positionX+=F._positionX,N._positionY+=F._positionY,N._positionZ+=F._positionZ,e._geom._computeAabb(e._aabb,e._ptransform),S=e._aabb._minX,C=e._aabb._minY,q=e._aabb._minZ,R=e._aabb._maxX,E=e._aabb._maxY,j=e._aabb._maxZ,e._geom._computeAabb(e._aabb,e._transform),e._aabb._minX=S<e._aabb._minX?S:e._aabb._minX,e._aabb._minY=C<e._aabb._minY?C:e._aabb._minY,e._aabb._minZ=q<e._aabb._minZ?q:e._aabb._minZ,e._aabb._maxX=R>e._aabb._maxX?R:e._aabb._maxX,e._aabb._maxY=E>e._aabb._maxY?E:e._aabb._maxY,e._aabb._maxZ=j>e._aabb._maxZ?j:e._aabb._maxZ,null!=e._proxy){var O,W,G;O=e._transform._positionX-e._ptransform._positionX,W=e._transform._positionY-e._ptransform._positionY,G=e._transform._positionZ-e._ptransform._positionZ;var H=e.displacement;H.x=O,H.y=W,H.z=G,e._rigidBody._world._broadPhase.moveProxy(e._proxy,e._aabb,e.displacement)}e=g}this._sleeping=!1,this._sleepTime=0},getRotation:function(){var t=new J,i=t;return i.e00=this._transform._rotation00,i.e01=this._transform._rotation01,i.e02=this._transform._rotation02,i.e10=this._transform._rotation10,i.e11=this._transform._rotation11,i.e12=this._transform._rotation12,i.e20=this._transform._rotation20,i.e21=this._transform._rotation21,i.e22=this._transform._rotation22,t},getRotationTo:function(t){var i=t;i.e00=this._transform._rotation00,i.e01=this._transform._rotation01,i.e02=this._transform._rotation02,i.e10=this._transform._rotation10,i.e11=this._transform._rotation11,i.e12=this._transform._rotation12,i.e20=this._transform._rotation20,i.e21=this._transform._rotation21,i.e22=this._transform._rotation22},setRotation:function(t){var i,a,o,n,s,r,e,_,h,l,c,p,v,m,b,f,x,u,y=t;this._transform._rotation00=y.e00,this._transform._rotation01=y.e01,this._transform._rotation02=y.e02,this._transform._rotation10=y.e10,this._transform._rotation11=y.e11,this._transform._rotation12=y.e12,this._transform._rotation20=y.e20,this._transform._rotation21=y.e21,this._transform._rotation22=y.e22,i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,a=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,o=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,n=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,s=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,r=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,e=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,_=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,h=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=a,this._invInertia02=o,this._invInertia10=n,this._invInertia11=s,this._invInertia12=r,this._invInertia20=e,this._invInertia21=_,this._invInertia22=h,l=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,c=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,p=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,v=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,m=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,b=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,f=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,x=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,u=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=l,this._invInertia01=c,this._invInertia02=p,this._invInertia10=v,this._invInertia11=m,this._invInertia12=b,this._invInertia20=f,this._invInertia21=x,this._invInertia22=u,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var g=this._ptransform,X=this._transform;g._positionX=X._positionX,g._positionY=X._positionY,g._positionZ=X._positionZ,g._rotation00=X._rotation00,g._rotation01=X._rotation01,g._rotation02=X._rotation02,g._rotation10=X._rotation10,g._rotation11=X._rotation11,g._rotation12=X._rotation12,g._rotation20=X._rotation20,g._rotation21=X._rotation21,g._rotation22=X._rotation22;for(var z=this._shapeList;null!=z;){var M,Y,Z,d,I,V,L,w,A,k,B,P,T=z._next,S=z._ptransform,C=z._localTransform,q=this._ptransform;M=q._rotation00*C._rotation00+q._rotation01*C._rotation10+q._rotation02*C._rotation20,Y=q._rotation00*C._rotation01+q._rotation01*C._rotation11+q._rotation02*C._rotation21,Z=q._rotation00*C._rotation02+q._rotation01*C._rotation12+q._rotation02*C._rotation22,d=q._rotation10*C._rotation00+q._rotation11*C._rotation10+q._rotation12*C._rotation20,I=q._rotation10*C._rotation01+q._rotation11*C._rotation11+q._rotation12*C._rotation21,V=q._rotation10*C._rotation02+q._rotation11*C._rotation12+q._rotation12*C._rotation22,L=q._rotation20*C._rotation00+q._rotation21*C._rotation10+q._rotation22*C._rotation20,w=q._rotation20*C._rotation01+q._rotation21*C._rotation11+q._rotation22*C._rotation21,A=q._rotation20*C._rotation02+q._rotation21*C._rotation12+q._rotation22*C._rotation22,S._rotation00=M,S._rotation01=Y,S._rotation02=Z,S._rotation10=d,S._rotation11=I,S._rotation12=V,S._rotation20=L,S._rotation21=w,S._rotation22=A,k=q._rotation00*C._positionX+q._rotation01*C._positionY+q._rotation02*C._positionZ,B=q._rotation10*C._positionX+q._rotation11*C._positionY+q._rotation12*C._positionZ,P=q._rotation20*C._positionX+q._rotation21*C._positionY+q._rotation22*C._positionZ,S._positionX=k,S._positionY=B,S._positionZ=P,S._positionX+=q._positionX,S._positionY+=q._positionY,S._positionZ+=q._positionZ;var R,E,j,N,D,F,O,W,G,H,U,J,Q,$,K,tt,it,at,ot=z._transform,nt=z._localTransform,st=this._transform;if(R=st._rotation00*nt._rotation00+st._rotation01*nt._rotation10+st._rotation02*nt._rotation20,E=st._rotation00*nt._rotation01+st._rotation01*nt._rotation11+st._rotation02*nt._rotation21,j=st._rotation00*nt._rotation02+st._rotation01*nt._rotation12+st._rotation02*nt._rotation22,N=st._rotation10*nt._rotation00+st._rotation11*nt._rotation10+st._rotation12*nt._rotation20,D=st._rotation10*nt._rotation01+st._rotation11*nt._rotation11+st._rotation12*nt._rotation21,F=st._rotation10*nt._rotation02+st._rotation11*nt._rotation12+st._rotation12*nt._rotation22,O=st._rotation20*nt._rotation00+st._rotation21*nt._rotation10+st._rotation22*nt._rotation20,W=st._rotation20*nt._rotation01+st._rotation21*nt._rotation11+st._rotation22*nt._rotation21,G=st._rotation20*nt._rotation02+st._rotation21*nt._rotation12+st._rotation22*nt._rotation22,ot._rotation00=R,ot._rotation01=E,ot._rotation02=j,ot._rotation10=N,ot._rotation11=D,ot._rotation12=F,ot._rotation20=O,ot._rotation21=W,ot._rotation22=G,H=st._rotation00*nt._positionX+st._rotation01*nt._positionY+st._rotation02*nt._positionZ,U=st._rotation10*nt._positionX+st._rotation11*nt._positionY+st._rotation12*nt._positionZ,J=st._rotation20*nt._positionX+st._rotation21*nt._positionY+st._rotation22*nt._positionZ,ot._positionX=H,ot._positionY=U,ot._positionZ=J,ot._positionX+=st._positionX,ot._positionY+=st._positionY,ot._positionZ+=st._positionZ,z._geom._computeAabb(z._aabb,z._ptransform),Q=z._aabb._minX,$=z._aabb._minY,K=z._aabb._minZ,tt=z._aabb._maxX,it=z._aabb._maxY,at=z._aabb._maxZ,z._geom._computeAabb(z._aabb,z._transform),z._aabb._minX=Q<z._aabb._minX?Q:z._aabb._minX,z._aabb._minY=$<z._aabb._minY?$:z._aabb._minY,z._aabb._minZ=K<z._aabb._minZ?K:z._aabb._minZ,z._aabb._maxX=tt>z._aabb._maxX?tt:z._aabb._maxX,z._aabb._maxY=it>z._aabb._maxY?it:z._aabb._maxY,z._aabb._maxZ=at>z._aabb._maxZ?at:z._aabb._maxZ,null!=z._proxy){var rt,et,_t;rt=z._transform._positionX-z._ptransform._positionX,et=z._transform._positionY-z._ptransform._positionY,_t=z._transform._positionZ-z._ptransform._positionZ;var ht=z.displacement;ht.x=rt,ht.y=et,ht.z=_t,z._rigidBody._world._broadPhase.moveProxy(z._proxy,z._aabb,z.displacement)}z=T}this._sleeping=!1,this._sleepTime=0},setRotationXyz:function(t){var i,a,o,n=t;i=n.x,a=n.y,o=n.z;var s,r,e,_,h,l,c,p,v,m,b,f,x,u,y,g,X,z,M=Math.sin(i),Y=Math.sin(a),Z=Math.sin(o),d=Math.cos(i),I=Math.cos(a),V=Math.cos(o);this._transform._rotation00=I*V,this._transform._rotation01=-I*Z,this._transform._rotation02=Y,this._transform._rotation10=d*Z+V*M*Y,this._transform._rotation11=d*V-M*Y*Z,this._transform._rotation12=-I*M,this._transform._rotation20=M*Z-d*V*Y,this._transform._rotation21=V*M+d*Y*Z,this._transform._rotation22=d*I,s=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,r=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,e=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,_=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,h=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,l=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,c=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,p=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,v=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=s,this._invInertia01=r,this._invInertia02=e,this._invInertia10=_,this._invInertia11=h,this._invInertia12=l,this._invInertia20=c,this._invInertia21=p,this._invInertia22=v,m=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,b=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,f=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,x=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,u=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,y=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,g=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,X=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,z=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=m,this._invInertia01=b,this._invInertia02=f,this._invInertia10=x,this._invInertia11=u,this._invInertia12=y,this._invInertia20=g,this._invInertia21=X,this._invInertia22=z,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var L=this._ptransform,w=this._transform;L._positionX=w._positionX,L._positionY=w._positionY,L._positionZ=w._positionZ,L._rotation00=w._rotation00,L._rotation01=w._rotation01,L._rotation02=w._rotation02,L._rotation10=w._rotation10,L._rotation11=w._rotation11,L._rotation12=w._rotation12,L._rotation20=w._rotation20,L._rotation21=w._rotation21,L._rotation22=w._rotation22;for(var A=this._shapeList;null!=A;){var k,B,P,T,S,C,q,R,E,j,N,D,F=A._next,O=A._ptransform,W=A._localTransform,G=this._ptransform;k=G._rotation00*W._rotation00+G._rotation01*W._rotation10+G._rotation02*W._rotation20,B=G._rotation00*W._rotation01+G._rotation01*W._rotation11+G._rotation02*W._rotation21,P=G._rotation00*W._rotation02+G._rotation01*W._rotation12+G._rotation02*W._rotation22,T=G._rotation10*W._rotation00+G._rotation11*W._rotation10+G._rotation12*W._rotation20,S=G._rotation10*W._rotation01+G._rotation11*W._rotation11+G._rotation12*W._rotation21,C=G._rotation10*W._rotation02+G._rotation11*W._rotation12+G._rotation12*W._rotation22,q=G._rotation20*W._rotation00+G._rotation21*W._rotation10+G._rotation22*W._rotation20,R=G._rotation20*W._rotation01+G._rotation21*W._rotation11+G._rotation22*W._rotation21,E=G._rotation20*W._rotation02+G._rotation21*W._rotation12+G._rotation22*W._rotation22,O._rotation00=k,O._rotation01=B,O._rotation02=P,O._rotation10=T,O._rotation11=S,O._rotation12=C,O._rotation20=q,O._rotation21=R,O._rotation22=E,j=G._rotation00*W._positionX+G._rotation01*W._positionY+G._rotation02*W._positionZ,N=G._rotation10*W._positionX+G._rotation11*W._positionY+G._rotation12*W._positionZ,D=G._rotation20*W._positionX+G._rotation21*W._positionY+G._rotation22*W._positionZ,O._positionX=j,O._positionY=N,O._positionZ=D,O._positionX+=G._positionX,O._positionY+=G._positionY,O._positionZ+=G._positionZ;var H,U,J,Q,$,K,tt,it,at,ot,nt,st,rt,et,_t,ht,lt,ct,pt=A._transform,vt=A._localTransform,mt=this._transform;if(H=mt._rotation00*vt._rotation00+mt._rotation01*vt._rotation10+mt._rotation02*vt._rotation20,U=mt._rotation00*vt._rotation01+mt._rotation01*vt._rotation11+mt._rotation02*vt._rotation21,J=mt._rotation00*vt._rotation02+mt._rotation01*vt._rotation12+mt._rotation02*vt._rotation22,Q=mt._rotation10*vt._rotation00+mt._rotation11*vt._rotation10+mt._rotation12*vt._rotation20,$=mt._rotation10*vt._rotation01+mt._rotation11*vt._rotation11+mt._rotation12*vt._rotation21,K=mt._rotation10*vt._rotation02+mt._rotation11*vt._rotation12+mt._rotation12*vt._rotation22,tt=mt._rotation20*vt._rotation00+mt._rotation21*vt._rotation10+mt._rotation22*vt._rotation20,it=mt._rotation20*vt._rotation01+mt._rotation21*vt._rotation11+mt._rotation22*vt._rotation21,at=mt._rotation20*vt._rotation02+mt._rotation21*vt._rotation12+mt._rotation22*vt._rotation22,pt._rotation00=H,pt._rotation01=U,pt._rotation02=J,pt._rotation10=Q,pt._rotation11=$,pt._rotation12=K,pt._rotation20=tt,pt._rotation21=it,pt._rotation22=at,ot=mt._rotation00*vt._positionX+mt._rotation01*vt._positionY+mt._rotation02*vt._positionZ,nt=mt._rotation10*vt._positionX+mt._rotation11*vt._positionY+mt._rotation12*vt._positionZ,st=mt._rotation20*vt._positionX+mt._rotation21*vt._positionY+mt._rotation22*vt._positionZ,pt._positionX=ot,pt._positionY=nt,pt._positionZ=st,pt._positionX+=mt._positionX,pt._positionY+=mt._positionY,pt._positionZ+=mt._positionZ,A._geom._computeAabb(A._aabb,A._ptransform),rt=A._aabb._minX,et=A._aabb._minY,_t=A._aabb._minZ,ht=A._aabb._maxX,lt=A._aabb._maxY,ct=A._aabb._maxZ,A._geom._computeAabb(A._aabb,A._transform),A._aabb._minX=rt<A._aabb._minX?rt:A._aabb._minX,A._aabb._minY=et<A._aabb._minY?et:A._aabb._minY,A._aabb._minZ=_t<A._aabb._minZ?_t:A._aabb._minZ,A._aabb._maxX=ht>A._aabb._maxX?ht:A._aabb._maxX,A._aabb._maxY=lt>A._aabb._maxY?lt:A._aabb._maxY,A._aabb._maxZ=ct>A._aabb._maxZ?ct:A._aabb._maxZ,null!=A._proxy){var bt,ft,xt;bt=A._transform._positionX-A._ptransform._positionX,ft=A._transform._positionY-A._ptransform._positionY,xt=A._transform._positionZ-A._ptransform._positionZ;var ut=A.displacement;ut.x=bt,ut.y=ft,ut.z=xt,A._rigidBody._world._broadPhase.moveProxy(A._proxy,A._aabb,A.displacement)}A=F}this._sleeping=!1,this._sleepTime=0},rotate:function(t){var i,a,o,n,s,r,e,_,h,l,c,p,v,m,b,f,x,u,y,g,X,z,M,Y,Z,d,I,V,L,w,A,k,B,P,T,S,C=t;i=C.e00,a=C.e01,o=C.e02,n=C.e10,s=C.e11,r=C.e12,e=C.e20,_=C.e21,h=C.e22,l=i*this._transform._rotation00+a*this._transform._rotation10+o*this._transform._rotation20,c=i*this._transform._rotation01+a*this._transform._rotation11+o*this._transform._rotation21,p=i*this._transform._rotation02+a*this._transform._rotation12+o*this._transform._rotation22,v=n*this._transform._rotation00+s*this._transform._rotation10+r*this._transform._rotation20,m=n*this._transform._rotation01+s*this._transform._rotation11+r*this._transform._rotation21,b=n*this._transform._rotation02+s*this._transform._rotation12+r*this._transform._rotation22,f=e*this._transform._rotation00+_*this._transform._rotation10+h*this._transform._rotation20,x=e*this._transform._rotation01+_*this._transform._rotation11+h*this._transform._rotation21,u=e*this._transform._rotation02+_*this._transform._rotation12+h*this._transform._rotation22,this._transform._rotation00=l,this._transform._rotation01=c,this._transform._rotation02=p,this._transform._rotation10=v,this._transform._rotation11=m,this._transform._rotation12=b,this._transform._rotation20=f,this._transform._rotation21=x,this._transform._rotation22=u,y=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,g=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,X=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,z=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,M=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,Y=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,Z=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,d=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,I=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=y,this._invInertia01=g,this._invInertia02=X,this._invInertia10=z,this._invInertia11=M,this._invInertia12=Y,this._invInertia20=Z,this._invInertia21=d,this._invInertia22=I,V=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,L=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,w=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,A=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,k=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,B=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,P=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,T=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,S=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=V,this._invInertia01=L,this._invInertia02=w,this._invInertia10=A,this._invInertia11=k,this._invInertia12=B,this._invInertia20=P,this._invInertia21=T,this._invInertia22=S,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var q=this._ptransform,R=this._transform;q._positionX=R._positionX,q._positionY=R._positionY,q._positionZ=R._positionZ,q._rotation00=R._rotation00,q._rotation01=R._rotation01,q._rotation02=R._rotation02,q._rotation10=R._rotation10,q._rotation11=R._rotation11,q._rotation12=R._rotation12,q._rotation20=R._rotation20,q._rotation21=R._rotation21,q._rotation22=R._rotation22;for(var E=this._shapeList;null!=E;){var j,N,D,F,O,W,G,H,U,J,Q,$,K=E._next,tt=E._ptransform,it=E._localTransform,at=this._ptransform;j=at._rotation00*it._rotation00+at._rotation01*it._rotation10+at._rotation02*it._rotation20,N=at._rotation00*it._rotation01+at._rotation01*it._rotation11+at._rotation02*it._rotation21,D=at._rotation00*it._rotation02+at._rotation01*it._rotation12+at._rotation02*it._rotation22,F=at._rotation10*it._rotation00+at._rotation11*it._rotation10+at._rotation12*it._rotation20,O=at._rotation10*it._rotation01+at._rotation11*it._rotation11+at._rotation12*it._rotation21,W=at._rotation10*it._rotation02+at._rotation11*it._rotation12+at._rotation12*it._rotation22,G=at._rotation20*it._rotation00+at._rotation21*it._rotation10+at._rotation22*it._rotation20,H=at._rotation20*it._rotation01+at._rotation21*it._rotation11+at._rotation22*it._rotation21,U=at._rotation20*it._rotation02+at._rotation21*it._rotation12+at._rotation22*it._rotation22,tt._rotation00=j,tt._rotation01=N,tt._rotation02=D,tt._rotation10=F,tt._rotation11=O,tt._rotation12=W,tt._rotation20=G,tt._rotation21=H,tt._rotation22=U,J=at._rotation00*it._positionX+at._rotation01*it._positionY+at._rotation02*it._positionZ,Q=at._rotation10*it._positionX+at._rotation11*it._positionY+at._rotation12*it._positionZ,$=at._rotation20*it._positionX+at._rotation21*it._positionY+at._rotation22*it._positionZ,tt._positionX=J,tt._positionY=Q,tt._positionZ=$,tt._positionX+=at._positionX,tt._positionY+=at._positionY,tt._positionZ+=at._positionZ;var ot,nt,st,rt,et,_t,ht,lt,ct,pt,vt,mt,bt,ft,xt,ut,yt,gt,Xt=E._transform,zt=E._localTransform,Mt=this._transform;if(ot=Mt._rotation00*zt._rotation00+Mt._rotation01*zt._rotation10+Mt._rotation02*zt._rotation20,nt=Mt._rotation00*zt._rotation01+Mt._rotation01*zt._rotation11+Mt._rotation02*zt._rotation21,st=Mt._rotation00*zt._rotation02+Mt._rotation01*zt._rotation12+Mt._rotation02*zt._rotation22,rt=Mt._rotation10*zt._rotation00+Mt._rotation11*zt._rotation10+Mt._rotation12*zt._rotation20,et=Mt._rotation10*zt._rotation01+Mt._rotation11*zt._rotation11+Mt._rotation12*zt._rotation21,_t=Mt._rotation10*zt._rotation02+Mt._rotation11*zt._rotation12+Mt._rotation12*zt._rotation22,ht=Mt._rotation20*zt._rotation00+Mt._rotation21*zt._rotation10+Mt._rotation22*zt._rotation20,lt=Mt._rotation20*zt._rotation01+Mt._rotation21*zt._rotation11+Mt._rotation22*zt._rotation21,ct=Mt._rotation20*zt._rotation02+Mt._rotation21*zt._rotation12+Mt._rotation22*zt._rotation22,Xt._rotation00=ot,Xt._rotation01=nt,Xt._rotation02=st,Xt._rotation10=rt,Xt._rotation11=et,Xt._rotation12=_t,Xt._rotation20=ht,Xt._rotation21=lt,Xt._rotation22=ct,pt=Mt._rotation00*zt._positionX+Mt._rotation01*zt._positionY+Mt._rotation02*zt._positionZ,vt=Mt._rotation10*zt._positionX+Mt._rotation11*zt._positionY+Mt._rotation12*zt._positionZ,mt=Mt._rotation20*zt._positionX+Mt._rotation21*zt._positionY+Mt._rotation22*zt._positionZ,Xt._positionX=pt,Xt._positionY=vt,Xt._positionZ=mt,Xt._positionX+=Mt._positionX,Xt._positionY+=Mt._positionY,Xt._positionZ+=Mt._positionZ,E._geom._computeAabb(E._aabb,E._ptransform),bt=E._aabb._minX,ft=E._aabb._minY,xt=E._aabb._minZ,ut=E._aabb._maxX,yt=E._aabb._maxY,gt=E._aabb._maxZ,E._geom._computeAabb(E._aabb,E._transform),E._aabb._minX=bt<E._aabb._minX?bt:E._aabb._minX,E._aabb._minY=ft<E._aabb._minY?ft:E._aabb._minY,E._aabb._minZ=xt<E._aabb._minZ?xt:E._aabb._minZ,E._aabb._maxX=ut>E._aabb._maxX?ut:E._aabb._maxX,E._aabb._maxY=yt>E._aabb._maxY?yt:E._aabb._maxY,E._aabb._maxZ=gt>E._aabb._maxZ?gt:E._aabb._maxZ,null!=E._proxy){var Yt,Zt,dt;Yt=E._transform._positionX-E._ptransform._positionX,Zt=E._transform._positionY-E._ptransform._positionY,dt=E._transform._positionZ-E._ptransform._positionZ;var It=E.displacement;It.x=Yt,It.y=Zt,It.z=dt,E._rigidBody._world._broadPhase.moveProxy(E._proxy,E._aabb,E.displacement)}E=K}this._sleeping=!1,this._sleepTime=0},rotateXyz:function(t){var i,a,o,n,s,r,e,_,h,l,c,p,v=t;i=v.x,a=v.y,o=v.z;var m,b,f,x,u,y,g,X,z,M,Y,Z,d,I,V,L,w,A,k,B,P,T,S,C,q,R,E,j=Math.sin(i),N=Math.sin(a),D=Math.sin(o),F=Math.cos(i),O=Math.cos(a),W=Math.cos(o);s=-O*D,r=N,e=F*D+W*j*N,_=F*W-j*N*D,h=-O*j,l=j*D-F*W*N,c=W*j+F*N*D,p=F*O,m=(n=O*W)*this._transform._rotation00+s*this._transform._rotation10+r*this._transform._rotation20,b=n*this._transform._rotation01+s*this._transform._rotation11+r*this._transform._rotation21,f=n*this._transform._rotation02+s*this._transform._rotation12+r*this._transform._rotation22,x=e*this._transform._rotation00+_*this._transform._rotation10+h*this._transform._rotation20,u=e*this._transform._rotation01+_*this._transform._rotation11+h*this._transform._rotation21,y=e*this._transform._rotation02+_*this._transform._rotation12+h*this._transform._rotation22,g=l*this._transform._rotation00+c*this._transform._rotation10+p*this._transform._rotation20,X=l*this._transform._rotation01+c*this._transform._rotation11+p*this._transform._rotation21,z=l*this._transform._rotation02+c*this._transform._rotation12+p*this._transform._rotation22,this._transform._rotation00=m,this._transform._rotation01=b,this._transform._rotation02=f,this._transform._rotation10=x,this._transform._rotation11=u,this._transform._rotation12=y,this._transform._rotation20=g,this._transform._rotation21=X,this._transform._rotation22=z,M=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,Y=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,Z=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,d=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,I=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,V=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,L=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,w=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,A=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=M,this._invInertia01=Y,this._invInertia02=Z,this._invInertia10=d,this._invInertia11=I,this._invInertia12=V,this._invInertia20=L,this._invInertia21=w,this._invInertia22=A,k=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,B=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,P=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,T=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,S=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,C=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,q=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,R=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,E=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=k,this._invInertia01=B,this._invInertia02=P,this._invInertia10=T,this._invInertia11=S,this._invInertia12=C,this._invInertia20=q,this._invInertia21=R,this._invInertia22=E,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var G=this._ptransform,H=this._transform;G._positionX=H._positionX,G._positionY=H._positionY,G._positionZ=H._positionZ,G._rotation00=H._rotation00,G._rotation01=H._rotation01,G._rotation02=H._rotation02,G._rotation10=H._rotation10,G._rotation11=H._rotation11,G._rotation12=H._rotation12,G._rotation20=H._rotation20,G._rotation21=H._rotation21,G._rotation22=H._rotation22;for(var U=this._shapeList;null!=U;){var J,Q,$,K,tt,it,at,ot,nt,st,rt,et,_t=U._next,ht=U._ptransform,lt=U._localTransform,ct=this._ptransform;J=ct._rotation00*lt._rotation00+ct._rotation01*lt._rotation10+ct._rotation02*lt._rotation20,Q=ct._rotation00*lt._rotation01+ct._rotation01*lt._rotation11+ct._rotation02*lt._rotation21,$=ct._rotation00*lt._rotation02+ct._rotation01*lt._rotation12+ct._rotation02*lt._rotation22,K=ct._rotation10*lt._rotation00+ct._rotation11*lt._rotation10+ct._rotation12*lt._rotation20,tt=ct._rotation10*lt._rotation01+ct._rotation11*lt._rotation11+ct._rotation12*lt._rotation21,it=ct._rotation10*lt._rotation02+ct._rotation11*lt._rotation12+ct._rotation12*lt._rotation22,at=ct._rotation20*lt._rotation00+ct._rotation21*lt._rotation10+ct._rotation22*lt._rotation20,ot=ct._rotation20*lt._rotation01+ct._rotation21*lt._rotation11+ct._rotation22*lt._rotation21,nt=ct._rotation20*lt._rotation02+ct._rotation21*lt._rotation12+ct._rotation22*lt._rotation22,ht._rotation00=J,ht._rotation01=Q,ht._rotation02=$,ht._rotation10=K,ht._rotation11=tt,ht._rotation12=it,ht._rotation20=at,ht._rotation21=ot,ht._rotation22=nt,st=ct._rotation00*lt._positionX+ct._rotation01*lt._positionY+ct._rotation02*lt._positionZ,rt=ct._rotation10*lt._positionX+ct._rotation11*lt._positionY+ct._rotation12*lt._positionZ,et=ct._rotation20*lt._positionX+ct._rotation21*lt._positionY+ct._rotation22*lt._positionZ,ht._positionX=st,ht._positionY=rt,ht._positionZ=et,ht._positionX+=ct._positionX,ht._positionY+=ct._positionY,ht._positionZ+=ct._positionZ;var pt,vt,mt,bt,ft,xt,ut,yt,gt,Xt,zt,Mt,Yt,Zt,dt,It,Vt,Lt,wt=U._transform,At=U._localTransform,kt=this._transform;if(pt=kt._rotation00*At._rotation00+kt._rotation01*At._rotation10+kt._rotation02*At._rotation20,vt=kt._rotation00*At._rotation01+kt._rotation01*At._rotation11+kt._rotation02*At._rotation21,mt=kt._rotation00*At._rotation02+kt._rotation01*At._rotation12+kt._rotation02*At._rotation22,bt=kt._rotation10*At._rotation00+kt._rotation11*At._rotation10+kt._rotation12*At._rotation20,ft=kt._rotation10*At._rotation01+kt._rotation11*At._rotation11+kt._rotation12*At._rotation21,xt=kt._rotation10*At._rotation02+kt._rotation11*At._rotation12+kt._rotation12*At._rotation22,ut=kt._rotation20*At._rotation00+kt._rotation21*At._rotation10+kt._rotation22*At._rotation20,yt=kt._rotation20*At._rotation01+kt._rotation21*At._rotation11+kt._rotation22*At._rotation21,gt=kt._rotation20*At._rotation02+kt._rotation21*At._rotation12+kt._rotation22*At._rotation22,wt._rotation00=pt,wt._rotation01=vt,wt._rotation02=mt,wt._rotation10=bt,wt._rotation11=ft,wt._rotation12=xt,wt._rotation20=ut,wt._rotation21=yt,wt._rotation22=gt,Xt=kt._rotation00*At._positionX+kt._rotation01*At._positionY+kt._rotation02*At._positionZ,zt=kt._rotation10*At._positionX+kt._rotation11*At._positionY+kt._rotation12*At._positionZ,Mt=kt._rotation20*At._positionX+kt._rotation21*At._positionY+kt._rotation22*At._positionZ,wt._positionX=Xt,wt._positionY=zt,wt._positionZ=Mt,wt._positionX+=kt._positionX,wt._positionY+=kt._positionY,wt._positionZ+=kt._positionZ,U._geom._computeAabb(U._aabb,U._ptransform),Yt=U._aabb._minX,Zt=U._aabb._minY,dt=U._aabb._minZ,It=U._aabb._maxX,Vt=U._aabb._maxY,Lt=U._aabb._maxZ,U._geom._computeAabb(U._aabb,U._transform),U._aabb._minX=Yt<U._aabb._minX?Yt:U._aabb._minX,U._aabb._minY=Zt<U._aabb._minY?Zt:U._aabb._minY,U._aabb._minZ=dt<U._aabb._minZ?dt:U._aabb._minZ,U._aabb._maxX=It>U._aabb._maxX?It:U._aabb._maxX,U._aabb._maxY=Vt>U._aabb._maxY?Vt:U._aabb._maxY,U._aabb._maxZ=Lt>U._aabb._maxZ?Lt:U._aabb._maxZ,null!=U._proxy){var Bt,Pt,Tt;Bt=U._transform._positionX-U._ptransform._positionX,Pt=U._transform._positionY-U._ptransform._positionY,Tt=U._transform._positionZ-U._ptransform._positionZ;var St=U.displacement;St.x=Bt,St.y=Pt,St.z=Tt,U._rigidBody._world._broadPhase.moveProxy(U._proxy,U._aabb,U.displacement)}U=_t}this._sleeping=!1,this._sleepTime=0},getOrientation:function(){var t,i,a,o,n,s=new tt,r=this._transform._rotation00,e=this._transform._rotation11,_=this._transform._rotation22,h=r+e+_;h>0?(o=.5*(n=Math.sqrt(h+1)),n=.5/n,t=(this._transform._rotation21-this._transform._rotation12)*n,i=(this._transform._rotation02-this._transform._rotation20)*n,a=(this._transform._rotation10-this._transform._rotation01)*n):r>e?r>_?(t=.5*(n=Math.sqrt(r-e-_+1)),n=.5/n,i=(this._transform._rotation01+this._transform._rotation10)*n,a=(this._transform._rotation02+this._transform._rotation20)*n,o=(this._transform._rotation21-this._transform._rotation12)*n):(a=.5*(n=Math.sqrt(_-r-e+1)),n=.5/n,t=(this._transform._rotation02+this._transform._rotation20)*n,i=(this._transform._rotation12+this._transform._rotation21)*n,o=(this._transform._rotation10-this._transform._rotation01)*n):e>_?(i=.5*(n=Math.sqrt(e-_-r+1)),n=.5/n,t=(this._transform._rotation01+this._transform._rotation10)*n,a=(this._transform._rotation12+this._transform._rotation21)*n,o=(this._transform._rotation02-this._transform._rotation20)*n):(a=.5*(n=Math.sqrt(_-r-e+1)),n=.5/n,t=(this._transform._rotation02+this._transform._rotation20)*n,i=(this._transform._rotation12+this._transform._rotation21)*n,o=(this._transform._rotation10-this._transform._rotation01)*n);var l=s;return l.x=t,l.y=i,l.z=a,l.w=o,s},getOrientationTo:function(t){var i,a,o,n,s,r=this._transform._rotation00,e=this._transform._rotation11,_=this._transform._rotation22,h=r+e+_;h>0?(n=.5*(s=Math.sqrt(h+1)),s=.5/s,i=(this._transform._rotation21-this._transform._rotation12)*s,a=(this._transform._rotation02-this._transform._rotation20)*s,o=(this._transform._rotation10-this._transform._rotation01)*s):r>e?r>_?(i=.5*(s=Math.sqrt(r-e-_+1)),s=.5/s,a=(this._transform._rotation01+this._transform._rotation10)*s,o=(this._transform._rotation02+this._transform._rotation20)*s,n=(this._transform._rotation21-this._transform._rotation12)*s):(o=.5*(s=Math.sqrt(_-r-e+1)),s=.5/s,i=(this._transform._rotation02+this._transform._rotation20)*s,a=(this._transform._rotation12+this._transform._rotation21)*s,n=(this._transform._rotation10-this._transform._rotation01)*s):e>_?(a=.5*(s=Math.sqrt(e-_-r+1)),s=.5/s,i=(this._transform._rotation01+this._transform._rotation10)*s,o=(this._transform._rotation12+this._transform._rotation21)*s,n=(this._transform._rotation02-this._transform._rotation20)*s):(o=.5*(s=Math.sqrt(_-r-e+1)),s=.5/s,i=(this._transform._rotation02+this._transform._rotation20)*s,a=(this._transform._rotation12+this._transform._rotation21)*s,n=(this._transform._rotation10-this._transform._rotation01)*s);var l=t;l.x=i,l.y=a,l.z=o,l.w=n},setOrientation:function(t){var i,a,o,n,s,r,e,_,h,l,c,p,v,m,b,f,x,u,y,g,X,z,M=t,Y=(i=M.x,a=M.y,o=M.z,n=M.w,2*i),Z=2*a,d=2*o,I=i*Y,V=a*Z,L=o*d,w=i*Z,A=a*d,k=i*d,B=n*Y,P=n*Z,T=n*d;this._transform._rotation00=1-V-L,this._transform._rotation01=w-T,this._transform._rotation02=k+P,this._transform._rotation10=w+T,this._transform._rotation11=1-I-L,this._transform._rotation12=A-B,this._transform._rotation20=k-P,this._transform._rotation21=A+B,this._transform._rotation22=1-I-V,s=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,r=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,e=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,_=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,h=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,l=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,c=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,p=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,v=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=s,this._invInertia01=r,this._invInertia02=e,this._invInertia10=_,this._invInertia11=h,this._invInertia12=l,this._invInertia20=c,this._invInertia21=p,this._invInertia22=v,m=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,b=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,f=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,x=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,u=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,y=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,g=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,X=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,z=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=m,this._invInertia01=b,this._invInertia02=f,this._invInertia10=x,this._invInertia11=u,this._invInertia12=y,this._invInertia20=g,this._invInertia21=X,this._invInertia22=z,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var S=this._ptransform,C=this._transform;S._positionX=C._positionX,S._positionY=C._positionY,S._positionZ=C._positionZ,S._rotation00=C._rotation00,S._rotation01=C._rotation01,S._rotation02=C._rotation02,S._rotation10=C._rotation10,S._rotation11=C._rotation11,S._rotation12=C._rotation12,S._rotation20=C._rotation20,S._rotation21=C._rotation21,S._rotation22=C._rotation22;for(var q=this._shapeList;null!=q;){var R,E,j,N,D,F,O,W,G,H,U,J,Q=q._next,$=q._ptransform,K=q._localTransform,tt=this._ptransform;R=tt._rotation00*K._rotation00+tt._rotation01*K._rotation10+tt._rotation02*K._rotation20,E=tt._rotation00*K._rotation01+tt._rotation01*K._rotation11+tt._rotation02*K._rotation21,j=tt._rotation00*K._rotation02+tt._rotation01*K._rotation12+tt._rotation02*K._rotation22,N=tt._rotation10*K._rotation00+tt._rotation11*K._rotation10+tt._rotation12*K._rotation20,D=tt._rotation10*K._rotation01+tt._rotation11*K._rotation11+tt._rotation12*K._rotation21,F=tt._rotation10*K._rotation02+tt._rotation11*K._rotation12+tt._rotation12*K._rotation22,O=tt._rotation20*K._rotation00+tt._rotation21*K._rotation10+tt._rotation22*K._rotation20,W=tt._rotation20*K._rotation01+tt._rotation21*K._rotation11+tt._rotation22*K._rotation21,G=tt._rotation20*K._rotation02+tt._rotation21*K._rotation12+tt._rotation22*K._rotation22,$._rotation00=R,$._rotation01=E,$._rotation02=j,$._rotation10=N,$._rotation11=D,$._rotation12=F,$._rotation20=O,$._rotation21=W,$._rotation22=G,H=tt._rotation00*K._positionX+tt._rotation01*K._positionY+tt._rotation02*K._positionZ,U=tt._rotation10*K._positionX+tt._rotation11*K._positionY+tt._rotation12*K._positionZ,J=tt._rotation20*K._positionX+tt._rotation21*K._positionY+tt._rotation22*K._positionZ,$._positionX=H,$._positionY=U,$._positionZ=J,$._positionX+=tt._positionX,$._positionY+=tt._positionY,$._positionZ+=tt._positionZ;var it,at,ot,nt,st,rt,et,_t,ht,lt,ct,pt,vt,mt,bt,ft,xt,ut,yt=q._transform,gt=q._localTransform,Xt=this._transform;if(it=Xt._rotation00*gt._rotation00+Xt._rotation01*gt._rotation10+Xt._rotation02*gt._rotation20,at=Xt._rotation00*gt._rotation01+Xt._rotation01*gt._rotation11+Xt._rotation02*gt._rotation21,ot=Xt._rotation00*gt._rotation02+Xt._rotation01*gt._rotation12+Xt._rotation02*gt._rotation22,nt=Xt._rotation10*gt._rotation00+Xt._rotation11*gt._rotation10+Xt._rotation12*gt._rotation20,st=Xt._rotation10*gt._rotation01+Xt._rotation11*gt._rotation11+Xt._rotation12*gt._rotation21,rt=Xt._rotation10*gt._rotation02+Xt._rotation11*gt._rotation12+Xt._rotation12*gt._rotation22,et=Xt._rotation20*gt._rotation00+Xt._rotation21*gt._rotation10+Xt._rotation22*gt._rotation20,_t=Xt._rotation20*gt._rotation01+Xt._rotation21*gt._rotation11+Xt._rotation22*gt._rotation21,ht=Xt._rotation20*gt._rotation02+Xt._rotation21*gt._rotation12+Xt._rotation22*gt._rotation22,yt._rotation00=it,yt._rotation01=at,yt._rotation02=ot,yt._rotation10=nt,yt._rotation11=st,yt._rotation12=rt,yt._rotation20=et,yt._rotation21=_t,yt._rotation22=ht,lt=Xt._rotation00*gt._positionX+Xt._rotation01*gt._positionY+Xt._rotation02*gt._positionZ,ct=Xt._rotation10*gt._positionX+Xt._rotation11*gt._positionY+Xt._rotation12*gt._positionZ,pt=Xt._rotation20*gt._positionX+Xt._rotation21*gt._positionY+Xt._rotation22*gt._positionZ,yt._positionX=lt,yt._positionY=ct,yt._positionZ=pt,yt._positionX+=Xt._positionX,yt._positionY+=Xt._positionY,yt._positionZ+=Xt._positionZ,q._geom._computeAabb(q._aabb,q._ptransform),vt=q._aabb._minX,mt=q._aabb._minY,bt=q._aabb._minZ,ft=q._aabb._maxX,xt=q._aabb._maxY,ut=q._aabb._maxZ,q._geom._computeAabb(q._aabb,q._transform),q._aabb._minX=vt<q._aabb._minX?vt:q._aabb._minX,q._aabb._minY=mt<q._aabb._minY?mt:q._aabb._minY,q._aabb._minZ=bt<q._aabb._minZ?bt:q._aabb._minZ,q._aabb._maxX=ft>q._aabb._maxX?ft:q._aabb._maxX,q._aabb._maxY=xt>q._aabb._maxY?xt:q._aabb._maxY,q._aabb._maxZ=ut>q._aabb._maxZ?ut:q._aabb._maxZ,null!=q._proxy){var zt,Mt,Yt;zt=q._transform._positionX-q._ptransform._positionX,Mt=q._transform._positionY-q._ptransform._positionY,Yt=q._transform._positionZ-q._ptransform._positionZ;var Zt=q.displacement;Zt.x=zt,Zt.y=Mt,Zt.z=Yt,q._rigidBody._world._broadPhase.moveProxy(q._proxy,q._aabb,q.displacement)}q=Q}this._sleeping=!1,this._sleepTime=0},getTransform:function(){var t=this._transform,i=new O;return i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,i},getTransformTo:function(t){var i=this._transform;t._positionX=i._positionX,t._positionY=i._positionY,t._positionZ=i._positionZ,t._rotation00=i._rotation00,t._rotation01=i._rotation01,t._rotation02=i._rotation02,t._rotation10=i._rotation10,t._rotation11=i._rotation11,t._rotation12=i._rotation12,t._rotation20=i._rotation20,t._rotation21=i._rotation21,t._rotation22=i._rotation22},setTransform:function(t){var i,a,o,n,s,r,e,_,h,l,c,p,v,m,b,f,x,u;this._transform._positionX=t._positionX,this._transform._positionY=t._positionY,this._transform._positionZ=t._positionZ,this._transform._rotation00=t._rotation00,this._transform._rotation01=t._rotation01,this._transform._rotation02=t._rotation02,this._transform._rotation10=t._rotation10,this._transform._rotation11=t._rotation11,this._transform._rotation12=t._rotation12,this._transform._rotation20=t._rotation20,this._transform._rotation21=t._rotation21,this._transform._rotation22=t._rotation22,i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,a=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,o=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,n=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,s=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,r=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,e=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,_=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,h=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=a,this._invInertia02=o,this._invInertia10=n,this._invInertia11=s,this._invInertia12=r,this._invInertia20=e,this._invInertia21=_,this._invInertia22=h,l=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,c=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,p=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,v=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,m=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,b=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,f=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,x=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,u=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=l,this._invInertia01=c,this._invInertia02=p,this._invInertia10=v,this._invInertia11=m,this._invInertia12=b,this._invInertia20=f,this._invInertia21=x,this._invInertia22=u,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var y=this._ptransform,g=this._transform;y._positionX=g._positionX,y._positionY=g._positionY,y._positionZ=g._positionZ,y._rotation00=g._rotation00,y._rotation01=g._rotation01,y._rotation02=g._rotation02,y._rotation10=g._rotation10,y._rotation11=g._rotation11,y._rotation12=g._rotation12,y._rotation20=g._rotation20,y._rotation21=g._rotation21,y._rotation22=g._rotation22;for(var X=this._shapeList;null!=X;){var z,M,Y,Z,d,I,V,L,w,A,k,B,P=X._next,T=X._ptransform,S=X._localTransform,C=this._ptransform;z=C._rotation00*S._rotation00+C._rotation01*S._rotation10+C._rotation02*S._rotation20,M=C._rotation00*S._rotation01+C._rotation01*S._rotation11+C._rotation02*S._rotation21,Y=C._rotation00*S._rotation02+C._rotation01*S._rotation12+C._rotation02*S._rotation22,Z=C._rotation10*S._rotation00+C._rotation11*S._rotation10+C._rotation12*S._rotation20,d=C._rotation10*S._rotation01+C._rotation11*S._rotation11+C._rotation12*S._rotation21,I=C._rotation10*S._rotation02+C._rotation11*S._rotation12+C._rotation12*S._rotation22,V=C._rotation20*S._rotation00+C._rotation21*S._rotation10+C._rotation22*S._rotation20,L=C._rotation20*S._rotation01+C._rotation21*S._rotation11+C._rotation22*S._rotation21,w=C._rotation20*S._rotation02+C._rotation21*S._rotation12+C._rotation22*S._rotation22,T._rotation00=z,T._rotation01=M,T._rotation02=Y,T._rotation10=Z,T._rotation11=d,T._rotation12=I,T._rotation20=V,T._rotation21=L,T._rotation22=w,A=C._rotation00*S._positionX+C._rotation01*S._positionY+C._rotation02*S._positionZ,k=C._rotation10*S._positionX+C._rotation11*S._positionY+C._rotation12*S._positionZ,B=C._rotation20*S._positionX+C._rotation21*S._positionY+C._rotation22*S._positionZ,T._positionX=A,T._positionY=k,T._positionZ=B,T._positionX+=C._positionX,T._positionY+=C._positionY,T._positionZ+=C._positionZ;var q,R,E,j,N,D,F,O,W,G,H,U,J,Q,$,K,tt,it,at=X._transform,ot=X._localTransform,nt=this._transform;if(q=nt._rotation00*ot._rotation00+nt._rotation01*ot._rotation10+nt._rotation02*ot._rotation20,R=nt._rotation00*ot._rotation01+nt._rotation01*ot._rotation11+nt._rotation02*ot._rotation21,E=nt._rotation00*ot._rotation02+nt._rotation01*ot._rotation12+nt._rotation02*ot._rotation22,j=nt._rotation10*ot._rotation00+nt._rotation11*ot._rotation10+nt._rotation12*ot._rotation20,N=nt._rotation10*ot._rotation01+nt._rotation11*ot._rotation11+nt._rotation12*ot._rotation21,D=nt._rotation10*ot._rotation02+nt._rotation11*ot._rotation12+nt._rotation12*ot._rotation22,F=nt._rotation20*ot._rotation00+nt._rotation21*ot._rotation10+nt._rotation22*ot._rotation20,O=nt._rotation20*ot._rotation01+nt._rotation21*ot._rotation11+nt._rotation22*ot._rotation21,W=nt._rotation20*ot._rotation02+nt._rotation21*ot._rotation12+nt._rotation22*ot._rotation22,at._rotation00=q,at._rotation01=R,at._rotation02=E,at._rotation10=j,at._rotation11=N,at._rotation12=D,at._rotation20=F,at._rotation21=O,at._rotation22=W,G=nt._rotation00*ot._positionX+nt._rotation01*ot._positionY+nt._rotation02*ot._positionZ,H=nt._rotation10*ot._positionX+nt._rotation11*ot._positionY+nt._rotation12*ot._positionZ,U=nt._rotation20*ot._positionX+nt._rotation21*ot._positionY+nt._rotation22*ot._positionZ,at._positionX=G,at._positionY=H,at._positionZ=U,at._positionX+=nt._positionX,at._positionY+=nt._positionY,at._positionZ+=nt._positionZ,X._geom._computeAabb(X._aabb,X._ptransform),J=X._aabb._minX,Q=X._aabb._minY,$=X._aabb._minZ,K=X._aabb._maxX,tt=X._aabb._maxY,it=X._aabb._maxZ,X._geom._computeAabb(X._aabb,X._transform),X._aabb._minX=J<X._aabb._minX?J:X._aabb._minX,X._aabb._minY=Q<X._aabb._minY?Q:X._aabb._minY,X._aabb._minZ=$<X._aabb._minZ?$:X._aabb._minZ,X._aabb._maxX=K>X._aabb._maxX?K:X._aabb._maxX,X._aabb._maxY=tt>X._aabb._maxY?tt:X._aabb._maxY,X._aabb._maxZ=it>X._aabb._maxZ?it:X._aabb._maxZ,null!=X._proxy){var st,rt,et;st=X._transform._positionX-X._ptransform._positionX,rt=X._transform._positionY-X._ptransform._positionY,et=X._transform._positionZ-X._ptransform._positionZ;var _t=X.displacement;_t.x=st,_t.y=rt,_t.z=et,X._rigidBody._world._broadPhase.moveProxy(X._proxy,X._aabb,X.displacement)}X=P}this._sleeping=!1,this._sleepTime=0},getMass:function(){return this._mass},getLocalInertia:function(){var t=new J,i=t;return i.e00=this._localInertia00,i.e01=this._localInertia01,i.e02=this._localInertia02,i.e10=this._localInertia10,i.e11=this._localInertia11,i.e12=this._localInertia12,i.e20=this._localInertia20,i.e21=this._localInertia21,i.e22=this._localInertia22,t},getLocalInertiaTo:function(t){var i=t;i.e00=this._localInertia00,i.e01=this._localInertia01,i.e02=this._localInertia02,i.e10=this._localInertia10,i.e11=this._localInertia11,i.e12=this._localInertia12,i.e20=this._localInertia20,i.e21=this._localInertia21,i.e22=this._localInertia22},getMassData:function(){var t=new ei;t.mass=this._mass;var i=t.localInertia;return i.e00=this._localInertia00,i.e01=this._localInertia01,i.e02=this._localInertia02,i.e10=this._localInertia10,i.e11=this._localInertia11,i.e12=this._localInertia12,i.e20=this._localInertia20,i.e21=this._localInertia21,i.e22=this._localInertia22,t},getMassDataTo:function(t){t.mass=this._mass;var i=t.localInertia;i.e00=this._localInertia00,i.e01=this._localInertia01,i.e02=this._localInertia02,i.e10=this._localInertia10,i.e11=this._localInertia11,i.e12=this._localInertia12,i.e20=this._localInertia20,i.e21=this._localInertia21,i.e22=this._localInertia22},setMassData:function(t){this._mass=t.mass;var i=t.localInertia;this._localInertia00=i.e00,this._localInertia01=i.e01,this._localInertia02=i.e02,this._localInertia10=i.e10,this._localInertia11=i.e11,this._localInertia12=i.e12,this._localInertia20=i.e20,this._localInertia21=i.e21,this._localInertia22=i.e22;var a,o,n,s,r,e,_,h,l,c,p,v,m,b,f,x,u,y,g=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,X=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,z=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,M=this._localInertia00*g-this._localInertia01*X+this._localInertia02*z;if(this._mass>0&&M>0&&0==this._type){this._invMass=1/this._mass;var Y=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,Z=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,d=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,I=this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21,V=this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20,L=this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20,w=this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11,A=this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10,k=this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10,B=this._localInertia00*Y-this._localInertia01*Z+this._localInertia02*d;(B<-1e-32||B>1e-32)&&(B=1/B),this._invLocalInertia00=Y*B,this._invLocalInertia01=-I*B,this._invLocalInertia02=w*B,this._invLocalInertia10=-Z*B,this._invLocalInertia11=V*B,this._invLocalInertia12=-A*B,this._invLocalInertia20=d*B,this._invLocalInertia21=-L*B,this._invLocalInertia22=k*B,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,0==this._type&&(this._type=1);a=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,o=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,n=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,s=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,r=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,e=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,_=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,h=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,l=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=a,this._invInertia01=o,this._invInertia02=n,this._invInertia10=s,this._invInertia11=r,this._invInertia12=e,this._invInertia20=_,this._invInertia21=h,this._invInertia22=l,c=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,p=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,v=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,m=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,b=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,f=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,x=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,u=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,y=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=c,this._invInertia01=p,this._invInertia02=v,this._invInertia10=m,this._invInertia11=b,this._invInertia12=f,this._invInertia20=x,this._invInertia21=u,this._invInertia22=y,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0},getRotationFactor:function(){var t=this._rotFactor;return new F(t.x,t.y,t.z)},setRotationFactor:function(t){var i,a,o,n,s,r,e,_,h,l,c,p,v,m,b,f,x,u,y=this._rotFactor;y.x=t.x,y.y=t.y,y.z=t.z,i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,a=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,o=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,n=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,s=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,r=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,e=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,_=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,h=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=a,this._invInertia02=o,this._invInertia10=n,this._invInertia11=s,this._invInertia12=r,this._invInertia20=e,this._invInertia21=_,this._invInertia22=h,l=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,c=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,p=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,v=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,m=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,b=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,f=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,x=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,u=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=l,this._invInertia01=c,this._invInertia02=p,this._invInertia10=v,this._invInertia11=m,this._invInertia12=b,this._invInertia20=f,this._invInertia21=x,this._invInertia22=u,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0},getLinearVelocity:function(){var t=new F,i=t;return i.x=this._velX,i.y=this._velY,i.z=this._velZ,t},getLinearVelocityTo:function(t){var i=t;i.x=this._velX,i.y=this._velY,i.z=this._velZ},setLinearVelocity:function(t){if(1==this._type)this._velX=0,this._velY=0,this._velZ=0;else{var i=t;this._velX=i.x,this._velY=i.y,this._velZ=i.z}this._sleeping=!1,this._sleepTime=0},getAngularVelocity:function(){var t=new F,i=t;return i.x=this._angVelX,i.y=this._angVelY,i.z=this._angVelZ,t},getAngularVelocityTo:function(t){var i=t;i.x=this._velX,i.y=this._velY,i.z=this._velZ},setAngularVelocity:function(t){if(1==this._type)this._angVelX=0,this._angVelY=0,this._angVelZ=0;else{var i=t;this._angVelX=i.x,this._angVelY=i.y,this._angVelZ=i.z}this._sleeping=!1,this._sleepTime=0},addLinearVelocity:function(t){if(1!=this._type){var i,a,o,n=t;i=n.x,a=n.y,o=n.z,this._velX+=i,this._velY+=a,this._velZ+=o}this._sleeping=!1,this._sleepTime=0},addAngularVelocity:function(t){if(1!=this._type){var i,a,o,n=t;i=n.x,a=n.y,o=n.z,this._angVelX+=i,this._angVelY+=a,this._angVelZ+=o}this._sleeping=!1,this._sleepTime=0},applyImpulse:function(t,i){var a,o,n,s,r,e,_,h,l,c=t;a=c.x,o=c.y,n=c.z,this._velX+=a*this._invMass,this._velY+=o*this._invMass,this._velZ+=n*this._invMass;var p,v,m,b=i;_=b.x,h=b.y,l=b.z,_-=this._transform._positionX,s=(h-=this._transform._positionY)*n-(l-=this._transform._positionZ)*o,r=l*a-_*n,e=_*o-h*a,p=this._invInertia00*s+this._invInertia01*r+this._invInertia02*e,v=this._invInertia10*s+this._invInertia11*r+this._invInertia12*e,m=this._invInertia20*s+this._invInertia21*r+this._invInertia22*e,s=p,r=v,e=m,this._angVelX+=s,this._angVelY+=r,this._angVelZ+=e,this._sleeping=!1,this._sleepTime=0},applyLinearImpulse:function(t){var i,a,o,n=t;i=n.x,a=n.y,o=n.z,this._velX+=i*this._invMass,this._velY+=a*this._invMass,this._velZ+=o*this._invMass,this._sleeping=!1,this._sleepTime=0},applyAngularImpulse:function(t){var i,a,o,n,s,r,e=t;i=e.x,a=e.y,o=e.z,n=this._invInertia00*i+this._invInertia01*a+this._invInertia02*o,s=this._invInertia10*i+this._invInertia11*a+this._invInertia12*o,r=this._invInertia20*i+this._invInertia21*a+this._invInertia22*o,i=n,a=s,o=r,this._angVelX+=i,this._angVelY+=a,this._angVelZ+=o,this._sleeping=!1,this._sleepTime=0},applyForce:function(t,i){var a,o,n,s,r,e,_,h,l,c=t;a=c.x,o=c.y,n=c.z,this._forceX+=a,this._forceY+=o,this._forceZ+=n;var p=i;_=p.x,h=p.y,l=p.z,_-=this._transform._positionX,s=(h-=this._transform._positionY)*n-(l-=this._transform._positionZ)*o,r=l*a-_*n,e=_*o-h*a,this._torqueX+=s,this._torqueY+=r,this._torqueZ+=e,this._sleeping=!1,this._sleepTime=0},applyForceToCenter:function(t){var i,a,o,n=t;i=n.x,a=n.y,o=n.z,this._forceX+=i,this._forceY+=a,this._forceZ+=o,this._sleeping=!1,this._sleepTime=0},applyTorque:function(t){var i,a,o,n=t;i=n.x,a=n.y,o=n.z,this._torqueX+=i,this._torqueY+=a,this._torqueZ+=o,this._sleeping=!1,this._sleepTime=0},getGravityScale:function(){return this._gravityScale},setGravityScale:function(t){this._gravityScale=t,this._sleeping=!1,this._sleepTime=0},getLocalPoint:function(t){var i,a,o,n,s,r,e=t;i=e.x,a=e.y,o=e.z,i-=this._transform._positionX,a-=this._transform._positionY,o-=this._transform._positionZ,n=this._transform._rotation00*i+this._transform._rotation10*a+this._transform._rotation20*o,s=this._transform._rotation01*i+this._transform._rotation11*a+this._transform._rotation21*o,r=this._transform._rotation02*i+this._transform._rotation12*a+this._transform._rotation22*o,i=n,a=s,o=r;var _=new F,h=_;return h.x=i,h.y=a,h.z=o,_},getLocalPointTo:function(t,i){var a,o,n,s,r,e,_=t;a=_.x,o=_.y,n=_.z,a-=this._transform._positionX,o-=this._transform._positionY,n-=this._transform._positionZ,s=this._transform._rotation00*a+this._transform._rotation10*o+this._transform._rotation20*n,r=this._transform._rotation01*a+this._transform._rotation11*o+this._transform._rotation21*n,e=this._transform._rotation02*a+this._transform._rotation12*o+this._transform._rotation22*n,a=s,o=r,n=e;var h=i;h.x=a,h.y=o,h.z=n},getLocalVector:function(t){var i,a,o,n,s,r,e=t;i=e.x,a=e.y,o=e.z,n=this._transform._rotation00*i+this._transform._rotation10*a+this._transform._rotation20*o,s=this._transform._rotation01*i+this._transform._rotation11*a+this._transform._rotation21*o,r=this._transform._rotation02*i+this._transform._rotation12*a+this._transform._rotation22*o,i=n,a=s,o=r;var _=new F,h=_;return h.x=i,h.y=a,h.z=o,_},getLocalVectorTo:function(t,i){var a,o,n,s,r,e,_=t;a=_.x,o=_.y,n=_.z,s=this._transform._rotation00*a+this._transform._rotation10*o+this._transform._rotation20*n,r=this._transform._rotation01*a+this._transform._rotation11*o+this._transform._rotation21*n,e=this._transform._rotation02*a+this._transform._rotation12*o+this._transform._rotation22*n,a=s,o=r,n=e;var h=i;h.x=a,h.y=o,h.z=n},getWorldPoint:function(t){var i,a,o,n,s,r,e=t;i=e.x,a=e.y,o=e.z,n=this._transform._rotation00*i+this._transform._rotation01*a+this._transform._rotation02*o,s=this._transform._rotation10*i+this._transform._rotation11*a+this._transform._rotation12*o,r=this._transform._rotation20*i+this._transform._rotation21*a+this._transform._rotation22*o,i=n,a=s,o=r,i+=this._transform._positionX,a+=this._transform._positionY,o+=this._transform._positionZ;var _=new F,h=_;return h.x=i,h.y=a,h.z=o,_},getWorldPointTo:function(t,i){var a,o,n,s,r,e,_=t;a=_.x,o=_.y,n=_.z,s=this._transform._rotation00*a+this._transform._rotation01*o+this._transform._rotation02*n,r=this._transform._rotation10*a+this._transform._rotation11*o+this._transform._rotation12*n,e=this._transform._rotation20*a+this._transform._rotation21*o+this._transform._rotation22*n,a=s,o=r,n=e,a+=this._transform._positionX,o+=this._transform._positionY,n+=this._transform._positionZ;var h=i;h.x=a,h.y=o,h.z=n},getWorldVector:function(t){var i,a,o,n,s,r,e=t;i=e.x,a=e.y,o=e.z,n=this._transform._rotation00*i+this._transform._rotation01*a+this._transform._rotation02*o,s=this._transform._rotation10*i+this._transform._rotation11*a+this._transform._rotation12*o,r=this._transform._rotation20*i+this._transform._rotation21*a+this._transform._rotation22*o,i=n,a=s,o=r;var _=new F,h=_;return h.x=i,h.y=a,h.z=o,_},getWorldVectorTo:function(t,i){var a,o,n,s,r,e,_=t;a=_.x,o=_.y,n=_.z,s=this._transform._rotation00*a+this._transform._rotation01*o+this._transform._rotation02*n,r=this._transform._rotation10*a+this._transform._rotation11*o+this._transform._rotation12*n,e=this._transform._rotation20*a+this._transform._rotation21*o+this._transform._rotation22*n,a=s,o=r,n=e;var h=i;h.x=a,h.y=o,h.z=n},getNumShapes:function(){return this._numShapes},getShapeList:function(){return this._shapeList},getNumContectLinks:function(){return this._numContactLinks},getContactLinkList:function(){return this._contactLinkList},getNumJointLinks:function(){return this._numJointLinks},getJointLinkList:function(){return this._jointLinkList},addShape:function(t){if(null==this._shapeList?(this._shapeList=t,this._shapeListLast=t):(this._shapeListLast._next=t,t._prev=this._shapeListLast,this._shapeListLast=t),this._numShapes++,t._rigidBody=this,null!=this._world){var i=this._world;t._proxy=i._broadPhase.createProxy(t,t._aabb),t._id=i._shapeIdCount++,i._numShapes++}this.updateMass();for(var a=this._shapeList;null!=a;){var o,n,s,r,e,_,h,l,c,p,v,m,b=a._next,f=a._ptransform,x=a._localTransform,u=this._ptransform;o=u._rotation00*x._rotation00+u._rotation01*x._rotation10+u._rotation02*x._rotation20,n=u._rotation00*x._rotation01+u._rotation01*x._rotation11+u._rotation02*x._rotation21,s=u._rotation00*x._rotation02+u._rotation01*x._rotation12+u._rotation02*x._rotation22,r=u._rotation10*x._rotation00+u._rotation11*x._rotation10+u._rotation12*x._rotation20,e=u._rotation10*x._rotation01+u._rotation11*x._rotation11+u._rotation12*x._rotation21,_=u._rotation10*x._rotation02+u._rotation11*x._rotation12+u._rotation12*x._rotation22,h=u._rotation20*x._rotation00+u._rotation21*x._rotation10+u._rotation22*x._rotation20,l=u._rotation20*x._rotation01+u._rotation21*x._rotation11+u._rotation22*x._rotation21,c=u._rotation20*x._rotation02+u._rotation21*x._rotation12+u._rotation22*x._rotation22,f._rotation00=o,f._rotation01=n,f._rotation02=s,f._rotation10=r,f._rotation11=e,f._rotation12=_,f._rotation20=h,f._rotation21=l,f._rotation22=c,p=u._rotation00*x._positionX+u._rotation01*x._positionY+u._rotation02*x._positionZ,v=u._rotation10*x._positionX+u._rotation11*x._positionY+u._rotation12*x._positionZ,m=u._rotation20*x._positionX+u._rotation21*x._positionY+u._rotation22*x._positionZ,f._positionX=p,f._positionY=v,f._positionZ=m,f._positionX+=u._positionX,f._positionY+=u._positionY,f._positionZ+=u._positionZ;var y,g,X,z,M,Y,Z,d,I,V,L,w,A,k,B,P,T,S,C=a._transform,q=a._localTransform,R=this._transform;if(y=R._rotation00*q._rotation00+R._rotation01*q._rotation10+R._rotation02*q._rotation20,g=R._rotation00*q._rotation01+R._rotation01*q._rotation11+R._rotation02*q._rotation21,X=R._rotation00*q._rotation02+R._rotation01*q._rotation12+R._rotation02*q._rotation22,z=R._rotation10*q._rotation00+R._rotation11*q._rotation10+R._rotation12*q._rotation20,M=R._rotation10*q._rotation01+R._rotation11*q._rotation11+R._rotation12*q._rotation21,Y=R._rotation10*q._rotation02+R._rotation11*q._rotation12+R._rotation12*q._rotation22,Z=R._rotation20*q._rotation00+R._rotation21*q._rotation10+R._rotation22*q._rotation20,d=R._rotation20*q._rotation01+R._rotation21*q._rotation11+R._rotation22*q._rotation21,I=R._rotation20*q._rotation02+R._rotation21*q._rotation12+R._rotation22*q._rotation22,C._rotation00=y,C._rotation01=g,C._rotation02=X,C._rotation10=z,C._rotation11=M,C._rotation12=Y,C._rotation20=Z,C._rotation21=d,C._rotation22=I,V=R._rotation00*q._positionX+R._rotation01*q._positionY+R._rotation02*q._positionZ,L=R._rotation10*q._positionX+R._rotation11*q._positionY+R._rotation12*q._positionZ,w=R._rotation20*q._positionX+R._rotation21*q._positionY+R._rotation22*q._positionZ,C._positionX=V,C._positionY=L,C._positionZ=w,C._positionX+=R._positionX,C._positionY+=R._positionY,C._positionZ+=R._positionZ,a._geom._computeAabb(a._aabb,a._ptransform),A=a._aabb._minX,k=a._aabb._minY,B=a._aabb._minZ,P=a._aabb._maxX,T=a._aabb._maxY,S=a._aabb._maxZ,a._geom._computeAabb(a._aabb,a._transform),a._aabb._minX=A<a._aabb._minX?A:a._aabb._minX,a._aabb._minY=k<a._aabb._minY?k:a._aabb._minY,a._aabb._minZ=B<a._aabb._minZ?B:a._aabb._minZ,a._aabb._maxX=P>a._aabb._maxX?P:a._aabb._maxX,a._aabb._maxY=T>a._aabb._maxY?T:a._aabb._maxY,a._aabb._maxZ=S>a._aabb._maxZ?S:a._aabb._maxZ,null!=a._proxy){var E,j,N;E=a._transform._positionX-a._ptransform._positionX,j=a._transform._positionY-a._ptransform._positionY,N=a._transform._positionZ-a._ptransform._positionZ;var D=a.displacement;D.x=E,D.y=j,D.z=N,a._rigidBody._world._broadPhase.moveProxy(a._proxy,a._aabb,a.displacement)}a=b}},removeShape:function(t){var i=t._prev,a=t._next;if(null!=i&&(i._next=a),null!=a&&(a._prev=i),t==this._shapeList&&(this._shapeList=this._shapeList._next),t==this._shapeListLast&&(this._shapeListLast=this._shapeListLast._prev),t._next=null,t._prev=null,this._numShapes--,t._rigidBody=null,null!=this._world){var o=this._world;o._broadPhase.destroyProxy(t._proxy),t._proxy=null,t._id=-1;for(var n=t._rigidBody._contactLinkList;null!=n;){var s=n._next,r=n._contact;if(r._s1==t||r._s2==t){var e=n._other;e._sleeping=!1,e._sleepTime=0;var _=o._contactManager,h=r._prev,l=r._next;if(null!=h&&(h._next=l),null!=l&&(l._prev=h),r==_._contactList&&(_._contactList=_._contactList._next),r==_._contactListLast&&(_._contactListLast=_._contactListLast._prev),r._next=null,r._prev=null,r._touching){var c=r._s1._contactCallback,p=r._s2._contactCallback;c==p&&(p=null),null!=c&&c.endContact(r),null!=p&&p.endContact(r)}var v=r._link1._prev,m=r._link1._next;null!=v&&(v._next=m),null!=m&&(m._prev=v),r._link1==r._b1._contactLinkList&&(r._b1._contactLinkList=r._b1._contactLinkList._next),r._link1==r._b1._contactLinkListLast&&(r._b1._contactLinkListLast=r._b1._contactLinkListLast._prev),r._link1._next=null,r._link1._prev=null;var b=r._link2._prev,f=r._link2._next;null!=b&&(b._next=f),null!=f&&(f._prev=b),r._link2==r._b2._contactLinkList&&(r._b2._contactLinkList=r._b2._contactLinkList._next),r._link2==r._b2._contactLinkListLast&&(r._b2._contactLinkListLast=r._b2._contactLinkListLast._prev),r._link2._next=null,r._link2._prev=null,r._b1._numContactLinks--,r._b2._numContactLinks--,r._link1._other=null,r._link2._other=null,r._link1._contact=null,r._link2._contact=null,r._s1=null,r._s2=null,r._b1=null,r._b2=null,r._touching=!1,r._cachedDetectorData._clear(),r._manifold._clear(),r._detector=null;var x=r._contactConstraint;x._s1=null,x._s2=null,x._b1=null,x._b2=null,x._tf1=null,x._tf2=null,r._next=_._contactPool,_._contactPool=r,_._numContacts--}n=s}o._numShapes--}this.updateMass();for(var u=this._shapeList;null!=u;){var y,g,X,z,M,Y,Z,d,I,V,L,w,A=u._next,k=u._ptransform,B=u._localTransform,P=this._ptransform;y=P._rotation00*B._rotation00+P._rotation01*B._rotation10+P._rotation02*B._rotation20,g=P._rotation00*B._rotation01+P._rotation01*B._rotation11+P._rotation02*B._rotation21,X=P._rotation00*B._rotation02+P._rotation01*B._rotation12+P._rotation02*B._rotation22,z=P._rotation10*B._rotation00+P._rotation11*B._rotation10+P._rotation12*B._rotation20,M=P._rotation10*B._rotation01+P._rotation11*B._rotation11+P._rotation12*B._rotation21,Y=P._rotation10*B._rotation02+P._rotation11*B._rotation12+P._rotation12*B._rotation22,Z=P._rotation20*B._rotation00+P._rotation21*B._rotation10+P._rotation22*B._rotation20,d=P._rotation20*B._rotation01+P._rotation21*B._rotation11+P._rotation22*B._rotation21,I=P._rotation20*B._rotation02+P._rotation21*B._rotation12+P._rotation22*B._rotation22,k._rotation00=y,k._rotation01=g,k._rotation02=X,k._rotation10=z,k._rotation11=M,k._rotation12=Y,k._rotation20=Z,k._rotation21=d,k._rotation22=I,V=P._rotation00*B._positionX+P._rotation01*B._positionY+P._rotation02*B._positionZ,L=P._rotation10*B._positionX+P._rotation11*B._positionY+P._rotation12*B._positionZ,w=P._rotation20*B._positionX+P._rotation21*B._positionY+P._rotation22*B._positionZ,k._positionX=V,k._positionY=L,k._positionZ=w,k._positionX+=P._positionX,k._positionY+=P._positionY,k._positionZ+=P._positionZ;var T,S,C,q,R,E,j,N,D,F,O,W,G,H,U,J,Q,$,K=u._transform,tt=u._localTransform,it=this._transform;if(T=it._rotation00*tt._rotation00+it._rotation01*tt._rotation10+it._rotation02*tt._rotation20,S=it._rotation00*tt._rotation01+it._rotation01*tt._rotation11+it._rotation02*tt._rotation21,C=it._rotation00*tt._rotation02+it._rotation01*tt._rotation12+it._rotation02*tt._rotation22,q=it._rotation10*tt._rotation00+it._rotation11*tt._rotation10+it._rotation12*tt._rotation20,R=it._rotation10*tt._rotation01+it._rotation11*tt._rotation11+it._rotation12*tt._rotation21,E=it._rotation10*tt._rotation02+it._rotation11*tt._rotation12+it._rotation12*tt._rotation22,j=it._rotation20*tt._rotation00+it._rotation21*tt._rotation10+it._rotation22*tt._rotation20,N=it._rotation20*tt._rotation01+it._rotation21*tt._rotation11+it._rotation22*tt._rotation21,D=it._rotation20*tt._rotation02+it._rotation21*tt._rotation12+it._rotation22*tt._rotation22,K._rotation00=T,K._rotation01=S,K._rotation02=C,K._rotation10=q,K._rotation11=R,K._rotation12=E,K._rotation20=j,K._rotation21=N,K._rotation22=D,F=it._rotation00*tt._positionX+it._rotation01*tt._positionY+it._rotation02*tt._positionZ,O=it._rotation10*tt._positionX+it._rotation11*tt._positionY+it._rotation12*tt._positionZ,W=it._rotation20*tt._positionX+it._rotation21*tt._positionY+it._rotation22*tt._positionZ,K._positionX=F,K._positionY=O,K._positionZ=W,K._positionX+=it._positionX,K._positionY+=it._positionY,K._positionZ+=it._positionZ,u._geom._computeAabb(u._aabb,u._ptransform),G=u._aabb._minX,H=u._aabb._minY,U=u._aabb._minZ,J=u._aabb._maxX,Q=u._aabb._maxY,$=u._aabb._maxZ,u._geom._computeAabb(u._aabb,u._transform),u._aabb._minX=G<u._aabb._minX?G:u._aabb._minX,u._aabb._minY=H<u._aabb._minY?H:u._aabb._minY,u._aabb._minZ=U<u._aabb._minZ?U:u._aabb._minZ,u._aabb._maxX=J>u._aabb._maxX?J:u._aabb._maxX,u._aabb._maxY=Q>u._aabb._maxY?Q:u._aabb._maxY,u._aabb._maxZ=$>u._aabb._maxZ?$:u._aabb._maxZ,null!=u._proxy){var at,ot,nt;at=u._transform._positionX-u._ptransform._positionX,ot=u._transform._positionY-u._ptransform._positionY,nt=u._transform._positionZ-u._ptransform._positionZ;var st=u.displacement;st.x=at,st.y=ot,st.z=nt,u._rigidBody._world._broadPhase.moveProxy(u._proxy,u._aabb,u.displacement)}u=A}},getType:function(){return this._type},setType:function(t){this._type=t,this.updateMass()},wakeUp:function(){this._sleeping=!1,this._sleepTime=0},sleep:function(){this._sleeping=!0,this._sleepTime=0},isSleeping:function(){return this._sleeping},getSleepTime:function(){return this._sleepTime},setAutoSleep:function(t){this._autoSleep=t,this._sleeping=!1,this._sleepTime=0},getLinearDamping:function(){return this._linearDamping},setLinearDamping:function(t){this._linearDamping=t},getAngularDamping:function(){return this._angularDamping},setAngularDamping:function(t){this._angularDamping=t},getPrev:function(){return this._prev},getNext:function(){return this._next}};var hi=function(){},li=function(t){this._id=-1,this._localTransform=new O,this._ptransform=new O,this._transform=new O;var i=t.position;this._localTransform._positionX=i.x,this._localTransform._positionY=i.y,this._localTransform._positionZ=i.z;var a=t.rotation;this._localTransform._rotation00=a.e00,this._localTransform._rotation01=a.e01,this._localTransform._rotation02=a.e02,this._localTransform._rotation10=a.e10,this._localTransform._rotation11=a.e11,this._localTransform._rotation12=a.e12,this._localTransform._rotation20=a.e20,this._localTransform._rotation21=a.e21,this._localTransform._rotation22=a.e22;var o=this._ptransform,n=this._localTransform;o._positionX=n._positionX,o._positionY=n._positionY,o._positionZ=n._positionZ,o._rotation00=n._rotation00,o._rotation01=n._rotation01,o._rotation02=n._rotation02,o._rotation10=n._rotation10,o._rotation11=n._rotation11,o._rotation12=n._rotation12,o._rotation20=n._rotation20,o._rotation21=n._rotation21,o._rotation22=n._rotation22;var s=this._transform,r=this._localTransform;s._positionX=r._positionX,s._positionY=r._positionY,s._positionZ=r._positionZ,s._rotation00=r._rotation00,s._rotation01=r._rotation01,s._rotation02=r._rotation02,s._rotation10=r._rotation10,s._rotation11=r._rotation11,s._rotation12=r._rotation12,s._rotation20=r._rotation20,s._rotation21=r._rotation21,s._rotation22=r._rotation22,this._restitution=t.restitution,this._friction=t.friction,this._density=t.density,this._geom=t.geometry,this._collisionGroup=t.collisionGroup,this._collisionMask=t.collisionMask,this._contactCallback=t.contactCallback,this._aabb=new x,this._proxy=null,this.displacement=new F};li.prototype={getFriction:function(){return this._friction},setFriction:function(t){this._friction=t},getRestitution:function(){return this._restitution},setRestitution:function(t){this._restitution=t},getLocalTransform:function(){var t=this._localTransform,i=new O;return i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,i},getLocalTransformTo:function(t){var i=this._localTransform;t._positionX=i._positionX,t._positionY=i._positionY,t._positionZ=i._positionZ,t._rotation00=i._rotation00,t._rotation01=i._rotation01,t._rotation02=i._rotation02,t._rotation10=i._rotation10,t._rotation11=i._rotation11,t._rotation12=i._rotation12,t._rotation20=i._rotation20,t._rotation21=i._rotation21,t._rotation22=i._rotation22},getTransform:function(){var t=this._transform,i=new O;return i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,i},getTransformTo:function(t){var i=this._transform;t._positionX=i._positionX,t._positionY=i._positionY,t._positionZ=i._positionZ,t._rotation00=i._rotation00,t._rotation01=i._rotation01,t._rotation02=i._rotation02,t._rotation10=i._rotation10,t._rotation11=i._rotation11,t._rotation12=i._rotation12,t._rotation20=i._rotation20,t._rotation21=i._rotation21,t._rotation22=i._rotation22},setLocalTransform:function(t){var i=this._localTransform;if(i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,null!=this._rigidBody){var a=this._rigidBody;a.updateMass();for(var o=a._shapeList;null!=o;){var n,s,r,e,_,h,l,c,p,v,m,b,f=o._next,x=o._ptransform,u=o._localTransform,y=a._ptransform;n=y._rotation00*u._rotation00+y._rotation01*u._rotation10+y._rotation02*u._rotation20,s=y._rotation00*u._rotation01+y._rotation01*u._rotation11+y._rotation02*u._rotation21,r=y._rotation00*u._rotation02+y._rotation01*u._rotation12+y._rotation02*u._rotation22,e=y._rotation10*u._rotation00+y._rotation11*u._rotation10+y._rotation12*u._rotation20,_=y._rotation10*u._rotation01+y._rotation11*u._rotation11+y._rotation12*u._rotation21,h=y._rotation10*u._rotation02+y._rotation11*u._rotation12+y._rotation12*u._rotation22,l=y._rotation20*u._rotation00+y._rotation21*u._rotation10+y._rotation22*u._rotation20,c=y._rotation20*u._rotation01+y._rotation21*u._rotation11+y._rotation22*u._rotation21,p=y._rotation20*u._rotation02+y._rotation21*u._rotation12+y._rotation22*u._rotation22,x._rotation00=n,x._rotation01=s,x._rotation02=r,x._rotation10=e,x._rotation11=_,x._rotation12=h,x._rotation20=l,x._rotation21=c,x._rotation22=p,v=y._rotation00*u._positionX+y._rotation01*u._positionY+y._rotation02*u._positionZ,m=y._rotation10*u._positionX+y._rotation11*u._positionY+y._rotation12*u._positionZ,b=y._rotation20*u._positionX+y._rotation21*u._positionY+y._rotation22*u._positionZ,x._positionX=v,x._positionY=m,x._positionZ=b,x._positionX+=y._positionX,x._positionY+=y._positionY,x._positionZ+=y._positionZ;var g,X,z,M,Y,Z,d,I,V,L,w,A,k,B,P,T,S,C,q=o._transform,R=o._localTransform,E=a._transform;if(g=E._rotation00*R._rotation00+E._rotation01*R._rotation10+E._rotation02*R._rotation20,X=E._rotation00*R._rotation01+E._rotation01*R._rotation11+E._rotation02*R._rotation21,z=E._rotation00*R._rotation02+E._rotation01*R._rotation12+E._rotation02*R._rotation22,M=E._rotation10*R._rotation00+E._rotation11*R._rotation10+E._rotation12*R._rotation20,Y=E._rotation10*R._rotation01+E._rotation11*R._rotation11+E._rotation12*R._rotation21,Z=E._rotation10*R._rotation02+E._rotation11*R._rotation12+E._rotation12*R._rotation22,d=E._rotation20*R._rotation00+E._rotation21*R._rotation10+E._rotation22*R._rotation20,I=E._rotation20*R._rotation01+E._rotation21*R._rotation11+E._rotation22*R._rotation21,V=E._rotation20*R._rotation02+E._rotation21*R._rotation12+E._rotation22*R._rotation22,q._rotation00=g,q._rotation01=X,q._rotation02=z,q._rotation10=M,q._rotation11=Y,q._rotation12=Z,q._rotation20=d,q._rotation21=I,q._rotation22=V,L=E._rotation00*R._positionX+E._rotation01*R._positionY+E._rotation02*R._positionZ,w=E._rotation10*R._positionX+E._rotation11*R._positionY+E._rotation12*R._positionZ,A=E._rotation20*R._positionX+E._rotation21*R._positionY+E._rotation22*R._positionZ,q._positionX=L,q._positionY=w,q._positionZ=A,q._positionX+=E._positionX,q._positionY+=E._positionY,q._positionZ+=E._positionZ,o._geom._computeAabb(o._aabb,o._ptransform),k=o._aabb._minX,B=o._aabb._minY,P=o._aabb._minZ,T=o._aabb._maxX,S=o._aabb._maxY,C=o._aabb._maxZ,o._geom._computeAabb(o._aabb,o._transform),o._aabb._minX=k<o._aabb._minX?k:o._aabb._minX,o._aabb._minY=B<o._aabb._minY?B:o._aabb._minY,o._aabb._minZ=P<o._aabb._minZ?P:o._aabb._minZ,o._aabb._maxX=T>o._aabb._maxX?T:o._aabb._maxX,o._aabb._maxY=S>o._aabb._maxY?S:o._aabb._maxY,o._aabb._maxZ=C>o._aabb._maxZ?C:o._aabb._maxZ,null!=o._proxy){var j,N,D;j=o._transform._positionX-o._ptransform._positionX,N=o._transform._positionY-o._ptransform._positionY,D=o._transform._positionZ-o._ptransform._positionZ;var F=o.displacement;F.x=j,F.y=N,F.z=D,o._rigidBody._world._broadPhase.moveProxy(o._proxy,o._aabb,o.displacement)}o=f}}},getDensity:function(){return this._density},setDensity:function(t){if(this._density=t,null!=this._rigidBody){var i=this._rigidBody;i.updateMass();for(var a=i._shapeList;null!=a;){var o,n,s,r,e,_,h,l,c,p,v,m,b=a._next,f=a._ptransform,x=a._localTransform,u=i._ptransform;o=u._rotation00*x._rotation00+u._rotation01*x._rotation10+u._rotation02*x._rotation20,n=u._rotation00*x._rotation01+u._rotation01*x._rotation11+u._rotation02*x._rotation21,s=u._rotation00*x._rotation02+u._rotation01*x._rotation12+u._rotation02*x._rotation22,r=u._rotation10*x._rotation00+u._rotation11*x._rotation10+u._rotation12*x._rotation20,e=u._rotation10*x._rotation01+u._rotation11*x._rotation11+u._rotation12*x._rotation21,_=u._rotation10*x._rotation02+u._rotation11*x._rotation12+u._rotation12*x._rotation22,h=u._rotation20*x._rotation00+u._rotation21*x._rotation10+u._rotation22*x._rotation20,l=u._rotation20*x._rotation01+u._rotation21*x._rotation11+u._rotation22*x._rotation21,c=u._rotation20*x._rotation02+u._rotation21*x._rotation12+u._rotation22*x._rotation22,f._rotation00=o,f._rotation01=n,f._rotation02=s,f._rotation10=r,f._rotation11=e,f._rotation12=_,f._rotation20=h,f._rotation21=l,f._rotation22=c,p=u._rotation00*x._positionX+u._rotation01*x._positionY+u._rotation02*x._positionZ,v=u._rotation10*x._positionX+u._rotation11*x._positionY+u._rotation12*x._positionZ,m=u._rotation20*x._positionX+u._rotation21*x._positionY+u._rotation22*x._positionZ,f._positionX=p,f._positionY=v,f._positionZ=m,f._positionX+=u._positionX,f._positionY+=u._positionY,f._positionZ+=u._positionZ;var y,g,X,z,M,Y,Z,d,I,V,L,w,A,k,B,P,T,S,C=a._transform,q=a._localTransform,R=i._transform;if(y=R._rotation00*q._rotation00+R._rotation01*q._rotation10+R._rotation02*q._rotation20,g=R._rotation00*q._rotation01+R._rotation01*q._rotation11+R._rotation02*q._rotation21,X=R._rotation00*q._rotation02+R._rotation01*q._rotation12+R._rotation02*q._rotation22,z=R._rotation10*q._rotation00+R._rotation11*q._rotation10+R._rotation12*q._rotation20,M=R._rotation10*q._rotation01+R._rotation11*q._rotation11+R._rotation12*q._rotation21,Y=R._rotation10*q._rotation02+R._rotation11*q._rotation12+R._rotation12*q._rotation22,Z=R._rotation20*q._rotation00+R._rotation21*q._rotation10+R._rotation22*q._rotation20,d=R._rotation20*q._rotation01+R._rotation21*q._rotation11+R._rotation22*q._rotation21,I=R._rotation20*q._rotation02+R._rotation21*q._rotation12+R._rotation22*q._rotation22,C._rotation00=y,C._rotation01=g,C._rotation02=X,C._rotation10=z,C._rotation11=M,C._rotation12=Y,C._rotation20=Z,C._rotation21=d,C._rotation22=I,V=R._rotation00*q._positionX+R._rotation01*q._positionY+R._rotation02*q._positionZ,L=R._rotation10*q._positionX+R._rotation11*q._positionY+R._rotation12*q._positionZ,w=R._rotation20*q._positionX+R._rotation21*q._positionY+R._rotation22*q._positionZ,C._positionX=V,C._positionY=L,C._positionZ=w,C._positionX+=R._positionX,C._positionY+=R._positionY,C._positionZ+=R._positionZ,a._geom._computeAabb(a._aabb,a._ptransform),A=a._aabb._minX,k=a._aabb._minY,B=a._aabb._minZ,P=a._aabb._maxX,T=a._aabb._maxY,S=a._aabb._maxZ,a._geom._computeAabb(a._aabb,a._transform),a._aabb._minX=A<a._aabb._minX?A:a._aabb._minX,a._aabb._minY=k<a._aabb._minY?k:a._aabb._minY,a._aabb._minZ=B<a._aabb._minZ?B:a._aabb._minZ,a._aabb._maxX=P>a._aabb._maxX?P:a._aabb._maxX,a._aabb._maxY=T>a._aabb._maxY?T:a._aabb._maxY,a._aabb._maxZ=S>a._aabb._maxZ?S:a._aabb._maxZ,null!=a._proxy){var E,j,N;E=a._transform._positionX-a._ptransform._positionX,j=a._transform._positionY-a._ptransform._positionY,N=a._transform._positionZ-a._ptransform._positionZ;var D=a.displacement;D.x=E,D.y=j,D.z=N,a._rigidBody._world._broadPhase.moveProxy(a._proxy,a._aabb,a.displacement)}a=b}}},getAabb:function(){return this._aabb.clone()},getAabbTo:function(t){t.copyFrom(this._aabb)},getGeometry:function(){return this._geom},getRigidBody:function(){return this._rigidBody},getCollisionGroup:function(){return this._collisionGroup},setCollisionGroup:function(t){this._collisionGroup=t},getCollisionMask:function(){return this._collisionMask},setCollisionMask:function(t){this._collisionMask=t},getContactCallback:function(){return this._contactCallback},setContactCallback:function(t){this._contactCallback=t},getPrev:function(){return this._prev},getNext:function(){return this._next}};e._BRUTE_FORCE=1,e._BVH=2,e.BRUTE_FORCE=1,e.BVH=2,p.SIMPLE=0,p.MINIMIZE_SURFACE_AREA=1,M._SPHERE=0,M._BOX=1,M._CYLINDER=2,M._CONE=3,M._CAPSULE=4,M._CONVEX_HULL=5,M._CONVEX_MIN=0,M._CONVEX_MAX=5,M.SPHERE=0,M.BOX=1,M.CYLINDER=2,M.CONE=3,M.CAPSULE=4,M.CONVEX_HULL=5,w.EDGE_BIAS_MULT=1,E.OK=0,E.INVALID_TRIANGLE=1,E.NO_ADJACENT_PAIR_INDEX=2,E.NO_ADJACENT_TRIANGLE=3,E.EDGE_LOOP_BROKEN=4,E.NO_OUTER_TRIANGLE=5,E.TRIANGLE_INVISIBLE=6,j.count=0,F.numCreations=0,W.defaultFriction=.2,W.defaultRestitution=.2,W.defaultDensity=1,W.defaultCollisionGroup=1,W.defaultCollisionMask=1,W.maxTranslationPerStep=20,W.maxRotationPerStep=3.14159265358979,W.bvhProxyPadding=.1,W.bvhIncrementalCollisionThreshold=.45,W.defaultGJKMargin=.05,W.enableGJKCaching=!0,W.maxEPAVertices=128,W.maxEPAPolyhedronFaces=128,W.contactEnableBounceThreshold=.5,W.velocityBaumgarte=.2,W.positionSplitImpulseBaumgarte=.4,W.positionNgsBaumgarte=1,W.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold=.05,W.defaultContactPositionCorrectionAlgorithm=0,W.alternativeContactPositionCorrectionAlgorithm=1,W.contactPersistenceThreshold=.05,W.maxManifoldPoints=4,W.defaultJointConstraintSolverType=0,W.defaultJointPositionCorrectionAlgorithm=0,W.jointWarmStartingFactorForBaungarte=.8,W.jointWarmStartingFactor=.95,W.minSpringDamperDampingRatio=1e-6,W.minRagdollMaxSwingAngle=1e-6,W.maxJacobianRows=6,W.directMlcpSolverEps=1e-9,W.islandInitialRigidBodyArraySize=128,W.islandInitialConstraintArraySize=128,W.sleepingVelocityThreshold=.2,W.sleepingAngularVelocityThreshold=.5,W.sleepingTimeThreshold=1,W.disableSleeping=!1,W.linearSlop=.005,W.angularSlop=.017453292519943278,G.instance=new G,H._SUCCEEDED=0,H._GJK_FAILED_TO_MAKE_TETRAHEDRON=1,H._GJK_DID_NOT_CONVERGE=2,H._EPA_FAILED_TO_INIT=257,H._EPA_FAILED_TO_ADD_VERTEX=258,H._EPA_DID_NOT_CONVERGE=259,H.SUCCEEDED=0,H.GJK_FAILED_TO_MAKE_TETRAHEDRON=1,H.GJK_DID_NOT_CONVERGE=2,H.EPA_FAILED_TO_INIT=257,H.EPA_FAILED_TO_ADD_VERTEX=258,H.EPA_DID_NOT_CONVERGE=259,J.numCreations=0,Q.numCreations=0,$.POSITIVE_INFINITY=1/0,$.NEGATIVE_INFINITY=-1/0,$.PI=3.14159265358979,$.TWO_PI=6.28318530717958,$.HALF_PI=1.570796326794895,$.TO_RADIANS=.017453292519943278,$.TO_DEGREES=57.29577951308238,tt.numCreations=0,mt.SPHERE_PHI_DIVISION=8,mt.SPHERE_THETA_DIVISION=4,mt.CIRCLE_THETA_DIVISION=8,ft.broadPhaseCollisionTime=0,ft.narrowPhaseCollisionTime=0,ft.dynamicsTime=0,ft.totalTime=0,ut._BAUMGARTE=0,ut._SPLIT_IMPULSE=1,ut._NGS=2,ut.BAUMGARTE=0,ut.SPLIT_IMPULSE=1,ut.NGS=2,Yt.BIT_LINEAR_SET=1,Yt.BIT_ANGULAR_SET=2,St._SPHERICAL=0,St._REVOLUTE=1,St._CYLINDRICAL=2,St._PRISMATIC=3,St._UNIVERSAL=4,St._RAGDOLL=5,St.SPHERICAL=0,St.REVOLUTE=1,St.CYLINDRICAL=2,St.PRISMATIC=3,St.UNIVERSAL=4,St.RAGDOLL=5,Jt._ITERATIVE=0,Jt._DIRECT=1,Jt.ITERATIVE=0,Jt.DIRECT=1,hi._DYNAMIC=0,hi._STATIC=1,hi._KINEMATIC=2,hi.DYNAMIC=0,hi.STATIC=1,hi.KINEMATIC=2,t.OIMO={},t.OIMO.DebugDraw=mt,t.OIMO.BroadPhase=i,i.prototype.createProxy=i.prototype.createProxy,i.prototype.destroyProxy=i.prototype.destroyProxy,i.prototype.moveProxy=i.prototype.moveProxy,i.prototype.isOverlapping=i.prototype.isOverlapping,i.prototype.collectPairs=i.prototype.collectPairs,i.prototype.getProxyPairList=i.prototype.getProxyPairList,i.prototype.isIncremental=i.prototype.isIncremental,i.prototype.getTestCount=i.prototype.getTestCount,i.prototype.rayCast=i.prototype.rayCast,i.prototype.convexCast=i.prototype.convexCast,i.prototype.aabbTest=i.prototype.aabbTest,t.OIMO.Geometry=a,a.prototype.getType=a.prototype.getType,a.prototype.getVolume=a.prototype.getVolume,a.prototype.rayCast=a.prototype.rayCast,t.OIMO.ConvexGeometry=o,o.prototype.getGjkMergin=o.prototype.getGjkMergin,o.prototype.setGjkMergin=o.prototype.setGjkMergin,o.prototype.computeLocalSupportingVertex=o.prototype.computeLocalSupportingVertex,o.prototype.rayCast=o.prototype.rayCast,t.OIMO.BroadPhaseProxyCallback=r,r.prototype.process=r.prototype.process,t.OIMO.BroadPhaseType=e,t.OIMO.Proxy=_,_.prototype.getId=_.prototype.getId,_.prototype.getFatAabb=_.prototype.getFatAabb,_.prototype.getFatAabbTo=_.prototype.getFatAabbTo,t.OIMO.ProxyPair=h,h.prototype.getProxy1=h.prototype.getProxy1,h.prototype.getProxy2=h.prototype.getProxy2,h.prototype.getNext=h.prototype.getNext,t.OIMO.BruteForceBroadPhase=l,l.prototype.createProxy=l.prototype.createProxy,l.prototype.destroyProxy=l.prototype.destroyProxy,l.prototype.moveProxy=l.prototype.moveProxy,l.prototype.collectPairs=l.prototype.collectPairs,l.prototype.rayCast=l.prototype.rayCast,l.prototype.convexCast=l.prototype.convexCast,l.prototype.aabbTest=l.prototype.aabbTest,t.OIMO.BvhBroadPhase=c,c.prototype.createProxy=c.prototype.createProxy,c.prototype.destroyProxy=c.prototype.destroyProxy,c.prototype.moveProxy=c.prototype.moveProxy,c.prototype.collectPairs=c.prototype.collectPairs,c.prototype.rayCast=c.prototype.rayCast,c.prototype.convexCast=c.prototype.convexCast,c.prototype.aabbTest=c.prototype.aabbTest,c.prototype.getTreeBalance=c.prototype.getTreeBalance,t.OIMO.Aabb=x,x.prototype.init=x.prototype.init,x.prototype.getMin=x.prototype.getMin,x.prototype.getMinTo=x.prototype.getMinTo,x.prototype.setMin=x.prototype.setMin,x.prototype.getMax=x.prototype.getMax,x.prototype.getMaxTo=x.prototype.getMaxTo,x.prototype.setMax=x.prototype.setMax,x.prototype.getCenter=x.prototype.getCenter,x.prototype.getCenterTo=x.prototype.getCenterTo,x.prototype.getExtents=x.prototype.getExtents,x.prototype.getExtentsTo=x.prototype.getExtentsTo,x.prototype.combine=x.prototype.combine,x.prototype.combined=x.prototype.combined,x.prototype.overlap=x.prototype.overlap,x.prototype.getIntersection=x.prototype.getIntersection,x.prototype.getIntersectionTo=x.prototype.getIntersectionTo,x.prototype.copyFrom=x.prototype.copyFrom,x.prototype.clone=x.prototype.clone,t.OIMO.BoxGeometry=u,u.prototype.getHalfExtents=u.prototype.getHalfExtents,u.prototype.getHalfExtentsTo=u.prototype.getHalfExtentsTo,u.prototype.computeLocalSupportingVertex=u.prototype.computeLocalSupportingVertex,t.OIMO.CapsuleGeometry=y,y.prototype.getRadius=y.prototype.getRadius,y.prototype.getHalfHeight=y.prototype.getHalfHeight,y.prototype.computeLocalSupportingVertex=y.prototype.computeLocalSupportingVertex,t.OIMO.ConeGeometry=g,g.prototype.getRadius=g.prototype.getRadius,g.prototype.getHalfHeight=g.prototype.getHalfHeight,g.prototype.computeLocalSupportingVertex=g.prototype.computeLocalSupportingVertex,t.OIMO.ConvexHullGeometry=X,X.prototype.getVertices=X.prototype.getVertices,X.prototype.computeLocalSupportingVertex=X.prototype.computeLocalSupportingVertex,t.OIMO.CylinderGeometry=z,z.prototype.getRadius=z.prototype.getRadius,z.prototype.getHalfHeight=z.prototype.getHalfHeight,z.prototype.computeLocalSupportingVertex=z.prototype.computeLocalSupportingVertex,t.OIMO.GeometryType=M,t.OIMO.RayCastHit=Y,t.OIMO.SphereGeometry=Z,Z.prototype.getRadius=Z.prototype.getRadius,Z.prototype.computeLocalSupportingVertex=Z.prototype.computeLocalSupportingVertex,t.OIMO.CollisionMatrix=d,d.prototype.getDetector=d.prototype.getDetector,t.OIMO.DetectorResult=I,I.prototype.getMaxDepth=I.prototype.getMaxDepth,I.prototype.clear=I.prototype.clear,t.OIMO.DetectorResultPoint=V,t.OIMO.Detector=L,L.prototype.detect=L.prototype.detect,t.OIMO.BoxBoxDetector=w,t.OIMO.CapsuleCapsuleDetector=P,t.OIMO.GjkEpaDetector=T,t.OIMO.SphereBoxDetector=S,t.OIMO.SphereCapsuleDetector=C,t.OIMO.SphereSphereDetector=q,t.OIMO.Vec3=F,F.prototype.init=F.prototype.init,F.prototype.zero=F.prototype.zero,F.prototype.add=F.prototype.add,F.prototype.addScaled=F.prototype.addScaled,F.prototype.sub=F.prototype.sub,F.prototype.scale=F.prototype.scale,F.prototype.scale3=F.prototype.scale3,F.prototype.dot=F.prototype.dot,F.prototype.cross=F.prototype.cross,F.prototype.addEq=F.prototype.addEq,F.prototype.addScaledEq=F.prototype.addScaledEq,F.prototype.subEq=F.prototype.subEq,F.prototype.scaleEq=F.prototype.scaleEq,F.prototype.scale3Eq=F.prototype.scale3Eq,F.prototype.crossEq=F.prototype.crossEq,F.prototype.mulMat3=F.prototype.mulMat3,F.prototype.mulMat4=F.prototype.mulMat4,F.prototype.mulTransform=F.prototype.mulTransform,F.prototype.mulMat3Eq=F.prototype.mulMat3Eq,F.prototype.mulMat4Eq=F.prototype.mulMat4Eq,F.prototype.mulTransformEq=F.prototype.mulTransformEq,F.prototype.length=F.prototype.length,F.prototype.lengthSq=F.prototype.lengthSq,F.prototype.normalized=F.prototype.normalized,F.prototype.normalize=F.prototype.normalize,F.prototype.negate=F.prototype.negate,F.prototype.negateEq=F.prototype.negateEq,F.prototype.copyFrom=F.prototype.copyFrom,F.prototype.clone=F.prototype.clone,F.prototype.toString=F.prototype.toString,t.OIMO.Transform=O,O.prototype.identity=O.prototype.identity,O.prototype.getPosition=O.prototype.getPosition,O.prototype.getPositionTo=O.prototype.getPositionTo,O.prototype.setPosition=O.prototype.setPosition,O.prototype.translate=O.prototype.translate,O.prototype.getRotation=O.prototype.getRotation,O.prototype.getRotationTo=O.prototype.getRotationTo,O.prototype.setRotation=O.prototype.setRotation,O.prototype.setRotationXyz=O.prototype.setRotationXyz,O.prototype.rotate=O.prototype.rotate,O.prototype.rotateXyz=O.prototype.rotateXyz,O.prototype.getOrientation=O.prototype.getOrientation,O.prototype.getOrientationTo=O.prototype.getOrientationTo,O.prototype.setOrientation=O.prototype.setOrientation,O.prototype.clone=O.prototype.clone,O.prototype.copyFrom=O.prototype.copyFrom,t.OIMO.Setting=W,t.OIMO.GjkEpa=G,G.prototype.computeClosestPoints=G.prototype.computeClosestPoints,G.prototype.computeDistance=G.prototype.computeDistance,G.prototype.convexCast=G.prototype.convexCast,G.prototype.rayCast=G.prototype.rayCast,G.getInstance=G.getInstance,t.OIMO.GjkEpaResultState=H,t.OIMO.SimplexUtil=U,U.projectOrigin2=U.projectOrigin2,U.projectOrigin3=U.projectOrigin3,U.projectOrigin4=U.projectOrigin4,t.OIMO.Mat3=J,J.prototype.init=J.prototype.init,J.prototype.identity=J.prototype.identity,J.prototype.add=J.prototype.add,J.prototype.sub=J.prototype.sub,J.prototype.scale=J.prototype.scale,J.prototype.mul=J.prototype.mul,J.prototype.addEq=J.prototype.addEq,J.prototype.subEq=J.prototype.subEq,J.prototype.scaleEq=J.prototype.scaleEq,J.prototype.mulEq=J.prototype.mulEq,J.prototype.prependScale=J.prototype.prependScale,J.prototype.appendScale=J.prototype.appendScale,J.prototype.prependRotation=J.prototype.prependRotation,J.prototype.appendRotation=J.prototype.appendRotation,J.prototype.prependScaleEq=J.prototype.prependScaleEq,J.prototype.appendScaleEq=J.prototype.appendScaleEq,J.prototype.prependRotationEq=J.prototype.prependRotationEq,J.prototype.appendRotationEq=J.prototype.appendRotationEq,J.prototype.transpose=J.prototype.transpose,J.prototype.transposeEq=J.prototype.transposeEq,J.prototype.determinant=J.prototype.determinant,J.prototype.trace=J.prototype.trace,J.prototype.inverse=J.prototype.inverse,J.prototype.inverseEq=J.prototype.inverseEq,J.prototype.toArray=J.prototype.toArray,J.prototype.copyFrom=J.prototype.copyFrom,J.prototype.clone=J.prototype.clone,J.prototype.fromQuat=J.prototype.fromQuat,J.prototype.toQuat=J.prototype.toQuat,J.prototype.fromEulerXyz=J.prototype.fromEulerXyz,J.prototype.toEulerXyz=J.prototype.toEulerXyz,J.prototype.getRow=J.prototype.getRow,J.prototype.getCol=J.prototype.getCol,J.prototype.getRowTo=J.prototype.getRowTo,J.prototype.getColTo=J.prototype.getColTo,J.prototype.fromRows=J.prototype.fromRows,J.prototype.fromCols=J.prototype.fromCols,J.prototype.toString=J.prototype.toString,t.OIMO.Mat4=Q,Q.prototype.init=Q.prototype.init,Q.prototype.identity=Q.prototype.identity,Q.prototype.add=Q.prototype.add,Q.prototype.sub=Q.prototype.sub,Q.prototype.scale=Q.prototype.scale,Q.prototype.mul=Q.prototype.mul,Q.prototype.addEq=Q.prototype.addEq,Q.prototype.subEq=Q.prototype.subEq,Q.prototype.scaleEq=Q.prototype.scaleEq,Q.prototype.mulEq=Q.prototype.mulEq,Q.prototype.prependScale=Q.prototype.prependScale,Q.prototype.appendScale=Q.prototype.appendScale,Q.prototype.prependRotation=Q.prototype.prependRotation,Q.prototype.appendRotation=Q.prototype.appendRotation,Q.prototype.prependTranslation=Q.prototype.prependTranslation,Q.prototype.appendTranslation=Q.prototype.appendTranslation,Q.prototype.prependScaleEq=Q.prototype.prependScaleEq,Q.prototype.appendScaleEq=Q.prototype.appendScaleEq,Q.prototype.prependRotationEq=Q.prototype.prependRotationEq,Q.prototype.appendRotationEq=Q.prototype.appendRotationEq,Q.prototype.prependTranslationEq=Q.prototype.prependTranslationEq,Q.prototype.appendTranslationEq=Q.prototype.appendTranslationEq,Q.prototype.transpose=Q.prototype.transpose,Q.prototype.transposeEq=Q.prototype.transposeEq,Q.prototype.determinant=Q.prototype.determinant,Q.prototype.trace=Q.prototype.trace,Q.prototype.inverse=Q.prototype.inverse,Q.prototype.inverseEq=Q.prototype.inverseEq,Q.prototype.lookAt=Q.prototype.lookAt,Q.prototype.perspective=Q.prototype.perspective,Q.prototype.ortho=Q.prototype.ortho,Q.prototype.toArray=Q.prototype.toArray,Q.prototype.copyFrom=Q.prototype.copyFrom,Q.prototype.fromMat3=Q.prototype.fromMat3,Q.prototype.fromTransform=Q.prototype.fromTransform,Q.prototype.clone=Q.prototype.clone,Q.prototype.toString=Q.prototype.toString,t.OIMO.MathUtil=$,$.abs=$.abs,$.sin=$.sin,$.cos=$.cos,$.tan=$.tan,$.asin=$.asin,$.acos=$.acos,$.atan=$.atan,$.safeAsin=$.safeAsin,$.safeAcos=$.safeAcos,$.atan2=$.atan2,$.sqrt=$.sqrt,$.clamp=$.clamp,$.rand=$.rand,$.randIn=$.randIn,$.randVec3In=$.randVec3In,$.randVec3=$.randVec3,t.OIMO.Pool=K,K.prototype.vec3=K.prototype.vec3,K.prototype.mat3=K.prototype.mat3,K.prototype.mat4=K.prototype.mat4,K.prototype.quat=K.prototype.quat,K.prototype.dispose=K.prototype.dispose,K.prototype.disposeVec3=K.prototype.disposeVec3,K.prototype.disposeMat3=K.prototype.disposeMat3,K.prototype.disposeMat4=K.prototype.disposeMat4,K.prototype.disposeQuat=K.prototype.disposeQuat,t.OIMO.Quat=tt,tt.prototype.identity=tt.prototype.identity,tt.prototype.init=tt.prototype.init,tt.prototype.add=tt.prototype.add,tt.prototype.sub=tt.prototype.sub,tt.prototype.scale=tt.prototype.scale,tt.prototype.addEq=tt.prototype.addEq,tt.prototype.subEq=tt.prototype.subEq,tt.prototype.scaleEq=tt.prototype.scaleEq,tt.prototype.length=tt.prototype.length,tt.prototype.lengthSq=tt.prototype.lengthSq,tt.prototype.dot=tt.prototype.dot,tt.prototype.normalized=tt.prototype.normalized,tt.prototype.normalize=tt.prototype.normalize,tt.prototype.setArc=tt.prototype.setArc,tt.prototype.slerp=tt.prototype.slerp,tt.prototype.copyFrom=tt.prototype.copyFrom,tt.prototype.clone=tt.prototype.clone,tt.prototype.fromMat3=tt.prototype.fromMat3,tt.prototype.toMat3=tt.prototype.toMat3,tt.prototype.toString=tt.prototype.toString,t.OIMO.Contact=it,it.prototype.getShape1=it.prototype.getShape1,it.prototype.getShape2=it.prototype.getShape2,it.prototype.isTouching=it.prototype.isTouching,it.prototype.getManifold=it.prototype.getManifold,it.prototype.getContactConstraint=it.prototype.getContactConstraint,it.prototype.getPrev=it.prototype.getPrev,it.prototype.getNext=it.prototype.getNext,t.OIMO.ContactLink=at,at.prototype.getContact=at.prototype.getContact,at.prototype.getOther=at.prototype.getOther,at.prototype.getPrev=at.prototype.getPrev,at.prototype.getNext=at.prototype.getNext,t.OIMO.ContactManager=ot,ot.prototype.getNumContacts=ot.prototype.getNumContacts,ot.prototype.getContactList=ot.prototype.getContactList,t.OIMO.TimeStep=st,t.OIMO.World=rt,rt.prototype.step=rt.prototype.step,rt.prototype.addRigidBody=rt.prototype.addRigidBody,rt.prototype.removeRigidBody=rt.prototype.removeRigidBody,rt.prototype.addJoint=rt.prototype.addJoint,rt.prototype.removeJoint=rt.prototype.removeJoint,rt.prototype.setDebugDraw=rt.prototype.setDebugDraw,rt.prototype.getDebugDraw=rt.prototype.getDebugDraw,rt.prototype.debugDraw=rt.prototype.debugDraw,rt.prototype.rayCast=rt.prototype.rayCast,rt.prototype.convexCast=rt.prototype.convexCast,rt.prototype.aabbTest=rt.prototype.aabbTest,rt.prototype.getRigidBodyList=rt.prototype.getRigidBodyList,rt.prototype.getJointList=rt.prototype.getJointList,rt.prototype.getBroadPhase=rt.prototype.getBroadPhase,rt.prototype.getContactManager=rt.prototype.getContactManager,rt.prototype.getNumRigidBodies=rt.prototype.getNumRigidBodies,rt.prototype.getNumJoints=rt.prototype.getNumJoints,rt.prototype.getNumShapes=rt.prototype.getNumShapes,rt.prototype.getNumIslands=rt.prototype.getNumIslands,rt.prototype.getNumVelocityIterations=rt.prototype.getNumVelocityIterations,rt.prototype.setNumVelocityIterations=rt.prototype.setNumVelocityIterations,rt.prototype.getNumPositionIterations=rt.prototype.getNumPositionIterations,rt.prototype.setNumPositionIterations=rt.prototype.setNumPositionIterations,rt.prototype.getGravity=rt.prototype.getGravity,rt.prototype.setGravity=rt.prototype.setGravity,t.OIMO.AabbTestCallback=lt,t.OIMO.ContactCallback=ct,t.OIMO.RayCastCallback=pt,t.OIMO.RayCastClosest=vt,vt.prototype.clear=vt.prototype.clear,vt.prototype.process=vt.prototype.process,t.OIMO.DebugDrawStyle=bt,t.OIMO.Performance=ft,t.OIMO.ConstraintSolver=xt,xt.prototype.preSolveVelocity=xt.prototype.preSolveVelocity,xt.prototype.warmStart=xt.prototype.warmStart,xt.prototype.solveVelocity=xt.prototype.solveVelocity,xt.prototype.postSolveVelocity=xt.prototype.postSolveVelocity,xt.prototype.preSolvePosition=xt.prototype.preSolvePosition,xt.prototype.solvePositionSplitImpulse=xt.prototype.solvePositionSplitImpulse,xt.prototype.solvePositionNgs=xt.prototype.solvePositionNgs,xt.prototype.postSolve=xt.prototype.postSolve,t.OIMO.PositionCorrectionAlgorithm=ut,t.OIMO.ContactConstraint=yt,yt.prototype.getShape1=yt.prototype.getShape1,yt.prototype.getShape2=yt.prototype.getShape2,yt.prototype.getManifold=yt.prototype.getManifold,yt.prototype.isTouching=yt.prototype.isTouching,t.OIMO.Manifold=Xt,Xt.prototype.getNormal=Xt.prototype.getNormal,Xt.prototype.getNormalTo=Xt.prototype.getNormalTo,Xt.prototype.getTangent=Xt.prototype.getTangent,Xt.prototype.getTangentTo=Xt.prototype.getTangentTo,Xt.prototype.getBinormal=Xt.prototype.getBinormal,Xt.prototype.getBinormalTo=Xt.prototype.getBinormalTo,Xt.prototype.getPoints=Xt.prototype.getPoints,Xt.prototype.getNumPoints=Xt.prototype.getNumPoints,t.OIMO.ManifoldPoint=zt,zt.prototype.getPosition1=zt.prototype.getPosition1,zt.prototype.getPosition1To=zt.prototype.getPosition1To,zt.prototype.getPosition2=zt.prototype.getPosition2,zt.prototype.getPosition2To=zt.prototype.getPosition2To,zt.prototype.getDepth=zt.prototype.getDepth,zt.prototype.isWarmStarted=zt.prototype.isWarmStarted,zt.prototype.getNormalImpulse=zt.prototype.getNormalImpulse,zt.prototype.getTangentImpulse=zt.prototype.getTangentImpulse,zt.prototype.getBinormalImpulse=zt.prototype.getBinormalImpulse,zt.prototype.isEnabled=zt.prototype.isEnabled,t.OIMO.Joint=Lt,Lt.prototype.getRigidBody1=Lt.prototype.getRigidBody1,Lt.prototype.getRigidBody2=Lt.prototype.getRigidBody2,Lt.prototype.getType=Lt.prototype.getType,Lt.prototype.getAnchor1=Lt.prototype.getAnchor1,Lt.prototype.getAnchor2=Lt.prototype.getAnchor2,Lt.prototype.getAnchor1To=Lt.prototype.getAnchor1To,Lt.prototype.getAnchor2To=Lt.prototype.getAnchor2To,Lt.prototype.getLocalAnchor1=Lt.prototype.getLocalAnchor1,Lt.prototype.getLocalAnchor2=Lt.prototype.getLocalAnchor2,Lt.prototype.getLocalAnchor1To=Lt.prototype.getLocalAnchor1To,Lt.prototype.getLocalAnchor2To=Lt.prototype.getLocalAnchor2To,Lt.prototype.getBasis1=Lt.prototype.getBasis1,Lt.prototype.getBasis2=Lt.prototype.getBasis2,Lt.prototype.getBasis1To=Lt.prototype.getBasis1To,Lt.prototype.getBasis2To=Lt.prototype.getBasis2To,Lt.prototype.getAllowCollision=Lt.prototype.getAllowCollision,Lt.prototype.setAllowCollision=Lt.prototype.setAllowCollision,Lt.prototype.getBreakForce=Lt.prototype.getBreakForce,Lt.prototype.setBreakForce=Lt.prototype.setBreakForce,Lt.prototype.getBreakTorque=Lt.prototype.getBreakTorque,Lt.prototype.setBreakTorque=Lt.prototype.setBreakTorque,Lt.prototype.getPositionCorrectionAlgorithm=Lt.prototype.getPositionCorrectionAlgorithm,Lt.prototype.setPositionCorrectionAlgorithm=Lt.prototype.setPositionCorrectionAlgorithm,Lt.prototype.getAppliedForce=Lt.prototype.getAppliedForce,Lt.prototype.getAppliedForceTo=Lt.prototype.getAppliedForceTo,Lt.prototype.getAppliedTorque=Lt.prototype.getAppliedTorque,Lt.prototype.getAppliedTorqueTo=Lt.prototype.getAppliedTorqueTo,Lt.prototype.getPrev=Lt.prototype.getPrev,Lt.prototype.getNext=Lt.prototype.getNext,t.OIMO.CylindricalJoint=wt,wt.prototype.getAxis1=wt.prototype.getAxis1,wt.prototype.getAxis2=wt.prototype.getAxis2,wt.prototype.getAxis1To=wt.prototype.getAxis1To,wt.prototype.getAxis2To=wt.prototype.getAxis2To,wt.prototype.getLocalAxis1=wt.prototype.getLocalAxis1,wt.prototype.getLocalAxis2=wt.prototype.getLocalAxis2,wt.prototype.getLocalAxis1To=wt.prototype.getLocalAxis1To,wt.prototype.getLocalAxis2To=wt.prototype.getLocalAxis2To,wt.prototype.getTranslationalSpringDamper=wt.prototype.getTranslationalSpringDamper,wt.prototype.getRotationalSpringDamper=wt.prototype.getRotationalSpringDamper,wt.prototype.getTranslationalLimitMotor=wt.prototype.getTranslationalLimitMotor,wt.prototype.getRotationalLimitMotor=wt.prototype.getRotationalLimitMotor,wt.prototype.getAngle=wt.prototype.getAngle,wt.prototype.getTranslation=wt.prototype.getTranslation,t.OIMO.JointConfig=At,t.OIMO.CylindricalJointConfig=kt,kt.prototype.init=kt.prototype.init,t.OIMO.JointLink=Tt,Tt.prototype.getContact=Tt.prototype.getContact,Tt.prototype.getOther=Tt.prototype.getOther,Tt.prototype.getPrev=Tt.prototype.getPrev,Tt.prototype.getNext=Tt.prototype.getNext,t.OIMO.JointType=St,t.OIMO.PrismaticJoint=Ct,Ct.prototype.getAxis1=Ct.prototype.getAxis1,Ct.prototype.getAxis2=Ct.prototype.getAxis2,Ct.prototype.getAxis1To=Ct.prototype.getAxis1To,Ct.prototype.getAxis2To=Ct.prototype.getAxis2To,Ct.prototype.getLocalAxis1=Ct.prototype.getLocalAxis1,Ct.prototype.getLocalAxis2=Ct.prototype.getLocalAxis2,Ct.prototype.getLocalAxis1To=Ct.prototype.getLocalAxis1To,Ct.prototype.getLocalAxis2To=Ct.prototype.getLocalAxis2To,Ct.prototype.getSpringDamper=Ct.prototype.getSpringDamper,Ct.prototype.getLimitMotor=Ct.prototype.getLimitMotor,Ct.prototype.getTranslation=Ct.prototype.getTranslation,t.OIMO.PrismaticJointConfig=qt,qt.prototype.init=qt.prototype.init,t.OIMO.RagdollJoint=Rt,Rt.prototype.getAxis1=Rt.prototype.getAxis1,Rt.prototype.getAxis2=Rt.prototype.getAxis2,Rt.prototype.getAxis1To=Rt.prototype.getAxis1To,Rt.prototype.getAxis2To=Rt.prototype.getAxis2To,Rt.prototype.getLocalAxis1=Rt.prototype.getLocalAxis1,Rt.prototype.getLocalAxis2=Rt.prototype.getLocalAxis2,Rt.prototype.getLocalAxis1To=Rt.prototype.getLocalAxis1To,Rt.prototype.getLocalAxis2To=Rt.prototype.getLocalAxis2To,Rt.prototype.getTwistSpringDamper=Rt.prototype.getTwistSpringDamper,Rt.prototype.getTwistLimitMotor=Rt.prototype.getTwistLimitMotor,Rt.prototype.getSwingSpringDamper=Rt.prototype.getSwingSpringDamper,Rt.prototype.getSwingAxis=Rt.prototype.getSwingAxis,Rt.prototype.getSwingAxisTo=Rt.prototype.getSwingAxisTo,Rt.prototype.getSwingAngle=Rt.prototype.getSwingAngle,Rt.prototype.getTwistAngle=Rt.prototype.getTwistAngle,t.OIMO.RagdollJointConfig=Et,Et.prototype.init=Et.prototype.init,t.OIMO.RevoluteJoint=jt,jt.prototype.getAxis1=jt.prototype.getAxis1,jt.prototype.getAxis2=jt.prototype.getAxis2,jt.prototype.getAxis1To=jt.prototype.getAxis1To,jt.prototype.getAxis2To=jt.prototype.getAxis2To,jt.prototype.getLocalAxis1=jt.prototype.getLocalAxis1,jt.prototype.getLocalAxis2=jt.prototype.getLocalAxis2,jt.prototype.getLocalAxis1To=jt.prototype.getLocalAxis1To,jt.prototype.getLocalAxis2To=jt.prototype.getLocalAxis2To,jt.prototype.getSpringDamper=jt.prototype.getSpringDamper,jt.prototype.getLimitMotor=jt.prototype.getLimitMotor,jt.prototype.getAngle=jt.prototype.getAngle,t.OIMO.RevoluteJointConfig=Nt,Nt.prototype.init=Nt.prototype.init,t.OIMO.RotationalLimitMotor=Dt,Dt.prototype.setLimits=Dt.prototype.setLimits,Dt.prototype.setMotor=Dt.prototype.setMotor,Dt.prototype.clone=Dt.prototype.clone,t.OIMO.SphericalJoint=Ft,Ft.prototype.getSpringDamper=Ft.prototype.getSpringDamper,t.OIMO.SphericalJointConfig=Ot,Ot.prototype.init=Ot.prototype.init,t.OIMO.SpringDamper=Wt,Wt.prototype.setSpring=Wt.prototype.setSpring,Wt.prototype.setSymplecticEuler=Wt.prototype.setSymplecticEuler,Wt.prototype.clone=Wt.prototype.clone,t.OIMO.TranslationalLimitMotor=Gt,Gt.prototype.setLimits=Gt.prototype.setLimits,Gt.prototype.setMotor=Gt.prototype.setMotor,Gt.prototype.clone=Gt.prototype.clone,t.OIMO.UniversalJoint=Ht,Ht.prototype.getAxis1=Ht.prototype.getAxis1,Ht.prototype.getAxis2=Ht.prototype.getAxis2,Ht.prototype.getAxis1To=Ht.prototype.getAxis1To,Ht.prototype.getAxis2To=Ht.prototype.getAxis2To,Ht.prototype.getLocalAxis1=Ht.prototype.getLocalAxis1,Ht.prototype.getLocalAxis2=Ht.prototype.getLocalAxis2,Ht.prototype.getLocalAxis1To=Ht.prototype.getLocalAxis1To,Ht.prototype.getLocalAxis2To=Ht.prototype.getLocalAxis2To,Ht.prototype.getSpringDamper1=Ht.prototype.getSpringDamper1,Ht.prototype.getSpringDamper2=Ht.prototype.getSpringDamper2,Ht.prototype.getLimitMotor1=Ht.prototype.getLimitMotor1,Ht.prototype.getLimitMotor2=Ht.prototype.getLimitMotor2,Ht.prototype.getAngle1=Ht.prototype.getAngle1,Ht.prototype.getAngle2=Ht.prototype.getAngle2,t.OIMO.UniversalJointConfig=Ut,Ut.prototype.init=Ut.prototype.init,t.OIMO.ConstraintSolverType=Jt,t.OIMO.DirectJointConstraintSolver=oi,oi.prototype.preSolveVelocity=oi.prototype.preSolveVelocity,oi.prototype.warmStart=oi.prototype.warmStart,oi.prototype.solveVelocity=oi.prototype.solveVelocity,oi.prototype.postSolveVelocity=oi.prototype.postSolveVelocity,oi.prototype.preSolvePosition=oi.prototype.preSolvePosition,oi.prototype.solvePositionSplitImpulse=oi.prototype.solvePositionSplitImpulse,oi.prototype.solvePositionNgs=oi.prototype.solvePositionNgs,oi.prototype.postSolve=oi.prototype.postSolve,t.OIMO.PgsContactConstraintSolver=si,si.prototype.preSolveVelocity=si.prototype.preSolveVelocity,si.prototype.warmStart=si.prototype.warmStart,si.prototype.solveVelocity=si.prototype.solveVelocity,si.prototype.preSolvePosition=si.prototype.preSolvePosition,si.prototype.solvePositionSplitImpulse=si.prototype.solvePositionSplitImpulse,si.prototype.solvePositionNgs=si.prototype.solvePositionNgs,si.prototype.postSolve=si.prototype.postSolve,t.OIMO.PgsJointConstraintSolver=ri,ri.prototype.preSolveVelocity=ri.prototype.preSolveVelocity,ri.prototype.warmStart=ri.prototype.warmStart,ri.prototype.solveVelocity=ri.prototype.solveVelocity,ri.prototype.postSolveVelocity=ri.prototype.postSolveVelocity,ri.prototype.preSolvePosition=ri.prototype.preSolvePosition,ri.prototype.solvePositionSplitImpulse=ri.prototype.solvePositionSplitImpulse,ri.prototype.solvePositionNgs=ri.prototype.solvePositionNgs,ri.prototype.postSolve=ri.prototype.postSolve,t.OIMO.MassData=ei,t.OIMO.RigidBody=_i,_i.prototype.getPosition=_i.prototype.getPosition,_i.prototype.getPositionTo=_i.prototype.getPositionTo,_i.prototype.setPosition=_i.prototype.setPosition,_i.prototype.translate=_i.prototype.translate,_i.prototype.getRotation=_i.prototype.getRotation,_i.prototype.getRotationTo=_i.prototype.getRotationTo,_i.prototype.setRotation=_i.prototype.setRotation,_i.prototype.setRotationXyz=_i.prototype.setRotationXyz,_i.prototype.rotate=_i.prototype.rotate,_i.prototype.rotateXyz=_i.prototype.rotateXyz,_i.prototype.getOrientation=_i.prototype.getOrientation,_i.prototype.getOrientationTo=_i.prototype.getOrientationTo,_i.prototype.setOrientation=_i.prototype.setOrientation,_i.prototype.getTransform=_i.prototype.getTransform,_i.prototype.getTransformTo=_i.prototype.getTransformTo,_i.prototype.setTransform=_i.prototype.setTransform,_i.prototype.getMass=_i.prototype.getMass,_i.prototype.getLocalInertia=_i.prototype.getLocalInertia,_i.prototype.getLocalInertiaTo=_i.prototype.getLocalInertiaTo,_i.prototype.getMassData=_i.prototype.getMassData,_i.prototype.getMassDataTo=_i.prototype.getMassDataTo,_i.prototype.setMassData=_i.prototype.setMassData,_i.prototype.getRotationFactor=_i.prototype.getRotationFactor,_i.prototype.setRotationFactor=_i.prototype.setRotationFactor,_i.prototype.getLinearVelocity=_i.prototype.getLinearVelocity,_i.prototype.getLinearVelocityTo=_i.prototype.getLinearVelocityTo,_i.prototype.setLinearVelocity=_i.prototype.setLinearVelocity,_i.prototype.getAngularVelocity=_i.prototype.getAngularVelocity,_i.prototype.getAngularVelocityTo=_i.prototype.getAngularVelocityTo,_i.prototype.setAngularVelocity=_i.prototype.setAngularVelocity,_i.prototype.addLinearVelocity=_i.prototype.addLinearVelocity,_i.prototype.addAngularVelocity=_i.prototype.addAngularVelocity,_i.prototype.applyImpulse=_i.prototype.applyImpulse,_i.prototype.applyLinearImpulse=_i.prototype.applyLinearImpulse,_i.prototype.applyAngularImpulse=_i.prototype.applyAngularImpulse,_i.prototype.applyForce=_i.prototype.applyForce,_i.prototype.applyForceToCenter=_i.prototype.applyForceToCenter,_i.prototype.applyTorque=_i.prototype.applyTorque,_i.prototype.getGravityScale=_i.prototype.getGravityScale,_i.prototype.setGravityScale=_i.prototype.setGravityScale,_i.prototype.getLocalPoint=_i.prototype.getLocalPoint,_i.prototype.getLocalPointTo=_i.prototype.getLocalPointTo,_i.prototype.getLocalVector=_i.prototype.getLocalVector,_i.prototype.getLocalVectorTo=_i.prototype.getLocalVectorTo,_i.prototype.getWorldPoint=_i.prototype.getWorldPoint,_i.prototype.getWorldPointTo=_i.prototype.getWorldPointTo,_i.prototype.getWorldVector=_i.prototype.getWorldVector,_i.prototype.getWorldVectorTo=_i.prototype.getWorldVectorTo,_i.prototype.getNumShapes=_i.prototype.getNumShapes,_i.prototype.getShapeList=_i.prototype.getShapeList,_i.prototype.getNumContectLinks=_i.prototype.getNumContectLinks,_i.prototype.getContactLinkList=_i.prototype.getContactLinkList,_i.prototype.getNumJointLinks=_i.prototype.getNumJointLinks,_i.prototype.getJointLinkList=_i.prototype.getJointLinkList,_i.prototype.addShape=_i.prototype.addShape,_i.prototype.removeShape=_i.prototype.removeShape,_i.prototype.getType=_i.prototype.getType,_i.prototype.setType=_i.prototype.setType,_i.prototype.wakeUp=_i.prototype.wakeUp,_i.prototype.sleep=_i.prototype.sleep,_i.prototype.isSleeping=_i.prototype.isSleeping,_i.prototype.getSleepTime=_i.prototype.getSleepTime,_i.prototype.setAutoSleep=_i.prototype.setAutoSleep,_i.prototype.getLinearDamping=_i.prototype.getLinearDamping,_i.prototype.setLinearDamping=_i.prototype.setLinearDamping,_i.prototype.getAngularDamping=_i.prototype.getAngularDamping,_i.prototype.setAngularDamping=_i.prototype.setAngularDamping,_i.prototype.getPrev=_i.prototype.getPrev,_i.prototype.getNext=_i.prototype.getNext,t.OIMO.RigidBodyConfig=function(){this.position=new F,this.rotation=new J,this.linearVelocity=new F,this.angularVelocity=new F,this.type=0,this.autoSleep=!0,this.linearDamping=0,this.angularDamping=0},t.OIMO.RigidBodyType=hi,t.OIMO.Shape=li,li.prototype.getFriction=li.prototype.getFriction,li.prototype.setFriction=li.prototype.setFriction,li.prototype.getRestitution=li.prototype.getRestitution,li.prototype.setRestitution=li.prototype.setRestitution,li.prototype.getLocalTransform=li.prototype.getLocalTransform,li.prototype.getLocalTransformTo=li.prototype.getLocalTransformTo,li.prototype.getTransform=li.prototype.getTransform,li.prototype.getTransformTo=li.prototype.getTransformTo,li.prototype.setLocalTransform=li.prototype.setLocalTransform,li.prototype.getDensity=li.prototype.getDensity,li.prototype.setDensity=li.prototype.setDensity,li.prototype.getAabb=li.prototype.getAabb,li.prototype.getAabbTo=li.prototype.getAabbTo,li.prototype.getGeometry=li.prototype.getGeometry,li.prototype.getRigidBody=li.prototype.getRigidBody,li.prototype.getCollisionGroup=li.prototype.getCollisionGroup,li.prototype.setCollisionGroup=li.prototype.setCollisionGroup,li.prototype.getCollisionMask=li.prototype.getCollisionMask,li.prototype.setCollisionMask=li.prototype.setCollisionMask,li.prototype.getContactCallback=li.prototype.getContactCallback,li.prototype.setContactCallback=li.prototype.setContactCallback,li.prototype.getPrev=li.prototype.getPrev,li.prototype.getNext=li.prototype.getNext,t.OIMO.ShapeConfig=function(){this.position=new F,this.rotation=new J,this.friction=W.defaultFriction,this.restitution=W.defaultRestitution,this.density=W.defaultDensity,this.collisionGroup=W.defaultCollisionGroup,this.collisionMask=W.defaultCollisionMask,this.geometry=null,this.contactCallback=null}}(window);