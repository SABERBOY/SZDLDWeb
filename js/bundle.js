!function(){"use strict";class t{constructor(){}static init(){Laya.ClassUtils.regClass}}t.width=750,t.height=1334,t.scaleMode="fixedwidth",t.screenMode="none",t.alignV="top",t.alignH="left",t.startScene="",t.sceneRoot="",t.debug=!1,t.stat=!1,t.physicsDebug=!1,t.exportSceneToJson=!0,t.init();class e{static addScrCon(t){}static addCommonCon(){}}class i{}i.logStyle="\n        color: #fff;\n        background-color: #8d93ab;\n        border-radius: 3px;\n        line-height: 15px;\n        ",i.logLightStyle="\n        color: #52575d;\n        background-color: #EBEBEB;\n        border-radius: 3px;\n        line-height: 15px;\n        ",i.comStyle="\n        color: #fff;\n        background-color: #ade498;\n        border-radius: 3px;\n        line-height: 15px;\n        ",i.warnStyle="\n        color: #5c6e06;\n        background-color: #ffa931;\n        border-radius: 3px;\n        line-height: 15px;\n        ",i.errorStyle="\n        color: #fff;\n        background-color: #ec0101;\n        border-radius: 3px;\n        line-height: 15px;\n        ",i.platformStyle="\n        color: #52575d;\n        background-color: #e3fdfd;\n        border-radius: 3px;\n        line-height: 15px;\n        ";class s{static log(...t){console.log(`%c ${t}`,i.logStyle)}static warn(...t){console.log(`%c ${t}`,i.warnStyle)}static error(...t){console.log(`%c ${t}`,i.errorStyle)}static packLog(...t){return[`%c ${t} `,i.logStyle]}static packLogLight(...t){return[`%c ${t} `,i.logLightStyle]}static comLog(...t){return[`%c ${t} `,i.comStyle]}static packWarn(...t){return[`%c 警告: ${t} `,i.warnStyle]}static packError(...t){return[`%c 错误: ${t} `,i.errorStyle]}static packPlatform(...t){return[`%c 平台: ${t} `,i.platformStyle]}}class a{static Load(t,e,i=null){if(i&&i.once&&(i.once=!1),!t||0==t.length)return e.run(),void i.run();Laya.loader.create(t,e,i)}static Load2d(t,e,i=null){if(i&&i.once&&(i.once=!1),!t||0==t.length)return e.run(),void i.run();Laya.loader.load(t,e,i)}static LoadAsync(t,e=null){return new Promise(i=>{a.Load(t,Laya.Handler.create(null,()=>{i()}),e)})}static Load2dAsync(t,e=null){return new Promise(function(i){a.Load2d(t,Laya.Handler.create(null,()=>{i()}),e)})}static Get(t,e=!1){let i=Laya.loader.getRes(t);return null==i?(console.log(...s.packError("资源尚未加载",t)),null):e?i:i.clone()}static LoadAndGet(t,e=!1){return new Promise(i=>{a.LoadAsync(t).then(s=>{i(a.Get(t,e))})})}static Unload(t){Laya.loader.clearRes(t)}}class n{static parseVector3(t,e){var i=t.split(",");e.setValue(Number(i[0]),Number(i[1]),Number(i[2]))}static setV3Length(t,e){let i=Laya.Vector3.scalarLength(t);if(0!=i){let s=e/i;t.x=t.x*s,t.y=t.y*s,t.z=t.z*s}}static PotLerpMove(t,e,i,s,a){if(!s)return void console.error("必须有一个输出的向量！");let n=Laya.Vector3.distance(t,e);return Laya.Vector3.lerp(t,e,i,s),1-n/a}static PotConstantSpeedMove(t,e,i,s){if(!s)return void console.error("必须有一个输出的向量！");let a,n=new Laya.Vector3;return Laya.Vector3.subtract(e,t,n),Laya.Vector3.scalarLength(n)>i?(this.setV3Length(n,i),a=!1):a=!0,Laya.Vector3.add(t,n,s),a}}class r{static initNode(t,e){t.name=e.name,e.position?n.parseVector3(e.position,t.transform.localPosition):t.transform.localPosition.setValue(0,0,0),t.transform.localPosition=t.transform.localPosition,e.euler?n.parseVector3(e.euler,t.transform.localRotationEuler):t.transform.localRotationEuler.setValue(0,0,0),t.transform.localRotationEuler=t.transform.localRotationEuler,e.scale?n.parseVector3(e.scale,t.transform.localScale):t.transform.localScale.setValue(1,1,1),t.transform.localScale=t.transform.localScale,"undefined"!=(e=e).prefabName&&e.differ&&this.setDiffer(t,e.differ)}static setDiffer(t,e){if(e.child)for(let i of e.child)this.setDiffer(t.getChildAt(i.index),i);e.position&&(n.parseVector3(e.position,this._centreV3),Laya.Vector3.add(t.transform.localPosition,this._centreV3,this._centreV3),this._centreV3.cloneTo(t.transform.localPosition),t.transform.localPosition=t.transform.localPosition),e.euler&&(n.parseVector3(e.euler,this._centreV3),Laya.Vector3.add(t.transform.localRotationEuler,this._centreV3,this._centreV3),this._centreV3.cloneTo(t.transform.localRotationEuler),t.transform.localRotationEuler=t.transform.localRotationEuler),e.scale&&(n.parseVector3(e.scale,this._centreV3),Laya.Vector3.add(t.transform.localScale,this._centreV3,this._centreV3),this._centreV3.cloneTo(t.transform.localScale),t.transform.localScale=t.transform.localScale)}}r._centreV3=new Laya.Vector3;class l{static get Datas(){return this.m_datas}static set Datas(t){this.m_datas=t}static get Handlers(){return this.m_handlers}static set Handlers(t){this.m_handlers=t}}l.m_ifSetProxy=!1;class h extends l{}class d{constructor(){this.Prefabs0="@library@@canteen@@waterRoom@@maleSink@@toilet@@peeArea@@famaleSink@@waitAera@",this.Prefabs1="@Building@@Plane@@YY@",this.Prefabs2="@Toilet@@Potted@",this.Prefabs3="@man_actionhero@@man_butler@@man_cyclist@@man_doctor@@man_metalhead@@man_naval_officer@@man_paramedic@@man_pilot@@man_reporter@@man_scientist@@man_skate@@man_tennis@",this.Prefabs4="@woman_basketball_player@@woman_carpenter@@woman_casual@@woman_dentist@@woman_doctor@@woman_metalhead@@woman_tennis@@woman_wh@@female_worker@@male_worker@",this.Prefabs5="@caidai@@cleaning@@emoji_money@@emoji_angry@@emoji_cry@@emoji_cute@@emoji_dead@@emoji_happy@@emoji_poop@@emoji_sick@@pee@@money@@hushen@@shui@@urine@@pg@@yan@@sink_Damage@@sink_Dirty@@toilet_damage@@toilet_dirty@@pee_dirty@@pee_Damage@@cleanRoom@@Entrance@@Exit@@door@@male_wall@@female_wall@@VendingMachine@@limit@@ZS@",this.Export=""}}var u,m;!function(t){t.Export="export"}(u||(u={}));class _ extends d{}class g{static get defaultLevelSceneName(){return u.Export}}!function(t){t.RootRes="res",t.Config="Config",t.Font="Font",t.FGUI="FGUI",t.LvConfig="LvConfig",t.Other="Other",t.icon="icon",t.img="img",t.music="music",t.sound="sound",t.skin="skin"}(m||(m={}));class p{}p.CDNURLs=[];class f{}f.subpackages=[{name:"res",root:"res/"},{name:"Prefabs0",root:"Prefabs0/"},{name:"Prefabs1",root:"Prefabs1/"},{name:"Prefabs2",root:"Prefabs2/"},{name:"Prefabs3",root:"Prefabs3/"},{name:"Prefabs4",root:"Prefabs4/"},{name:"Prefabs5",root:"Prefabs5/"}];class y{constructor(){this.m_KeyResList={},this.m_KeyResList_={},this.m_KeyResList={[m.RootRes]:m.RootRes+"/",[m.Config]:m.RootRes+"/"+m.Config+"/",[m.FGUI]:m.RootRes+"/"+m.FGUI+"/",[m.LvConfig]:m.RootRes+"/"+m.LvConfig+"/",[m.Font]:m.RootRes+"/"+m.Font+"/",[m.Other]:m.RootRes+"/"+m.Other+"/",[m.icon]:m.RootRes+"/"+m.Other+"/"+m.icon+"/",[m.img]:m.RootRes+"/"+m.Other+"/"+m.img+"/",[m.music]:m.RootRes+"/"+m.Other+"/"+m.music+"/",[m.sound]:m.RootRes+"/"+m.Other+"/"+m.sound+"/",[m.skin]:m.RootRes+"/"+m.Other+"/"+m.skin+"/"};let t=new _;for(let e in t)m[e]=e,this.m_KeyResList[m[e]]=m.RootRes+"/"+m[e]+"/",console.log(...s.packLogLight("注入预制体资源路径",this.m_KeyResList[m[e]]));for(let t in this.m_KeyResList)this.m_KeyResList_[t]=this.m_KeyResList[t];this.setRes()}static get instance(){return null==this._instance&&(this._instance=new y),this._instance}setRes(){for(let t of f.subpackages)this.editKeyResList(t.name,t.root);for(let t of p.CDNURLs)this.editKeyResList(t.name,t.root)}ifKeyRes(t){let e=!1;for(let i in m)if(t==m[i]){e=!0;break}return e}getResURL(t){return this.m_KeyResList[t]}editKeyResList(t,e){let i=this.m_KeyResList_[t];if(i){console.log(...s.packLog("修改关键点资源路径",i,"替换成",e));for(let t in this.m_KeyResList)this.m_KeyResList[t]=this.m_KeyResList[t].replace(i,e);this.m_KeyResList_[t]=e}else console.log(...s.packWarn("修改资源路径失败，没有"+t+"这个关键路径！"))}}class S{static EssentialOtherResUrl(){return[]}static levelConfigURL(t){return y.instance.getResURL(m.LvConfig)+t+".json"}static ConfigURL(t){return y.instance.getResURL(m.Config)+t}static FGUIPack(t){return y.instance.getResURL(m.FGUI)+t}static prefab_url(t){for(let e in this._AllPrefabsNames)if(-1!=this._AllPrefabsNames[e].indexOf("@"+t+"@"))return y.instance.getResURL(m[e])+"Conventional/"+t+".lh";console.log(...s.packError("没有在场景找到预制体",t,"可能是没有导出场景预制体列表导致的。"))}}S._AllPrefabsNames=new _;class I{static Unique(t){return Array.from(new Set(t))}static ReverseReserveUnique(t){return Array.from(new Set(t.reverse())).reverse()}static ObjUnique(t,e){for(let i=0,s=t.length;i<s;i++)for(let s=i+1,a=t.length;s<a;s++)e(t[i])===e(t[s])&&(t.splice(s,1),s--,a--);return t}static Replace(t,e,i){let s=t.indexOf(e);return!(s<0)&&(t.splice(s,1,i),!0)}static RemoveItem(t,e){let i=t.indexOf(e);return!(i<0)&&(t.splice(i,1),!0)}static RemoveAt(t,e){return!(t.length<=e)&&(t.splice(e,1),!0)}static Contains(t,e){return t.indexOf(e)>=0}static Copy(t){let e=[];for(let i=0;i<t.length;++i)e.push(t[i]);return e}static upsetArray(t){t.sort(()=>Math.random()-.5)}static RandomGet(t,e=1,i=t.map(t=>1)){if(t.length<=0)return;let s,a=[],n=[],o=[],r=i[0];i.forEach(t=>{r=Math.min(r,t)}),i=i.map(t=>Math.floor(t*(1/r))),t.forEach((t,e)=>{a.push(t);for(let t=0;t<i[e];t++)o.push(e)});for(let t=0;t<e&&!(a.length<=0);t++)s=Math.floor(Math.random()*o.length),o=o.filter(t=>t!=s),n.push(a.splice(o[s],1)[0]);return n}}class w{constructor(t,e,i){this._prefabRes=[],this.m_affiliateResURLs=[],this.prefabs={},this.sprite3Ds=[],this.sceneNode=t,this.sceneNode_=e,this._lvConfig=i}get ifDestroy(){return!Boolean(this._scene)}get scene(){return this._scene}set affiliateResURLs(t){this.m_affiliateResURLs=t}get affiliateResURLs(){return this.m_affiliateResURLs}get allResURLs(){let t=this.scenePrefabUrl();return t.push(...this.m_affiliateResURLs),t}addAffiliateResURLs(t){t.length<=0||(this.m_affiliateResURLs.push(...t),this.m_affiliateResURLs=I.Unique(this.m_affiliateResURLs))}loadRes(t=null){return a.LoadAsync(this.allResURLs,t)}buildScene(t=null){return new Promise(e=>{if(this._scene)return console.log(...s.packWarn("重复构建关卡，请注意")),void e(this._scene);console.log(...s.packLog("开始构建关卡->"+this._lvConfig.key)),this.loadRes(t).then(()=>{this._scene=new Laya.Sprite3D,h.s3d.addChild(this._scene);for(let t in this.sceneNode){let e=new Laya.Sprite3D;e.name=t,this._scene.addChild(e),this._buildScene(this.sceneNode[t],e)}console.log(...s.packLog("关卡->"+this._lvConfig.key+"构建完成")),console.log("关卡->"+this._lvConfig.key,"\n场景->",this._scene,"\n预制体->",this.prefabs,"\n物体->",this.sprite3Ds),e(this._scene)})})}clearScene(){this._scene&&(console.log(...s.packLog("清除关卡->"+this._lvConfig.key)),this._scene.destroy(),this._prefabRes=[],this.prefabs={},this._scene=null,this.sprite3Ds=[])}scenePrefabUrl(){let t=[],e=this.scenePrefabResName();return e&&e.forEach(e=>{t.push(S.prefab_url(e))}),t}sceneDirectPrefabUrl(){let t=[],e=this.sceneDirectPrefabResName();return e&&e.forEach(e=>{t.push(S.prefab_url(e))}),t}scenePreloadPrefabUrl(){let t=[],e=this.scenePreloadPrefabResName();return e&&e.forEach(e=>{t.push(S.prefab_url(e))}),t}scenePrefabResName(){let t=0;for(let e in this.sceneNode)t++;if(0!=t){if(!this._prefabRes||this._prefabRes.length<=0){for(let t in this.sceneNode)this._getPrefabName(this._prefabRes,this.sceneNode[t]);this.sceneNode_&&this.sceneNode_.length>0&&this.sceneNode_.forEach(t=>{this._getPrefabName(this._prefabRes,t)})}return this._prefabRes}console.log(...s.packError("关卡->"+this._lvConfig.key+"<-不存在,或者是没有内容"))}sceneDirectPrefabResName(){let t=[];for(let e in this.sceneNode)this._getPrefabName(t,this.sceneNode[e]);return t}scenePreloadPrefabResName(){let t=[];return this.sceneNode_.forEach(e=>{this._getPrefabName(t,e)}),t}_getPrefabName(t,e){if(e){let i=e.prefabName;i?(e=e,t.indexOf(i)<0&&t.push(i)):(e=e).child&&e.child.forEach(e=>{this._getPrefabName(t,e)})}}_buildScene(t,e){let i=t.prefabName;if(i){t=t;let s=a.Get(S.prefab_url(i));s&&(r.initNode(s,t),e.addChild(s),this.prefabs[i]=this.prefabs[i]||[],this.prefabs[i].push(s),this.sprite3Ds.push(s))}else if((t=t).child){let i=new Laya.Sprite3D;r.initNode(i,t),e.addChild(i),t.child.forEach(t=>{this._buildScene(t,i)})}}}class C{static set sevelConfig(t){this.m_sevelConfig=t}static initCamera(t,e=g.defaultLevelSceneName){let i=this.m_sevelConfig[e].camera;i&&r.initNode(t,i)}static initLight(t,e=g.defaultLevelSceneName){let i=this.m_sevelConfig[e].light;i&&r.initNode(t,i)}}var b,L,v,A,x,k,P,D;C.m_sevelConfig={},function(t){t.config=class{},t.path="res/config/LevelConfig.json"}(b||(b={}));class U{constructor(){this.initData()}initData(){}}class T extends U{get dataList(){return this.m_dataList}}class R extends U{get data(){return this.m_data}}class O extends T{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new O),this._instance}initData(){this.m_dataList=b.dataList}getLevelNumber(){let t=0;return this.m_dataList.forEach(e=>{e.id>0&&t++}),t}byIdGetData(t){return this.m_dataList.find(e=>e.id==t)}}!function(t){t.config=class{},t.path="res/config/OtherLevelConfig.json"}(L||(L={}));class M extends T{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new M),this._instance}initData(){this.m_dataList=L.dataList}byIdGetData(t){return this.m_dataList.find(e=>e.id==t)}byNameGetData(t){return this.m_dataList.find(e=>e.name==t)}}class E{static byLevelIdGetLevelData(t){let e=O.instance.byIdGetData(t);return this.getLevelData("ID",e.sceneName,e.sceneOtherRes,e.rootScene)}static byLevelNameGetOtherLevelData(t){let e=M.instance.byNameGetData(t);return this.getLevelData("Name",e.sceneName,e.sceneOtherRes,e.rootScene)}static getLevelData(t,e,i,s){return e.replace(/\s+/g,"").replace(/^,+/,"").replace(/,+$/,"").replace(/,+/g,","),i.replace(/\s+/g,"").replace(/^,+/,"").replace(/,+$/,"").replace(/,+/g,","),{key:"$"+s+":"+t+"-"+e,rootScene:s,sceneName:e.split(","),sceneOtherRes:i.split(",")}}}class B{}B.PrestrainLeveId=["prestrain"];class G{constructor(){this._levelConfig={},this._scenes={},C.sevelConfig=this._levelConfig}static get instance(){return null==this._instance&&(this._instance=new G),this._instance}init(){}initConfig(){let t,e;for(let i in u)if(t=u[i]){if(t=S.levelConfigURL(t),(e=a.Get(t,!0)).root){this._levelConfig[u[i]]={};for(let t=0;t<e.root.length;t++){let s=e.root[t];this._levelConfig[u[i]][s.name]=s}}a.Unload(t)}}Preload(t){let e=[];B.PrestrainLeveId.forEach(t=>{e.push(...this.getOtherSceneByName(t).scenePrefabUrl())}),t.push(...e)}preloadSceneRes(t){console.log(...s.packLog("预加载关卡->",t)),this.getSceneByLv(t).loadRes()}preloadOtherSceneRes(t){console.log(...s.packLog("预加载其它关卡->",t)),this.getOtherSceneByName(t).loadRes()}getSceneByLv(t){let e=E.byLevelIdGetLevelData(t);return e||console.log(...s.packError("不存在此关卡->",t)),this._scenes[e.key]||(this._scenes[e.key]=this.getSceneByData(e.key,e)),this._scenes[e.key]}getOtherSceneByName(t){let e=E.byLevelNameGetOtherLevelData(t);return e||console.log(...s.packError("不存在此关卡->",t)),this._scenes[e.key]||(this._scenes[e.key]=this.getSceneByData(e.key,e)),this._scenes[e.key]}getSceneByData(t,e){let i=e.sceneName,a=e.sceneOtherRes,n={},o=[];this._levelConfig[e.rootScene]||console.log(...s.packError("没有找到场景-",e.rootScene," 请先注册。"));for(let t in this._levelConfig[e.rootScene])-1!=i.findIndex(e=>e==t)&&(n[t]=this._levelConfig[e.rootScene][t]),-1!=a.findIndex(e=>e==t)&&o.push(this._levelConfig[e.rootScene][t]);return new w(n,o,e)}getLvResName(t){return this.getSceneByLv(t).scenePrefabResName()}getLvResUrl(t){return this.getSceneByLv(t).scenePrefabUrl()}}class N{}N.gravity=-10,N.ifPreloadCustoms=!1;class F{constructor(){this.m_proList={},this.init(),this.register()}getPro(t){return this.m_proList[t]}init(){}register(){}AllotPre(t){this.allotPrefab(t),this.allotMediator()}allotPrefab(t){}allotMediator(){}AllotOtherScenePre(t,e){this.allotOtherScenePrefab(t,e),this.allotOtherSceneMediator(t)}allotOtherScenePrefab(t,e){}allotOtherSceneMediator(t){}}!function(t){t.CameraPro="EProcessor_CameraPro",t.HeightFogCubePro="EProcessor_HeightFogCubePro"}(v||(v={}));class V{constructor(t){this.m_proTypeof=t}get proTypeof(){return this.m_proTypeof}addScript(t,e,i){let s=t.addComponent(e);return s.setPro(this),s.setData(i),s}}class W extends Laya.Script3D{constructor(){super(...arguments),this.m_proStamp=[]}addProStamp(t){-1==this.m_proStamp.findIndex(e=>e==t)&&this.m_proStamp.push(t)}get proStamp(){return this.m_proStamp}ifAtPro(t){return-1!=this.m_proStamp.findIndex(e=>e==t)}}class j extends V{constructor(t){super(t),this.ifAddProStampScript=!1,this.ifAddParentNode=!1,this.onlyInit()}get sprList(){return this.m_sprList}get parentNode(){return this.m_parentNode}set _vo(t){this.m_vo=t,this.m_vo._initPro(this)}set _mediator(t){this.m_mediator=t,this.m_mediator._initPro(this)}onlyInit(){}_init(){this.ifAddParentNode&&(this.m_parentNode=new Laya.Sprite3D)}startPor(t){this._init(),this.initExtend(),this.init(),this.m_sprList=this.proSpr(t),this.sprInitExtend(),this.sprInit()}addSprAndPor(t){let e=this.proSpr(t);this.m_sprList.push(...e),this.addSprAndProCom(e)}addSprAndProCom(t){}init(){}initExtend(){}setSpr(t){}setSprExtend(t){}sprInit(){}sprInitExtend(){}getSprClass({id:t}){for(let e in this.m_sprIdClassList)if(-1!=this.m_sprIdClassList[e].findIndex(e=>e==t))return e}getAddCommonScrSpr(t){return t}static getProStamp(t){let e=t.getComponent(W);return e?e.proStamp:[]}proSpr(t){let e=[];for(let i in t)t[i]&&(e.push(...t[i]),this.addSprIdClassList(i,t[i]));return e.forEach(t=>{this.ifAddParentNode&&this.m_parentNode.addChild(t),this.addProStampCommonScr(this.getAddCommonScrSpr(t)),this.setSprExtend(t),this.setSpr(t)}),e}addSprIdClassList(t,e){if(!e)return;this.m_sprIdClassList||(this.m_sprIdClassList={}),this.m_sprIdClassList[t]||(this.m_sprIdClassList[t]=[]);let i=e.map(t=>t.id);this.m_sprIdClassList[t].push(...i);let s=new Set(this.m_sprIdClassList[t]);this.m_sprIdClassList[t]=Array.from(s)}addProStampCommonScr(t){if(!this.ifAddProStampScript)return;let e,i;(e=(i=t.getComponent(W))||t.addComponent(W)).addProStamp(this.proTypeof)}}class q extends Laya.Script3D{}class H extends q{get pro(){if(this.m_Pro)return this.m_Pro;console.log(...s.packWarn("->没有找到Pro!<-"))}get data(){return this.m_data}setPro(t){this.m_Pro=t}setData(t){this.m_data=t}}class z extends H{set cameraNode(t){this.m_cameraNode=t,this.m_cameraNodeTransform=t.transform}init(){}onAwake(){this.m_transform=this.owner.transform}onUpdate(){}}class Q{static get zeroV3(){return Q.m_zeroV3.clone()}static get zeroV2(){return Q.m_zeroV2.clone()}}Q.m_zeroV3=new Laya.Vector3(0,0,0),Q.m_zeroV2=new Laya.Vector2(0,0);class J{static RgbToHex(t,e,i){for(var s=(t<<16|e<<8|i).toString(16);s.length<6;)s="0"+s;return"#"+s}static ColorToHex(t){return this.RgbToHex(255*t.r,255*t.g,255*t.b)}static HexToColor(t,e=null){t.startsWith("#")&&(t=t.substring(1));let i=t.substring(0,2),s=t.substring(2,4),a=t.substring(4,6),n=t.substring(6,8),o=parseInt(i,16),r=parseInt(s,16),l=parseInt(a,16),h=e||parseInt(n,16);return new Laya.Color(o/255,r/255,l/255,h)}static ToV3(t){return new Laya.Vector3(t.r,t.g,t.b)}static ToV4(t){return new Laya.Vector4(t.r,t.g,t.b,t.a)}static HexToV3(t){t.startsWith("#")&&(t=t.substring(1));let e=t.substring(0,2),i=t.substring(2,4),s=t.substring(4,6),a=parseInt(e,16),n=parseInt(i,16),o=parseInt(s,16);return new Laya.Vector3(a/255,n/255,o/255)}static HexToV4(t,e=null){t.startsWith("#")&&(t=t.substring(1));let i=t.substring(0,2),s=t.substring(2,4),a=t.substring(4,6),n=t.substring(6,8),o=parseInt(i,16),r=parseInt(s,16),l=parseInt(a,16),h=e||parseInt(n,16);return new Laya.Vector4(o/255,r/255,l/255,h)}}class K{constructor(){this.items={}}set(t,e){return this.items[t]=e,!0}has(t){return this.items.hasOwnProperty(t)}remove(t){return!!this.has(t)&&(delete this.items[t],!0)}get(t){return this.has(t)?this.items[t]:void 0}keys(){return Object.keys(this.items)}get length(){return this.keys().length}clear(){this.items={}}}class Z{}Z.timestep=1/60,Z.iterations=24,Z.broadphase=2,Z.worldscale=1,Z.random=!0,Z.info=!1,Z.gravity=[0,-9.8,0];class Y{constructor(){this._oimoRigDic=new K,this._transformDic=new K,this._oimoOffset=new K,this._oimoRigDicR=new K,this._transformDicR=new K,this._oimoOffsetR=new K,this._tempOimoV3=new OIMO.Vec3,this._tempOimoQuat=new OIMO.Quat,this._tempQuaternion=new Laya.Quaternion,this._init()}get oimoWorld(){return this._oimoWorld}static get instance(){return Y._instance||(Y._instance=new Y),Y._instance}_init(){this._oimoWorld=this.CreateWolrd(),window.oimoWorld=this._oimoWorld}CreateWolrd(){return new OIMO.World({timestep:Z.timestep,iterations:Z.iterations,broadphase:Z.broadphase,worldscale:Z.worldscale,random:Z.random,info:Z.info,gravity:Z.gravity})}_createRigBox(t,e,i,s,a,n="box"){return t.add({type:n,size:[s.x,s.y,s.z],pos:[e.x,e.y,e.z],rot:[i.x,i.y,i.z],move:a,density:10,belongsTo:1,collidesWith:4294967295})}CreateCompoundRig(t,e,i=!0,s=!0,a=!1,n=!1,o=10,r=1,l=4294967295){for(var h=[],c=[],d=[],u=[],m=0;m<e.length;m++){let t=e[m];h.push(t.type),c.push(t.pos.x,t.pos.y,t.pos.z),d.push(t.eular.x,t.eular.y,t.eular.z),u.push(t.size.x,t.size.y,t.size.z)}let _=this.oimoWorld.add({type:h,pos:[t.position.x,t.position.y,t.position.z],rot:[t.rotationEuler.x,t.rotationEuler.y,t.rotationEuler.z],posShape:c,rotShape:d,size:u,move:i,density:o,friction:.999,restitution:.1,isKinematic:n,belongsTo:r,collidesWith:l});return _.id=Y.m_rigId,Y.m_rigId++,s&&(this._oimoRigDic.set(_.id,_),this._transformDic.set(_.id,t),this._oimoOffset.set(_.id,new Laya.Vector3)),a&&(this._oimoRigDicR.set(_.id,_),this._transformDicR.set(_.id,t),this._oimoOffsetR.set(_.id,new Laya.Vector3)),_}static SetCollideData(t,e,i,s,a){for(var n=t.shapes;null!==n;n=n.next)null!=e&&(n.belongsTo=e),null!=i&&(n.collidesWith=i),null!=s&&(n.restitution=s),null!=a&&(n.friction=a)}setCanMove(t,e){e?t.setupMass(OIMO.BODY_DYNAMIC,!1):t.setupMass(OIMO.BODY_STATIC,!1)}clearRig(){this._oimoWorld.clear(),this._oimoRigDic.clear(),this._transformDic.clear(),this._oimoOffset.clear(),this._oimoRigDicR.clear(),this._transformDicR.clear(),this._oimoOffsetR.clear()}addRig(t,e=this._oimoWorld){t&&e.addRigidBody(t)}RemoveRig(t,e=this._oimoWorld,i=!1){t&&(i&&(this._oimoRigDic.remove(t.id),this._transformDic.remove(t.id),this._oimoOffset.remove(t.id),this._oimoRigDicR.remove(t.id),this._transformDicR.remove(t.id),this._oimoOffsetR.remove(t.id)),e.removeRigidBody(t))}AddJoint(t,e,i,s,a,n){return this.oimoWorld.add({type:t,body1:e,body2:i,pos1:null!=s?[s.x,s.y,s.z]:s,pos2:null!=a?[a.x,a.y,a.z]:a,spring:n})}RemoveJoint(t){this.oimoWorld.removeJoint(t)}updateAllTrans(){this._oimoRigDic.keys().forEach(t=>{this.UpdateTrans(this._transformDic.get(t),this._oimoRigDic.get(t),this._oimoOffset.get(t))})}updateAllTransReverse(){this._oimoRigDicR.keys().forEach(t=>{this.UpdateTransReverse(this._transformDicR.get(t),this._oimoRigDicR.get(t))})}UpdateTransReverse(t,e){if(!t||!e||!e.parent)return;let i=t.position;this._tempOimoV3.set(i.x,i.y,i.z),e.awake(),e.setPosition(this._tempOimoV3);let s=t.rotation;this._tempOimoQuat.set(s.x,s.y,s.z,s.w),e.setQuaternion(this._tempOimoQuat)}UpdateTrans(t,e,i){if(!t||!e||!e.parent)return;let s=e.getPosition();if(t.position.x=s.x,t.position.y=s.y,t.position.z=s.z,i&&!this.isZero(i)){let e=i.clone();Laya.Quaternion.createFromYawPitchRoll(this.deg2rad(t.rotationEuler.y),this.deg2rad(t.rotationEuler.x),this.deg2rad(t.rotationEuler.z),this._tempQuaternion),Laya.Vector3.transformQuat(e,this._tempQuaternion,e),Laya.Vector3.subtract(t.position,e,t.position)}t.position=t.position;let a=e.getQuaternion();t.rotation.x=a.x,t.rotation.y=a.y,t.rotation.z=a.z,t.rotation.w=a.w,t.rotation=t.rotation}isZero(t){return Laya.MathUtils3D.isZero(t.x)&&Laya.MathUtils3D.isZero(t.y)&&Laya.MathUtils3D.isZero(t.z)}deg2rad(t){return t*Math.PI/180}GetRig(t){return this._oimoRigDic.get(t)}}Y.m_rigId=0;class X extends Laya.Script3D{onUpdate(){Y.instance.oimoWorld.timeStep=Laya.timer.delta/1e3,Y.instance.oimoWorld.step(),Y.instance.updateAllTrans(),Y.instance.updateAllTransReverse()}}class ${}$.support2D=!1,$.support3D=!0,$.ifAddOimoSystem=!1,$.ifTest=!1;class et{static InitAll(){$.support3D?(this.s3d=Laya.stage.addChildAt(new Laya.Scene3D,0),this.camera=new Laya.Camera,this.s3d.addChild(this.camera),this.light=new Laya.DirectionLight,this.s3d.addChild(this.light),$.ifAddOimoSystem&&this.addOimoSystem(),h.s3d=this.s3d,h.camera=this.camera,h.light=this.light):console.log(...s.packLog("请设置支持3D!"))}static addOimoSystem(){let t=new Laya.Sprite3D;this.s3d.addChild(t),t.addComponent(X)}}!function(t){t.LookAd="_EEventScene_LookAd",t.UnLookAd="_EEventScene_UnLookAd",t.GameLevelsBuild="_EEventScene_GameLevelsBuild",t.GameOtherLevelsBuild="_EEventScene_GameOtherLevelsBuild",t.GameLevelsBuildBefore="_EEventScene_GameLevelsBuildBefore",t.GameLevelsOnBuild="_EEventScene_GameLevelsOnBuild",t.GameLevelsDelete="_EEventScene_GameLevelsDelete",t.GameOtherLevelsDelete="_EEventScene_GameOtherLevelsDelete",t.GameLevelsDeleteBefore="_EEventScene_GameLevelsDeleteBefore",t.GameLevelsOnDelete="_EEventScene_GameLevelsOnDelete",t.GameStart="_EEventScene_Start",t.GameSuspend="_EEventScene_GameSuspend",t.GameGoOn="_EEventScene_GameGoOn",t.GameRestart="_EEventScene_GameRestart",t.GameEnd="_EEventScene_GameEnd",t.GameCom="_EEventScene_GameCom",t.GameWin="_EEventScene_gameWin",t.GameFail="_EEventScene_gameFail",t.RoleDie="_EEventScene_RoleDie",t.RoleRevive="_EEventScene_Revive",t.OnClickBuilding="_Scene_OnClickBuilding",t.UpdateBuildingData="_Scene_UpdateBuildingData",t.UpdateBuildingOutlookEvent="_Scene_UpdateBuildingOutlook",t.UpdateSlotOutLook="UpdateSlotOutLook",t.OnUpdateSlotComplete="OnUpdateSlotComplete",t.DoNext="_EventSceneDONEXT",t.RepairFacility="_EventScene_RepairFacility",t.FacilityRepairComplete="_EventScene_FacilityRepairComplete",t.UpdateMaxFlow="_EventScene_UpdateMaxFlow",t.SetDoorActive="_EventScene_SetDoorActive",t.OpenBuildBlock="_EventScene_OpenBuildBlock",t.AddStaff="_EventScene_AddStaff",t.SceneLoadComplete="_EventScene_SceneLoadComplete",t.NetRedLeaveWC="NetRedLeaveWC"}(A||(A={}));class it extends Laya.EventDispatcher{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new it),this._instance}init(){}eventGlobal(t,e){it.instance.event(t,e)}eventAudio(t,e){it.instance.event(t,e)}eventUI(t,e){it.instance.event(t,e)}event3D(t,e){it.instance.event(t,e)}onGlobal(t,e,i,s){it.instance.on(t,e,i,s)}onAudio(t,e,i,s){it.instance.on(t,e,i,s)}onUI(t,e,i,s){it.instance.on(t,e,i,s)}on3D(t,e,i,s){it.instance.on(t,e,i,s)}onGuide(t,e,i,s){it.instance.on(t,e,i,s)}offGlobal(t,e,i){it.instance.off(t,e,i)}offGuide(t,e,i){it.instance.off(t,e,i)}offAudio(t,e,i){it.instance.off(t,e,i)}offUI(t,e,i){it.instance.off(t,e,i)}off3D(t,e,i){it.instance.off(t,e,i)}}!function(t){t[t.MinLeveNumber=3]="MinLeveNumber",t[t.DefaultLeveId=1]="DefaultLeveId",t[t.DebugLeveId=0]="DebugLeveId",t[t.NewHandLeveId=1]="NewHandLeveId"}(x||(x={}));class st{}st.GameWhatTeam="ShShi",st.GameName="Tycoon",st.GameName_="Bathroom Brawl\nバスルームの乱闘\nWC大乱斗",st.GameExplain="",st.versions="0.0.4",st.OnLine=!0;class at{static SplitToIntArray(t,e){for(var i=t.split(e),s=[],a=0;a<i.length;++a){var n=parseInt(i[a]);isNaN(n)&&(n=0),s.push(n)}return s}static IntArrToStr(t){for(var e="",i=0;i<t.length;++i)e+=t[i].toFixed(0),i<t.length-1&&(e+=",");return e}static IsNullOrEmpty(t){return null==t||""==t}}class nt{constructor(){this._state=new Int32Array(4),this._buffer=new ArrayBuffer(68),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}static hashStr(t,e=!1){return this.onePassHasher.start().appendStr(t).end(e)}static hashAsciiStr(t,e=!1){return this.onePassHasher.start().appendAsciiStr(t).end(e)}static _hex(t){const e=nt.hexChars,i=nt.hexOut;let s,a,n,o;for(o=0;o<4;o+=1)for(a=8*o,s=t[o],n=0;n<8;n+=2)i[a+1+n]=e.charAt(15&s),s>>>=4,i[a+0+n]=e.charAt(15&s),s>>>=4;return i.join("")}static _md5cycle(t,e){let i=t[0],s=t[1],a=t[2],n=t[3];s=((s+=((a=((a+=((n=((n+=((i=((i+=(s&a|~s&n)+e[0]-680876936|0)<<7|i>>>25)+s|0)&s|~i&a)+e[1]-389564586|0)<<12|n>>>20)+i|0)&i|~n&s)+e[2]+606105819|0)<<17|a>>>15)+n|0)&n|~a&i)+e[3]-1044525330|0)<<22|s>>>10)+a|0,s=((s+=((a=((a+=((n=((n+=((i=((i+=(s&a|~s&n)+e[4]-176418897|0)<<7|i>>>25)+s|0)&s|~i&a)+e[5]+1200080426|0)<<12|n>>>20)+i|0)&i|~n&s)+e[6]-1473231341|0)<<17|a>>>15)+n|0)&n|~a&i)+e[7]-45705983|0)<<22|s>>>10)+a|0,s=((s+=((a=((a+=((n=((n+=((i=((i+=(s&a|~s&n)+e[8]+1770035416|0)<<7|i>>>25)+s|0)&s|~i&a)+e[9]-1958414417|0)<<12|n>>>20)+i|0)&i|~n&s)+e[10]-42063|0)<<17|a>>>15)+n|0)&n|~a&i)+e[11]-1990404162|0)<<22|s>>>10)+a|0,s=((s+=((a=((a+=((n=((n+=((i=((i+=(s&a|~s&n)+e[12]+1804603682|0)<<7|i>>>25)+s|0)&s|~i&a)+e[13]-40341101|0)<<12|n>>>20)+i|0)&i|~n&s)+e[14]-1502002290|0)<<17|a>>>15)+n|0)&n|~a&i)+e[15]+1236535329|0)<<22|s>>>10)+a|0,s=((s+=((a=((a+=((n=((n+=((i=((i+=(s&n|a&~n)+e[1]-165796510|0)<<5|i>>>27)+s|0)&a|s&~a)+e[6]-1069501632|0)<<9|n>>>23)+i|0)&s|i&~s)+e[11]+643717713|0)<<14|a>>>18)+n|0)&i|n&~i)+e[0]-373897302|0)<<20|s>>>12)+a|0,s=((s+=((a=((a+=((n=((n+=((i=((i+=(s&n|a&~n)+e[5]-701558691|0)<<5|i>>>27)+s|0)&a|s&~a)+e[10]+38016083|0)<<9|n>>>23)+i|0)&s|i&~s)+e[15]-660478335|0)<<14|a>>>18)+n|0)&i|n&~i)+e[4]-405537848|0)<<20|s>>>12)+a|0,s=((s+=((a=((a+=((n=((n+=((i=((i+=(s&n|a&~n)+e[9]+568446438|0)<<5|i>>>27)+s|0)&a|s&~a)+e[14]-1019803690|0)<<9|n>>>23)+i|0)&s|i&~s)+e[3]-187363961|0)<<14|a>>>18)+n|0)&i|n&~i)+e[8]+1163531501|0)<<20|s>>>12)+a|0,s=((s+=((a=((a+=((n=((n+=((i=((i+=(s&n|a&~n)+e[13]-1444681467|0)<<5|i>>>27)+s|0)&a|s&~a)+e[2]-51403784|0)<<9|n>>>23)+i|0)&s|i&~s)+e[7]+1735328473|0)<<14|a>>>18)+n|0)&i|n&~i)+e[12]-1926607734|0)<<20|s>>>12)+a|0,s=((s+=((a=((a+=((n=((n+=((i=((i+=(s^a^n)+e[5]-378558|0)<<4|i>>>28)+s|0)^s^a)+e[8]-2022574463|0)<<11|n>>>21)+i|0)^i^s)+e[11]+1839030562|0)<<16|a>>>16)+n|0)^n^i)+e[14]-35309556|0)<<23|s>>>9)+a|0,s=((s+=((a=((a+=((n=((n+=((i=((i+=(s^a^n)+e[1]-1530992060|0)<<4|i>>>28)+s|0)^s^a)+e[4]+1272893353|0)<<11|n>>>21)+i|0)^i^s)+e[7]-155497632|0)<<16|a>>>16)+n|0)^n^i)+e[10]-1094730640|0)<<23|s>>>9)+a|0,s=((s+=((a=((a+=((n=((n+=((i=((i+=(s^a^n)+e[13]+681279174|0)<<4|i>>>28)+s|0)^s^a)+e[0]-358537222|0)<<11|n>>>21)+i|0)^i^s)+e[3]-722521979|0)<<16|a>>>16)+n|0)^n^i)+e[6]+76029189|0)<<23|s>>>9)+a|0,s=((s+=((a=((a+=((n=((n+=((i=((i+=(s^a^n)+e[9]-640364487|0)<<4|i>>>28)+s|0)^s^a)+e[12]-421815835|0)<<11|n>>>21)+i|0)^i^s)+e[15]+530742520|0)<<16|a>>>16)+n|0)^n^i)+e[2]-995338651|0)<<23|s>>>9)+a|0,s=((s+=((n=((n+=(s^((i=((i+=(a^(s|~n))+e[0]-198630844|0)<<6|i>>>26)+s|0)|~a))+e[7]+1126891415|0)<<10|n>>>22)+i|0)^((a=((a+=(i^(n|~s))+e[14]-1416354905|0)<<15|a>>>17)+n|0)|~i))+e[5]-57434055|0)<<21|s>>>11)+a|0,s=((s+=((n=((n+=(s^((i=((i+=(a^(s|~n))+e[12]+1700485571|0)<<6|i>>>26)+s|0)|~a))+e[3]-1894986606|0)<<10|n>>>22)+i|0)^((a=((a+=(i^(n|~s))+e[10]-1051523|0)<<15|a>>>17)+n|0)|~i))+e[1]-2054922799|0)<<21|s>>>11)+a|0,s=((s+=((n=((n+=(s^((i=((i+=(a^(s|~n))+e[8]+1873313359|0)<<6|i>>>26)+s|0)|~a))+e[15]-30611744|0)<<10|n>>>22)+i|0)^((a=((a+=(i^(n|~s))+e[6]-1560198380|0)<<15|a>>>17)+n|0)|~i))+e[13]+1309151649|0)<<21|s>>>11)+a|0,s=((s+=((n=((n+=(s^((i=((i+=(a^(s|~n))+e[4]-145523070|0)<<6|i>>>26)+s|0)|~a))+e[11]-1120210379|0)<<10|n>>>22)+i|0)^((a=((a+=(i^(n|~s))+e[2]+718787259|0)<<15|a>>>17)+n|0)|~i))+e[9]-343485551|0)<<21|s>>>11)+a|0,t[0]=i+t[0]|0,t[1]=s+t[1]|0,t[2]=a+t[2]|0,t[3]=n+t[3]|0}start(){return this._dataLength=0,this._bufferLength=0,this._state.set(nt.stateIdentity),this}appendStr(t){const e=this._buffer8,i=this._buffer32;let s,a,n=this._bufferLength;for(a=0;a<t.length;a+=1){if((s=t.charCodeAt(a))<128)e[n++]=s;else if(s<2048)e[n++]=192+(s>>>6),e[n++]=63&s|128;else if(s<55296||s>56319)e[n++]=224+(s>>>12),e[n++]=s>>>6&63|128,e[n++]=63&s|128;else{if((s=1024*(s-55296)+(t.charCodeAt(++a)-56320)+65536)>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");e[n++]=240+(s>>>18),e[n++]=s>>>12&63|128,e[n++]=s>>>6&63|128,e[n++]=63&s|128}n>=64&&(this._dataLength+=64,nt._md5cycle(this._state,i),n-=64,i[0]=i[16])}return this._bufferLength=n,this}appendAsciiStr(t){const e=this._buffer8,i=this._buffer32;let s,a=this._bufferLength,n=0;for(;;){for(s=Math.min(t.length-n,64-a);s--;)e[a++]=t.charCodeAt(n++);if(a<64)break;this._dataLength+=64,nt._md5cycle(this._state,i),a=0}return this._bufferLength=a,this}appendByteArray(t){const e=this._buffer8,i=this._buffer32;let s,a=this._bufferLength,n=0;for(;;){for(s=Math.min(t.length-n,64-a);s--;)e[a++]=t[n++];if(a<64)break;this._dataLength+=64,nt._md5cycle(this._state,i),a=0}return this._bufferLength=a,this}getState(){const t=this._state;return{buffer:String.fromCharCode.apply(null,this._buffer8),buflen:this._bufferLength,length:this._dataLength,state:[t[0],t[1],t[2],t[3]]}}setState(t){const e=t.buffer,i=t.state,s=this._state;let a;for(this._dataLength=t.length,this._bufferLength=t.buflen,s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],a=0;a<e.length;a+=1)this._buffer8[a]=e.charCodeAt(a)}end(t=!1){const e=this._bufferLength,i=this._buffer8,s=this._buffer32,a=1+(e>>2);let n;if(this._dataLength+=e,i[e]=128,i[e+1]=i[e+2]=i[e+3]=0,s.set(nt.buffer32Identity.subarray(a),a),e>55&&(nt._md5cycle(this._state,s),s.set(nt.buffer32Identity)),(n=8*this._dataLength)<=4294967295)s[14]=n;else{const t=n.toString(16).match(/(.*?)(.{0,8})$/);if(null===t)return;const e=parseInt(t[2],16),i=parseInt(t[1],16)||0;s[14]=e,s[15]=i}return nt._md5cycle(this._state,s),t?this._state:nt._hex(this._state)}}nt.ifUse=!0,nt.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]),nt.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),nt.hexChars="0123456789abcdef",nt.hexOut=[],nt.onePassHasher=new nt,"5d41402abc4b2a76b9719d911017c592"!==nt.hashStr("hello")&&(nt.ifUse=!1,console.warn("Md5 self test failed."));class ot{}class rt{static encode(t){let e,i,s,a,n,o,r,l="",h=0;for(t=this._utf8_encode(t);h<t.length;)a=(e=t.charCodeAt(h++))>>2,n=(3&e)<<4|(i=t.charCodeAt(h++))>>4,o=(15&i)<<2|(s=t.charCodeAt(h++))>>6,r=63&s,isNaN(i)?o=r=64:isNaN(s)&&(r=64),l=l+this._keyStr.charAt(a)+this._keyStr.charAt(n)+this._keyStr.charAt(o)+this._keyStr.charAt(r);return l}static decode(t){let e,i,s,a,n,o,r,l="",h=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");h<t.length;)e=(a=this._keyStr.indexOf(t.charAt(h++)))<<2|(n=this._keyStr.indexOf(t.charAt(h++)))>>4,i=(15&n)<<4|(o=this._keyStr.indexOf(t.charAt(h++)))>>2,s=(3&o)<<6|(r=this._keyStr.indexOf(t.charAt(h++))),l+=String.fromCharCode(e),64!==o&&(l+=String.fromCharCode(i)),64!==r&&(l+=String.fromCharCode(s));return l=this._utf8_decode(l)}static _utf8_encode(t){t=t.replace(/\r\n/g,"\n");let e="";for(let i=0;i<t.length;i++){const s=t.charCodeAt(i);s<128?e+=String.fromCharCode(s):s>127&&s<2048?(e+=String.fromCharCode(s>>6|192),e+=String.fromCharCode(63&s|128)):(e+=String.fromCharCode(s>>12|224),e+=String.fromCharCode(s>>6&63|128),e+=String.fromCharCode(63&s|128))}return e}static _utf8_decode(t){let e="",i=0,s=0,a=0,n=0;for(;i<t.length;)(s=t.charCodeAt(i))<128?(e+=String.fromCharCode(s),i++):s>191&&s<224?(a=t.charCodeAt(i+1),e+=String.fromCharCode((31&s)<<6|63&a),i+=2):(a=t.charCodeAt(i+1),n=t.charCodeAt(i+2),e+=String.fromCharCode((15&s)<<12|(63&a)<<6|63&n),i+=3);return e}}rt._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";class lt extends ot{get saveName(){return st.GameName+this._saveName}get differName(){return this.encrypt(this.saveName+"-(-__DifferData__LayaMiniGame__-)-")}_SaveToDisk(t){let e=JSON.stringify(t);if(Laya.LocalStorage.setJSON(this.saveName,e),st.OnLine){let t=this.getDifferData(e);Laya.LocalStorage.setJSON(this.differName,t)}}_ReadFromFile(){let t=Laya.LocalStorage.getJSON(this.saveName);if(st.OnLine){let e=Laya.LocalStorage.getJSON(this.differName);if(this.getDifferData(t)!=e)return this._saveNewData()}let e=this.getNewData();e.versions=void 0;try{if(at.IsNullOrEmpty(t))return this._saveNewData();{let i=JSON.parse(t);for(let t in i)e[t]=i[t]}}catch(t){return this._saveNewData()}return e.versions==st.versions?e:this._saveNewData()}_saveNewData(){let t=this.getNewData();return t.versions=st.versions,t.GameName=st.GameName,t.GameExplain=st.GameExplain,this._SaveToDisk(t),t}getDifferData(t){return at.IsNullOrEmpty(t)?"":this.encrypt(t)}encrypt(t){let e="LayaMiniGame-(-"+t+"-)-ModifiedWithout-"+st.GameName+"-"+st.versions;return nt.ifUse?nt.hashStr(e).toString():rt.encode(e)}}class ht{}class ct extends ht{clone(){}}class dt extends ct{constructor(){super(...arguments),this.maxCustoms=0,this.ifOpenBgm=!0,this.ifOpenSound=!0,this.ifOpenVibrate=!0,this.coinCount=0,this.onCustoms=x.DefaultLeveId,this.maxCustomsRecord=1}clone(){return JSON.parse(JSON.stringify(this))}}class ut extends lt{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new ut),this._instance}get _saveName(){return"->GameDataSave<-"}InitData(){this._saveData=this._ReadFromFile()}static get gameData(){return this._instance._saveData.clone()}static initCustoms(t){t=Math.floor(t),this._instance._saveData.maxCustoms!=t&&(this._instance._saveData.maxCustoms=t,this._instance._saveData.onCustoms>t&&(this._instance._saveData.onCustoms=t),this._instance._saveData.maxCustomsRecord>t&&(this._instance._saveData.maxCustomsRecord=t),this.SaveToDisk())}static ifNewHandCustoms(){return this._instance._saveData.onCustoms==x.NewHandLeveId&&this._instance._saveData.maxCustomsRecord<=x.NewHandLeveId}static setIfOpenBGM(t){this._instance._saveData.ifOpenBgm=t,this.SaveToDisk()}static setIfOpenSound(t){this._instance._saveData.ifOpenSound=t,this.SaveToDisk()}static setIfOpenVibrate(t){this._instance._saveData.ifOpenVibrate=t,this.SaveToDisk()}static setCustoms(t){(t=Math.floor(t))>this._instance._saveData.maxCustoms||(this._instance._saveData.onCustoms=t)}static addCustoms(t=1){t=Math.floor(t);let e=this._instance._saveData.onCustoms+t,i=!1;return e<=this._instance._saveData.maxCustoms?(this._instance._saveData.onCustoms=e,e>this._instance._saveData.maxCustomsRecord&&(this._instance._saveData.maxCustomsRecord=e),i=!0):(this._instance._saveData.onCustoms=x.DefaultLeveId,i=!0),this.SaveToDisk(),i}static getDefaultCustoms(){return this._instance._saveData.onCustoms>this._instance._saveData.maxCustoms&&(this._instance._saveData.onCustoms=x.DefaultLeveId,this.SaveToDisk()),this._instance._saveData.onCustoms}static getPreloadCustoms(){return this.getNextCustoms()}static getNextCustoms(){let t=this._instance._saveData.onCustoms+1;return t>this._instance._saveData.maxCustoms&&(t=x.DefaultLeveId),t}getNewData(){return new dt}static SaveToDisk(){this._instance._SaveToDisk(this._instance._saveData)}}!function(t){t.config=class{},t.path="res/config/EnvironmentConfig.json"}(k||(k={}));class mt extends T{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new mt),this._instance}initData(){this.m_dataList=k.dataList}byLevelIdGetData(t){return this.m_dataList.find(e=>e.id==t)}}!function(t){t.config=class{},t.path="res/config/OtherEnvironmentConfig.json"}(P||(P={}));class _t extends T{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new _t),this._instance}initData(){this.m_dataList=P.dataList}byLevelIdGetData(t){return this.m_dataList.find(e=>e.id==t)}byLevelNameGetData(t){return this.m_dataList.find(e=>e.name==t)}}class gt{constructor(t){this.name="SystemException",this.message="异常!",t&&(this.message=t)}ToString(){return this.name+":"+this.message}}class pt extends gt{constructor(t,...e){super(t),this.name="ArgumentException",this.message="参数异常",t&&(this.message=t),this.data=e}}class ft extends gt{constructor(t){super(t),this.name="DivideByZeroException",this.message="不能除以0！",t&&(this.message=t)}}class yt extends gt{constructor(t){super(t),this.name="NotImplementedException",this.message="未实现该方法或操作",t&&(this.message=t)}}class St{static CachFile(t){if(Laya.Browser.onWeiXin){var e=Laya.URL.formatURL(t);null==Laya.MiniAdpter.getFileInfo(e)&&Laya.MiniAdpter.downLoadFile(e)}}static DownLoadFiles(t,e,i){Laya.loader.create(t,e,i,null,null,null,1,!0)}static makeTimeLeftString(t,e=":",i=!1){var s,a="";if(t<=0)return a+="00:00";if(t>St.ONE_YEAR)return a="大于一年";if(i){var n;if(t>St.ONE_DAY)a=(n=Math.floor(t/St.ONE_DAY))+"天";else if(t>=3600)a=(s=Math.floor(t/3600))+"时";else{var o,r;(o=Math.floor(t/60))<10&&(a+="0"),a+=o.toString()+e,(r=t%60)<10&&(a+="0"),a+=r.toString()}return a}if(t>St.ONE_DAY&&(a=(n=Math.floor(t/St.ONE_DAY))+"天",t-=n*St.ONE_DAY,i))return(s=Math.floor(t/3600))>0&&(a+=s+"时"),a;return t<=0?a+="00:00":(a="",(s=Math.floor(t/3600))>0&&(a+=s<10?"0"+s.toString()+e:s.toString()+e),(o=Math.floor((t-3600*s)/60))>0||s>0?(o<10&&(a+="0"),a+=o.toString()+e):a+="00"+e,(r=t%60)<10&&(a+="0"),a+=r.toString())}static GetCurrentDayCount(t){return Math.floor(t/1e3/60/60/24)}static randomRangeInt(t,e){return Math.floor(Math.random()*(e-t)+t)}static get deltaTime(){return this._recordFrame!=Laya.timer.currFrame&&(this._deltaTime=Math.min(Laya.timer.delta,100),this._deltaTimeSec=.001*this._deltaTime,this._recordFrame=Laya.timer.currFrame),this._deltaTime*this.timeScale}static get deltaTimeSec(){return this._recordFrame!=Laya.timer.currFrame&&(this._deltaTime=Math.min(Laya.timer.delta,100),this._deltaTimeSec=.001*this._deltaTime,this._recordFrame=Laya.timer.currFrame),this._deltaTimeSec*this.timeScale}static cloneObject(t){return JSON.parse(JSON.stringify(t))}}St.ONE_YEAR=31536e3,St.ONE_DAY=86400,St.timeScale=1,St._recordFrame=0,St._deltaTime=30,St._deltaTimeSec=.016;class It{static get deltaTime(){return St.deltaTimeSec}static get scale(){return Laya.timer.scale}static set scale(t){Laya.timer.scale=t}static ToTimeString(t){t/=1e3;let e=Math.floor(t/60/60),i=Math.floor((t-60*e*60)/60);i=i<0?0:i;let s=Math.floor(t-60*e*60-60*i);return(e+":"+i+":"+(s=s<0?0:s)).replace(/[0-9]+/g,t=>Number(t)<10?"0"+t:t)}}class wt{static Clamp01(t){return wt.Clamp(0,1,t)}static Clamp(t,e,i){return i<t?t:i>e?e:i}static Lerp(t,e,i){return(i=wt.Clamp01(i))*(e-t)+t}static LerpUnclamped(t,e,i){return i*(e-t)+t}static SmoothDamp(t,e,i,s=1/0,a=Laya.timer.delta){let n=i/a,o=.998228611243-.994433814875*Math.exp(-4.68826970093*Math.pow(n,-1.00200917568)),r=(e-t)*(o=wt.Clamp01(o))/a*1e3;r>s&&(r=s);let l=r/1e3*a;return l=t+l}static DeltaAngle(t,e){let i=0;return i=(t%=360)+180<(e%=360)&&e<=t+360?t+360-e:e-t}static StepMove(t,e,i){let s=e-t;return 0==s?e:(s<0&&(i=-i),t+=i*It.deltaTime)}}class Ct{constructor(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0}get SqrMagnitude(){return Laya.Vector3.scalarLengthSquared(this)}get magnitude(){return Laya.Vector3.scalarLength(this)}get normalized(){let t=new Ct;return Laya.Vector3.normalize(this,t),t}Multiply(t){return this.x*=t,this.y*=t,this.z*=t,this}Divide(t){return this.x/=t,this.y/=t,this.z/=t,this}Add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}Subtract(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}ToString(){return"Vector3:(".concat(this.x.toString(),",",this.y.toString(),",",this.z.toString(),")")}Equal(t){return null!=t&&Ct.SqrDistance(this,t)<.1}setValue(t,e,i){return this.x=t,this.y=e,this.z=i,this}fromArray(t,e){if(3!=t.length)throw new pt("数组长度不为3!");this.x=t[0],this.y=t[1],this.z=t[2],e&&(this.x+=e,this.y+=e,this.z+=e)}Copy(t){this.x=t.x,this.y=t.y,this.z=t.z}cloneTo(t){t.x=this.x,t.y=this.y,t.z=this.z}clone(){return new Ct(this.x,this.y,this.z)}toDefault(){this.x=0,this.z=0,this.y=0}forNativeElement(t){throw new yt("forNativeElement方法未实现!")}static get one(){return new Ct(1,1,1)}static get zero(){return new Ct(0,0,0)}static get up(){return new Ct(0,1,0)}static get down(){return new Ct(0,-1,0)}static get left(){return new Ct(-1,0,0)}static get right(){return new Ct(1,0,0)}static get forward(){return new Ct(0,0,-1)}static get back(){return new Ct(0,0,1)}static Add(t,e){let i=new Ct(0,0,0);return i.x=t.x+e.x,i.y=t.y+e.y,i.z=t.z+e.z,i}static Subtract(t,e){return new Ct(t.x-e.x,t.y-e.y,t.z-e.z)}static Multiply(t,e){return new Ct(t.x*e,t.y*e,t.z*e)}static Divide(t,e){return new Ct(t.x/e,t.y/e,t.z/e)}static Copy(t){let e=Ct.zero;return e.x=t.x,e.y=t.y,e.z=t.z,e}static Dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}static Cross(t,e){let i=t.y*e.z-e.y*t.z,s=t.z*e.x-t.x*e.z,a=t.x*e.y-e.x*t.y;return new Ct(i,s,a)}static Project(t,e){let i=e.magnitude;return i=Ct.Dot(t,e)/i/i,Ct.Multiply(e,i)}static ProjectOnPlane(t,e){let i=Ct.Cross(e,t),s=Ct.Cross(i,e);return Ct.Project(t,s)}static Angle(t,e){let i=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z),s=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);if(0==i||0==s)throw new ft("无法求零向量的夹角!");let a=t.x*e.x+t.z*e.z+t.y*e.y;return a=Math.acos(a/i/s)/Math.PI*180}static SignedAngle(t,e,i){let s=Ct.ProjectOnPlane(t,i),a=Ct.ProjectOnPlane(e,i),n=Ct.Cross(s,a),o=Ct.Angle(s,a);return Ct.Dot(n,i)>0&&(o=-o),o}static ClampMagnitude(t,e){if(t.magnitude<=e)return Ct.Copy(t);{let i=e/t.magnitude;return Ct.Multiply(t,i)}}static Distance(t,e){return Laya.Vector3.distance(t,e)}static SqrDistance(t,e){return Laya.Vector3.distanceSquared(t,e)}static Lerp(t,e,i){return i<=0?Ct.Copy(t):i>=1?Ct.Copy(e):Ct.LerpUnclamped(t,e,i)}static LerpUnclamped(t,e,i){let s=(e.x-t.x)*i+t.x,a=(e.y-t.y)*i+t.y,n=(e.z-t.z)*i+t.z;return new Ct(s,a,n)}static Max(t,e){let i=t.x>e.x?t.x:e.x,s=t.y>e.y?t.y:e.y,a=t.z>e.z?t.z:e.z;return new Ct(i,s,a)}static Min(t,e){let i=t.x<e.x?t.x:e.x,s=t.y<e.y?t.y:e.y,a=t.z<e.z?t.z:e.z;return new Ct(i,s,a)}static Normalize(t){let e=t.x*t.x+t.y*t.y+t.z*t.z,i=Math.sqrt(e);0!=i&&(t.x/=i,t.y/=i,t.z/=i)}MoveTowards(t,e,i){let s=Ct.Subtract(e,t);return s.magnitude>i?(Ct.Normalize(s),s.Multiply(i),s.Add(t),s):Ct.Copy(e)}static Reflect(t,e){let i=2*Ct.Dot(t,e),s=Ct.Multiply(e,i);return s=Ct.Subtract(t,s)}static RotateTowards(t,e,i,s){throw new yt}static Scale(t,e){return new Ct(t.x*e.x,t.y*e.y,t.z*e.z)}static SmoothDamp(t,e,i,s=1/0,a=Laya.timer.delta){let n=Ct.Distance(t,e),o=wt.SmoothDamp(0,n,i,s,a);(o=o/a*1e3)>s&&(o=s);let r=Ct.Subtract(e,t).normalized.Multiply(o/1e3*a);return r.Add(t),r}}!function(t){t.config=class{},t.path="res/config/CameraConst.json"}(D||(D={}));class bt extends R{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new bt),this._instance}initData(){this.m_data=D.data}}class Lt{constructor(){}static get instance(){return this.m_instance||(this.m_instance=new Lt),this.m_instance}init(){this.m_s3d=et.s3d,this.m_camera=et.camera,this.m_light=et.light}setEnvironment(t){this.m_scene=t;let e=ut.gameData.onCustoms;this.m_enviromentConfig=mt.instance.byLevelIdGetData(e),console.log("关卡环境配置参数->"+e+"->",this.m_enviromentConfig),this.setS3D(this.m_s3d),this.setCamera(this.m_camera,this.m_enviromentConfig.clear_color),this.setLight(this.light,this.m_enviromentConfig.light_color,this.m_enviromentConfig.light_intensity),this.addAmbient(this.s3d,this.m_enviromentConfig.ambient_color),it.instance.on3D(A.GameLevelsDelete,this,this.gameLevelsDelete)}setOtherEnvironment(t,e,i=this.m_s3d,s=this.m_camera,a=this.m_light){let n=_t.instance.byLevelNameGetData(t);console.log("关卡环境配置参数->"+t+"->",n),this.setCamera(s,n.clear_color),this.setLight(a,n.light_color,n.light_intensity),this.addAmbient(i,n.ambient_color)}get s3d(){return this.m_s3d}get camera(){return this.m_camera}get scene(){return this.m_scene}get light(){return this.m_light}setS3D(t){this.m_ifSetS3D||(this.m_ifSetS3D=!0)}setCamera(t,e){t.clearColor=J.HexToV4(e);let i=new Ct(bt.instance.data.EulerX,bt.instance.data.EulerY,bt.instance.data.EulerZ);this.camera.transform.rotationEuler=i;let s=new Ct(bt.instance.data.x,bt.instance.data.y,bt.instance.data.z);this.camera.transform.position=s,this.camera.farPlane=bt.instance.data.far,this.camera.orthographic=bt.instance.data.orthographic,this.camera.orthographicVerticalSize=bt.instance.data.orthographic_size}setLight(t,e,i){t.color=J.HexToV3(e),t.intensity=i}addAmbient(t,e){t.ambientMode=Laya.AmbientMode.SolidColor,t.ambientColor=J.HexToV3(e)}addFog(t,e,i,s){t.enableFog=!0,t.fogColor=J.HexToV3(e),t.fogRange=i,t.fogStart=s}gameLevelsDelete(){}}class vt extends j{constructor(){super(...arguments),this.ifAddProStampScript=!1}sprInit(){this.m_camera||(this.m_sprList[0]||console.log(...s.packError("没有找到摄像机!")),this.m_camera=this.m_sprList[0],this.m_cameraNode=new Laya.Sprite3D,this.m_rootPos=this.m_camera.transform.position.clone(),this.m_rootAng=this.m_camera.transform.rotationEuler.clone(),this.m_rootAng.x=-this.m_rootAng.x,this.m_rootAng.y=this.m_rootAng.y-180,this.m_cameraNode.addChild(this.m_camera),this.m_camera.transform.localPosition=Q.zeroV3,this.m_camera.transform.localRotationEuler=new Laya.Vector3(0,-180,0),this.m_Scr=this.addScript(this.m_camera,z),this.m_Scr.cameraNode=this.m_cameraNode,Lt.instance.s3d.addChild(this.m_cameraNode)),this.m_cameraNode.transform.position=this.m_rootPos,this.m_cameraNode.transform.rotationEuler=new Laya.Vector3(this.m_rootAng.x,this.m_rootAng.y,0),this.m_Scr.init()}}class At extends j{constructor(){super(...arguments),this.ifAddProStampScript=!1}}class xt extends l{constructor(){super()}static get instance(){return this._instance?this._instance:(this._instance=new xt,this._instance)}getPro(t){return this.ProList[t]}get cameraPro(){return this.getPro(v.CameraPro)}get heightFogCubePro(){return this.getPro(v.HeightFogCubePro)}}class kt{}kt.Library="library",kt.Canteen="canteen",kt.WaterRoom="waterRoom",kt.MaleSink="maleSink",kt.Toilet="toilet",kt.PeeArea="peeArea",kt.FamaleSink="famaleSink",kt.WaitAera="waitAera";class Pt{}Pt.Building="Building",Pt.Plane="Plane",Pt.YY="YY";class Dt{}Dt.Toilet="Toilet",Dt.Potted="Potted";class Ut{}Ut.Man_actionhero="man_actionhero",Ut.Man_butler="man_butler",Ut.Man_cyclist="man_cyclist",Ut.Man_doctor="man_doctor",Ut.Man_metalhead="man_metalhead",Ut.Man_naval_officer="man_naval_officer",Ut.Man_paramedic="man_paramedic",Ut.Man_pilot="man_pilot",Ut.Man_reporter="man_reporter",Ut.Man_scientist="man_scientist",Ut.Man_skate="man_skate",Ut.Man_tennis="man_tennis";class Tt{}Tt.Woman_basketball_player="woman_basketball_player",Tt.Woman_carpenter="woman_carpenter",Tt.Woman_casual="woman_casual",Tt.Woman_dentist="woman_dentist",Tt.Woman_doctor="woman_doctor",Tt.Woman_metalhead="woman_metalhead",Tt.Woman_tennis="woman_tennis",Tt.Woman_wh="woman_wh",Tt.Female_worker="female_worker",Tt.Male_worker="male_worker";class Rt{}Rt.VendingMachine="VendingMachine",Rt.WaterRoom="waterRoom",Rt.WaitAera="waitAera",Rt.MaleSink="maleSink",Rt.FamaleSink="famaleSink",Rt.Toilet="toilet",Rt.PeeArea="peeArea",Rt.CleanRoom="cleanRoom",Rt.Entrance="Entrance",Rt.Exit="Exit",Rt.EP_femaleToilet="EP_femaleToilet",Rt.EP_malePee="EP_malePee",Rt.EP_maleToilet="EP_maleToilet",Rt.Man_actionhero="man_actionhero",Rt.Man_butler="man_butler",Rt.Man_cyclist="man_cyclist",Rt.Man_doctor="man_doctor",Rt.Man_metalhead="man_metalhead",Rt.Man_naval_officer="man_naval_officer",Rt.Man_paramedic="man_paramedic",Rt.Man_pilot="man_pilot",Rt.Man_police="man_police",Rt.Man_reporter="man_reporter",Rt.Man_scientist="man_scientist",Rt.Man_skate="man_skate",Rt.Man_tennis="man_tennis",Rt.Woman_basketball_player="woman_basketball_player",Rt.Woman_carpenter="woman_carpenter",Rt.Woman_casual="woman_casual",Rt.Woman_dentist="woman_dentist",Rt.Woman_doctor="woman_doctor",Rt.Woman_metalhead="woman_metalhead",Rt.Woman_scientist="woman_scientist",Rt.Woman_tennis="woman_tennis",Rt.Female_worker="female_worker";class Ot{}Ot.Caidai="caidai",Ot.Cleaning="cleaning",Ot.Emoji_money="emoji_money",Ot.Emoji_angry="emoji_angry",Ot.Emoji_cry="emoji_cry",Ot.Emoji_cute="emoji_cute",Ot.Emoji_dead="emoji_dead",Ot.Emoji_happy="emoji_happy",Ot.Emoji_poop="emoji_poop",Ot.Emoji_sick="emoji_sick",Ot.Pee="pee",Ot.Money="money",Ot.Hushen="hushen",Ot.Shui="shui",Ot.Urine="urine",Ot.Pg="pg",Ot.Yan="yan",Ot.Sink_Damage="sink_Damage",Ot.Sink_Dirty="sink_Dirty",Ot.Toilet_damage="toilet_damage",Ot.Toilet_dirty="toilet_dirty",Ot.Pee_dirty="pee_dirty",Ot.Pee_Damage="pee_Damage",Ot.CleanRoom="cleanRoom",Ot.Entrance="Entrance",Ot.Exit="Exit",Ot.Door="door",Ot.Male_wall="male_wall",Ot.Female_wall="female_wall",Ot.VendingMachine="VendingMachine",Ot.Limit="limit",Ot.ZS="ZS";class Mt extends Rt{}Mt.Camera="camera",Mt.Environment="environment",Mt.HeightFog="heightFog";const Et={prefab0:kt,prefab1:Pt,prefab2:Dt,prefab3:Ut,prefab4:Tt,prefab5:Ot},Bt=Ot;class Gt extends F{constructor(){super()}static get instance(){return this._instance?this._instance:(this._instance=new Gt,this._instance)}init(){xt.instance.ProList=this.m_proList}register(){this.m_proList[v.CameraPro]=new vt(v.CameraPro),this.m_proList[v.HeightFogCubePro]=new At(v.HeightFogCubePro)}allotPrefab(t){this.m_proList[v.CameraPro].startPor({[Mt.Camera]:[Lt.instance.camera]}),this.m_proList[v.HeightFogCubePro].startPor({[Mt.HeightFog]:t[Mt.HeightFog]})}allotMediator(){}allotOtherScenePrefab(t,e){}allotOtherSceneMediator(t){}}var Nt,Ft,Vt,Wt,jt,qt,Ht,zt,Qt,Jt,Kt,Zt,Yt,Xt,$t,te,ee,ie,se,ae,ne,oe,re,le;!function(t){t.LookAd="_EEventUI_LookAd",t.UnLookAd="_EEventUI_UnLookAd",t.CustomsChange="_EEventUI_CustomsChange",t.GameStart="_EEventUI_Start",t.GameEnd="_EEventUI_GameEnd",t.GamePasue="_EEventUI_GamePause",t.GameResume="_EEventUI_GameResume",t.GameCom="_EEventUI_GameCom",t.GameWin="_EEventUI_GameWin",t.GameFail="_EEventUI_GameFail",t.RoleDie="_EEventUI_RoleDie",t.RoleRevive="_EEventUI_RoleRevive",t.GameCoinChange="_EEventUI_GameCoinChange",t.SoundStateChange="_EEventUI_SoundStateChange",t.VibrateStateChange="_EEventUI_VibrateStateChange",t.SceneGameCustomsInit="_EEventUI_SceneGameCustomsInit",t.SceneGameCustomsLoading="_EEventUI_SceneGameCustomsLoading",t.SceneGameCustomDelete="_EEventUI_SceneGameCustomDelete",t.BuildConstruction="_EEventUI_BuildConstruction",t.BuildComplete="_EEventUI_BuildComplete",t.ShowStaffPanel="_EEventUI_ShowStaffPanel",t.UpdateSlotData="_EEventUI_UpdateSlot",t.UpdateSlotComplete="_EEventUI_UpdateSlotUI",t.OnClickRepairBtn="_EEventUI_OnClickRepairBtn",t.RepairProgressComplete="_EEventUI_RepairProgressComplete",t.AddStaff="_EEventUI_AddStaff",t.RenderMarketStaffList="_EEventUI_RenderMarketStaffList",t.OnClickTip="_EEventUI_OnClickTip",t.UpdateDiamondNum="_EEventUI_UpdateDiamondNum",t.UpdateMoneyNum="_EEventUI_UpdateMoneyNum",t.UpdateWaterState="_EEventUI_UpdateWaterState",t.GuideToNext="_EEventUI_GuideToNext",t.Guide="_EEventUI__Guide",t.ShowCleanRoomStaff="_EEventUI_ShowCleanRoomStaff",t.GuideToEnd="_EEventUI_GuideToEnd",t.UpdateAdBuffTime="_EEventUI_UpdateAdBuffTime",t.CostMoney="减去花费",t.OtherGuide="_EEventUI_OtherGuide",t.DamageSlot="_EEventUI_DamageSlot",t.TaskEvent="_EEventUI_TaskEvent",t.UpdateTaskProgress="_EEventUI_UpdateTaskProgress",t.AddAdUtilityNetRed="_EEventUI_AddAdUtilityNetRed",t.LibraryTimeOver="LibraryTimeOver",t.CanteenTimeOver="CanteenTimeOver",t.OnStopRecord="OnStopRecord",t.OnStartRecord="OnStartRecord"}(Nt||(Nt={}));class he{constructor(){this.m_data=[];let t=S.ConfigURL("guestPool.json"),e=a.Get(t,!0);e&&(this.m_data=e),a.Unload(t)}static get instance(){return this.m_instance||(this.m_instance=new he),this.m_instance}init(){}}!function(t){t.config=class{},t.path="res/config/SlotUiConfig.json"}(Ft||(Ft={}));class ce extends T{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new ce),this._instance}initData(){this.m_dataList=Ft.dataList}}class de{static NameUpper(t){return t=(t=t.replace(/^([a-z])/,t=>t.toUpperCase())).replace(/_[a-zA-Z]/g,t=>t.replace("_","").toUpperCase())}}de.list=["slot_Baby_mirror_config","slot_mt_config","slot_Accessible_mt_config","slot_clean_trash_can_config","slot_detergent_config","slot_airConditioner_config","slot_Accessible_airConditioner_config","slot_air_cleaner_config","slot_sweep_config","slot_cart_config","slot_book_config","slot_Chair_config","slot_coffee_config","slot_sweetmeats_config","slot_desk_config","slot_Accessible_cushion_config","slot_plss_config","slot_Accessible_wt_config","slot_Baby_lr_config","slot_Baby_c_config","slot_urinal_config","slot_Accessible_xbc_config","slot_Baby_bed_config","slot_Baby_bench_config","slot_Baby_platform_config","slot_Baby_toy_config","slot_mint_config","slot_Accessible_mint_config","slot_potted_config","slot_Accessible_pot_config","slot_trashCan_config","slot_Accessible_trash_config","slot_paper_config","slot_Accessible_paper_config","slot_phone_config","slot_Accessible_phone_config","slot_clock_config","slot_wash_basin_man_config","slot_wash_basin_woman_config","slot_Accessible_Hand_washstand_config","slot_Baby_wash_config","slot_sewage_config","slot_flow_config","slot_peeQueue_config","slot_maleQueue_config","slot_femaleQueue_config","slot_book_cabinet_config","slot_cashier_config","slot_fruits_config","slot_vertical_air_config","slot_flower_config","slot_shelf_config","slot_freezer_config","slot_bookrack_config","slot_drinks_config","slot_groceries_config","slot_clean_config","slot_basket_config","slot_twowindow_config","slot_onewindow_config","slot_table_config","slot_secretaire_config"],function(t){t.ZH="ZH",t.EN="EN",t.JP="JP"}(Vt||(Vt={}));class ue{constructor(){this.languageCode=Vt.ZH,this._map=new Map}static get instance(){return null==this._instance&&(this._instance=new ue),this._instance}initLanguagesData(t){for(let e=0;e<t.length;e++){let i=t[e];this._map.set(i.id_text,i)}console.log("initLanguagesData:",this._map)}getLanguage(t){if(console.log("getLanguage:",t),!this._map.has(t))return t;const e=this._map.get(t);return this.languageCode==Vt.EN?null==e?void 0:e.en_text:this.languageCode==Vt.JP?null==e?void 0:e.jp_text:this.languageCode==Vt.ZH?null==e?void 0:e.id_text:null==e?void 0:e.en_text}}String.prototype.clamp=function(t=8){return String(this)},String.prototype.i18n=function(...t){const e=String(this);return ue.instance.getLanguage(e)},function(t){t.config=class{},t.path="res/config/Languages.json"}(Wt||(Wt={}));class me{constructor(){this._map={},this._dict={}}static get instance(){return null==this._instance&&(this._instance=new me),this._instance}initData(){let t=ce.instance.dataList.length;for(let e=0;e<t;e++){let t=ce.instance.dataList[e],i=S.ConfigURL(de.NameUpper(t.name)+".json"),s=a.Get(i,!0);s?(this._map[e]?console.error("Slot配置表添加失败，id重复：",e,i,this._map):(this._map[e]=s,this._dict[t.name]=s),a.Unload(i)):console.error("Slot配置表读取失败：",i,t.name)}console.log("所有slot数据加载完毕：",this._map),ue.instance.initLanguagesData(Wt.dataList)}GetSlotConfigByUID(t){let e=this._map[t];return e||(console.error("获取UID对应的config失败：",t),null)}GetSlotConfigByName(t){let e=this._dict[t];return e||(console.error("获取SlotName对应的config失败：",t),null)}}class _e{static Range(t,e){return t+(e-t)*Math.random()}static RangeInt(t,e){let i=_e.Range(t,e);return Math.floor(i)}static get random(){return Math.random()}}!function(t){t.maleSinkAera="maleSinkAera",t.femaleSinkAera="femaleSinkAera",t.WaitAera="waitAera",t.PeeArea="PeeArea",t.maleToilet="maleToilet",t.femaleToilet="femaleToilet",t.pee="pee",t.disableRoom="disableRoom",t.waterRoom="waterRoom",t.lineUp="lineUp",t.famaleSink="famaleSink",t.maleSink="maleSink",t.babyRoom="babyRoom",t.cleanRoom="cleanRoom",t.coffeeRoom="coffeeRoom",t.MapRoot="MapRoot.json",t.GusetPool="guestPool.json",t.EmployeeData="EmployeeData.json",t.equipment="equipment",t.placeholder="placeholder",t.toiletWall="street_men_toilet_1",t.cs_nv="cs_nv",t.cs_nan="cs_nan",t.line_up_men="line_up_men",t.line_up_women="line_up_women",t.line_up_pee="line_up_pee",t.Chair="Chair",t.Door="door",t.slot_flow_config_0="slot_flow_config_0",t.slot_femaleQueue_config_1="slot_femaleQueue_config_1",t.slot_peeQueue_config_2="slot_peeQueue_config_2",t.slot_maleQueue_config_3="slot_maleQueue_config_3",t.entrance="entrance",t.EP_Female="EP_Female",t.EP_Male="EP_Male",t.EP_Pee="EP_Pee",t.exit="exit",t.canteen="canteen",t.Library="library"}(jt||(jt={}));class ge{constructor(){this._totalWeight=0;let t=S.ConfigURL(jt.EmployeeData),e=a.Get(t,!0);if(e){this.m_data=e;for(let t of this.m_data)this._totalWeight+=t.Weight,t.Weight=this._totalWeight}a.Unload(t)}static get instance(){return null==this._instance&&(this._instance=new ge),this._instance}GetRandomData(){let t=_e.Range(0,this._totalWeight),e=null;for(let i of this.m_data)if(i.Weight>t){e=i;break}return e}static GetIconSprite(t){switch(t){case 0:return"res/sprite/skillicon/skill_1001.png";case 1:return"res/sprite/skillicon/skill_1002.png";case 2:return"res/sprite/skillicon/skill_1003.png";case 3:return"res/sprite/skillicon/skill_1004.png";case 4:return"res/sprite/skillicon/skill_1005.png"}}static GetEmployeeSpriteByName(t){return""}static GetEmployeeSprite(t){return 0==t.Gender?"res/sprite/employee/female_1.png":"res/sprite/employee/male_1.png"}}!function(t){t[t.MaleToilet=2]="MaleToilet",t[t.MalePee=3]="MalePee",t[t.MaleSink=4]="MaleSink",t[t.FemaleToilte=6]="FemaleToilte",t[t.FemaleSink=7]="FemaleSink",t[t.DisableToilet=10]="DisableToilet",t[t.CleanRoom=11]="CleanRoom",t[t.BabyRoom=12]="BabyRoom",t[t.WaitAera=13]="WaitAera",t[t.CoffeeRoom=14]="CoffeeRoom",t[t.Canteen=15]="Canteen",t[t.Library=16]="Library",t[t.WaterRoom=17]="WaterRoom"}(qt||(qt={}));class pe extends pt{constructor(t,...e){super(t),this.name="ArgumentNullException",this.message="参数为空（不允许）",t&&(this.message=t),this.data=e}}class fe extends Laya.Script3D{get sprite3D(){return null==this._sprite3D&&(this._sprite3D=this.owner),this._sprite3D}get transform(){return null==this._transform&&(this._transform=this.owner.transform),this._transform}Invoke(t,e,i,s){Laya.timer.once(t,this,e,i,s)}InvokeRepeating(t,e,i,s,a,n){e>0&&Laya.timer.once(t,this,()=>Laya.timer.loop(e,this,i,s,a,n))}CancelAllInvoke(){Laya.timer.clearAll(this)}CancelInvoke(t){Laya.timer.clear(this,t)}GetChildByName(t){if(null==t||""==t)throw new pe;return this.sprite3D.getChildByName(t)}GetSpriteChildByName(t){return this.GetChildByName(t)}Instantiate(t,e){return Laya.Sprite3D.instantiate(t,e)}ToggleAllChild(t,e){if(t.numChildren>0)for(let i=0;i<t.numChildren;i++){t.getChildAt(i).active=e}}DeepFind(t,e){let i=e.numChildren,s=null;if(i>0){if(s=e.getChildByName(t))return s;for(let a=0;a<i;a++){let i=e.getChildAt(a);if(s=this.DeepFind(t,i))break}}return s}}class ye extends gt{constructor(t,...e){super(t),this.name="NullReferenceException",this.message="依从一个空对象",t&&(this.message=t),this.data=e}}!function(t){t.config=class{},t.path="res/config/SlotUIDConst.json"}(Ht||(Ht={}));class Se extends R{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new Se),this._instance}initData(){this.m_data=Ht.data}static get Data(){return this.instance.data}}class Ie extends fe{constructor(){super(...arguments),this._nameList=[Bt.Caidai,Bt.Cleaning,Bt.Emoji_angry,Bt.Emoji_cry,Bt.Emoji_cute,Bt.Emoji_dead,Bt.Emoji_happy,Bt.Emoji_poop,Bt.Emoji_sick,Bt.Emoji_money,Bt.Hushen,Bt.Money,Bt.Shui,Bt.Urine,Bt.Yan,Bt.Pee,Bt.Pee_dirty,Bt.Pee_Damage,Bt.Toilet_dirty,Bt.Toilet_damage,Bt.Sink_Dirty,Bt.Sink_Damage,Bt.Cleaning,Bt.ZS],this._map=new Map,this._prefab={},this._callerDict=new Map}static get instance(){return this._runtimeInstance}get prefabs(){return Et.prefab5}onAwake(){Ie._runtimeInstance=this}InitAllPrefabs(){for(let t of this._nameList){let e=S.prefab_url(t);if(!e)throw new Error("获取预置体url失败："+t);{let i=a.Get(e,!0);if(!i)throw new Error("获取预置体失败："+e);this._prefab[t]=i}}}GetEffectByName(t){let e=this._map.get(t),i=null;if(e&&e.length>0)for(let t of e)if(!t.active){i=t;break}if(null==i){let s=this._prefab[t];if(!s)throw new Error("获取特效预置体失败："+t);i=this.Instantiate(s,et.s3d),null==e?((e=[]).push(i),this._map.set(t,e)):e.push(i)}return i}RecycleEffect(t){t.parent!=this.owner&&et.s3d.addChild(t),t.active=!1}static PlayEffect(t,e,i,s,a){let n=this.instance._callerDict.get(e);null==n&&(n=new Map,this.instance._callerDict.set(e,n));let o=n.get(t);return null==o&&(o=this.instance.GetEffectByName(t)),o&&(n.set(t,o),s&&(o.transform.position=s),a&&(o.transform.rotationEuler=a),i&&Laya.timer.once(i,this,()=>this.Clear(e,t)),o.active=!0),o}static Clear(t,e){let i=this.instance._callerDict.get(t);if(i){let s=i.get(e);s&&Ie.instance.RecycleEffect(s),i.delete(e),i.size<=0&&(i.clear(),this.instance._callerDict.delete(t))}}static ClearAll(t){let e=this.instance._callerDict.get(t);e&&(e.forEach(t=>{Ie.instance.RecycleEffect(t)}),e.clear()),this.instance._callerDict.delete(t)}}!function(t){t.config=class{},t.path="res/config/BuildConfig.json"}(zt||(zt={}));class we extends T{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new we),this._instance}initData(){this.m_dataList=zt.dataList}}!function(t){t.config=class{},t.path="res/config/DefaultBuilding.json"}(Qt||(Qt={}));class Ce extends T{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new Ce),this._instance}initData(){this.m_dataList=Qt.dataList}}!function(t){t.config=class{},t.path="res/config/UIManagerBuildConfig.json"}(Jt||(Jt={}));class be extends T{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new be),this._instance}initData(){this.m_dataList=Jt.dataList}}!function(t){t.config=class{},t.path="res/config/FocusPositionConfig.json"}(Kt||(Kt={}));class Le extends T{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new Le),this._instance}initData(){this.m_dataList=Kt.dataList}}!function(t){t.bottom_group="m_bottom_group",t.anim_enter="m_anim_enter",t.anim_exit="m_anim_exit"}(Zt||(Zt={})),function(t){t.Bg="EUILayer_Bg",t.EventLayer="EventLayer",t.EventBar="EventBar",t.Main="EUILayer_Main",t.OneUI="EUILayer_OneUI",t.TalkPanel="TalkPanel",t.Panel="EUILayer_Panel",t.ToiletPanel="ToiletPanel",t.StaffInfoPanel="StaffInfoPanel",t.MarketPanel="MarketPanel",t.Popup="EUILayer_Popup",t.Prop="EUILayer_Prop",t.Tip="EUILayer_Tip",t.Pause="EUILayer_Pause",t.Set="EUILayer_Set",t.Top="EUILayer_Top",t.Loading="EUILayer_Loading",t.Guide="Guide",t.NativeAD="NativeAD"}(Yt||(Yt={}));class ve{static get top(){return 0}static get bottom(){return 0}}class Ae{static getLayer(t){return this.LayerList[t]}static Init(){fgui.UIConfig.packageFileExtension="bin",Laya.stage.addChild(fgui.GRoot.inst.displayObject),this.LayerList={};for(let t in Yt)this.LayerList[Yt[t]]=fgui.GRoot.inst.addChild(new fgui.GComponent);this.UpdateAllUI(),Laya.stage.on(Laya.Event.RESIZE,this,this.UpdateAllUI)}static AddUI(t,e){let i=t.createInstance();if(e==Yt.OneUI){let t=Ae.oneUIs;t.length>0&&t.forEach(t=>{t&&t.Hide()}),Ae.oneUIs=[]}return this.getLayer(e).addChild(i),window[i.constructor.name]=i,i.setSize(fgui.GRoot.inst.width,fgui.GRoot.inst.height-ve.top-ve.bottom),i}static setUIToTopShow(t,e){let i=this.getLayer(e);-1!=i.getChildIndex(t)?(t.removeFromParent(),i.addChild(t)):console.log(...s.packWarn("设置ui到最顶层失败，因为该层级里面没有该UI！"))}static UpdateAllUI(){let t=Laya.stage.width,e=Laya.stage.height;fgui.GRoot.inst.setSize(t,e);let i=fgui.GRoot.inst.numChildren,s=0,a=0;for(let t=0;t<i;++t){let e=fgui.GRoot.inst.getChildAt(t);s=fgui.GRoot.inst.width,a=fgui.GRoot.inst.height-ve.top-ve.bottom,e.setSize(s,a),e.y=ve.top}}static CheckIn(t,e,i){return e>t.x&&e<t.x+t.width&&i>t.y&&i<t.y+t.height}}Ae.oneUIs=[];class xe{constructor(){this.top=0,this.bottom=0,this._ifUpdateUISize=!0,this._layer=Yt.Panel,this._ifBelongUIMediator=!1,this._belongDownUIMediator=[],this._belongUpUIMediator=[],this._isShow=!1,this.m_serialNumber=ke.GlobalSerialNumber,Laya.stage.on(Laya.Event.RESIZE,this,this.UpdateUI)}get ui(){return this._ui}get serialNumber(){return this.m_serialNumber}get layer(){return this._layer}get ifBelongUIMediator(){return this._ifBelongUIMediator}get belongDownUIMediator(){return this._belongDownUIMediator}get belongUpUIMediator(){return this._belongUpUIMediator}get isShow(){return this._isShow}get isDispose(){return this.ui.isDisposed}set keyId(t){this.m_keyId=t}get keyId(){return this.m_keyId}_InitBottom(){let t=this._ui[Zt.bottom_group];this._defaultBottomHeight=null==t?0:t.y}_SetBottomDown(t=0){let e=this._ui[Zt.bottom_group];null!=e&&(e.y=this._defaultBottomHeight+t)}setUIToTopShow(){this._ui&&Ae.setUIToTopShow(this._ui,this._layer)}Show(){if(this._isShow)this.setUIToTopShow();else if(this.OnshowBefore(),this._isShow=!0,!this._ui||this._ui&&this._ui.isDisposed?(this._ui=Ae.AddUI(this._classDefine,this._layer),this._layer==Yt.OneUI&&Ae.oneUIs.push(this)):this.ui.visible=!0,this.setUIToTopShow(),this._OnShow(),console.log("显示UI:"+this._classDefine.uiName,this),this.UpdateUI(),this._ui[Zt.anim_enter]){this._ui[Zt.anim_enter].play(Laya.Handler.create(this,this._CallEnterAnimEnd))}else this.OnEnterAnimEnd()}_CallEnterAnimEnd(){this.OnEnterAnimEnd()}UpdateUI(){if(!this._ifUpdateUISize)return;if(!this._isShow)return;if(!this._ui)return;if(this._ui.isDisposed)return;let t=fgui.GRoot.inst.width,e=fgui.GRoot.inst.height-this.top-this.bottom-ve.top-ve.bottom;this._ui.setSize(t,e),this._ui.y=this.top}OnEnterAnimEnd(){}OnshowBefore(){}_OnShow(){}Hide(t=!0){if(null!=this._ui&&!this._ui.isDisposed&&this._isShow)if(this._isShow=!1,this.OnHideBefore(),this._ui[Zt.anim_exit]){this._ui[Zt.anim_exit].play(Laya.Handler.create(this,this._DoHide,[t]))}else this._DoHide(t)}_DoHide(t){t?this._ui.dispose():this._ui.visible=!1,this._OnHide()}OnHideBefore(){}_OnHide(){}}class ke{static get GlobalSerialNumber(){return this.m_GlobalSerialNumber++,this.m_GlobalSerialNumber}}ke.m_GlobalSerialNumber=0;class Pe extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("EventPanel","EventCommPanel")}onConstruct(){this.m_btn_help_1=this.getChildAt(0),this.m_btn_help_2=this.getChildAt(1),this.m_btn_help_3=this.getChildAt(2),this.m_btn_help_4=this.getChildAt(3),this.m_btn_help_5=this.getChildAt(4)}}Pe.URL="ui://gp34j27lkuiluf",function(t){t[t.Normal=0]="Normal",t[t.Toilet=1]="Toilet",t[t.Repair=2]="Repair",t[t.StartRepair=3]="StartRepair",t[t.Building=4]="Building",t[t.Sweep=5]="Sweep",t[t.Money=6]="Money",t[t.Diamond=7]="Diamond"}(Xt||(Xt={}));class De extends fairygui.GButton{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("EventPanel","EventTip")}onConstruct(){this.m_state=this.getControllerAt(0),this.m_runtime=this.getControllerAt(1),this.m_fill_green=this.getChildAt(11),this.m_t0=this.getTransitionAt(0),this.m_t1=this.getTransitionAt(1)}}De.URL="ui://gp34j27lqrltut";class Ue extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("EventPanel","Mosaic")}onConstruct(){this.m_msk=this.getChildAt(0)}}Ue.URL="ui://gp34j27ljjshv5";class Te extends ct{constructor(){super(...arguments),this.isCompleteGuide1=!1,this.isCompleteGuide2=!1,this.isCompleteGuide3=!1,this.isCompleteGuide4=!1,this.isCompleteGuide5=!1,this.guideID=0}}class Re extends lt{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new Re),this.m_instance}get Data(){return this._data}get _saveName(){return"GuideData"}getNewData(){return new Te}SaveData(){this._SaveToDisk(this._data)}InitData(){this._data=this._ReadFromFile()}static get IsCompleteAllGuide(){return this.instance._data.isCompleteGuide1&&this.instance._data.isCompleteGuide2&&this.instance._data.isCompleteGuide3&&this.instance._data.isCompleteGuide4&&this.instance._data.isCompleteGuide5}}class Oe{static get inst(){return this.GetInstance()}static InitUma(){if(Laya.Browser.onWeiXin)try{Oe.GetInstance()}catch(t){console.error(t)}else console.warn("不是微信平台，uma不进行初始化")}static GetInstance(){return null==this._inst&&(Laya.Browser.onWeiXin?this._inst=window.wx.uma:this._inst=window.uma),null==this._inst&&console.error("Uma初始化失败！"),this._inst}static setOpenid(t){null!=this._inst&&this._inst.setOpenid(t)}static trackEvent(t,e){this._onWeb&&console.log(t,e),null!=this._inst&&this._inst.trackEvent(t,e)}static trackShare(t){return null==this._inst?t:this._inst.trackShare(t)}static shareAppMessage(t){null!=this._inst&&this._inst.shareAppMessage(t)}}Oe._onWeb=!0,function(t){t.OnGameEnter="OnGameEnter",t.GuideStart="GuideStart",t.GuideEnd="GuideEnd",t.WorldEvent="WorldEvent",t.WorldEvtAD="WorldEvtAD",t.DoubleUI="DoubleUI",t.DoubleAD="DoubleAD",t.LuckWheel="LuckWheel",t.LuckWheelAD="LuckWheelAD",t.Build="Build",t.Help="Help",t.Repair="Repair",t.Update="Update",t.StaffUI="StaffUI",t.Employee="Employee",t.AddStaffPosition="AddStaffPosition",t.MarkertAD="MarkertAD",t.UpdateWaterRoom="UpdateWaterRoom",t.OpenCoffeeUI="OpenCoffeeUI",t.CoffeeAD="CoffeeAD",t.CSSJ="cssj",t.Task="Task",t.BuildingStatistic="BuildingStatistic",t.LoadProgress="LoadProgress",t.GuideProgress="GuideProgress"}($t||($t={}));class Me extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","PGameTalk")}onConstruct(){this.m_type=this.getControllerAt(0),this.m_Bg=this.getChildAt(0),this.m_talk=this.getChildAt(2),this.m_Repair=this.getChildAt(3),this.m_Sweep=this.getChildAt(4),this.m_Help=this.getChildAt(5),this.m_ani=this.getTransitionAt(0)}}Me.URL="ui://8nmf3q47hpmn1d1";class Ee extends l{constructor(){super(...arguments),this.m_UIMediator={},this.m_onShowUI=[],this.m_ifSetMediatroList=!1}setProxyMediatroList(t){this.m_UIMediator=t,this.m_onShowUI=[],this.m_ifSetMediatroList=!0,this.Init()}Init(){}get ifSetMediatroList(){return this.m_ifSetMediatroList}get onShowUIs(){return this.m_onShowUI}getUIMeiatro(t){return this.m_UIMediator[t]}closeUI(t){this.setUIState([{typeIndex:t.keyId,state:!1}],!1)}setUIState(t,e=!0,i={state:!1,dispose:!0},a,n){if(!this.m_ifSetMediatroList)return void console.log(...s.packError("还没有为UI代理类设置代理UI调度者列表！"));for(let e of t)void 0===e.state&&(e.state=!0),void 0===e.dispose&&(e.dispose=!0);void 0===i.dispose&&(i.dispose=!0);let o,r=[],l=[];t=I.ObjUnique(t,t=>t.typeIndex),t=this.statesFilter(t);for(let e of t)e.state?(-1!=(o=this.m_onShowUI.findIndex(t=>t.typeIndex==e.typeIndex))&&this.m_onShowUI.splice(o,1),r.push(e)):-1!=(o=this.m_onShowUI.findIndex(t=>t.typeIndex==e.typeIndex))&&(this.m_onShowUI.splice(o,1),l.push(e));if(e){let t=[];for(let e in this.m_UIMediator)-1==r.findIndex(t=>t.typeIndex==e)&&-1==l.findIndex(t=>t.typeIndex==e)&&t.push({typeIndex:e,state:i.state,dispose:i.dispose});i.state?r.unshift(...t):l.push(...t)}else r.unshift(...this.m_onShowUI);void 0!==a&&(a=I.Unique(a),r=r.filter(t=>-1!=a.findIndex(e=>e==this.m_UIMediator[t.typeIndex].layer))),void 0!==n&&(n=I.Unique(n),l=l.filter(t=>-1!=n.findIndex(e=>e==this.m_UIMediator[t.typeIndex].layer)));for(let t of l)this.m_UIMediator[t.typeIndex].ifBelongUIMediator?console.log(...s.packWarn("注意：有一个附属UI的UI调度者试图被隐藏，KEY为",this.m_UIMediator[t.typeIndex].keyId)):this.hideUIMediator(this.m_UIMediator[t.typeIndex],t.dispose);for(let t of r)this.m_UIMediator[t.typeIndex].ifBelongUIMediator?console.log(...s.packWarn("注意：有一个附属UI的UI调度者试图被显示，KEY为",this.m_UIMediator[t.typeIndex].keyId)):this.showUIMediator(this.m_UIMediator[t.typeIndex]);this.m_onShowUI=r}statesFilter(t){return t.filter(t=>void 0!==this.m_UIMediator[t.typeIndex])}hideUIMediator(t,e,i=!1){t.belongUpUIMediator.length>0&&t.belongUpUIMediator.forEach(t=>{this.hideUIMediator(t,e,!0)}),!i||t.ifBelongUIMediator?t.Hide(e):console.log(...s.packWarn("注意：有一个不是附属UI的UI调度者试图被隐藏，KEY为",t.keyId)),t.belongDownUIMediator.length>0&&t.belongDownUIMediator.forEach(t=>{this.hideUIMediator(t,e,!0)})}showUIMediator(t,e=!1){t.belongDownUIMediator.length>0&&t.belongDownUIMediator.forEach(t=>{this.showUIMediator(t,!0)}),!e||t.ifBelongUIMediator?t.Show():console.log(...s.packWarn("注意：有一个不是附属UI的UI调度者试图被显示，KEY为",t.keyId)),t.belongUpUIMediator.length>0&&t.belongUpUIMediator.forEach(t=>{this.showUIMediator(t,!0)})}}!function(t){t.GameInit="_EEventGlobal_GameInit",t.GameOnInit="_EEventGlobal_GameOnInit",t.GameLoading="_EEventGlobal_GameLoading",t.GameResLoading="_EEventGlobal_GameResLoading"}(te||(te={})),function(t){t.GameLoading="EUI_GameLoading",t.CustomsLoading="EUI_CustomsLoading",t.TestMain="EUI_TestMain",t.TestPlatform="EUI_TestPlatform",t.Set="EUI_Set",t.Pause="EUI_Pause",t.Play="EUI_Play",t.Start="EUI_Start",t.Com="EUI_Com",t.End="EUI_End",t.Main="Main",t.Manager="Manager",t.EventLayer="EventLayer",t.AD="AD",t.LuckyWheel="LuckyWheel",t.Offline="Offline",t.RemoveAD="RemoveAD",t.SuperDouble="SuperDouble",t.Setting="Setting",t.Task="Task",t.Staff="Staff",t.TopPanel="TopPanel",t.EventPanel="EventPanel",t.OffLineIncomePanel="OffLineIncomePanel",t.StaffMarket="StaffMarket",t.StaffInfoPanel="StaffInfoPanel",t.Guide="Guide",t.UIMoneyEffect="UIMoneyEffect",t.UIMediatorCheers="UIMediatorCheers",t.UIMediatorInfluencer="UIMediatorInfluencer",t.UIMeditorRepairGame="UIMeditorRepairGame",t.UIMediatorSpeedUp="UIMediatorSpeedUp",t.UIMediatorFlyPanel="UIMediatorFlyPanel",t.DailySign="DailySign",t.OpenCoffee="OpenCoffee",t.CountDownTime="CountDownTime",t.RecordVideo="RecordVideo",t.TalkPanel="TalkPanel",t.NativeAD="GameAd"}(ee||(ee={}));class Be extends Ee{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new Be),this.m_instance}get gameMainMediator(){return this.getUIMeiatro(ee.Main)}Init(){it.instance.onGlobal(te.GameLoading,this,this.gameLoading),it.instance.onGlobal(te.GameResLoading,this,this.gameResLoading),it.instance.onUI(Nt.SceneGameCustomsLoading,this,this.gameCustomsLoading)}Start(){this.setUIState([{typeIndex:ee.Main},{typeIndex:ee.EventLayer},{typeIndex:ee.TopPanel},{typeIndex:ee.UIMediatorFlyPanel}])}gameLoading(){}gameResLoading(){}gameCustomsLoading(t){-1==t&&this.setUIState([{typeIndex:ee.CustomsLoading}],!1)}}class Ge extends xe{constructor(){super(),this._talkTextList=["非常感谢你，我感觉舒服多了！".i18n(),"你的厕所真的非常舒适，让我感觉好多了！".i18n(),"太舒坦了！这间厕所真的很不错呢！".i18n(),"看到有网红说这里很不错，果然名不虚传啊！".i18n(),"在派上对突然肚子疼，能来到你这里解决真是太好了！".i18n(),"我是慕名过来的，这里的服务和环境都是一流的呢！".i18n()],this._repairText="点击屏幕中的".i18n()+"       /       "+"让雇员前往处理，更快的恢复收益，多多招募雇员吧！".i18n(),this._worldEvtText="点击屏幕右侧跳动的按钮".i18n()+"                             "+"可以获得奖励或者增益效果哦！".i18n(),this._helpText="头顶有".i18n()+"         "+"的客人需要您的帮助，多次点击按钮来帮助他（她）们。".i18n(),this._lastShowTime=0,this._layer=Yt.TalkPanel,this._timer=2e4,this._typeIndex=0}static get instance(){return this.m_instance||(this.m_instance=new Ge,this.m_instance._classDefine=Me),this.m_instance}_OnShow(){console.warn("显示对话事件：",this._typeIndex,this.ui),this.ui.m_type.selectedIndex=this._typeIndex,this.ui.m_ani.play(Laya.Handler.create(this,this.ShowTalk)),this.ui.m_talk.visible=!1,this.ui.m_Repair.visible=!1,this.ui.m_Sweep.visible=!1,this.ui.m_Help.visible=!1,this.ui.m_Bg.onClick(this,this.OnClickClose)}_OnHide(){this._lastShowTime=(new Date).getTime()}ShowTalkPanel(t){if(this.isShow||!Re.IsCompleteAllGuide)return!1;let e=(new Date).getTime()-this._lastShowTime;return e>this._timer?(this._typeIndex=t,Be.instance.setUIState([{typeIndex:ee.TalkPanel,state:!0}],!1)):console.log("时间差小于"+this._timer/1e3+"秒，不显示对话事件:"+e),!0}ShowTalk(){if(this.isShow)if(this.ui.m_talk.visible=!0,0==this._typeIndex||1==this._typeIndex){let t=_e.RangeInt(0,this._talkTextList.length);this.ui.m_talk.title=this._talkTextList[t].i18n()}else 2==this._typeIndex?(this.ui.m_Repair.visible=!0,this.ui.m_Sweep.visible=!0,this.ui.m_talk.text=this._repairText):3==this._typeIndex?this.ui.m_talk.text=this._worldEvtText:4==this._typeIndex&&(this.ui.m_Help.visible=!0,this.ui.m_talk.text=this._helpText)}OnClickClose(){this.isShow&&Be.instance.setUIState([{typeIndex:ee.TalkPanel,state:!1}],!1)}}class Ne extends xe{constructor(){super(),this.offset=new Laya.Vector3(-2,2,0),this._layer=Yt.EventBar,this.helpBtnList=[],this.commomBtnList=[],this.tipBtnList=[],this.mosaicList=[],this._dict={},this._dictHelp={},this._dictRepair={},this._dictMosaic={},this._fillSpeed=.05,this._lastTipTime=0}static get instance(){return this.m_instance||(this.m_instance=new Ne,this.m_instance._classDefine=Pe),this.m_instance}_OnShow(){super.Show(),this.InitBtnList()}InitBtnList(){this.helpBtnList.push({btn:this.ui.m_btn_help_1,screenPos:new Laya.Vector4}),this.helpBtnList.push({btn:this.ui.m_btn_help_2,screenPos:new Laya.Vector4}),this.helpBtnList.push({btn:this.ui.m_btn_help_3,screenPos:new Laya.Vector4}),this.helpBtnList.push({btn:this.ui.m_btn_help_4,screenPos:new Laya.Vector4}),this.helpBtnList.push({btn:this.ui.m_btn_help_5,screenPos:new Laya.Vector4});for(let t of this.helpBtnList)t.btn.visible=!1}InstanceCommBtn(){let t=fairygui.UIPackage.createObject("EventPanel","CommonButton");this.ui.addChild(t);let e={btn:t,screenPos:new Laya.Vector4};this.commomBtnList.push(e),e.btn.visible=!1}InstanceTipBtn(){let t=De.createInstance();this.ui.addChild(t);let e={btn:t,screenPos:new Laya.Vector4};this.tipBtnList.push(e),t.m_fill_green.fillAmount=0,e.btn.visible=!1}InstanceMosaic(){let t=Ue.createInstance();this.ui.addChild(t);let e={img:t,screenPos:new Laya.Vector4};e.img.visible=!1,this.mosaicList.push(e)}EventDistribute(t,e,i,s){switch(i){case Xt.Toilet:this.UpdateSpecialEven(t,e,s);break;case Xt.Building:case Xt.Normal:this.UpdateCommEven(t,e,i,s);break;case Xt.Repair:case Xt.Sweep:case Xt.Money:case Xt.Diamond:this.UpdateRepair(t,e,s,i);break;case Xt.StartRepair:this.StartRepair(e)}}UpdateSpecialEven(t,e,i){let s,a;if((s=this._dictMosaic[e])&&this.MosaicChangePos(t,s),a=this._dict[e]){let s=a.btn;return this.ChangePos(t,a.screenPos,s),s.m_fill_green.fillAmount+=It.deltaTime/i,void(s.m_fill_green.fillAmount>=1&&(s.visible=!1,this._dict[e]=null,this._dictMosaic[e].img.visible=!1,this._dictMosaic[e]=null,it.instance.event3D(A.DoNext,e)))}if(a=this._dictHelp[e]){let i=a.btn;if(this.ChangePos(t,a.screenPos,i),i.m_fill_red.fillAmount+=this._fillSpeed*It.deltaTime,i.m_fill_yellow.fillAmount>i.m_fill_red.fillAmount?i.m_fill_yellow.fillAmount-=this._fillSpeed*It.deltaTime*2:i.m_fill_yellow.fillAmount=i.m_fill_red.fillAmount-.02,i.m_fill_red.fillAmount>=1||i.m_fill_yellow.fillAmount>=1){if(i.m_fill_red.fillAmount>=1){let t=(new Date).getTime();if(t-this._lastTipTime>6e4){Ge.instance.ShowTalkPanel(4)&&(this._lastTipTime=t)}}i.off(Laya.Event.CLICK,this,this.OnClick),this._dictMosaic[e].img.visible=!1,this._dictMosaic[e]=null;let t=i.m_fill_yellow.fillAmount>=1;if(it.instance.event3D(A.DoNext,[e,t]),i.m_fill_yellow.fillAmount>=1)return i.m_switch.selectedIndex=1,void Laya.timer.once(1e3,this,()=>{i.visible=!1,this._dictHelp[e]=null});i.visible=!1,this._dictHelp[e]=null}}else null==this._dictMosaic[e]&&(this._dictMosaic[e]=this.GetMosaicImg()),_e.Range(0,8)<1.5&&Re.IsCompleteAllGuide?null!=(a=this.GetHelpObject(t))&&(this._dictHelp[e]=a):null!=(a=this.GetObject(t,Xt.Normal))&&(this._dict[e]=a)}UpdateCommEven(t,e,i,s){let a;if(a=this._dict[e]){let i=a.btn;return this.ChangePos(t,a.screenPos,i),i.m_fill_green.fillAmount+=It.deltaTime/s,void(i.m_fill_green.fillAmount>=1&&(i.visible=!1,this._dict[e]=null,it.instance.event3D(A.DoNext,e)))}null!=(a=this.GetObject(t,i))&&(this._dict[e]=a)}UpdateRepair(t,e,i,s){let a;if(a=this._dictRepair[e]){let s=a.btn;return this.NoSkewChangePos(t,a.screenPos,s),void(2==a.btn.m_runtime.selectedIndex&&(s.m_fill_green.fillAmount+=It.deltaTime/i,s.m_fill_green.fillAmount>=1&&(console.log("======维修结束===="),s.visible=!1,this._dictRepair[e]=null,it.instance.eventUI(Nt.RepairProgressComplete,e))))}null!=(a=this.GetTipObject(t,e,s))&&(this._dictRepair[e]=a)}NoSkewChangePos(t,e,i){this.isShow&&(Lt.instance.camera.worldToViewportPoint(t,e),i.x=e.x,i.y=e.y-70*Ne.scale,i.scaleX=Ne.scale,i.scaleY=Ne.scale)}ChangePos(t,e,i){this.isShow&&(Lt.instance.camera.worldToViewportPoint(t,e),i.x=e.x,i.y=e.y-80*Ne.scale,i.scaleX=Ne.scale,i.scaleY=Ne.scale)}MosaicChangePos(t,e){this.isShow&&(Lt.instance.camera.worldToViewportPoint(t,e.screenPos),e.img.x=e.screenPos.x,e.img.y=e.screenPos.y-20*Ne.scale+15,e.img.scaleX=Ne.scale,e.img.scaleY=Ne.scale)}InitButton(t){t.m_fill_red.fillAmount=.05,t.m_switch.selectedIndex=0,t.scaleX=.7,t.scaleY=.7,t.m_fill_yellow.fillAmount=t.m_fill_red.fillAmount,t.on(Laya.Event.CLICK,this,this.OnClick,[t])}InitTipButton(t,e){t.m_runtime.setSelectedIndex(0),t.onClick(this,()=>{switch(t.m_state.selectedIndex){case 0:case 1:0==t.m_runtime.selectedIndex&&(it.instance.eventUI(Nt.OnClickRepairBtn),t.m_runtime.selectedIndex=1,Oe.trackEvent($t.Repair));break;case 2:case 3:it.instance.eventUI(Nt.OnClickTip,e),t.visible=!1}})}OnClick(t){t.m_fill_yellow.fillAmount+=.1,Oe.trackEvent($t.Help)}GetObject(t,e){let i;for(let s of this.commomBtnList)if(!s.btn.visible){i=s,e==Xt.Building?(i.btn.m_state.setSelectedIndex(1),i.btn.scaleX=2,i.btn.scaleY=2):(i.btn.m_state.setSelectedIndex(0),i.btn.scaleX=1,i.btn.scaleY=1),i.btn.m_fill_green.fillAmount=.05,this.ChangePos(t,i.screenPos,i.btn),i.btn.visible=!0;break}return null==i&&Laya.timer.once(0,this,this.InstanceCommBtn),i}GetHelpObject(t){let e=null;for(let i of this.helpBtnList)if(!i.btn.visible){e=i,this.InitButton(e.btn),this.ChangePos(t,e.screenPos,e.btn),e.btn.visible=!0;break}return e}GetTipObject(t,e,i){let s;for(let a of this.tipBtnList)if(!a.btn.visible){switch(s=a,this.InitTipButton(s.btn,e),i){case Xt.Repair:s.btn.m_state.selectedIndex=0;break;case Xt.Sweep:s.btn.m_state.selectedIndex=1;break;case Xt.Money:s.btn.m_state.selectedIndex=2;break;case Xt.Diamond:s.btn.m_state.selectedIndex=3}s.btn.m_runtime.setSelectedIndex(0),s.btn.m_fill_green.fillAmount=0,this.ChangePos(t,s.screenPos,s.btn),s.btn.visible=!0;break}return null==s&&(console.log("tipBtnList没有可用的"),Laya.timer.once(0,this,this.InstanceTipBtn)),s}GetMosaicImg(){let t;for(let e of this.mosaicList)if(!e.img.visible){(t=e).img.visible=!0;break}if(null==t){Laya.timer.once(0,this,this.InstanceMosaic);for(let e of this.mosaicList)if(!e.img.visible){(t=e).img.visible=!0;break}}return null==t&&console.warn("警告！警告！返回了一个空的mosaic"),t}StartRepair(t){this._dictRepair[t]?(console.log("======开始维修====="),this._dictRepair[t].btn.m_runtime.selectedIndex=2):console.warn("_dictRepair[{0}]不存在",t)}RecycleBtn(t,e){let i=this._dictRepair[t];if(i)return i.btn.visible=!1,this._dictRepair[t]=null,void it.instance.eventUI(Nt.RepairProgressComplete,t);console.error("回收失败"+t+e)}_OnHide(){super.Hide()}}Ne.scale=1;class Fe extends fe{constructor(){super(...arguments),this._maxForce=5,this._minForce=1,this._damp=0,this._appleForce=new Laya.Vector3,this._maxSize=0,this._minSize=1,this._scaleSpeed=1,this.localPosition=new Laya.Vector3(0,-10,0),this.oneTouch=!1,this.twoTouch=!1,this.hasTwoTouch=!1,this.posOne=new Laya.Vector2,this.posTwo=new Laya.Vector2,this._onDrag=!0,this._onScale=!0,this.offSet=new Laya.Vector3(0,26.66,50),this._targetPos=new Laya.Vector3,this._lookPos=new Laya.Vector3}static get instance(){return this._instance}get Input(){return this._scene.input}get _unTouch(){return!this.oneTouch&&!this.twoTouch}get isOneTouch(){return this.oneTouch&&!this.twoTouch}get isTwoTouch(){return this.oneTouch&&this.twoTouch&&this.hasTwoTouch}get _scene(){return et.s3d}onAwake(){Fe._instance=this}Init(t){let e=t.getChildByName("Cube");this.parent=e.transform,this._damp=bt.instance.data.damp,this._maxForce=bt.instance.data.maxForce,this._minForce=bt.instance.data.minForce,this._rigidBody=e.getComponent(Laya.Rigidbody3D),this._rigidBody.linearDamping=bt.instance.data.damp,this._rigidBody.linearFactor=new Laya.Vector3(1,0,1),this._rigidBody.angularFactor=new Laya.Vector3(0,0,0),e.addChild(this.owner),this.transform.localPosition=this.localPosition,et.camera.transform.rotationEuler=new Laya.Vector3(-45,0,0),this._maxSize=bt.instance.data.orthographic_MaxSize,this._minSize=bt.instance.data.orthographic_MinSize,this._scaleSpeed=bt.instance.data.scaleSpeed}MoveByForce(t,e){(t^t+e*e)<.3?this._rigidBody.linearDamping<=0&&(this._rigidBody.linearDamping=this._damp):this._rigidBody.linearDamping>0&&(this._rigidBody.linearDamping=0);let i=(et.camera.orthographicVerticalSize-this._minSize)/(this._maxSize-this._minSize),s=wt.Lerp(this._minForce,this._maxForce,i);this._appleForce.x=t*s,this._appleForce.z=e*s,this._rigidBody.wakeUp(),this._rigidBody.linearVelocity=this._appleForce}Scale(t){t*=this._scaleSpeed;let e=et.camera.orthographicVerticalSize+t;e=wt.Clamp(this._minSize,this._maxSize,e),et.camera.orthographicVerticalSize=e,Ne.scale=this._maxSize/e*.8+.2}onUpdate(){this.TouchCountCheck(),this.Run()}onLateUpdate(){}TouchCountCheck(){let t=this._scene.input.touchCount();0==t?(this.oneTouch=!1,this.twoTouch=!1,this.hasTwoTouch=!1,this._onDrag=!0,this._onScale=!0):1==t?(this.oneTouch=!0,this.hasTwoTouch=!1,this._onScale=!0):2==t&&(this.oneTouch=!0,this.twoTouch=!0,this.hasTwoTouch=!0)}Run(){if(this.isTwoTouch)if(this._onScale){let t=this.Input.getTouch(0).position;this.SetPos(this.posOne,t);let e=this.Input.getTouch(1).position;this.SetPos(this.posTwo,e),this._onScale=!1}else{let t=this.Input.getTouch(0).position,e=this.Input.getTouch(1).position,i=this.GetDistance(t,e),s=this.GetDistance(this.posOne,this.posTwo);this.SetPos(this.posOne,t),this.SetPos(this.posTwo,e),this.Scale(s-i)}else if(this.isOneTouch)if(this._onDrag){let t=this.Input.getTouch(0).position;this.SetPos(this.posOne,t),this._onDrag=!1}else{let t=this.Input.getTouch(0).position,e=t.x-this.posOne.x,i=t.y-this.posOne.y;this.SetPos(this.posOne,t),this.MoveByForce(-e,-i)}(this._unTouch||this.oneTouch&&this.twoTouch)&&this._rigidBody.linearDamping<=0&&(this._rigidBody.linearDamping=this._damp)}SetPos(t,e){t.x=e.x,t.y=e.y}GetDistance(t,e){let i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)}FocusPositionByIndex(t,e=!0){let i=Le.instance.dataList[t];return this.FocusPosition(i,e),i}FocusBuild(t){let e=Le.instance.dataList[t];this.FocusPosition({x:e.x,y:e.y,z:e.z+1.5},!1)}FocusPosition(t,e=!0,i=null){let s=new Laya.Vector3(-t.x,t.y,t.z),a=this.parent.position;Laya.Vector3.add(s,this.offSet,s),e&&(et.camera.orthographicVerticalSize=bt.instance.data.orthographic_MinSize,Ne.scale=this._maxSize/et.camera.orthographicVerticalSize*.8+.2),Laya.Tween.to(a,{x:s.x,z:s.z,update:new Laya.Handler(this,t=>{this.parent.position=t},[a])},200,Laya.Ease.sineOut,i)}ComOffSet(){let t=new Laya.Vector2,e=new Laya.Ray(new Laya.Vector3,new Laya.Vector3);et.camera.viewportPointToRay(t,e);let i=new Laya.HitResult;et.s3d.physicsSimulation.rayCast(e,i,1e3,2),Laya.Vector3.subtract(this.transform.position,i.point,this.offSet)}LookAt(t){this._lookPos.setValue(t.x,0,t.z),Laya.Vector3.add(this._lookPos,this.offSet,this._lookPos),this.parent.position.x=this._lookPos.x,this.parent.position.z=this._lookPos.z,this.parent.position=this.parent.position}}!function(t){t.config=class{},t.path="res/config/TaskConfig.json"}(ie||(ie={}));class Ve extends T{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new Ve),this._instance}initData(){this.m_dataList=ie.dataList}}class We{constructor(){}static DoConverter(t){if(t=Math.floor(t),this.moneyStr=t.toString().trim(),this.moneyStr.length>3&&this.moneyStr.length<7)return this.moneyStr.slice(0,this.moneyStr.length-3)+","+this.moneyStr.slice(this.moneyStr.length-3);if(this.moneyStr.length>6){let t=Math.floor((this.moneyStr.length-6)/3);if(t>3)return"NAN";let e=this.moneyStr.substring(0,this.moneyStr.length-3*(t+1)),i=this.moneyStr[this.moneyStr.length-3*(t+1)];return parseInt(i)>=5&&(e=(parseInt(e)+1).toString()).length>5?this.DoConverter(1e3*(parseInt(e)+1)*(t+1)):e.length>3?e.slice(0,e.length-3)+","+e.slice(e.length-3).concat(this.unit[t]):e.concat(this.unit[t])}return this.moneyStr}static TaskDoConverter(t){if(t=Math.floor(t),this.moneyStr=t.toString().trim(),this.moneyStr.length>3){let t=Math.floor((this.moneyStr.length-4)/3);if(t>3)return"NAN";let e=this.moneyStr.substring(0,this.moneyStr.length-3*(t+1)),i=this.moneyStr[this.moneyStr.length-3*(t+1)];return parseInt(i)>=5&&(e=(parseInt(e)+1).toString()).length>3?this.TaskDoConverter(1e3*(parseInt(e)+1)*(t+1)):e.concat(this.unit[t])}return this.moneyStr}}We.moneyStr="",We.unit=["k","M","B","T"];class je{constructor(t){this.index=t,this.name=Ve.instance.dataList[t].name.i18n(),this.describe=Ve.instance.dataList[t].describe.i18n(),this.reward=Ve.instance.dataList[t].reward,this.rewardType=Ve.instance.dataList[t].reward_type,this.record=0,this.progress=0,this.condition=Ve.instance.dataList[t].condition}CheckProgress(t){return this.progress}Init(){console.log("method(Init) not implement")}get NextTask(){return this.index+1}toProgressString(){return this.progress>=100?"完成":Math.floor(this.record)+"/"+this.condition}toSimpleProgressString(){return this.progress>=100?"完成":We.TaskDoConverter(this.record)+"/"+We.TaskDoConverter(this.condition)}Go(){console.log("method(Go) not implement")}}class qe{}!function(t){t[t.UpdateFlow=0]="UpdateFlow",t[t.UpdateFemaleSink=1]="UpdateFemaleSink",t[t.UpdateMt=2]="UpdateMt",t[t.UpdateSewage=3]="UpdateSewage",t[t.UpdateMaleSink=4]="UpdateMaleSink",t[t.UpdateUrinal=5]="UpdateUrinal",t[t.UpdatePaper=6]="UpdatePaper",t[t.BuildMaleToilet=7]="BuildMaleToilet",t[t.BuildFemaleToilet=8]="BuildFemaleToilet",t[t.UpdateTrash=9]="UpdateTrash",t[t.Guest=10]="Guest",t[t.Money=11]="Money"}(se||(se={}));class He{constructor(t,e,i,s,a){this.count=t,this.name=e,this.UID=i,this.costWater=a,this.costMoney=s}}class ze extends ct{ReSort(){this.list.sort((t,e)=>t.costMoney<e.costMoney?1:t.costMoney==e.costMoney?0:-1)}}class Qe extends lt{constructor(){super(),this.InitData(),it.instance.onUI(Nt.BuildConstruction,this,this.OnBuildConstruction)}static get instance(){return null==this._instance&&(this._instance=new Qe),this._instance}Save(){console.log("保存数据"),this._SaveToDisk(this._data)}static get data(){return this.instance._data}get data(){return this._data}get _saveName(){return"BuildData"}getNewData(){return new ze}GetBuildDataByName(t){return this.dict.get(t)}InitData(){if(this._data=this._ReadFromFile(),this.dict=new Map,null==this._data.list||this._data.list.length<=0){this._data.list=[];for(let t of Ce.instance.dataList)this._data.list.push(new He(t.defaultCount,t.name,t.UID,t.money,t.water))}for(let t of this._data.list)this.dict.set(t.name,t)}OnBuildConstruction(t,e){let i=this.dict.get(e);if(!i)throw new ye("按照名字获取Data失败，导致升级失败",t,e);{let t=be.instance.dataList[i.UID].maxCount,s=null,a=null;if(i.count<=t){i.count+=1;let n=i.name==jt.maleToilet,o=i.count+1;if(i.count+1<=t)switch(e){case jt.maleToilet:s=we.instance.dataList[o].maleMoney,a=we.instance.dataList[o].maleWater;break;case jt.femaleToilet:s=we.instance.dataList[o].femaleMoney,a=we.instance.dataList[o].femaleWater;break;case jt.disableRoom:s=we.instance.dataList[o].disableMoney,a=we.instance.dataList[o].disableWater;break;case jt.babyRoom:s=we.instance.dataList[o].babyMoney,a=we.instance.dataList[o].babyWater;break;default:console.log("没有设置case：",e)}if(console.log(e,"下一级花费",s,a),it.instance.eventUI(Nt.CostMoney,i.costMoney),i.costMoney=s||0,i.costWater=a||0,this._tempDataCount=i.count,this._tempBuidlingName=e,this._tempIsMale=n,Oe.trackEvent($t.Build,{Building_name:i.name+"_Building_count_"+i.count.toString()}),it.instance.eventUI(Nt.BuildComplete,e),e==jt.maleToilet||e==jt.femaleToilet){let t=new qe;t.evt=e==jt.maleToilet?se.BuildMaleToilet:se.BuildFemaleToilet,it.instance.eventUI(Nt.TaskEvent,t);let s=this.GetFocusPos(i.count,n),a=this.GetFocusIndex(i.count,n);new Laya.Vector3(s.x,0,s.z);Fe.instance.FocusPositionByIndex(a)}else e==jt.Library?Fe.instance.FocusPositionByIndex(22):e==jt.canteen&&Fe.instance.FocusPositionByIndex(23);Laya.timer.once(500,this,this.EventBuildingComplete),this._SaveToDisk(this._data)}else console.log("当前建筑已经达到最大级:",e,i.count,i)}}EventBuildingComplete(){it.instance.event3D(A.OpenBuildBlock,[this._tempDataCount,this._tempIsMale]),it.instance.event3D(A.UpdateBuildingData,{Name:this._tempBuidlingName,Count:this._tempDataCount}),Laya.timer.clearAll(this)}GetFocusPos(t,e){let i=this.GetFocusIndex(t,e);return Le.instance.dataList[i]}GetFocusIndex(t,e){return e?24+t:30+t}}class Je extends fe{constructor(){super(...arguments),this._array={},this._dict=new Map,this._facTable=new Map,this._facList=[],this._guestToFac=new Map,this._maleList=new Array(20),this._femaleList=new Array(20),this._peeList=new Array(20),this._femaleSinkList=new Array(1),this._maleSinkList=new Array(1),this._libraryList=new Array(1),this._canteenList=new Array(1),this._MaxSizePee=4,this._MaxSizeMale=4,this._MaxSizeFemale=4,this._endPointTable={},this._queuePosTable={},this._flow=0,this._doorList=[],this._StatisticsArray=[]}static get instance(){return this._instance}get buildingMap(){return this._dict}onAwake(){Je._instance=this,it.instance.on3D(A.UpdateBuildingOutlookEvent,this,this.UpdateBuildingOutlookEvent),it.instance.on3D(A.UpdateSlotOutLook,this,this.UpdateSlotOutLookEvent),Laya.timer.once(1500,this,this.UpdateCheck),it.instance.onUI(Nt.DamageSlot,this,this.DamageSlot)}UpdateCheck(){Laya.timer.loop(500,this,this.CheckQueue)}SetPrefabs(t){this._prefabs=t,this.InitDoorManager(t)}AddBuild(t,e){let i=e,s=this._array[i];if(s){s.indexOf(t)<0?s.push(t):console.error("重复添加建筑:",t)}else this._array[i]=[],this._array[i].push(t);null==this._dict.get(t.buildingName)?this._dict.set(t.buildingName,t):console.error("字典中已经包含相同键"),this.UpdateBlockState(e,t),this.AddFacsByList(e,t.slotPosList),this.AddEndPoint(e,t),this.AddPosPlane(e,t),this.UpdateWaitAreaSize(t)}ExistBuilding(t){let e=this._array[t];return e&&e.length>0}GetBuildingByName(t){return this._dict.get(t)}GetBuildingListByFunctionID(t){return this._array[t]}UpdateBuildingOutlookEvent(t){if(!t)throw new pe("建筑脚本获取失败，参数不应为null");{let e=this._dict.get(t.buildingName);if(!e)throw new ye("建筑脚本获取失败!"+t.buildingName,t);if(e.InitBuilding(t.buildingData,!0),this.AddFacsByList(e.functionID,e.slotPosList),this.UpdateWaitAreaSize(e),e.functionID==qt.MaleToilet){this.GetBuildingByName(jt.PeeArea).UpdateFacOutLook()}}let e=this.GetBuildingListByFunctionID(t.buildingData.functionID);for(let i of e)this.UpdateBlockState(t.buildingData.functionID,i)}UpdateBlockState(t,e){switch(t){case qt.MaleToilet:let i=Qe.instance.GetBuildDataByName(jt.maleToilet);e.sprite3D.active=e.index<=i.count+1;break;case qt.FemaleToilte:let s=Qe.instance.GetBuildDataByName(jt.femaleToilet);e.sprite3D.active=e.index<=2*s.count+2}}UpdateSlotOutLookEvent(t){let e=this._dict.get(t.building.buildingName);if(e){let i=e.slots[t.slotIndex];e.UpdateFacilityLevel(i.name+"_"+t.slotIndex.toString(),i.level,!0,i),this.AddFacsByList(e.functionID,e.slotPosList),this.UpdateWaitAreaSize(e),it.instance.event3D(A.OnUpdateSlotComplete);let s=e.developProgress;Oe.trackEvent($t.BuildingStatistic,{progress:e.buildingName+"_"+Math.floor(100*s)})}else console.error("建筑管理者获取建筑失败，无法升级slot！")}get flow(){return this._flow}get MaxSizeMale(){return this._MaxSizeMale}get MaxSizePee(){return this._MaxSizePee}get MaxSizeFemale(){return this._MaxSizeFemale}get femaleQueueCount(){return this.GetCount(this._femaleList,this._MaxSizeFemale)}get maleQueueCount(){return this.GetCount(this._maleList,this._MaxSizeMale)}get peeQueueCount(){return this.GetCount(this._peeList,this._MaxSizePee)}AddFacsByList(t,e){if(e&&e.length>0)for(let i of e)this.AddFac(t,i)}AddFac(t,e){let i=this._facTable.get(t);null==i&&(i=[],this._facTable.set(t,i)),this.Contain(i,e)?console.error("重复添加设备",e):(i.push(e),this._facList.push(e))}AddEndPoint(t,e){switch(t){case qt.WaitAera:this.AddEndPointForWaitArea(e);break;case qt.MalePee:case qt.FemaleToilte:case qt.MaleToilet:break;default:this.AddEndPointForNormalBuilding(t,e)}}AddEndPointForNormalBuilding(t,e){if(null==this._endPointTable[t]){let i=e.owner.getChildByName(jt.entrance);if(i){let s=i.numChildren-1,a=i.getChildAt(s);a?this._endPointTable[t]=a:console.log("此功能的建筑没有设置队列入口",e)}}else console.error("此功能建筑的队列入口已经存在：",t)}AddEndPointForWaitArea(t){let e=t.owner.getChildByName(jt.EP_Female),i=t.owner.getChildByName(jt.EP_Male),s=t.owner.getChildByName(jt.EP_Pee);this._endPointTable[qt.FemaleToilte]=e,this._endPointTable[qt.MaleToilet]=i,this._endPointTable[qt.MalePee]=s}AddPosPlane(t,e){switch(t){case qt.MaleToilet:case qt.FemaleToilte:case qt.MalePee:break;case qt.WaitAera:this.AddPlaneFromWaitArea(e);break;default:this.AddPlaneFromNormalBuilding(t,e)}}AddPlaneFromWaitArea(t){let e=t.owner.getChildByName(jt.equipment),i=e.getChildByName(jt.slot_femaleQueue_config_1);this.AddPlaneForFunction(qt.FemaleToilte,[],i);let s=e.getChildByName(jt.slot_maleQueue_config_3);this.AddPlaneForFunction(qt.MaleToilet,[],s);let a=e.getChildByName(jt.slot_peeQueue_config_2);this.AddPlaneForFunction(qt.MalePee,[],a)}AddPlaneFromNormalBuilding(t,e){let i=e.owner.getChildByName(jt.entrance);this.AddPlaneForFunction(t,[],i)}AddPlaneForFunction(t,e,i){let s=i.numChildren;if(s>0)for(let t=0;t<s;t++){let s=i.getChildByName(t.toString());e.push(s)}this._queuePosTable[t]=e}Contain(t,e){return t.forEach(t=>{if(t.sprite.id==e.sprite.id)return!0}),!1}UpdateWaitAreaSize(t){let e=t.slots;for(let t of e)switch(t.uid){case Se.Data.slot_peeQueue_config:let e=me.instance.GetSlotConfigByUID(t.uid)[t.level].length;if(!e)throw"无法获取小便区当前等级排队人数";this._MaxSizePee=e;break;case Se.Data.slot_maleQueue_config:let i=me.instance.GetSlotConfigByUID(t.uid)[t.level].length;if(!i)throw"无法获取男厕所当前等级排队人数";this._MaxSizeMale=i;break;case Se.Data.slot_femaleQueue_config:let s=me.instance.GetSlotConfigByUID(t.uid)[t.level].length;if(!s)throw"无法获取女厕所当前等级排队人数";this._MaxSizeFemale=s;break;case Se.Data.slot_flow_config:let a=me.instance.GetSlotConfigByUID(t.uid)[t.level].length;if(!a)throw"无法获取当前等级人流量";this._flow=a,it.instance.event3D(A.UpdateMaxFlow,a)}}CheckQueue(){this.DispatchGuest(qt.MaleToilet,this._maleList),this.DispatchGuest(qt.MalePee,this._peeList),this.DispatchGuest(qt.FemaleToilte,this._femaleList),this.DispatchGuest(qt.FemaleSink,this._femaleSinkList),this.DispatchGuest(qt.MaleSink,this._maleSinkList),this.DispatchGuest(qt.Library,this._libraryList),this.DispatchGuest(qt.Canteen,this._canteenList)}DispatchGuest(t,e){let i=this.GetEmptyFuncPos(t);if(i){let s=this.PopGuest(t,e);if(s){let t=i.belonger.entrance.transform.position,e=i.belonger.exit.transform.position;i.peopleSprite=s.sprite3D,this._guestToFac.set(s.sprite3D.id,i),s.MoveToEntrancePos({entrance:t,exit:e,funcPos:i.sprite.transform.position,slot:i.slotData,fac:i})}}}PopGuest(t,e){let i=this.GetMaxSizeByFunction(t);for(let t=0;t<i;t++)if(e[t]){let i=e[t];return e[t]=null,i}return null}GetEmptyFuncPos(t){let e=this._facTable.get(t);if(null==e||e.length<=0)return null;for(let t of e)if(null==t.peopleSprite&&t.belonger.active&&t.slotData.level>0&&t.slotData.usable&&!t.isBreaking)return t;return null}GetQueue(t){switch(t){case qt.MaleToilet:return this._maleList;case qt.FemaleToilte:return this._femaleList;case qt.MalePee:return this._peeList;case qt.FemaleSink:return this._femaleSinkList;case qt.MaleSink:return this._maleSinkList;case qt.Library:return this._libraryList;case qt.Canteen:return this._canteenList;default:return console.error("获取等待列表失败:",t),null}}GetMaxSizeByFunction(t){switch(t){case qt.MalePee:return this._MaxSizePee;case qt.FemaleToilte:return this._MaxSizeFemale;case qt.MaleToilet:return this._MaxSizeMale;default:return 1}}GetPlaneList(t){return this._queuePosTable[t]}GetCount(t,e){let i=0;for(let s=0;s<e;s++)t[s]&&i++;return i}GetEndPoint(t){switch(t){case qt.Library:case qt.Canteen:let e=this.GetBuildingListByFunctionID(t)[0];if(null!=e&&e.active)break;return null}return this._endPointTable[t]}TrtEnqueue(t,e,i){try{let s=this.GetQueue(t);if(s){let e=this.GetMaxSizeByFunction(t),a=this.GetPlaneList(t)[e].transform.position;i.setValue(a.x,a.y,a.z);let n=this.GetCount(s,e);return s&&n<e}}catch(s){throw console.error(t,e,i),s}}ExistInQueue(t,e){return this.GetQueue(t).indexOf(e)>-1}GetNextPointInQueue(t,e){let i=this.GetQueue(t),s=this.GetMaxSizeByFunction(t),a=this.GetPlaneList(t);if(i){let t=i.indexOf(e);if(t>-1){let s=t-1;if(s>=0&&null==i[s])return i[t]=null,i[s]=e,a[s].transform.position}else{let t=s-1;if(null==i[t])return i[t]=e,a[t].transform.position}}return null}RequestOpenTheDoor(t){return this.TryOpenDoor(t.transform.position)}ResetFac(t){let e=this._guestToFac.get(t.sprite3D.id);e&&(e.peopleSprite=null,this._guestToFac.delete(t.sprite3D.id),this.RandomBreakFacility(e))}RandomBreakFacility(t){if(!Re.IsCompleteAllGuide)return;if(_e.Range(0,100)<7){let e=_e.random>.5,i=!1;switch(t.slotData.uid){case Se.Data.slot_mt_config:let s=Ie.PlayEffect(e?Bt.Toilet_dirty:Bt.Toilet_damage,t.sprite.id);t.sprite.addChild(s),s.transform.localPosition=Ct.zero,s.transform.rotationEuler=t.sprite.transform.rotationEuler,i=!0;break;case Se.Data.slot_urinal_config:let a=Ie.PlayEffect(e?Bt.Pee_dirty:Bt.Pee_Damage,t.sprite.id);t.sprite.addChild(a),a.transform.localPosition=Ct.zero,a.transform.rotationEuler=t.sprite.transform.rotationEuler,i=!0;break;case Se.Data.slot_wash_basin_man_config:case Se.Data.slot_wash_basin_woman_config:let n=Ie.PlayEffect(e?Bt.Sink_Dirty:Bt.Sink_Damage,t.sprite.id);t.sprite.addChild(n),n.transform.localPosition=Ct.zero,n.transform.rotationEuler=t.sprite.transform.rotationEuler,i=!0;break;default:i=!1}i&&(t.SetBreakState(!0,e?Xt.Sweep:Xt.Repair),it.instance.event3D(A.RepairFacility,t))}}DamageSlot(){let t=this.GetBuildingListByFunctionID(qt.MaleSink)[0].slotPosList[0];if(t){let e=Ie.PlayEffect(Bt.Toilet_damage,t.sprite.id);t.sprite.addChild(e),e.transform.localPosition=Ct.zero,e.transform.rotationEuler=t.sprite.transform.rotationEuler,t.SetBreakState(!0,Xt.Repair),it.instance.event3D(A.RepairFacility,t)}else console.error("派发损坏失败!");it.instance.offUI(Nt.DamageSlot,this,this.DamageSlot)}InitDoorManager(t){let e=t[Et.prefab5.Door];if(!(e&&e.length>0))throw new Error("建筑管理者初始化门失败！");this._doorList=e,it.instance.on3D(A.SetDoorActive,this,this.SetDoorActive)}GetDoorByPos(t){let e=1/0,i=null;for(let s of this._doorList){let a=Laya.Vector3.distanceSquared(s.transform.position,t);a<e&&(e=a,i=s)}return i}TryOpenDoor(t,e=!0){let i=this.GetDoorByPos(t),s=Laya.Vector3.distanceSquared(t,i.transform.position);if(i){if(s>100)return console.error("距离门太远了",s,t),!1;{let t=i.getComponent(Laya.Animator);return t.play("open"),e&&(Laya.timer.clearAll(t),Laya.timer.once(3500,t,()=>t.play("close"))),!0}}return!1}TryCloseDoor(t){let e=this.GetDoorByPos(t),i=Laya.Vector3.distanceSquared(t,e.transform.position);if(e){if(i>100)return console.error("距离门太远了",i,t),!1;return e.getComponent(Laya.Animator).play("close"),!0}return!1}SetDoorActive(t,e){let i=this.GetDoorByPos(t);i&&(i.active=e)}GetBuildingEntrance(t){return this._array[t][0].entrance}GetStatisticsInfo(){let t=Je.instance.buildingMap;return this._StatisticsArray=[],t.forEach(t=>{if(t.active){let e=t;if(e.income>0){let t={functionID:e.functionID,title:e.title,buildingName:e.buildingName,income:e.income,progress:e.developProgress};this._StatisticsArray.push(t)}}}),this._StatisticsArray}GetTotalMoney(){this.GetStatisticsInfo();let t=0;return this._StatisticsArray.length>0&&this._StatisticsArray.forEach(e=>{t+=e.income}),t}}class Ke{constructor(t,e){this.loops=1,this.time=0,this.runTimes=0,this.time=t.getTime(),this.localTimeString=t.toLocaleTimeString(),this.event=e,this.Immediately(!1)}get isDone(){return this.loops>=0&&this.runTimes>=this.loops}UpdateClockTime(t,e=!0){let i=new Date(t),s=new Date(this.time),a=e?s.getDate()+1:s.getDate()-1,n=new Date(i.getFullYear(),i.getMonth(),a,s.getHours(),s.getMinutes(),s.getSeconds());this.time=n.getTime()}Check(t){t>this.time&&(this.runTimes++,this.isDone||this.UpdateClockTime(t),this.DispatchEvent())}SetLoop(t){this.loops=t}DispatchEvent(){console.log(this.localTimeString,"广播",this.event),it.instance.event(this.event)}ResetEvent(t){this.event=t,this.runTimes=0}Immediately(t=!1){if(t){let t=(new Date).getTime();this.time>t&&this.UpdateClockTime(t,!1)}else{let t=(new Date).getTime();this.time<t&&this.UpdateClockTime(t)}return this}}class Ze extends ct{constructor(){super(...arguments),this.List=[],this.TickEvent=[]}}class Ye extends lt{constructor(){super(),this._hasRun=!1,this._clockEvtDict=new Map,this._tempAdd=[],this._tempSub=[],this._offClock=[],this._onClock=[],this._isDirty=!1,this._isTicking=!1,this.InitData()}static get instance(){return null==this._instance&&(this._instance=new Ye),this._instance}get _saveName(){return"ClockManagerData"}getNewData(){return new Ze}InitData(){this._data=this._ReadFromFile();let t=[];for(let e of this._data.List){let i=this._clockEvtDict.get(e.event);null==i&&(i={},this._clockEvtDict.set(e.event,i)),e=i[e.localTimeString]=new Ke(new Date(e.time),e.event),t.push(e)}this._data.List=t}get isTicking(){return this._isTicking}set isTicking(t){this._isTicking=t}get _clockList(){return this._data.List}get _tickEventList(){return this._data.TickEvent}Start(){this._hasRun=!0,console.log("计时器启动..."),Laya.timer.loop(1e3,this,this.Tick)}AddClock(t,e){let i=null,s=t.toLocaleTimeString(),a=this._clockEvtDict.get(e);if(null==a?(a={},this._clockEvtDict.set(e,a),i=a[s]=new Ke(t,e)):null==(i=a[s])&&(i=a[s]=new Ke(t,e)),this.isTicking)this._onClock.push(i),this.SetDirty();else{this.indexOf(this._clockList,i)<0&&(this._clockList.push(i),this.Save())}return i}Tick(){this._isTicking=!0,this.OnTick(),this.AfterTick(),this._isTicking=!1}OnTick(){let t=new Date;for(let e of this._clockList)e.Check(t.getTime()),e.isDone&&this._offClock.push(e);for(let t of this._tickEventList)it.instance.event(t)}AfterTick(){this.SpliceElement(this._tempSub,this._tickEventList),this.SpliceElement(this._offClock,this._clockList),this.PushElement(this._tempAdd,this._tickEventList),this.PushElement(this._onClock,this._clockList);for(let t of this._offClock)this.DisposeClock(t);this._tempAdd.length>0&&(this._tempAdd=[]),this._tempSub.length>0&&(this._tempSub=[]),this._offClock.length>0&&(this._offClock=[]),this._onClock.length>0&&(this._onClock=[]),this._isDirty&&(this.Save(),this._isDirty=!1)}indexOf(t,e){if(null==t||t.length<=0||null==e)return-1;for(let i=0;i<t.length;i++){let s=t[i];if(s.event==e.event&&s.localTimeString==e.localTimeString)return i}return-1}PushElement(t,e){if(t.length>0)for(let i of t){let t=-1;(t=i instanceof Ke?this.indexOf(e,i):e.indexOf(i))<0&&e.push(i)}}SpliceElement(t,e){if(t.length>0&&e.length>0)for(let i of t){if(0==e.length)break;let t=-1;(t=i instanceof Ke?this.indexOf(e,i):e.indexOf(i))>-1&&e.splice(t,1)}}SetDirty(){this._isDirty=!0}Save(){this._SaveToDisk(this._data)}ClearUnusedClock(){for(let t of this._clockList)it.instance.hasListener(t.event)||this._offClock.push(t)}DisposeClock(t){if(t){let e=this._clockEvtDict.get(t.event);delete e[t.localTimeString],Object.keys(e).length<=0&&this._clockEvtDict.delete(t.event);let i=this.indexOf(this._clockList,t);i>-1&&this._clockList.splice(i,1)}}static OnTick(t){if(this.instance._isTicking)this.instance._tempAdd.push(t),this.instance.SetDirty();else{this._instance._tickEventList.indexOf(t)<0&&this._instance._tickEventList.push(t),this.instance.Save()}}static OffTick(t){if(this.instance._isTicking)this.instance._tempSub.push(t),this.instance.SetDirty();else{let e=this._instance._tickEventList.indexOf(t);e>-1&&this._instance._tickEventList.splice(e,1),Ye.instance.Save()}}static AddClock(t,e,i,s){let a=new Date,n=new Date(a.getFullYear(),a.getMonth(),a.getDate(),t,e,i);return Ye.instance.AddClock(n,s)}static RemoveClock(t,e,i,s){let a=Ye.GetClock(t,e,i,s);this.instance.isTicking?(this._instance._offClock.push(a),this.instance.SetDirty()):(this.instance.DisposeClock(a),Ye.instance.Save())}static GetClock(t,e,i,s){let a=new Date,n=new Date(a.getFullYear(),a.getMonth(),a.getDate(),t,e,i).toLocaleTimeString(),o=this.instance._clockEvtDict.get(s);if(o)return o[n]}static AddListener(t,e,i,s){it.instance.on(t,e,i)}static RemoveListener(t,e,i,s){it.instance.off(t,e,i,s)}static OnNewDay(t){return Ye.AddClock(0,0,0,t)}}!function(t){t.Default="Default",t.NewDay="NewDay",t.UpdateOnLineTime="UpdateOnLineTime"}(ae||(ae={}));class Xe extends ct{constructor(){super(...arguments),this.money=5e4,this.diamond=700,this.water=80,this.MaxWater=80,this.staffSize=3,this.workMarketTime=432e5,this.onLineTime=0,this.isFirstGame=!0,this.maxOffLineTime=2,this.OfflineAdTotalNum=0,this.OfflineDiamondLoop=5,this.OfflineAdDayNum=0,this.OfflineMaxDayNum=8,this.LuckWheelAdDayNum=0,this.LuckWheelAdMaxDayNum=8,this.LuckWheelStartCount=2,this.DoubleBuffTime=0,this.MaxDoubleBuffTime=0,this.signDay=0,this.hasSign=!1,this.allTaskComplete=!1,this.CanteenLastTime=864e5,this.LibraryLastTime=1728e5,this.hasCanteenTime=!1,this.hasLibraryTime=!1}}class $e extends lt{constructor(){super(),this._runtimeTotalIncomeMin=0,it.instance.onUI(Nt.AddStaff,this,this.AddStaff),it.instance.on3D(A.SceneLoadComplete,this,$e.RefreshWater),it.instance.onUI(Nt.CostMoney,this,this.CostMoney),it.instance.on3D(A.OnUpdateSlotComplete,this,this.UpdateIncomeMin),Ye.OnTick(ae.UpdateOnLineTime),Ye.OnNewDay(ae.NewDay).SetLoop(-1),Ye.AddListener(ae.UpdateOnLineTime,this,this.OnTick),Ye.AddListener(ae.NewDay,this,this.OnNewDay)}static get data(){return this.instance._data}static get AdIncomeBuff(){return this.instance._data.DoubleBuffTime>0?2:1}static get toiletSpeed(){return this.speedUpTime>0?.5:1}static get instance(){return this.m_instance||(this.m_instance=new $e),this.m_instance}get Data(){return this._data}get _saveName(){return"MiscData"}getNewData(){return new Xe}InitData(){if(this._data=this._ReadFromFile(),null==this._data.staffList||this._data.staffList.length<=0){let t={Gender:0,Level:2,Name:"安娜",Price:5e3,Weight:.5,MoveSpeed:1.5};this._data.staffList=[],this._data.staffList.push(t)}this._data.isFirstGame&&(this._data.onLineTime=(new Date).getTime(),this._data.isFirstGame=!1)}UpdateWaterState(){$e.RefreshWater();let t=Je.instance.GetBuildingByName(jt.cleanRoom);$e.MaxWater=t.waterAdd}GetEmployeeIndexByName(t){for(let e=0;e<this._data.staffList.length;e++){if(this._data.staffList[e].Name==t)return e}return-1}AddStaffPosNum(){this._data.staffSize+=1}AddStaff(t,e){let i=this._data.marketList[t];if(!i)throw Error("获取招聘市场雇员信息失败:"+t);{let t=this.GetEmployeeIndexByName(e);null!=e&&t>-1?(this._data.staffList[t]=i,console.log("替换雇员")):(this._data.staffList.push(i),console.log("增加雇员")),$e.Money-=i.Price,it.instance.event3D(A.AddStaff,[i,e]),it.instance.eventUI(Nt.RenderMarketStaffList),Oe.trackEvent($t.Employee,{Number:this._data.staffList.length.toString()})}}UpdateMarketList(){this._data.marketList=this.GetEmployeeDataFromPool()}GetEmployeeDataFromPool(){let t=[],e=$e.instance.Data.staffList;for(;t.length<3;){let i=ge.instance.GetRandomData();t.indexOf(i)<0&&!$e.ContainEmployee(i,e)&&t.push(i)}return t}static ContainEmployee(t,e){for(let i of e)if(i.Name==t.Name)return!0;return!1}GetMarketEmployeeList(){return(!this._data.marketList||this._data.marketList.length<0)&&(this._data.marketList=this.GetEmployeeDataFromPool()),this._data.marketList}GetEmployeeList(){return this._data.staffList}static get Money(){return this.instance._data.money}static set Money(t){isNaN(t)?console.error("NaN!!!"):(t>this.instance._data.money&&this.instance.DispatchMoneyTaskEvent(t-this.instance._data.money),this.instance._data.money=t,it.instance.eventUI(Nt.UpdateMoneyNum,t))}static get Diamond(){return this.instance._data.diamond}static set Diamond(t){this.instance._data.diamond=t,it.instance.eventUI(Nt.UpdateDiamondNum,t)}static get Water(){return this.instance._data.water}static UpdateWaterState(){}static set Water(t){this.instance._data.water=t,it.instance.eventUI(Nt.UpdateWaterState)}static get MaxWater(){let t=Je.instance.GetBuildingByName(jt.waterRoom);return this.instance._data.MaxWater=t.waterAdd,this.instance._data.MaxWater}static set MaxWater(t){this.instance._data.MaxWater=t,it.instance.eventUI(Nt.UpdateWaterState)}static RefreshWater(){let t=Je.instance.buildingMap,e=0;if(null==t)throw"map is null!";return t.forEach(t=>{if(t.active){e+=t.wasteWater}}),$e.Water=e,e}UpdateIncomeMin(){this._runtimeTotalIncomeMin=Je.instance.GetTotalMoney()/60,isNaN(this._runtimeTotalIncomeMin)&&(this._runtimeTotalIncomeMin=0),console.log("刷新每秒收入：",this._runtimeTotalIncomeMin)}OnTick(){this._runtimeTotalIncomeMin>0&&($e.Money+=this._runtimeTotalIncomeMin),$e.data.DoubleBuffTime>0&&($e.data.DoubleBuffTime-=1e3,$e.data.DoubleBuffTime<0&&($e.data.DoubleBuffTime=0,$e.data.MaxDoubleBuffTime=0),it.instance.eventUI(Nt.UpdateAdBuffTime)),$e.speedUpTime>0&&($e.speedUpTime-=1e3,$e.speedUpTime<0&&($e.speedUpTime=0)),$e.data.LibraryLastTime>0&&$e.data.hasLibraryTime&&($e.data.LibraryLastTime-=1e3,$e.data.LibraryLastTime<0&&($e.data.LibraryLastTime=0),it.instance.eventUI(Nt.LibraryTimeOver)),$e.data.CanteenLastTime>0&&$e.data.hasCanteenTime&&($e.data.CanteenLastTime-=1e3,$e.data.CanteenLastTime<0&&($e.data.CanteenLastTime=0),it.instance.eventUI(Nt.CanteenTimeOver)),$e.data.workMarketTime>0&&($e.data.workMarketTime-=1e3,$e.data.workMarketTime<0&&($e.data.workMarketTime=432e5,this.UpdateMarketList())),this._data.onLineTime=(new Date).getTime(),this._SaveToDisk(this._data)}OnNewDay(){this._data.OfflineAdDayNum=0,this._data.LuckWheelAdDayNum=0,this._data.LuckWheelStartCount=2,this._data.hasSign=!1}static AddDoubleBuffTime(t){$e.data.MaxDoubleBuffTime+=t,$e.data.DoubleBuffTime+=t}CostMoney(t){$e.Money-=t}DispatchMoneyTaskEvent(t){if(this._data.allTaskComplete)return;let e=new qe;e.evt=se.Money,e.data=t,it.instance.eventUI(Nt.TaskEvent,e)}AddSignDay(){this._data.signDay++,this._data.signDay=this._data.signDay%7}}$e.speedUpTime=0;class ti{constructor(){this.isBreaking=!1,this.usable=!1}static UpdateSlotData(t,e){if(e&&e.length>0){let i=e[t.slotIndex];i.uid!=t.uid&&console.warn("Slot升级警告：信息UID和依靠索引索引获取的数据中的UID不一致！");let s=i.level+1;if(s<=ce.instance.dataList[i.uid].maxLevel){i.level=s;let e=me.instance.GetSlotConfigByUID(i.uid)[s];null!=e.updateCostCoin&&($e.Money-=e.updateCostCoin,Oe.trackEvent($t.Update,{Type:"Money",Update:t.building.buildingName+"_"+i.name+"_"+i.id+"_Level_"+i.level})),null!=e.updataCostDiamond&&($e.Diamond-=e.updataCostDiamond,Oe.trackEvent($t.Update,{Type:"Diamond",Update:t.building.buildingName+"_"+i.name+"_"+i.id+"_Level_"+i.level})),null!=e.updateCostWater&&$e.UpdateWaterState(),it.instance.event3D(A.UpdateSlotOutLook,t),it.instance.eventUI(Nt.UpdateSlotComplete),this.EventFacUpdate(i)}else console.warn("Slot升级警告：",t.building.buildingName,i.name,"已到达最大等级，无法升级！")}else console.error("获取数据失败！",t)}static EventFacUpdate(t){if(!$e.data.allTaskComplete){let e=new qe;switch(t.uid){case Se.instance.data.slot_flow_config:e.evt=se.UpdateFlow;break;case Se.instance.data.slot_wash_basin_woman_config:e.evt=se.UpdateFemaleSink;break;case Se.instance.data.slot_mt_config:e.evt=se.UpdateMt;break;case Se.instance.data.slot_sewage_config:e.evt=se.UpdateSewage;break;case Se.instance.data.slot_wash_basin_man_config:e.evt=se.UpdateMaleSink;break;case Se.instance.data.slot_urinal_config:e.evt=se.UpdateUrinal;break;case Se.instance.data.slot_paper_config:e.evt=se.UpdatePaper;break;case Se.instance.data.slot_trashCan_config:e.evt=se.UpdateTrash}it.instance.event(Nt.TaskEvent,e)}}}class ei{constructor(){this.active=!1,this.slots=[]}Copy(t){for(let e of t){let t=new ti;t.id=e.id,t.uid=e.uid,t.level=e.level,t.name=e.name,this.slots.push(t)}}}!function(t){t.config=class{},t.path="res/config/BuildingDefaultSlotConfig.json"}(ne||(ne={}));class ii extends T{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new ii),this._instance}initData(){this.m_dataList=ne.dataList}}class si extends ct{}class ai extends lt{constructor(){super(),it.instance.onUI(Nt.UpdateSlotData,this,this.UpdateSlotData)}static get instance(){return null==this._instance&&(this._instance=new ai),this._instance}get data(){return this._data}get _saveName(){return"CleanRoomData"}getNewData(){return new si}InitData(){this._data=this._ReadFromFile(),null==this._data.list&&(this._data.list=new ei,this._data.list.active=!0,this._data.list.functionID=qt.CleanRoom,this._data.list.index=0,this._data.list.title="清洁室",this._data.list.name=Et.prefab5.CleanRoom,this.InitSlot(this._data.list),this._SaveToDisk(this._data))}InitSlot(t){let e=0,i=ii.instance.dataList;for(let t=0;t<i.length;t++)i[t].cleanroom_Slot>-1&&e++;if(e>0){t.slots=new Array(e);for(let s=0;s<e;s++){let e=new ti;e.level=i[s].cleanroom_Slot_Level,e.uid=i[s].cleanroom_Slot,e.name=ce.instance.dataList[e.uid].name,e.id=s,t.slots[s]=e}}else console.warn("清洁室没有可用的Slot")}UpdateSlotData(t){if(t.building.functionID==qt.CleanRoom){let e=this.data.list;e?(ti.UpdateSlotData(t,e.slots),this._SaveToDisk(this._data)):console.error("获取数据失败！",t)}}}class ni extends ei{constructor(t,e){super(),this.isMale=t,this.active=!0,this.functionID=this.isMale?qt.MaleSink:qt.FemaleSink,this.index=e,this.name=t?"maleSinkAera":"femaleSinkAera",this.title=t?"洗手区（男）":"洗手区(女)"}}class oi extends ct{}class ri extends lt{constructor(){super(),this.dict={},it.instance.onUI(Nt.UpdateSlotData,this,this.UpdateSlotData)}static get instance(){return null==this._instance&&(this._instance=new ri),this._instance}static get data(){return this.instance._data}get maleSinkData(){return this.dict[jt.maleSinkAera]}get femaleSinkData(){return this.dict[jt.femaleSinkAera]}get _saveName(){return"SinkData"}getNewData(){return new oi}InitData(){this._data=this._ReadFromFile(),null!=this._data&&null!=this._data.list||(console.log("第一次进行游戏,初始洗手池数据..."),this._data.list=[],this.InitSinkData(),this._SaveToDisk(this._data));for(let t of this._data.list)this.dict[t.name]=t}InitSinkData(){let t=new ni(!0,0),e=new ni(!1,1);this._data.list.push(t),this._data.list.push(e),this.dict[jt.maleSinkAera]=t,this.dict[jt.femaleSinkAera]=e,this.InitSlot(!0,t),this.InitSlot(!1,e)}InitSlot(t,e){let i=0,s=ii.instance.dataList;for(let e=0;e<s.length;e++)t?s[e].wash_man_Slot>-1&&i++:s[e].wash_woman_Slot>-1&&i++;if(i>0){e.slots=new Array(i);for(let a=0;a<i;a++){let i=new ti;i.id=a,t?(i.level=s[a].wash_man_Slot_Level,i.uid=s[a].wash_man_Slot,i.name=ce.instance.dataList[i.uid].name,e.slots[a]=i):(i.level=s[a].wash_woman_Slot_Level,i.uid=s[a].wash_woman_Slot,i.name=ce.instance.dataList[i.uid].name,e.slots[a]=i),i.usable=i.uid==Ht.data.slot_wash_basin_woman_config||i.uid==Ht.data.slot_wash_basin_man_config}}else console.warn("洗手池没有可用的SLot，isMale：",t)}UpdateSlotData(t){let e=t.building.functionID;if(e==qt.FemaleSink||e==qt.MaleSink){let e=this.dict[t.building.buildingName];e?(ti.UpdateSlotData(t,e.slots),this._SaveToDisk(this._data)):console.error("获取数据失败！",t)}}}class li extends ei{constructor(t,e){super(),this.isMale=t,this.index=e,t?(this.title="男厕所No."+e,this.name="maleToilet_"+e,this.functionID=qt.MaleToilet):(this.title="女厕所No."+e,this.name="femaleToilet_"+e,this.functionID=qt.FemaleToilte),this.slots=[];let i=0,s=ii.instance.dataList;if(s&&s.length>0){for(let e=0;e<s.length;e++)t?s[e].maleToiletSolt>-1&&i++:s[e].femaleToiletSolt>-1&&i++;if(i>0){this.slots=new Array(i);for(let e=0;e<i;e++){let i=new ti,a=s[e];i.id=e,t?(i.uid=a.maleToiletSolt,i.name=ce.instance.dataList[i.uid].name,i.level=a.male_Slot_Level,i.usable=Ht.data.slot_mt_config==i.uid):(i.uid=a.femaleToiletSolt,i.name=ce.instance.dataList[i.uid].name,i.level=a.female_Slot_Level,i.usable=Ht.data.slot_mt_config==i.uid),this.slots[e]=i}}else console.warn(this.name,"没有可用的SLot")}}}class hi extends ct{}class ci extends lt{constructor(){super(),this._dict=new Map,it.instance.on3D(A.UpdateBuildingData,this,this.UpdateBuildData),it.instance.onUI(Nt.UpdateSlotData,this,this.UpdateSlotData)}static get instance(){return null==this._instance&&(this._instance=new ci),this._instance}static get data(){return this.instance._data}get _saveName(){return"TolietData"}getNewData(){return new hi}InitData(){this._data=this._ReadFromFile(),null!=this._data&&null!=this._data.list||(console.log("第一次进行游戏,初始化厕所数据..."),this._data.list=[],this.InitTolietData(),this._SaveToDisk(this._data));for(let t of this._data.list)this._dict.set(t.name,t)}InitTolietData(){let t=be.instance.dataList[1].minCount,e=be.instance.dataList[1].maxCount,i=be.instance.dataList[0].minCount,s=be.instance.dataList[0].maxCount,a=2*t;for(let t=1;t<=a;t++){let e=new li(!1,t);e.active=!0,this._data.list.push(e)}for(let t=1;t<=i;t++){let e=new li(!0,t);e.active=!0,this._data.list.push(e)}let n=2*(e-t);for(let t=1;t<=n;t++){let e=new li(!1,t+a);e.active=!1,this._data.list.push(e)}n=s-i;for(let t=1;t<=n;t++){let e=new li(!0,t+i);e.active=!1,this._data.list.push(e)}}UpdateBuildData(t){if(t.Name==jt.femaleToilet){let e=2*t.Count,i=e-1,s=t.Name+"_"+i.toString(),a=t.Name+"_"+e.toString(),n=this._dict.get(s),o=this._dict.get(a);if(!n)throw new ye("获取厕所信息失败:"+s);{n.active=!0;let t={buildingName:n.name,buildingData:n};it.instance.event3D(A.UpdateBuildingOutlookEvent,t)}if(!o)throw new ye("获取厕所信息失败:"+a);{o.active=!0;let t={buildingName:o.name,buildingData:o};it.instance.event3D(A.UpdateBuildingOutlookEvent,t)}}else if(t.Name==jt.maleToilet){let e=t.Name+"_"+t.Count.toString(),i=this._dict.get(e);if(!i)throw new ye("获取厕所信息失败:"+e);{i.active=!0;let t={buildingName:i.name,buildingData:i};it.instance.event3D(A.UpdateBuildingOutlookEvent,t)}}this._SaveToDisk(this._data)}UpdateSlotData(t){let e=t.building.functionID;if(e==qt.MaleToilet||e==qt.FemaleToilte){let e=this._dict.get(t.building.buildingName);e?(ti.UpdateSlotData(t,e.slots),this._SaveToDisk(this._data)):console.error("获取数据失败！",t)}}}class di extends ct{}class ui extends lt{constructor(){super(),it.instance.onUI(Nt.UpdateSlotData,this,this.UpdateSlotData)}static get instance(){return null==this._instance&&(this._instance=new ui),this._instance}get data(){return this._data}get _saveName(){return"WaitAeraData"}getNewData(){return new di}InitData(){this._data=this._ReadFromFile(),null==this._data.list&&(this._data.list=new ei,this._data.list.active=!0,this._data.list.functionID=qt.WaitAera,this._data.list.index=0,this._data.list.name=jt.WaitAera,this._data.list.title="等候区",this.InitSlots(this._data.list),this._SaveToDisk(this._data))}InitSlots(t){let e=0,i=ii.instance.dataList;for(let t=0;t<i.length;t++)i[t].waitArea_slot>-1&&e++;if(e>0){t.slots=new Array(e);for(let s=0;s<e;s++){let e=new ti;e.level=i[s].waitArea_slot_level,e.uid=i[s].waitArea_slot,e.name=ce.instance.dataList[e.uid].name,e.id=s,t.slots[s]=e}}else console.warn("等候区没有可用的SLot")}UpdateSlotData(t){if(t.building.functionID==qt.WaitAera){let e=this._data.list.slots;e&&e.length>0?(ti.UpdateSlotData(t,e),this._SaveToDisk(this._data)):console.error("获取数据失败！",t)}}}class mi{constructor(){this.isBreaking=!1}SetBreakState(t,e){this.slotData.isBreaking=this.isBreaking=t,this.eventID=t?e:null}get runtimeFirstChild(){return null==this._tempChild&&(this._tempChild=this.sprite.getChildAt(0)),this._tempChild}}class _i extends fe{constructor(){super(...arguments),this._facMap=new Map,this.slotPosList=[],this.developProgress=0,this.income=0,this.duration=0,this.wasteWater=0,this.waterAdd=0,this.cleanTime=32,this.sweepTime=32,this._standardCleanTime=25,this._standardSweepTime=27,this._standardTime=20}get index(){return this._index}get isMale(){return this._isMale}get buildingName(){return this._name}get title(){return this._title}get _equipmentNode(){return null==this._runtimeEquipmentNode&&(this._runtimeEquipmentNode=this.sprite3D.getChildByName(jt.equipment),null==this._runtimeEquipmentNode&&console.error(this.sprite3D.name+"设备节点获取失败")),this._runtimeEquipmentNode}InitBuilding(t,e){if(this._isMale=t.isMale,this.active=t.active,this.functionID=t.functionID,this._index=t.index,this._name=t.name,this.slots=t.slots,this._title=t.title,t.active)if(this.ShowOutlook(t.isMale,t.index,e),t.slots&&t.slots.length>0)for(let i=0;i<t.slots.length;i++){let s=t.slots[i];s.isBreaking=!1,this.UpdateFacilityLevel(s.name+"_"+i.toString(),s.level,e,s)}else console.warn("设备初始化失败,已关闭所有设备显示,没有插槽数据:",this.sprite3D.name),this._equipmentNode&&(this._equipmentNode.active=!1);else this.ShowPlaceholder()}UpdateFacilityLevel(t,e,i,s){let a=this._equipmentNode.getChildByName(t);if(a){a.active=!0;let n=a.getChildByName(e.toString());if(n){if(this.ToggleAllChild(a,!1),s.uid==Se.instance.data.slot_urinal_config){let t=Qe.instance.GetBuildDataByName(jt.maleToilet).count+1,e=a.getChildByName("menban");if(s.id<2*t){if(n.active=!0,e&&(e.active=!0),i){let t=n.id;Ie.PlayEffect(Bt.Yan,t,2e3,n.transform.position)}}else console.log("关闭pee显示")}else if(n.active=!0,i){let t=n.id;Ie.PlayEffect(Bt.Yan,t,2e3,n.transform.position)}s&&this.AddSlotPositon(a,t,s),this.UpdateStatistic()}else 0!=e?console.warn("建筑",this.sprite3D.name,"的",t,"的等级",e,"寻找失败，无法改变设备外观模型,设备显示已经关闭."):this.ToggleAllChild(a,!1)}else console.warn("试图在建筑",this.sprite3D.name,"中获取一个不存在的设备",t,",请检查建筑设备节点equipmen下是否已正确放置此设备...")}AddSlotPositon(t,e,i){let s=this._facMap.get(e);null==s?((s=new mi).slotData=i,s.sprite=t,s.belonger=this,this._facMap.set(e,s),this.slotPosList.push(s)):console.log(e)}ShowOutlook(t,e,i=!1){console.error("ShowOutlook方法没有在子类中实现:",this.sprite3D.name)}PlayBuildEffect(){Ie.PlayEffect(Bt.Caidai,this.id,2e3,this.sprite3D.transform.position)}ShowPlaceholder(){let t=this.sprite3D.getChildByName(jt.placeholder);this.ToggleAllChild(this.sprite3D,!1),t?t.active=!0:console.warn("节点下没有占位节点：",this.sprite3D.name)}ClosePlaceholder(){let t=this.sprite3D.getChildByName(jt.placeholder);t?t.active=!1:console.warn("节点下没有占位节点：",this.sprite3D.name)}get entrance(){return null==this._runtimeEntrance&&(this._runtimeEntrance=this.sprite3D.getChildByName(jt.entrance)),this._runtimeEntrance}get exit(){return null==this._runtimeExit&&(this._runtimeExit=this.sprite3D.getChildByName(jt.exit)),this._runtimeExit}UpdateStatistic(){let t=0,e=0,i=0,s=0,a=0,n=0,o=0,r=0;for(let l of this.slots){let h=me.instance.GetSlotConfigByUID(l.uid)[l.level];if(e+=l.level,t+=ce.instance.dataList[l.uid].maxLevel,l.level<1)continue;let c=h.income;c&&(i+=c);let d=h.Buff;d&&(s+=d);let u=h.updateCostWater;u&&(a+=u);let m=h.water_add;m&&(n+=m,this.functionID==qt.WaterRoom&&($e.MaxWater=n));let _=h.repair_time;_&&(o+=_);let g=h.sweep_time;g&&(r+=g)}this.developProgress=e/t,this.income=3*i,this.duration=this._standardTime+s,this.wasteWater=a,this.waterAdd=n,$e.RefreshWater(),this.cleanTime=this._standardCleanTime+o,this.sweepTime=this._standardSweepTime+r}CreateIncome(t){let e=me.instance.GetSlotConfigByUID(t.uid)[t.level].income;e?$e.Money+=e*$e.AdIncomeBuff:console.log(this.buildingName,"获取收入失败！")}OnClick(){}OffClick(){}}!function(t){class e{constructor(){this._wps=[],this._openTable=[],this._closeTable=[]}static get instance(){return null==this._instance&&(this._instance=new e),this._instance}InitData(t){console.log("导航模块初始化...");let e=S.ConfigURL(t),s=a.Get(e,!0);if(s){this._dataList=s,this._nodeDict=new Map;for(const t of this._dataList)this._nodeDict.set(t.key,new i(t));a.Unload(e)}else console.warn("导航数据初始化失败",t)}GetNeighbors(t){let e=new Array,i=t.data;if(i.neighbors&&i.neighbors.length>0)for(const s of i.neighbors){let i=this._nodeDict.get(s);if(i){e.indexOf(i)<0?e.push(i):console.warn(t,"重复获取相邻节点：",s)}else console.warn(t,"获取相邻节点失败：",s)}return e}GetNodeByKey(t){return this._nodeDict.get(t)}PushInOpen(t){if(null==t)throw new pe("Grid不能为空");this._openTable.indexOf(t)<0&&(t.isInOpen=!0,this._openTable.push(t))}PushInClose(t){if(null==t)throw new pe("node不能为空");let e=this._openTable.indexOf(t);e>-1&&this._openTable.splice(e,1),(e=this._closeTable.indexOf(t))<0&&(t.isInClose=!0,this._closeTable.push(t))}SetStartAndEnd(t,e){this._startNode=t,this._startNode.G=0,this._startNode.H=0,this._endNode=e}Search(){let t=[];for(t.push(this._startNode);t.length>0;){t.sort((t,e)=>t.F<e.F?-1:t.F>e.F?1:0);let e=t.shift();if(e==this._endNode)break;{let i=this.GetNeighbors(e);if(i&&i.length>0)for(let s of i){let i=s.F;this.G(e,s),this.H(s),s.F<i&&(s.parent=e,t.push(s))}}}return this.BuildPath(this._endNode)}G(t,e){let i=e.G,s=Laya.Vector3.distance(t.data.position,e.data.position),a=t.G+s;a<i&&(e.G=a)}H(t){let e=t.H,i=Laya.Vector3.distance(t.data.position,this._endNode.data.position);i<e&&(t.H=i)}SearchPath(t){if(this._openTable.length<=0)return void console.warn("寻路失败，from:",this._start,",to:",t);this._openTable.sort((t,e)=>t.F<e.F?-1:t.F==e.F?0:1);let i=this._openTable.shift();if(i==t)return void this.BuildPath(t);this.PushInClose(i);let s=e.instance.GetNeighbors(i);if(s&&s.length>0){this.CheckAndSetCost(i,t,s);for(let t=0;t<s.length;t++){let e=s[t];e.isInClose||e.isObstacle||(e.isInOpen||(this.PushInOpen(e),e.SetParent(i)))}}this.SearchPath(t)}BuildPath(t){let e=[],i=t;for(;i.parent;)e.push(i),i=i.parent;if(e.push(i),e.reverse(),this._wps=[],e.length>0&&e)for(let t=0;t<e.length;t++){let i=e[t];this._wps.push({position:i.position,name:i.data.belonger})}return this._wps}CheckAndSetCost(t,e,i){i&&i.length>0&&i.forEach(i=>{i.G=this.Manhattan(i,t),i.H=this.SqrtDistance(i,e)})}Manhattan(t,e){let i=t.position.x-e.position.x,s=t.position.z-e.position.z,a=t.position.y-e.position.y;return i*i+s*s+e.G+a*a}Greedy(t,e){let i=t.position.x-e.position.x,s=t.position.z-e.position.z,a=t.position.y-e.position.y;return(i=Math.abs(i))+(s=Math.abs(s))+(a=Math.abs(a))}SqrtDistance(t,e){let i=t.position.x-e.position.x,s=t.position.z-e.position.z,a=t.position.y-e.position.y;return i*i+s*s+a*a}Distance(t,e){let i=t.position.x-e.position.x,s=t.position.z-e.position.z,a=t.position.y-e.position.y,n=i*i+s*s+a*a;return Math.sqrt(n)}GetNodeByName(t){if(t)for(let e=0;e<this._dataList.length;e++){let i=this._dataList[e];if(i.belonger==t)return this._nodeDict.get(i.key)}return null}GetNearestNode(t){let e=1/0,i=null;for(const s of this._nodeDict){let a=Ct.SqrDistance(s[1].position,t);a<e&&(e=a,i=s[1])}return i}ResetNode(){for(const t of this._nodeDict)t[1].ToDefault()}get RandomNode(){let t=_e.RangeInt(0,this._dataList.length),e=this._dataList[t].key;return this._nodeDict.get(e)}Check(t,e){null==t&&console.warn("获取导航起点失败"),null==e&&console.warn("获取导航起点失败")}TrySearchByName(t,e){let i=this.GetNodeByName(t),s=this.GetNodeByName(e);if(i&&s){return this.ResetNode(),this.SetStartAndEnd(i,s),this.Search()}this.Check(i,s)}TrySearchByPos(t,e){let i=this.GetNearestNode(t),s=this.GetNodeByName(e);if(i&&s){return this.ResetNode(),this.SetStartAndEnd(i,s),this.Search()}this.Check(i,s)}TrySearchByNearestPos(t,e){let i=this.GetNearestNode(t),s=this.GetNearestNode(e);if(i&&s){return this.ResetNode(),this.SetStartAndEnd(i,s),this.Search()}this.Check(i,s)}}t.NetMap=e;t.NodeData=class{};class i{constructor(t){this.isObstacle=!1,this.G=0,this.H=0,this.data=t}get position(){return this.data.position}get F(){return this.G+this.H+this.data.extraCost}SetParent(t){if(!t)throw new pe("Node不能为空");this.parent=t}ToDefault(){this.isInOpen=!1,this.isInClose=!1,this.G=1/0,this.H=1/0,this.parent=null}}t.Node=i}(oe||(oe={}));class gi{static updateRotation(t){return this.angleByPoint({x:0,y:0},{x:t.x,y:t.z})}static angleByPoint(t,e){return-parseFloat((180*Math.atan2(t.x-e.x,-(t.y-e.y))/Math.PI).toFixed(2))}static deg2rad(t){return t*Math.PI/180}static isZero(t){return 0==t.x&&0==t.y&&0==t.z}static SwitchParent(t,e){if(t&&e){let i=t.transform.scale.clone(),s=t.transform.position.clone(),a=t.transform.rotationEuler.clone();e.addChild(t),t.transform.scale=i,t.transform.position=s,t.transform.rotationEuler=a}}static SwitchParentLocal(t,e){if(t&&e){let i=t.transform.localScale.clone(),s=t.transform.localPosition.clone(),a=t.transform.localRotationEuler.clone();e.addChild(t),t.transform.localScale=i,t.transform.localPosition=s,t.transform.localRotationEuler=a}}static direOneDis(t,e){let i=t.distance(e.x,e.y),s=gi.minus(t,e);return Laya.Vector2.scale(s,1/i,s),s}static UpdateRotation(t){return gi.angleByPoint({x:0,y:0},{x:t.x,y:t.z})}static updateRotationDelayY(t,e,i){let s=this.angleByPoint(Ct.zero,{x:t.x,y:t.z});return gi.updateRotationByAngle(s,e,i)}static updateRotationDelayX(t,e,i){let s=this.angleByPoint(Ct.zero,{x:t.z,y:t.y});return gi.updateRotationByAngle(s,e,i)}static updateRotationDelayZ(t,e,i){let s=this.angleByPoint(Ct.zero,{x:t.y,y:t.x});return gi.updateRotationByAngle(s,e,i)}static updateRotationByAngle(t,e,i,s=1){let a=this.getIncludeAngle(t,e),n=0==s?18/i:i;if(Math.abs(a)<=n)return a;let o=i;return 0==s&&(this._tempAngle!=t&&(this._offset=a),o=this._offset*i/10),o*=Laya.timer.scale,a>0?o:a<0?-o:void 0}static direOneDisV3(t,e){let i=Laya.Vector3.distance(t,e),s=new Laya.Vector3;return Laya.Vector3.subtract(t,e,s),Laya.Vector3.scale(s,1/i,s),s}static minus(t,e){return new Laya.Vector2(t.x-e.x,t.y-e.y)}static getIncludeAngle(t,e){-180==t&&(t=180);let i=t-(e%=360);return i>180&&(i-=360),i<-180&&(i=360+i),i>180&&console.log("错误"),i}static Shuffle(t){for(let e=t.length;e;e--){let i=Math.floor(Math.random()*e);[t[e-1],t[i]]=[t[i],t[e-1]]}return t}static GetDate(){var t=new Date;return t.getFullYear()+"年"+(t.getMonth()+1)+"月"+t.getDate()+"日"}static TimeToString(t,e=0){var i=Math.floor(t/1e3),s=i%60,a=Math.floor(i/60)%60,n=Math.floor(i/3600)%24;return 0==e?gi.formatNumber(n)+":"+gi.formatNumber(a)+":"+gi.formatNumber(s):gi.formatNumber(n)+"小时"+gi.formatNumber(a)+"分钟"+gi.formatNumber(s)+"秒"}static formatNumber(t){var e=t.toString();return e[1]?e:"0"+e}static rand(t){return t[Math.floor(Math.random()*t.length)]}static randByWeight(...t){for(var e=0,i=0;i<t.length;i++)e+=Number(t[i]);var s=Math.random()*e,a=0;for(i=0;i<t.length;i++){var n=a;if(a+=Number(t[i]),s>=n&&s<=a)return i}return 0}static hexToRgba01(t){return new Laya.Vector4(parseInt("0x"+t.slice(1,3))/255,parseInt("0x"+t.slice(3,5))/255,parseInt("0x"+t.slice(5,7))/255,1)}static rgb01ToHex(t,e,i){return"#"+((t=Math.min(255,Math.round(255*t)))<<16|(e=Math.min(255,Math.round(255*e)))<<8|(i=Math.min(255,Math.round(255*i)))).toString(16)}static rgb255ToHex(t,e,i){return"#"+(t<<16|e<<8|i).toString(16)}static hexToRgb01(t){return new Laya.Vector3(parseInt("0x"+t.slice(1,3))/255,parseInt("0x"+t.slice(3,5))/255,parseInt("0x"+t.slice(5,7))/255)}static rgb255Torgb01(t){return t.x/=255,t.y/=255,t.z/=255,t}static Angle2(t,e){var i=(t.x*e.x+t.y*e.y+t.z*e.z)/(Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)*Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z));return i<-1&&(i=-1),i>1&&(i=1),180*Math.acos(i)/Math.PI}static Save(t,e){var i=Laya.Browser.document.createElement("a");i.download=e,i.style.display="none";var s=new Blob([JSON.stringify(t)]);i.href=URL.createObjectURL(s),document.body.appendChild(i),i.click(),document.body.removeChild(i)}static SaveArray(t,e){var i=Laya.Browser.document.createElement("a");i.download=e,i.style.display="none";new ArrayBuffer(4*t.length);var s=new Blob([t]);i.href=URL.createObjectURL(s),document.body.appendChild(i),i.click(),document.body.removeChild(i)}static vibrateShort(){window.wx&&Laya.timer.callLater(wx,wx.vibrateShort,[null])}static vibrateLong(){window.wx&&Laya.timer.callLater(wx,wx.vibrateLong,[null])}static get TodayMS(){var t=new Date;return t.setHours(0,0,0,0),t.getTime()}static get CurrentTime(){return(new Date).getTime()}static WaitFrame(t){return new Promise(e=>{Laya.timer.frameOnce(t,null,e)})}static WaitTime(t){return new Promise(e=>{t<=0?e():setTimeout(e,t)})}static WaitWithBlock(t){return new Promise(e=>{var i=()=>{Laya.timer.delta,t()&&(Laya.timer.clear(null,i),e())};Laya.timer.frameLoop(1,null,i)})}static WaitTimeWithBlock(t,e){return new Promise(i=>{var s=0,a=()=>{var n=Math.min(100,Laya.timer.delta);((s+=n)>=t||e())&&(Laya.timer.clear(null,a),i())};Laya.timer.frameLoop(1,null,a)})}static WaitTimeWithDuartionCall(t,e,i){return new Promise(s=>{var a=0,n=0;i();var o=()=>{var r=Math.min(100,Laya.timer.delta);(a+=r,(n+=r)>=e)&&(n-=e,0==i()&&(Laya.timer.clear(null,o),s()));t>0&&a>=t&&(Laya.timer.clear(null,o),s())};Laya.timer.frameLoop(1,null,o)})}static PromiseQueue(t,...e){var i=Promise.resolve(t);return e&&e.forEach(t=>{i=i.then(t)}),i}static SaveImgToTempPath(t,e=null){return new Promise(i=>{var s=window.wx;if(null!=s){var a=(e=null==e?t.toBase64("image/png",1):e).indexOf("base64,")+7,n=s.getFileSystemManager(),o=gi.CurrentTime,r=s.env.USER_DATA_PATH+"/pic"+o+".png";n.writeFile({filePath:r,data:e.slice(a),encoding:"base64",success:t=>{i(r)},fail:t=>{console.log(t),i(null)}})}else i(null)})}static OppoSaveImgToTempPath(t){return new Promise(e=>{var i=window.wx;if(null!=i){var s=i.getFileSystemManager(),a=gi.CurrentTime,n=i.env.USER_DATA_PATH+"/pic"+a+".png";s.writeFile({filePath:n,data:t,encoding:"binary",success:t=>{e(n)},fail:t=>{console.log(t),e(null)}})}else e(null)})}static DistancePointWithLine(t,e,i){return Math.abs(this.SignDistancePointWithLine(t,e,i))}static PointToSegmentDist(t,e,i){var s=(i.x-e.x)*(t.x-e.x)+(i.y-e.y)*(t.y-e.y);if(s<=0)return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y));var a=(i.x-e.x)*(i.x-e.x)+(i.y-e.y)*(i.y-e.y);if(s>=a)return Math.sqrt((t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y));var n=s/a,o=e.x+(i.x-e.x)*n,r=e.y+(i.y-e.y)*n;return Math.sqrt((t.x-o)*(t.x-o)+(r-t.y)*(r-t.y))}static PointToSegmentDist2(t,e,i,s,a,n){var o=(a-i)*(t-i)+(n-s)*(e-s);if(o<=0)return Math.sqrt((t-i)*(t-i)+(e-s)*(e-s));var r=(a-i)*(a-i)+(n-s)*(n-s);if(o>=r)return Math.sqrt((t-a)*(t-a)+(e-n)*(e-n));var l=o/r,h=i+(a-i)*l,c=s+(n-s)*l;return Math.sqrt((t-h)*(t-h)+(c-e)*(c-e))}static SignDistancePointWithLine(t,e,i){var s=new Laya.Vector3;Laya.Vector3.subtract(t,e,s);var a=new Laya.Vector3(-i.z,0,i.x);return Laya.Vector3.cross(new Laya.Vector3(0,0,1),i,a),Laya.Vector3.normalize(a,a),Laya.Vector3.dot(s,a)}static CheckSegmentLineIntersect(t,e,i,s){var a=this.SignDistancePointWithLine(t,i,s),n=this.SignDistancePointWithLine(e,i,s);return!(!Laya.MathUtils3D.isZero(a)&&!Laya.MathUtils3D.isZero(n))||Math.sign(a)!=Math.sign(n)}static SegmentLineIntersectPos(t,e,i,s){var a=this.DistancePointWithLine(t,i,s),n=new Laya.Vector3;Laya.Vector3.add(t,e,n);var o=a/(a+this.DistancePointWithLine(n,i,s)),r=new Laya.Vector3;return Laya.Vector3.scale(e,o,r),Laya.Vector3.add(t,r,r),r}static LineIntersectPos(t,e,i,s){var a=new Laya.Vector3;Laya.Vector3.subtract(i,t,a);var n=e.x*s.y-e.y*s.x,o=(a.x*s.y-a.y*s.x)/n;return Laya.Vector3.scale(e,o,e),Laya.Vector3.add(t,e,a),a}static AngleLerpWithSpeed(t,e,i,s){var a=e-t;a<-180?a+=360:a>180&&(a-=360);var n=i;return a<0&&(n=-i),(t+=n*s)>360&&(t-=360),t<0&&(t+=360),t}static AngleLerp(t,e,i){var s=e-t;return s<-180?s+=360:s>180&&(s-=360),(t+=s*i)>360&&(t-=360),t<0&&(t+=360),t}static GetAllSKinMeshRender(t,e){if(t instanceof Laya.SkinnedMeshSprite3D){var i=t.skinnedMeshRenderer;e.push(i)}for(let i=0;i<t.numChildren;i++){var s=t.getChildAt(i);this.GetAllSKinMeshRender(s,e)}}static GetAllMeshRenderer(t,e){if(t instanceof Laya.MeshSprite3D){var i=t.meshRenderer;e.push(i)}for(let i=0;i<t.numChildren;i++){var s=t.getChildAt(i);this.GetAllMeshRenderer(s,e)}}static SetAllMeshRendererMat(t,e){t instanceof Laya.MeshSprite3D&&(t.meshRenderer.sharedMaterial=e);for(let s=0;s<t.numChildren;s++){var i=t.getChildAt(s);this.SetAllMeshRendererMat(i,e)}}static GetChildNode(t,e){if(t.name==e)return t;if(!(t.numChildren>0))return null;for(let s=0;s<t.numChildren;s++){var i=this.GetChildNode(t.getChildAt(s),e);if(null!=i)return i}}static SetPhysicGroup(t,e){var i=t.getComponent(Laya.PhysicsCollider);null!=i&&(i.collisionGroup=e);var s=t.getComponent(Laya.Rigidbody3D);null!=s&&(s.collisionGroup=e);for(var a=0;a<t.numChildren;a++)this.SetPhysicGroup(t.getChildAt(a),e)}static ParseVector3(t){var e=t.split(",");return new Laya.Vector3(Number(e[0]),Number(e[1]),Number(e[2]))}}class pi extends fe{constructor(){super(...arguments),this.isPoly=!1,this._toTarget=Ct.zero,this._wpIndex=0,this.moveSpeed=1.5,this.isOut=!1,this._isRepairing=!1,this.eventID=Xt.Repair,this.repairTime=40,this.moneySkill=!1,this.moneySeed=0,this._runtimeMoney=0,this.diamondSkill=!1,this.diamondSeed=0,this._runtimeDiamonds=0,this._runtimeAnimatorStateName=null,this._step=new Ct,this.isDisposed=!1}get toolCar(){return null==this._toolCar&&(this._toolCar=this.sprite3D.getChildByName("Car")),this._toolCar}get toolMop(){return null==this._toolMop&&(this._toolMop=this.DeepFind("Mop",this.owner)),this._toolMop}get _animator(){return null==this._runtimeAnimator&&(this._runtimeAnimator=this.owner.getComponent(Laya.Animator)),this._runtimeAnimator}get _agent(){return oe.NetMap.instance}get hasFacTarget(){return null!=this.facPos}onAwake(){it.instance.onUI(Nt.OnClickTip,this,this.OnClickTip),it.instance.onUI(Nt.RepairProgressComplete,this,this.OnRepairComplete),this.PlayAnimationByState(re.Sit)}SetRepairTime(t){this.repairTime=t}PlayAnimationByState(t){try{if(this._runtimeAnimatorStateName!=t){let e=t;switch(t){case re.CaZhuoZi:case re.DaSao:e="clean"}this._animator.play(e),this._runtimeAnimatorStateName=t,this.ShowToolByState(t)}}catch(e){throw console.error("播放动画失败：",t),e}}ShowToolByState(t){switch(t){case re.DaSao:this.toolMop.active=!0,this.toolCar.active=!1;break;case re.Car:this.toolMop.active=!1,this.toolCar.active=!0;break;case re.CaZhuoZi:default:this.toolMop.active=!1,this.toolCar.active=!1}}SetFacTarget(t,e){this.facPos=t,this.isOut?this.MoveToTarget():this.MoveToExit(e),this.isOut=!0}MoveToExit(t){console.log("移动到出口位置拿工具");let e=this._agent.TrySearchByNearestPos(this.transform.position,t);this.SetWayPoints(e).OnComplete(this.GetTool,"GetTool"),this.PlayAnimationByState(re.Walk)}GetTool(){this.PlayAnimationByState(re.Idle),console.log("维修工变出工具！"),Je.instance.TryOpenDoor(this.transform.position),Laya.timer.once(500,this,this.MoveToTarget)}MoveToTarget(){if(null!=this.facPos&&null!=this.facPos.belonger||console.error(this.facPos),this.PlayAnimationByState(re.Car),this.facPos.belonger.functionID==qt.FemaleToilte||this.facPos.belonger.functionID==qt.MaleToilet){let t=this.facPos.belonger.entrance,e=this._agent.TrySearchByNearestPos(this.transform.position,t.transform.position);this.SetWayPoints(e).OnComplete(this.WaitOpenDoor,"WaitOpenDoor")}else{let t=this._agent.TrySearchByNearestPos(this.transform.position,this.facPos.sprite.transform.position);this.SetWayPoints(t).OnComplete(this.DoRepair,"DoRepair"),this.PlayAnimationByState(re.Car)}}WaitOpenDoor(){Je.instance.TryOpenDoor(this.transform.position),Laya.timer.once(600,this,()=>{if(null==this.facPos)return;let t=this._agent.TrySearchByNearestPos(this.transform.position,this.facPos.sprite.transform.position);this.SetWayPoints(t).OnComplete(this.DoRepair,"DoRepair"),this.PlayAnimationByState(re.Car)})}SetWayPoints(t){return t&&t.length>0?(this._wayPoints=t,this._target=this._wayPoints[0].position,this._wpIndex=0):console.log("路径点数据为空或者数量为0"),this}onUpdate(){this._runtimeMoney>0&&Ne.instance.EventDistribute(this.transform.position,this.id,Xt.Money,0),this._runtimeDiamonds>0&&Ne.instance.EventDistribute(this.transform.position,this.id,Xt.Diamond,0),this.hasFacTarget&&Ne.instance.EventDistribute(this.facPos.runtimeFirstChild.transform.position,this.facPos.sprite.id,this.facPos.eventID,this.facPos.eventID==Xt.Repair?this.repairTime:this.sweepTime),this._target&&(Laya.Vector3.subtract(this._target,this.transform.position,this._toTarget),this._toTarget.SqrMagnitude<.01?(this._wpIndex++,this._wpIndex>=this._wayPoints.length?(this._target=null,this._transitionFunc?(console.log("执行转换：",this._transition),this.OnReach=this._transitionFunc,this.OnReach(),this.OnReach==this._transitionFunc&&(this._transition=null)):console.error("抵达没有回调,或者切换方法为空:",this._transition)):this._target=this._wayPoints[this._wpIndex].position):(Laya.Vector3.normalize(this._toTarget,this._step),Laya.Vector3.scale(this._step,this.moveSpeed*It.deltaTime,this._step),this.transform.localRotationEulerY=gi.updateRotation(this._step)-45,Laya.Vector3.add(this.transform.position,this._step,this.transform.position),this.transform.position=this.transform.position))}OnComplete(t,e){this._transitionFunc=t,this._transition=e}DoRepair(){if(this.facPos.slotData.uid==Ht.data.slot_mt_config?this.PlayAnimationByState(re.DaSao):this.PlayAnimationByState(re.CaZhuoZi),Ie.ClearAll(this.facPos.sprite.id),this.facPos.belonger.functionID==qt.MaleToilet||this.facPos.belonger.functionID==qt.FemaleToilte){let t=new Laya.Vector3;this.facPos.sprite.transform.getForward(t),Laya.Vector3.scale(t,.5,t),t.y=0,Laya.Vector3.subtract(this.facPos.sprite.transform.position,t,t),this.transform.position=t}Ne.instance.EventDistribute(this.facPos.sprite.transform.position,this.facPos.sprite.id,Xt.StartRepair,0),this._isRepairing=!0}OnRepairComplete(t){if(this.hasFacTarget&&this.facPos.sprite.id==t){Laya.timer.clearAll(this),this.moneySkill&&(this._runtimeMoney+=_e.RangeInt(1,this.moneySeed)),this.diamondSkill&&(this._runtimeDiamonds+=_e.RangeInt(1,this.diamondSeed)),this.facPos.slotData.uid==Ht.data.slot_mt_config&&Je.instance.TryOpenDoor(this.transform.position),this._isRepairing=!1;let t=this.facPos,e=this.facPos.sprite.id,i=Ie.PlayEffect(Bt.Cleaning,e,2e3);this.facPos.runtimeFirstChild.addChild(i),i.transform.localPosition=Ct.zero,t.SetBreakState(!1),this.facPos=null,it.instance.event3D(A.FacilityRepairComplete,[t,this]),this.isDisposed&&this.sprite3D.destroy(!0)}}ReturnChairPos(t){if(null==t)throw Error("获取椅子失败，维修工无法返回休息椅子！");let e=null;this._runtimeChair=t,this.PlayAnimationByState(re.Car);let i=Je.instance.GetBuildingEntrance(qt.CleanRoom);e=this._agent.TrySearchByNearestPos(this.transform.position,i.transform.position),this.SetWayPoints(e).OnComplete(()=>{Je.instance.TryOpenDoor(this.transform.position),Laya.timer.once(600,this,()=>{e=this._agent.TrySearchByNearestPos(this.transform.position,t.transform.position),this.SetWayPoints(e).OnComplete(()=>{this.isOut=!1,this.PlayAnimationByState(re.Sit),this.transform.position=this._runtimeChair.transform.position,this.transform.rotationEuler=this._runtimeChair.transform.rotationEuler})})})}Init(t){if(this.Name=t.Name,this.moveSpeed=t.MoveSpeed,this.repairTime=40,this.sweepTime=25,t.Skill&&t.Skill.length>0)for(let e of t.Skill)switch(e.Type){case 0:this.repairTime=this.repairTime*(1-e.parameter[0]);break;case 1:this.sweepTime=this.sweepTime*(1-e.parameter[0]);break;case 2:this.moveSpeed=this.moveSpeed*(1+e.parameter[0]);break;case 3:this.moneySkill=!0,this.moneySeed=e.parameter[0];break;case 4:this.diamondSkill=!0,this.diamondSeed=e.parameter[0];break;default:console.log("没有技能")}}Disposed(){this.hasFacTarget?this.isDisposed=!0:this.sprite3D.destroy(!0)}OnClickTip(t){t==this.id&&(this.moneySkill&&(console.log("收取小费"+this._runtimeMoney),$e.Money+=this._runtimeMoney,this._runtimeMoney=0),this.diamondSkill&&(console.log("收取钻石"+this._runtimeDiamonds),$e.Diamond+=this._runtimeDiamonds,this._runtimeDiamonds=0))}RepairCompleteNow(){Ie.ClearAll(this.facPos.sprite.id),Ne.instance.RecycleBtn(this.facPos.sprite.id,this.facPos.eventID)}}!function(t){t.Walk="zou",t.CaZhuoZi="clean",t.DaSao="clean",t.Sit="daiji",t.Car="tuiche",t.Idle="daiji"}(re||(re={}));class fi extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","Main")}onConstruct(){this.m_btn_statistics=this.getChildAt(0),this.m_setBtn=this.getChildAt(2),this.m_staffBtn=this.getChildAt(3),this.m_turntableBtn=this.getChildAt(4),this.m_taskBtn=this.getChildAt(5),this.m_LowLeft=this.getChildAt(6),this.m_txt_doubleTime=this.getChildAt(9),this.m_btn_video=this.getChildAt(10),this.m_LowRight=this.getChildAt(11),this.m_btn_netRed=this.getChildAt(12),this.m_btn_cheers=this.getChildAt(13),this.m_btn_repair=this.getChildAt(14),this.m_btn_speedUp=this.getChildAt(15),this.m_btn_record=this.getChildAt(16),this.m_ani_netRed=this.getTransitionAt(0),this.m_ani_cheers=this.getTransitionAt(1),this.m_ani_repair=this.getTransitionAt(2),this.m_ani_speedUp=this.getTransitionAt(3)}}fi.URL="ui://8nmf3q47aucl1";class yi{static NextFrame(){return this.Frames(2)}static Frames(t){return new Promise(function(e){Laya.timer.frameOnce(t,null,()=>{e()})})}static Seconds(t){return new Promise(function(e){Laya.timer.once(1e3*t,null,()=>{e()})})}}class Si{static ToHex(t){return t.toString(16)}static RandomFromArrayExcept(t,e){let i=[];for(let s=0;s<t.length;++s)e!=t[s]&&i.push(t[s]);return this.RandomFromArray(i)}static RandomFromArray(t){return t[Si.RandomInt(0,t.length)]}static RandomArrayFromArray(t,e){let i=[],s=[];for(let e=0;e<t.length;++e)s.push(e);for(let a=0;a<e;++a){let e=Si.RandomInt(0,s.length),a=s[e];I.RemoveAt(s,e),i.push(t[a])}return i}static RandomFromWithWeight(t,e){if(null==t||0==t.length)return null;var i=0;for(var s of e)i+=s;for(var a=Si.Random(0,i),n=0,o=0;o<t.length;++o)if(a<(n+=e[o]))return t[o];return t[t.length-1]}static RandomInt(t,e){return Math.floor(this.Random(t,e))}static Random(t,e){return(e-t)*Math.random()+t}static RandomRatio(t){return t>.01*Si.RandomInt(0,1e4)}static Clamp(t,e,i){return t<e?e:t>i?i:t}static Clamp01(t){return this.Clamp(t,0,1)}static Sign(t){return 0==t?1:t>0?1:-1}static GetNumCount(t){for(var e=0,i=t;i/10>0;)i=Math.floor(i/10),e++;return e}static Lerp(t,e,i){return t+(e-t)*Si.Clamp01(i)}static MoveTowardsAngle(t,e,i){var s=Si.DeltaAngle(t,e);return 0-i<s&&s<i?e:(e=t+s,Si.MoveTowards(t,e,i))}static MoveTowards(t,e,i){return Math.abs(e-t)<=i?e:t+Math.sign(e-t)*i}static DeltaAngle(t,e){var i=Si.Repeat(e-t,360);return i>180&&(i-=360),i}static Repeat(t,e){return Si.Clamp(t-Math.floor(t/e)*e,0,e)}static IsSimilar(t,e){return t==e}}Si.Deg2Rad=.0175,Si.Rad2Deg=57.2958;class Ii extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("EffectLayer","FlyPanel")}onConstruct(){this.m_test=this.getChildAt(0),this.m_pos=this.getChildAt(1)}}Ii.URL="ui://c2q7aw0bhluzc";class wi extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("EffectLayer","view_fly_diamond")}onConstruct(){this.m_icon=this.getChildAt(0)}}wi.URL="ui://c2q7aw0bhluze";class Ci extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("EffectLayer","view_fly_Money")}onConstruct(){this.m_icon=this.getChildAt(0)}}Ci.URL="ui://c2q7aw0bhluzf";class bi extends xe{constructor(){super(),this._layer=Yt.Tip}static get instance(){return null==this._instance&&(this._instance=new bi,this._instance._classDefine=Ii),this._instance}FlyCoins(t,e,i=100,s=1,a=10){let n=t.localToGlobal(),o=e.localToGlobal(),r=.6*s*1e3,l=.4*s*1e3;for(let t=0;t<i;++t){let t=Ci.createInstance();this.ui.addChild(t),t.setXY(n.x,n.y);let e=new Laya.Vector2(n.x+Si.Random(-a,a),n.y+Si.Random(-a,a));r=_e.Range(.85*r,r),Laya.Tween.to(t,{x:e.x,y:e.y},r,Laya.Ease.quadInOut,Laya.Handler.create(this,()=>{Laya.Tween.to(t,{x:o.x,y:o.y},l,Laya.Ease.quadInOut,Laya.Handler.create(this,()=>{t.dispose()}))}))}yi.Seconds(s)}FlyDiamonds(t,e,i=100,s=1,a=10){let n=t.localToGlobal(),o=e.localToGlobal(),r=.6*s*1e3,l=.4*s*1e3;for(let t=0;t<i;++t){let t=wi.createInstance();this.ui.addChild(t),t.setXY(n.x,n.y);let e=new Laya.Vector2(n.x+Si.Random(-a,a),n.y+Si.Random(-a,a));r=_e.Range(.85*r,r),Laya.Tween.to(t,{x:e.x,y:e.y},r,Laya.Ease.quadInOut,Laya.Handler.create(this,()=>{Laya.Tween.to(t,{x:o.x,y:o.y},l,Laya.Ease.quadInOut,Laya.Handler.create(this,()=>{t.dispose()}))}))}yi.Seconds(s)}}class Li{static FlyCoinsTo(t,e,i=20,s=1.5,a=120){bi.instance.FlyCoins(t,e,i,s,a)}static FlyDiamondTo(t,e,i=20,s=1.5,a=100){bi.instance.FlyDiamonds(t,e,i,s,a)}}class vi extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("TopInfoUI","PGameTopUI")}onConstruct(){this.m_text_money=this.getChildAt(1),this.m_text_water=this.getChildAt(3),this.m_text_diamond=this.getChildAt(5),this.m_bg_star=this.getChildAt(7),this.m_img_star=this.getChildAt(8),this.m_starProgress=this.getChildAt(9)}}vi.URL="ui://z16gwam3hd3v0";class Ai extends xe{constructor(){super(),this._layer=Yt.Main}static get instance(){return this.m_instance||(this.m_instance=new Ai,this.m_instance._classDefine=vi),this.m_instance}UpdateMoneyNum(t){this.isShow&&(this.ui.m_text_money.text=We.DoConverter(Math.floor(t)))}UpdateDiamondNum(t){this.isShow&&(this.ui.m_text_diamond.text=We.DoConverter(Math.floor(t)))}UpdateWaterState(){this.isShow&&(this.ui.m_text_water.text=this._data.water+"/"+this._data.MaxWater)}_OnShow(){super.Show(),it.instance.onUI(Nt.UpdateDiamondNum,this,this.UpdateDiamondNum),it.instance.onUI(Nt.UpdateMoneyNum,this,this.UpdateMoneyNum),it.instance.onUI(Nt.UpdateWaterState,this,this.UpdateWaterState),it.instance.on3D(A.SceneLoadComplete,this,this.UpdateMoneyDiamondShow),this._data=$e.instance.Data}UpdateMoneyDiamondShow(){this.ui.m_text_money.text=We.DoConverter(this._data.money),this.ui.m_text_diamond.text=We.DoConverter(this._data.diamond)}Expend(t,e){if(e<0)return!1;switch(t){case le.Money:if(!($e.Money>=e))return!1;$e.Money=$e.Money-e;break;case le.Diamond:if(!($e.Diamond>=e))return!1;$e.Diamond-=e;break;case le.Water:if(!($e.Water>=e))return!1;break;default:return!1}return!0}}!function(t){t.Money="Money",t.Diamond="Diamond",t.Water="Water"}(le||(le={}));class xi{constructor(){this.appId="",this.appKey="",this.bannerId="",this.rewardVideoId="",this.interstitialId="",this.nativeId="",this.nativeBannerIds=[],this.nativeIconIds=[],this.nativeinterstitialIds=[],this.nativeinpageIds=[],this.shareId=""}}class ki extends xi{constructor(){super(...arguments),this.appId="105468555",this.appKey="a70c0bc2cfe69035a6d1fd2cfac23470",this.bannerId="26b93e50f1ce416eab2c6f1fc1f01d7f",this.rewardVideoId="127dcf12690446ce8de68579944260d4",this.interstitialId="c7562d8a59d64a9cb121bfcb09ca2be8",this.nativeId="afc5b6c523254198bbbd30d02e5dca01",this.nativeBannerIds=[],this.nativeIconIds=[],this.nativeinterstitialIds=[],this.nativeinpageIds=[],this.shareId=""}}class Pi{constructor(){this.m_platform=window.qg||window.vivo,this.m_data=new ki}static get instance(){return this._i||(this._i=new Pi),this._i}get nativeAd(){return this.m_nativeAd}createNativeAd(){this.m_nativeAd=this.m_platform.createNativeAd({adUnitId:this.m_data.nativeId})}nativeAdLoadAsync(){return console.log("异步加载原生广告"),new Promise(t=>{var e,i,s;let a=e=>{var i;null===(i=this.m_nativeAd)||void 0===i||i.offLoad(a),t(e.adList)};null===(e=this.m_nativeAd)||void 0===e||e.onLoad(a);let n=t=>{var e,i;console.log("加载广告失败出错"),null===(e=this.m_nativeAd)||void 0===e||e.offError(n),null===(i=this.m_nativeAd)||void 0===i||i.offLoad(a),console.log("原生广告错误信息===>>>："+t.errMsg),console.log("原生广告错误码==>>>："+t.errCode)};null===(i=this.m_nativeAd)||void 0===i||i.onError(n),null===(s=this.m_nativeAd)||void 0===s||s.load()})}destroy(){try{console.warn("destroy 前",this.m_nativeAd),this.m_nativeAd&&this.m_nativeAd.destroy&&this.m_nativeAd.destroy(),console.warn("destroy 后",this.m_nativeAd)}catch(t){console.warn("destroy 异常"),console.error(t)}}}var Di,Ui="105468555",Ti="7CaD3L23LlGnENd1",Ri="true",Oi="vivo",Mi={},Ei=function(t,e){Mi[t]=e},Bi=function(t){return Mi[t]},Gi=function(t,e){if(e){var i=Bi(t+"_time");return null==i||Date.now()-Number(i)<e?Bi(t):null}return Bi(t)},Ni=function(t,e){Ei(t,e),Ei(t+"_time",Date.now())},Fi=function(t,e,i,s,a,n){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==o.readyState){var t=o.responseText;if(o.status>=200&&o.status<400){var e={};try{e=JSON.parse(t)}catch(e){console.error("json parse error ",t),a&&a(e)}s&&s(e)}else console.error("error ",t),a&&a(t)}},o.timeout=3e3,o.ontimeout=function(t){console.error("error ",t),a&&a(t)},o.open(i,t,!0),"POST"==i?(o.open("POST",t),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(function(t){var e=[];for(var i in t)e.push(i+"="+t[i]);return e.join("&")}(e))):o.send()},Vi=function(t){return"function"==typeof t},Wi=function(t,e){e=e||!0;for(var i=Object.keys(t).sort(),s="",a=0;a<i.length;a++)s+=i[a]+":"+t[i[a]];e&&(s+=Ti);var n=function(t){var e,i,s,a,n,o,r,l,h,c=function(t,e){return t<<e|t>>>32-e},d=function(t,e){var i,s,a,n,o;return a=2147483648&t,n=2147483648&e,o=(1073741823&t)+(1073741823&e),(i=1073741824&t)&(s=1073741824&e)?2147483648^o^a^n:i|s?1073741824&o?3221225472^o^a^n:1073741824^o^a^n:o^a^n},u=function(t,e,i,s,a,n,o){return t=d(t,d(d(function(t,e,i){return t&e|~t&i}(e,i,s),a),o)),d(c(t,n),e)},m=function(t,e,i,s,a,n,o){return t=d(t,d(d(function(t,e,i){return t&i|e&~i}(e,i,s),a),o)),d(c(t,n),e)},_=function(t,e,i,s,a,n,o){return t=d(t,d(d(function(t,e,i){return t^e^i}(e,i,s),a),o)),d(c(t,n),e)},g=function(t,e,i,s,a,n,o){return t=d(t,d(d(function(t,e,i){return e^(t|~i)}(e,i,s),a),o)),d(c(t,n),e)},p=function(t){var e,i="",s="";for(e=0;e<=3;e++)i+=(s="0"+(t>>>8*e&255).toString(16)).substr(s.length-2,2);return i},f=Array();for(f=function(t){for(var e,i=t.length,s=i+8,a=16*((s-s%64)/64+1),n=Array(a-1),o=0,r=0;r<i;)o=r%4*8,n[e=(r-r%4)/4]=n[e]|t.charCodeAt(r)<<o,r++;return o=r%4*8,n[e=(r-r%4)/4]=n[e]|128<<o,n[a-2]=i<<3,n[a-1]=i>>>29,n}(t=function(t){t=t.replace(/\x0d\x0a/g,"\n");for(var e="",i=0;i<t.length;i++){var s=t.charCodeAt(i);s<128?e+=String.fromCharCode(s):s>127&&s<2048?(e+=String.fromCharCode(s>>6|192),e+=String.fromCharCode(63&s|128)):(e+=String.fromCharCode(s>>12|224),e+=String.fromCharCode(s>>6&63|128),e+=String.fromCharCode(63&s|128))}return e}(t)),o=1732584193,r=4023233417,l=2562383102,h=271733878,e=0;e<f.length;e+=16)i=o,s=r,a=l,n=h,o=u(o,r,l,h,f[e+0],7,3614090360),h=u(h,o,r,l,f[e+1],12,3905402710),l=u(l,h,o,r,f[e+2],17,606105819),r=u(r,l,h,o,f[e+3],22,3250441966),o=u(o,r,l,h,f[e+4],7,4118548399),h=u(h,o,r,l,f[e+5],12,1200080426),l=u(l,h,o,r,f[e+6],17,2821735955),r=u(r,l,h,o,f[e+7],22,4249261313),o=u(o,r,l,h,f[e+8],7,1770035416),h=u(h,o,r,l,f[e+9],12,2336552879),l=u(l,h,o,r,f[e+10],17,4294925233),r=u(r,l,h,o,f[e+11],22,2304563134),o=u(o,r,l,h,f[e+12],7,1804603682),h=u(h,o,r,l,f[e+13],12,4254626195),l=u(l,h,o,r,f[e+14],17,2792965006),o=m(o,r=u(r,l,h,o,f[e+15],22,1236535329),l,h,f[e+1],5,4129170786),h=m(h,o,r,l,f[e+6],9,3225465664),l=m(l,h,o,r,f[e+11],14,643717713),r=m(r,l,h,o,f[e+0],20,3921069994),o=m(o,r,l,h,f[e+5],5,3593408605),h=m(h,o,r,l,f[e+10],9,38016083),l=m(l,h,o,r,f[e+15],14,3634488961),r=m(r,l,h,o,f[e+4],20,3889429448),o=m(o,r,l,h,f[e+9],5,568446438),h=m(h,o,r,l,f[e+14],9,3275163606),l=m(l,h,o,r,f[e+3],14,4107603335),r=m(r,l,h,o,f[e+8],20,1163531501),o=m(o,r,l,h,f[e+13],5,2850285829),h=m(h,o,r,l,f[e+2],9,4243563512),l=m(l,h,o,r,f[e+7],14,1735328473),o=_(o,r=m(r,l,h,o,f[e+12],20,2368359562),l,h,f[e+5],4,4294588738),h=_(h,o,r,l,f[e+8],11,2272392833),l=_(l,h,o,r,f[e+11],16,1839030562),r=_(r,l,h,o,f[e+14],23,4259657740),o=_(o,r,l,h,f[e+1],4,2763975236),h=_(h,o,r,l,f[e+4],11,1272893353),l=_(l,h,o,r,f[e+7],16,4139469664),r=_(r,l,h,o,f[e+10],23,3200236656),o=_(o,r,l,h,f[e+13],4,681279174),h=_(h,o,r,l,f[e+0],11,3936430074),l=_(l,h,o,r,f[e+3],16,3572445317),r=_(r,l,h,o,f[e+6],23,76029189),o=_(o,r,l,h,f[e+9],4,3654602809),h=_(h,o,r,l,f[e+12],11,3873151461),l=_(l,h,o,r,f[e+15],16,530742520),o=g(o,r=_(r,l,h,o,f[e+2],23,3299628645),l,h,f[e+0],6,4096336452),h=g(h,o,r,l,f[e+7],10,1126891415),l=g(l,h,o,r,f[e+14],15,2878612391),r=g(r,l,h,o,f[e+5],21,4237533241),o=g(o,r,l,h,f[e+12],6,1700485571),h=g(h,o,r,l,f[e+3],10,2399980690),l=g(l,h,o,r,f[e+10],15,4293915773),r=g(r,l,h,o,f[e+1],21,2240044497),o=g(o,r,l,h,f[e+8],6,1873313359),h=g(h,o,r,l,f[e+15],10,4264355552),l=g(l,h,o,r,f[e+6],15,2734768916),r=g(r,l,h,o,f[e+13],21,1309151649),o=g(o,r,l,h,f[e+4],6,4149444226),h=g(h,o,r,l,f[e+11],10,3174756917),l=g(l,h,o,r,f[e+2],15,718787259),r=g(r,l,h,o,f[e+9],21,3951481745),o=d(o,i),r=d(r,s),l=d(l,a),h=d(h,n);return(p(o)+p(r)+p(l)+p(h)).toLowerCase()}(s);return n=n.toLowerCase()},ji=null;if("wx"===Oi){var qi={app_key:Ui,getLocation:!1};ji=function(){var t={},e=function(t,e){if("3"==t.app_type){var i=Bi(t.appid);Ei(t.appid,null==i?1:Number(i)+1)}var s,a,n,o,r,l;"undefined"!=typeof wx&&(s=t.app_id,a=e,n=Math.round((new Date).getTime()/1e3).toString(),r=Wi(o={user_id:a,from_id:Ui,to_id:s,timestamp:n}),l=Object.assign({},o,{sign:r}),Fi("https://ad.li-yun.wang/api/appad_new/collect",l,"POST",function(){},function(){console.log("appad_new/collect fail")}))};t.userId=null,t.srcAppId="",t.launchScene="",t.init=function(t){console.log("zsAdSdk.init"),function(){function o(r,c,_){function t(){return new Promise(function(t,e){let i=wx.getStorageSync("tjxx");if(void 0!==i.openid)for(_ in i)r[_]=i[_];if(""==r.cd)t("");else{u++;wx.request({url:"https://ad.ali-yun.wang/api/app_jump/in",data:r,header:{se:l||"",op:h||"",img:f||""},method:"POST",success:function(e){wx.setStorageSync("tjxx",e.data),clearTimeout(s),!0,void 0!==e.data.rtime&&parseInt(e.data.rtime)>0?s=setTimeout(function(){o(r,t,2)},1e3*parseInt(e.data.rtime)):void 0!==i.rtime&&parseInt(i.rtime)>0&&(s=setTimeout(function(){o(r,t,2)},1e3*parseInt(i.rtime)))},fail:function(){!0,void 0!==i.rtime&&parseInt(i.rtime)>0&&(clearTimeout(s),s=setTimeout(function(){o(r,t,2)},1e3*parseInt(i.rtime)))}})}})}r.rq_c=u,r.cd=y,r.ifo=a,r.ak=i.app_key,r.uu=n,r.v=e,r.st=Date.now(),r.ev=c,r.wsr=m,r.ufo=function(t){if(void 0===t||""===t)return"";var e={};for(var i in t)"rawData"!=i&&"errMsg"!=i&&(e[i]=t[i]);return e}(r.ufo),r.ec=d,void 0===_?wx.Queue.push(t):t()}function c(t){var e={};for(var i in t)e[i]=t[i];return e}wx.Queue=new function(){this.concurrency=200,this.queue=[],this.tasks=[],this.activeCount=0;var t=this;this.push=function(e){this.tasks.push(new Promise(function(i,s){var a=function(){t.activeCount++,e().then(function(t){i(t)}).then(function(){t.next()})};t.activeCount<t.concurrency?a():t.queue.push(a)})),console.log("3")},this.all=function(){return console.log("4"),Promise.all(this.tasks)},this.next=function(){console.log("5"),t.activeCount--,t.queue.length>0&&t.queue.shift()()}},wx.Queue.all();var e="1.0.0",i=qi;""===i.app_key&&console.error("请在配置文件中填写您的app_key"),i.app_key=i.app_key.replace(/\s/g,"");var s,a="",n=function(){var t="";try{t=wx.getStorageSync("h_stat_uuid"),wx.setStorageSync("h_ifo",!0)}catch(e){t="uuid_getstoragesync"}if(t)a=!1;else{t=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+e()+e()+e()+e()+e()+e()}(),a=!0;try{wx.setStorageSync("h_stat_uuid",t)}catch(t){wx.setStorageSync("h_stat_uuid","uuid_getstoragesync")}}return t}(),r={},l="",h="",d=0,u="",m=wx.getLaunchOptionsSync(),_=Date.now(),g=(Date.now(),Math.floor(1e7*Math.random()),Date.now(),Math.floor(1e7*Math.random()),0),p="",f="",y="",S=!0,I=["h_SendEvent","h_OnShareAppMessage","h_ShareAppMessage","h_SendSession","h_SendOpenid"];Promise.all([new Promise(function(t,e){""==y&&wx.login({success:function(e){y=e.code,console.log(y+"---------"),t("")}})}),new Promise(function(t,e){wx.getNetworkType({success:function(e){t(e)},fail:function(){t("")}})}),new Promise(function(t,e){i.getLocation?wx.getLocation({success:function(e){t(e)},fail:function(){t("")}}):wx.getSetting({success:function(e){e.authSetting["scope.userLocation"]?(wx.getLocation({success:function(e){t(e)},fail:function(){t("")}}),t("")):t("")},fail:function(){t("")}})})]).then(function(t){""!==t[2]?(r.lat=t[2].latitude||"",r.lng=t[2].longitude||"",r.spd=t[2].speed||""):(r.lat="",r.lng="",r.spd=""),""!==t[1]?r.nt=t[1].networkType||"":r.nt="";var e=c(r);""!==t[0]&&(e.ufo=t[0],p=t[0]),o(e,"init")}),wx.onShow(function(t){u=0,m=t,g=Date.now(),S||(""+Date.now()+Math.floor(1e7*Math.random()),a=!1,wx.setStorageSync("h_ifo",!1)),S=!1;var e=c(r),i=c(r);e.sm=g-_,t.query.h_share_src&&t.shareTicket&&"1044"===t.scene?(i.tp="h_share_click",new Promise(function(t,e){"1044"==m.scene?wx.getShareInfo({shareTicket:m.shareTicket,success:function(e){t(e)},fail:function(){t("")}}):t("")}).then(function(t){i.ct=t,o(i,"event")})):t.query.h_share_src&&(i.tp="h_share_click",i.ct="1",o(i,"event")),o(e,"show")}),wx.onHide(function(){var t=c(r);t.dr=Date.now()-g,""===p?wx.getSetting({success:function(e){e.authSetting["scope.userInfo"]?wx.getUserInfo({success:function(e){t.ufo=e,p=e,f=function(t){for(var e="",i=0;i<t.length;i++)t[i].length>e.length&&(e=t[i]);return e}(e.userInfo.avatarUrl.split("/")),o(t,"hide")}}):o(t,"hide")}}):o(t,"hide")}),wx.onError(function(t){var e=c(r);e.tp="h_error_message",e.ct=t,d++,o(e,"event")});for(var w={h_SendEvent:function(t,e){var i=c(r);""!==t&&"string"==typeof t&&t.length<=255?(i.tp=t,"string"==typeof e&&e.length<=255?(i.ct=String(e),o(i,"event")):"object"==(void 0===e?"undefined":_typeof(e))?(JSON.stringify(e).length>=255&&console.error("自定义事件参数不能超过255个字符"),i.ct=JSON.stringify(e),o(i,"event")):void 0===e||""===e?o(i,"event"):console.error("事件参数必须为String,Object类型,且参数长度不能超过255个字符")):console.error("事件名称必须为String类型且不能超过255个字符")},h_OnShareAppMessage:function(t){wx.updateShareMenu({withShareTicket:!0,complete:function(){wx.onShareAppMessage(function(){var e=t(),i="",s="";i=void 0!==e.success?e.success:"",s=void 0!==e.fail?e.fail:"";var a;a=void 0!==m.query.h_share_src?void 0!==e.query?(m.query.h_share_src.indexOf(n),e.query+"&h_share_src="+m.query.h_share_src+","+n):(m.query.h_share_src.indexOf(n),"h_share_src="+m.query.h_share_src+","+n):void 0!==e.query?e.query+"&h_share_src="+n:"h_share_src="+n;var l=c(r);return e.query=a,l.ct=e,l.tp="h_share_chain",o(l,"event"),e.success=function(t){l.tp="h_share_status",o(l,"event"),""!==i&&i(t)},e.fail=function(t){l.tp="h_share_fail",o(l,"event"),""!==s&&s(t)},e})}})},h_ShareAppMessage:function(t){var e=t,i="",s="";i=void 0!==e.success?e.success:"",s=void 0!==e.fail?e.fail:"";var a;a=void 0!==m.query.h_share_src?void 0!==e.query?(m.query.h_share_src.indexOf(n),e.query+"&h_share_src="+m.query.h_share_src+","+n):(m.query.h_share_src.indexOf(n),"h_share_src="+m.query.h_share_src+","+n):void 0!==e.query?e.query+"&h_share_src="+n:"h_share_src="+n,e.query=a;var l=c(r);l.ct=e,l.tp="h_share_chain",o(l,"event"),e.success=function(t){l.tp="h_share_status",o(l,"event"),""!==i&&i(t)},e.fail=function(t){l.tp="h_share_fail",o(l,"event"),""!==s&&s(t)},wx.updateShareMenu({withShareTicket:!0,complete:function(){wx.shareAppMessage(e)}})},h_SendSession:function(t){if(""!==t&&t){var e=c(r);e.tp="session",e.ct="session",l=t,""===p?wx.getSetting({success:function(t){t.authSetting["scope.userInfo"]?wx.getUserInfo({success:function(t){e.ufo=t,o(e,"event")}}):o(e,"event")}}):(e.ufo=p,""!==p&&(e.gid=""),o(e,"event"))}else console.error("请传入从后台获取的session_key")},h_SendOpenid:function(t){if(""!==t&&t){h=t;var e=c(r);e.tp="openid",e.ct="openid",o(e,"event")}else console.error("openID不能为空")}},C=0;C<I.length;C++)!function(t,e){Object.defineProperty(wx,t,{value:e,writable:!1,enumerable:!0,configurable:!0})}(I[C],w[I[C]]);try{var b=wx.getSystemInfoSync();r.br=b.brand||"",r.md=b.model,r.pr=b.pixelRatio,r.sw=b.screenWidth,r.sh=b.screenHeight,r.ww=b.windowWidth,r.wh=b.windowHeight,r.lang=b.language,r.wv=b.version,r.sv=b.system,r.wvv=b.platform,r.fs=b.fontSizeSetting,r.wsdk=b.SDKVersion,r.bh=b.benchmarkLevel||"",r.bt=b.battery||"",r.wf=b.wifiSignal||"",r.lng="",r.lat="",r.nt="",r.spd="",r.ufo=""}catch(t){}}()};var i=[1011,1012,1013,1025,1031,1032,1047,1048,1049,1124,1125,1126];return t.adCbList=[],t.inAdRequest=!1,t.isFromLink=function(){return this.launchInfo&&i.indexOf(this.launchInfo.scene)>=0?(console.log("open by code"),!0):null!=this.launchInfo&&null!=this.launchInfo.query&&null!=this.launchInfo.query.customLink},t.loadAd=function(e){var i=Gi("zsAd",6e5);if(i)e(i);else if(this.inAdRequest)this.adCbList.push(e);else{this.inAdRequest=!0,this.adCbList.push(e);var s=Math.round((new Date).getTime()/1e3).toString(),a={appid:Ui,timestamp:s},n=Wi(a),o=Object.assign({},a,{sign:n});Fi("https://ad.li-yun.wang/api/appad_new/index",o,"POST",function(e){for(var i in t.inAdRequest=!1,e.data){e.data[i].sort(function(){return Math.random()>.5?1:-1})}var s={more:e.data["position-1"]||[],promotion:e.data["position-2"]||[],indexFloat:e.data["position-3"]||[],banner:e.data["position-4"]||[],indexLeft:e.data["position-7"]||[],gameFloat:e.data["position-8"]||[],endPage:e.data["position-9"]||[],indexLeftFloat:e.data["position-11"]||[],backAd:e.data["position-12"]||[],iosLinkAd:e.data["position-13"]||[]};Ni("zsAd",s);for(var a=0;a<t.adCbList.length;a++)Vi(t.adCbList[a])&&t.adCbList[a](s);t.adCbList=[]},function(e){t.inAdRequest=!1,console.log("requestAdData fail");for(var i={more:[],promotion:[],indexFloat:[],banner:[],indexLeft:[],gameFloat:[],endPage:[],indexLeftFloat:[],backAd:[],iosLinkAd:[]},s=0;s<t.adCbList.length;s++)Vi(t.adCbList[s])&&t.adCbList[s](i);t.adCbList=[]})}},t.navigate2Mini=function(t,i,s,a,n){var o=t;if("undefined"==typeof wx)return Vi(a)&&a(),void(Vi(n)&&n());o.extraData=o.extraData||{},wx.navigateToMiniProgram({appId:o.appid,path:o.link_path,extraData:o.extraData,success:function(t){e(o,i),Vi(s)&&s()},fail:function(t){Vi(a)&&a()},complete:function(t){Vi(n)&&n()}})},t.login=function(t,e){wx.login({success:function(i){i.code?function(t,e,i){Fi("https://cpcf.qop2018.com/api/app_login/index",i,"POST",function(i){200!=i.code?e(i.msg):t(i.data.openid)},function(t){e(t)})}(t,e,{code:i.code,appid:Ui}):e&&e("微信登陆失败")},fail:function(){e&&e("微信登陆失败")},complete:function(){}})},t.loadCfg=function(t,e){Fi("https://cpcf.wqop218.com/api/list_config/index",{appid:Ui},"POST",function(i){200!=i.code?e(i.msg):t(i.data)},function(t){e(t)})},t}()}else"oppo"===Oi?((Di={}).userId=null,Di.init=function(t){this.userId=t,function(){if(null!=Di.userId){if("undefined"!=typeof qg){var t=qg.getLaunchOptionsSync(),e=t&&t.referrerInfo?t.referrerInfo.extraData:null;if(e&&e.from){var i={from_id:e.from,oppo_id:Ui,user_id:Di.userId,from_path:e.path?e.path:"0",from_page:t.referrerInfo.package?t.referrerInfo.package:"0"};Fi("https://platform.qwpo2018.com/api/oppo_in/index",i,"POST",function(){console.log("oppo_in success")},function(){console.log("oppo_in fail")})}}}else console.error("userId is null")}()},Di.cfgCbList=[],Di.inCfgRequest=!1,Di.adCbList=[],Di.inAdRequest=!1,Di.loadAd=function(t){var e=Gi("zsAd",6e5);e?t(e):this.inAdRequest?this.adCbList.push(t):(this.inAdRequest=!0,this.adCbList.push(t),Fi("https://platform.qwpo2018.com/api/apk_ad/index",{apk_id:Ui},"POST",function(t){Di.inAdRequest=!1,t.data.sort(function(){return Math.random()>.5?1:-1});for(var e=0;e<t.data.length;++e)t.data[e].app_icon=t.data[e].link_img,t.data[e].app_title=t.data[e].link_name,t.data[e].app_desc=t.data[e].link_name,t.data[e].app_desc=t.data[e].link_des,t.data[e].link_id=t.data[e].id,t.data[e].pkg_name=t.data[e].link_page,t.data[e].path=t.data[e].link_path;var i={promotion:t.data};Ni("zsAd",i);for(var s=0;s<Di.adCbList.length;s++)Vi(Di.adCbList[s])&&Di.adCbList[s](i);Di.adCbList=[]},function(t){Di.inAdRequest=!1,console.log("requestAdData fail");for(var e={promotion:[]},i=0;i<Di.adCbList.length;i++)Vi(Di.adCbList[i])&&Di.adCbList[i](e);Di.adCbList=[]}))},Di.navigate2Mini=function(t,e,i,s,a){var n=t,o=n.extraData||{};o.from=Ui,qg.navigateToMiniGame({pkgName:n.pkg_name,path:n.path,extraData:o,success:function(){!function(t,e){t={apk_id:Ui,link_id:t.link_id,user_id:e},Fi("https://platform.qwpo2018.com/api/apk_ad/click_log",t,"POST",function(){console.log("uploadNavigateEvent success")},function(){console.log("uploadNavigateEvent fail")})}(n,e),console.log("targetMini:",n),Vi(i)&&i()},fail:function(){Vi(s)&&s()}}),console.log("navigateData:"+JSON.stringify(o))},Di.login=function(t,e){qg.login({success:function(i){0==i.code?function(t,e,i){Fi("https://platform.qwpo2018.com/api/oppo_login/index",i,"POST",function(i){200!=i.code?e(i.msg):t(i.data.user_id)},function(t){e(t)})}(t,e,{code:i.data.token,apk_id:Ui}):e&&e("oppo登陆失败")},fail:function(){e&&e("oppo登陆失败")},complete:function(){}})},Di.loadCfg=function(t,e){Fi("https://platform.qwpo2018.com/api/list_config/index",{apk_id:Ui},"POST",function(i){200!=i.code?e(i.msg):t(i.data)},function(t){e(t)})},Di.isExportValid=function(){return!0},Di.isFromLink=function(){return!1},ji=Di):ji="vivo"===Oi?function(){var t={},e=function(t,e,i){Fi("https://platform.qwpo2018.com/api/vivo_login/index",i,"POST",function(i){200!=i.code?e(i.msg):t(i.data.user_id)},function(t){e(t)})};return t.cfgCbList=[],t.inCfgRequest=!1,t.adCbList=[],t.inAdRequest=!1,t.loadAd=function(e){var i=Gi("zsAd",6e5);if(i)e(i);else if(this.inAdRequest)this.adCbList.push(e);else{this.inAdRequest=!0,this.adCbList.push(e);Fi("https://platform.qwpo2018.com/api/apk_ad/index",{apk_id:Ui},"POST",function(e){t.inAdRequest=!1,e.data.sort(function(){return Math.random()>.5?1:-1});for(var i=0;i<e.data.length;++i)e.data[i].app_icon=e.data[i].link_img,e.data[i].app_title=e.data[i].link_name,e.data[i].app_desc=e.data[i].link_name,e.data[i].app_desc=e.data[i].link_des,e.data[i].link_id=e.data[i].id,e.data[i].pkg_name=e.data[i].link_page,e.data[i].path=e.data[i].link_path;var s={promotion:e.data};Ni("zsAd",s);for(var a=0;a<t.adCbList.length;a++)Vi(t.adCbList[a])&&t.adCbList[a](s);t.adCbList=[]},function(e){t.inAdRequest=!1,console.log("requestAdData fail");for(var i={promotion:[]},s=0;s<t.adCbList.length;s++)Vi(t.adCbList[s])&&t.adCbList[s](i);t.adCbList=[]})}},t.navigate2Mini=function(t,e,i,s,a){var n=t,o=n.extraData||{};o.from=Ui,qg.navigateToMiniGame({pkgName:n.pkg_name,path:n.path,extraData:o,success:function(){!function(t,e){t={apk_id:Ui,link_id:t.link_id,user_id:e};Fi("https://platform.qwpo2018.com/api/apk_ad/click_log",t,"POST",function(){console.log("uploadNavigateEvent success")},function(){console.log("uploadNavigateEvent fail")})}(n,e),console.log("targetMini:",n),Vi(i)&&i()},fail:function(){Vi(s)&&s()}}),console.log("navigateData:"+JSON.stringify(o))},t.login=function(t,i){console.log("zsSdk.login..","vivo平台版本为："+qg.getSystemInfoSync().platformVersionCode),qg.getSystemInfoSync().platformVersionCode>=1053?qg.login().then(s=>{if(s.data.token){var a=JSON.stringify(s.data);console.log(a),e(t,i,{code:s.data.token,apk_id:Ui})}},t=>{failedHandler&&failedHandler.runWith(JSON.stringify(t)),console.log("vivo login fail",JSON.stringify(t))}):qg.authorize({type:"code",success:function(s){console.log(s),e(t,i,{code:s.code,apk_id:Ui})},fail:function(t,e){failedHandler&&failedHandler.runWith(JSON.stringify(e)),console.log("vivo login fail",JSON.stringify(t))}})},t.loadCfg=function(t,e){Fi("https://platform.qwpo2018.com/api/list_config/index",{apk_id:Ui},"POST",function(i){200!=i.code?e(i.msg):t(i.data)},function(t){e(t)})},t}():"tt"==Oi?function(){var t={};return t.userId=null,t.srcAppId="",t.init=function(e){if(console.log("zsAdSdk.init"),this.userId=e,"undefined"==typeof tt)this.srcAppId="0";else{var i=tt.getLaunchOptionsSync();this.launchScene=i.scene?i.scene:"",this.srcAppId=i.referrerInfo&&i.referrerInfo.appId?i.referrerInfo.appId:"0"}!function(){if(Ri)if(null!=t.userId){if("undefined"!=typeof tt){var e=tt.getLaunchOptionsSync(),i={appid:Ui,from_id:t.srcAppId,user_id:t.userId,from_path:e.query?e.query:"0"};Fi("https://platform.qwpo2018.com/api/jrtt_jump/index",i,"POST",function(){},function(){console.log('jrtt_jump/index" fail')})}}else console.error("userId is null")}()},t.adCbList=[],t.inAdRequest=!1,t.loadAd=function(e){var i=Gi("zsAd",1e3);if(i)e(i);else if(this.inAdRequest)this.adCbList.push(e);else{this.inAdRequest=!0,this.adCbList.push(e);var s=Math.round((new Date).getTime()/1e3).toString(),a={apk_id:Ui,timestamp:s},n=Wi(a),o=Object.assign({},a,{sign:n});Fi("https://platform.qwpo2018.com/api/apk_ad/index",o,"POST",function(e){t.inAdRequest=!1,e.data.sort(function(){return Math.random()>.5?1:-1}),console.log("res.data",e.data);for(var i=0;i<e.data.length;++i)e.data[i].app_icon=e.data[i].link_img,e.data[i].app_title=e.data[i].link_name,e.data[i].app_desc=e.data[i].link_name,e.data[i].app_desc=e.data[i].link_des,e.data[i].link_id=e.data[i].id,e.data[i].app_id=e.data[i].link_appid,e.data[i].pkg_name=e.data[i].link_page,e.data[i].path=e.data[i].link_path;var s={promotion:e.data};Ni("zsAd",s);for(var a=0;a<t.adCbList.length;a++)Vi(t.adCbList[a])&&t.adCbList[a](s);t.adCbList=[]},function(e){t.inAdRequest=!1,console.log("requestAdData fail");for(var i={promotion:[]},s=0;s<t.adCbList.length;s++)Vi(t.adCbList[s])&&t.adCbList[s](i);t.adCbList=[]})}},t.showMoreGamesModal=function(t,e){if("undefined"==typeof tt||"function"!=typeof tt.showMoreGamesModal)return;tt.offNavigateToMiniProgram(),tt.offMoreGamesModalClose(),tt.onMoreGamesModalClose(function(t){console.log("modal closed",t)}),tt.onNavigateToMiniProgram(function(i){i&&(console.log("是否有跳转的小游戏",i),0==i.errCode?Vi(t)&&t():Vi(e)&&e())});const i=tt.getSystemInfoSync();var s={};s.appId=Ui,"ios"!==i.platform&&tt.showMoreGamesModal({appLaunchOptions:[{extraData:s}],success(t){console.log("showMoreGamesModal success",t.errMsg)},fail(t){console.log("showMoreGamesModal fail",t.errMsg)}})},t.login=function(t,e){tt.login({force:!1,success:function(i){console.log(i),i.code||i.anonymousCode?function(t,e,i){Fi("https://platform.qwpo2018.com/api/jrtt_login/index",i,"POST",function(i){200!=i.code?e(i.msg):t(i.data.openid)},function(t){e(t)})}(t,e,{appid:Ui,code:i.code||"",anonymous_code:i.anonymousCode}):e&&e("头条登陆失败")},fail:function(){e&&e("头条登陆失败")},complete:function(){}})},t.loadCfg=function(t,e){Fi("https://platform.qwpo2018.com/api/list_config/index",{apk_id:Ui},"POST",function(i){200!=i.code?e(i.msg):t(i.data)},function(t){e(t)})},t}():"qq"==Oi?function(){var t={};t.userId=null,t.srcAppId="",t.launchScene="",t.init=function(e){if(console.log("zsAdSdk.init"),this.userId=e,"undefined"==typeof qq)this.launchScene=1038,this.srcAppId="";else{var i=qq.getLaunchOptionsSync();this.launchScene=i.scene?i.scene:"",this.srcAppId=i.referrerInfo&&i.referrerInfo.appId?i.referrerInfo.appId:"",console.debug("来路统计"+this.srcAppId)}!function(){if(null!=t.userId){var e={appid:Ui,from_id:t.srcAppId?t.srcAppId:t.launchScene,user_id:t.userId};Fi("https://platform.qwpo2018.com/api/qq_jump/index",e,"POST",function(){console.log("qq_jump/index  --\x3e success")},function(){console.log("qq_jump/index  --\x3e fail")})}else console.error("userId is null")}()},t.cfgCbList=[],t.inCfgRequest=!1,t.loadCfg=function(t,e){var i=Math.round((new Date).getTime()/1e3).toString(),s={apk_id:Ui,timestamp:i},a=Wi(s),n=Object.assign({},s,{sign:a});Fi("https://platform.qwpo2018.com/api/list_config/index",n,"POST",function(i){200!=i.code?e(i.msg):t(i.data)},function(t){e(t)})},t.adCbList=[],t.inAdRequest=!1,t.loadAd=function(e){var i=Gi("zsAd",1e3);if(i)e(i);else if(this.inAdRequest)this.adCbList.push(e);else{this.inAdRequest=!0,this.adCbList.push(e);var s=Math.round((new Date).getTime()/1e3).toString(),a={apk_id:Ui,timestamp:s},n=Wi(a),o=Object.assign({},a,{sign:n});Fi("https://platform.qwpo2018.com/api/apk_ad/index",o,"POST",function(e){if(e.data){t.inAdRequest=!1,e.data.sort(function(){return Math.random()>.5?1:-1}),console.log("res.data",e.data);for(var i=0;i<e.data.length;++i)e.data[i].app_icon=e.data[i].link_img,e.data[i].app_title=e.data[i].link_name,e.data[i].app_desc=e.data[i].link_name,e.data[i].app_desc=e.data[i].link_des,e.data[i].link_id=e.data[i].id,e.data[i].app_id=e.data[i].link_appid,e.data[i].pkg_name=e.data[i].link_page,e.data[i].path=e.data[i].link_path;var s={promotion:e.data};Ni("zsAd",s);for(var a=0;a<t.adCbList.length;a++)Vi(t.adCbList[a])&&t.adCbList[a](s);t.adCbList=[]}},function(e){t.inAdRequest=!1,console.log("requestAdData fail");for(var i={promotion:[]},s=0;s<t.adCbList.length;s++)Vi(t.adCbList[s])&&t.adCbList[s](i);t.adCbList=[]})}};var e=[];t.isFromLink=function(){return this.launchInfo&&e.indexOf(this.launchInfo.scene)>=0?(console.log("open by code"),!0):null!=this.launchInfo&&null!=this.launchInfo.query&&null!=this.launchInfo.query.customLink},t.login=function(t,e){qq.login({success:function(i){i.code?function(t,e,i){Fi("https://platform.qwpo2018.com/api/qq_login/index",i,"POST",function(i){200!=i.code?e(i.msg):t(i.data.openid)},function(t){e(t)})}(t,e,{code:i.code,appid:Ui}):e&&e("QQ登陆失败")},fail:function(){e&&e("QQ登陆失败")},complete:function(){}})},t.launchInfo=null;return"undefined"==typeof qq||(t.launchInfo=qq.getLaunchOptionsSync(),console.debug("scene:"+t.launchInfo.scene),t.isFromLink()&&console.debug("open by link")),t}():function(){var t={loadAd:function(t){},navigate2Mini:function(t,e,i,s,a){},login:function(t,e){},loadCfg:function(t,e){}};return t}();const Hi=ji;class zi{constructor(){this.version="1.09999"}static get instance(){return this.m_instance||(this.m_instance=new zi),this.m_instance}get data(){return this.m_data}start(){return new Promise(t=>{Hi.loadCfg(e=>{this.m_data=e,console.log("加载配置成功================>>>>>>",e),t()},e=>{this.m_data={},console.log("加载配置失败================>>>>>>>",e),t()})})}}class Qi extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameAd","GameAd")}onConstruct(){this.m_mask=this.getChildAt(0),this.m_AdBg=this.getChildAt(1),this.m_AdIcon=this.getChildAt(2),this.m_JumpBtn=this.getChildAt(3),this.m_closeBtn=this.getChildAt(4),this.m_title=this.getChildAt(5),this.m_logo_bg=this.getChildAt(6),this.m_logo=this.getChildAt(7),this.m_forkClickArea=this.getChildAt(8)}}Qi.URL="ui://ch5t1ckll2oz0";class Ji extends xe{constructor(){super(),this.vivoObj=null,this.CanShow=!0,this._layer=Yt.NativeAD,this.SDKdata=zi.instance.data}static get instance(){return this.m_instance||(this.m_instance=new Ji,this.m_instance._classDefine=Qi),this.m_instance}ShowNativeAd(){Re.IsCompleteAllGuide?this.CanShow?(console.log("调用原生广告"),Pi.instance.destroy(),Pi.instance.nativeAdLoadAsync().then(t=>{console.log("原生广告数据",t),this.m_data=t[0],this.SDKdata.zs_version==zi.instance.version&&1==this.SDKdata.zs_native_limit&&(Pi.instance.nativeAd.reportAdShow({adId:t[0].adId}),this.TempFGUI_GameAd=Ae.AddUI(Qi,Yt.NativeAD),this.setAdData(this.TempFGUI_GameAd,this.m_data),this.CanShow=!1)})):console.warn("原生广是否可显示: ",this.CanShow):console.warn("引导未结束，不显示原生广告！")}setAdData(t,e){if(this.TempFGUI_GameAd=t,this.TempNativeAd=e,e.imgUrlList[0]){t.m_title.text=e.title;let i=e.imgUrlList[0];t.m_AdIcon.m_loaderIcon.url=i,t.m_logo.url=e.logoUrl,console.log("广告UI图片===>>>>// 3：图文混合"+e.imgUrlList[0])}else t.m_AdIcon.m_FIeld.text=e.title,t.m_logo.url=e.logoUrl,console.warn("纯文本时",!e.imgUrlList[0]);0==this.SDKdata.zs_native_click_switch?t.m_JumpBtn.m_BtnTitle.text="点击跳过":t.m_JumpBtn.m_BtnTitle.text="点击查看",0==this.SDKdata.zs_native_click_switch?(t.m_forkClickArea.width=38,t.m_forkClickArea.height=38):(t.m_forkClickArea.width=35,t.m_forkClickArea.height=35),t.m_forkClickArea.onClick(this,this.onLeftUpCloseBtn),t.m_AdIcon.onClick(this,()=>{this.onLeftUpCloseBtn(),Pi.instance.nativeAd.reportAdClick({adId:e.adId})}),t.m_JumpBtn.onClick(this,this.onJumpAdBtn)}onLeftUpCloseBtn(){try{this.TempFGUI_GameAd&&!this.TempFGUI_GameAd.isDisposed&&this.TempFGUI_GameAd.dispose(),this.CanShow=!0}catch(t){console.log("”关闭onLeftUpCloseBtn===+++++++++++++++++>>>>"+t)}}onJumpAdBtn(){if(0==this.SDKdata.zs_native_click_switch)try{this.onLeftUpCloseBtn()}catch(t){console.log("点击跳 过”===+++++++++++++++++>>>>"+t)}else try{this.onLeftUpCloseBtn(),Pi.instance.nativeAd.reportAdClick({adId:this.TempNativeAd.adId})}catch(t){console.log("查看广告按钮===+++++++++++++++>>>>"+t)}}}class Ki{constructor(){it.instance.on3D(A.OnClickBuilding,this,this.OnClickBuilding)}static get instance(){return null==this._instance&&(this._instance=new Ki),this._instance}Init(){console.log("UI中介初始化...")}get building(){return this._runtimecurrbuilding}set _currentSelecedBuilding(t){this._runtimecurrbuilding=t}get _currentSelectedBuilding(){return this._runtimecurrbuilding}OnClickBuilding(t){let e=Je.instance.GetBuildingByName(t);this._runtimecurrbuilding=e,this._currentSelecedBuilding?console.log("已经选择了建筑，避免重复显示UI"):this._currentSelecedBuilding!=e?e?e.active?(console.log("显示建筑对应的升级UI",e.buildingName),Be.instance.setUIState([{typeIndex:ee.Staff,state:!0}],!1)):Be.instance.setUIState([{typeIndex:ee.Manager,state:!0}],!1):console.error("获取建筑脚本失败",t):console.log("选择了同一个建筑，避免重复显示UI")}ResetCurrSelectedBuilding(){this._currentSelecedBuilding=null}ShowCleanRoom(){let t=Je.instance.GetBuildingListByFunctionID(qt.CleanRoom)[0];this.OnClickBuilding(t.buildingName),it.instance.eventUI(Nt.ShowCleanRoomStaff)}ShowRoom(t){let e=Je.instance.GetBuildingListByFunctionID(t)[0];this.OnClickBuilding(e.buildingName)}static PlayMoneyEffect(t){let e=Ai.instance.ui.m_text_money;Li.FlyCoinsTo(t,e)}static PlayDiamondEffect(t){let e=Ai.instance.ui.m_text_diamond;Li.FlyDiamondTo(t,e)}static ShowPanel(t){Be.instance.setUIState([{typeIndex:t,state:!0}],!1)}static ClosePanel(t){Be.instance.setUIState([{typeIndex:t,state:!1}],!1)}static ShowNativeAD(){Ji.instance.Show()}static HideNativeAD(){Ji.instance.Hide()}}var Zi,Yi,Xi,$i,ts,es,is,ss,as,ns,os,rs;!function(t){t.config=class{},t.path="res/config/GusetPrefabConfig.json"}(Zi||(Zi={}));class ls extends T{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new ls),this._instance}initData(){this.m_dataList=Zi.dataList}}class hs{static get instance(){return null==this._instance&&(this._instance=new hs),this._instance}static get prefabs(){return this.instance._prefabs}SetPrefabs(t){this._prefabs=t}}class cs extends je{CheckProgress(t){if(t.evt==se.UpdateFlow)return this.Init(),this.progress}Init(){let t=ui.instance.data;this.record=t.list.slots[0].level,this.progress=this.record/this.condition*100}Go(){let t=Fe.instance.FocusPositionByIndex(24,!1),e=new Laya.Vector3(-t.x,t.y,t.z);Ie.PlayEffect(Bt.ZS,1111,1e4,e)}}class ds extends je{CheckProgress(t){return t.evt==se.UpdateFemaleSink&&this.Init(),this.progress}Init(){let t=ri.instance.femaleSinkData.slots;this.record=0;for(let e of t)e.uid==Se.instance.data.slot_wash_basin_woman_config&&e.level>0&&this.record++;this.progress=this.record/this.condition*100}Go(){let t=Fe.instance.FocusPositionByIndex(19,!1),e=new Laya.Vector3(-t.x,t.y,t.z);Ie.PlayEffect(Bt.ZS,1111,1e4,e)}}class us extends je{CheckProgress(t){return t.evt==se.UpdateMt&&this.Init(),this.progress}Init(){let t=ci.data.list;this.record=0;for(let e of t)for(let t of e.slots)t.uid==Se.instance.data.slot_mt_config&&t.level>=3&&this.record++;this.progress=this.record/this.condition*100}Go(){let t=Fe.instance.FocusPositionByIndex(0,!1),e=new Laya.Vector3(-t.x,t.y,t.z);Ie.PlayEffect(Bt.ZS,1111,1e4,e)}}class ms extends ct{}class _s extends lt{constructor(){super(),it.instance.onUI(Nt.UpdateSlotData,this,this.UpdateSlotData)}static get instance(){return null==this._instance&&(this._instance=new _s),this._instance}get data(){return this._data}static get data(){return this.instance._data}get _saveName(){return"WaterRoomData"}getNewData(){return new ms}InitData(){this._data=this._ReadFromFile(),null==this._data.list&&(this._data.list=new ei,this._data.list.active=!0,this._data.list.functionID=qt.WaterRoom,this._data.list.index=0,this._data.list.title="水循环处理室",this._data.list.name=jt.waterRoom,this.InitSlot(this._data.list),this._SaveToDisk(this._data))}InitSlot(t){let e=0,i=ii.instance.dataList;for(let t=0;t<i.length;t++)i[t].sewage_Slot_Level>-1&&e++;if(e>0){t.slots=new Array(e);for(let s=0;s<e;s++){let e=new ti;e.level=i[s].sewage_Slot_Level,e.uid=i[s].sewage_Slot,e.name=ce.instance.dataList[e.uid].name,e.id=s,t.slots[s]=e}}else console.warn("水循环处理室没有可用的Slot")}UpdateSlotData(t){if(t.building.functionID==qt.WaterRoom){let e=this._data.list;e?(ti.UpdateSlotData(t,e.slots),this._SaveToDisk(this._data)):console.error("获取数据失败！",t)}}}class gs extends je{CheckProgress(t){return t.evt==se.UpdateSewage&&this.Init(),this.progress}Init(){let t=_s.instance.data.list.slots[0];this.record=t.level,this.progress=this.record/this.condition*100}Go(){let t=Fe.instance.FocusPositionByIndex(20,!1),e=new Laya.Vector3(-t.x,t.y,t.z);Ie.PlayEffect(Bt.ZS,1111,1e4,e)}}class ps extends je{CheckProgress(t){return t.evt==se.UpdateMaleSink&&this.Init(),this.progress}Init(){let t=ri.instance.maleSinkData.slots;this.record=0;for(let e of t)e.uid==Se.instance.data.slot_wash_basin_man_config&&e.level>0&&this.record++;this.progress=this.record/this.condition*100}Go(){let t=Fe.instance.FocusPositionByIndex(18,!1),e=new Laya.Vector3(-t.x,t.y,t.z);Ie.PlayEffect(Bt.ZS,1111,1e4,e)}}class fs extends je{CheckProgress(t){return t.evt==se.BuildMaleToilet&&this.Init(),this.progress}Init(){let t=Qe.instance.GetBuildDataByName(jt.maleToilet);this.record=t.count,this.progress=this.record/this.condition*100}Go(){let t=Fe.instance.FocusPositionByIndex(28,!1),e=new Laya.Vector3(-t.x,t.y,t.z);Ie.PlayEffect(Bt.ZS,1111,1e4,e)}}class ys extends ct{}class Ss extends lt{constructor(){super(),it.instance.onUI(Nt.UpdateSlotData,this,this.UpdateSlotData)}static get instance(){return null==this._instance&&(this._instance=new Ss),this._instance}get data(){return this._data}InitData(){this._data=this._ReadFromFile(),null==this._data.list&&(this._data.list=new ei,this._data.list.active=!0,this._data.list.functionID=qt.MalePee,this._data.list.index=0,this._data.list.title="小便区（男）",this._data.list.name=jt.PeeArea,this.InitSlots(this._data.list),this._SaveToDisk(this._data))}get _saveName(){return"PeeAreaData"}getNewData(){return new ys}InitSlots(t){let e=ii.instance.dataList,i=0;for(let t=0;t<e.length;t++)e[t].pee_slot>-1&&i++;if(i>0){t.slots=new Array(i);for(let s=0;s<i;s++){let i=new ti,a=e[s];i.id=s,i.uid=a.pee_slot,i.name=ce.instance.dataList[i.uid].name,i.level=a.pee_Slot_Level,i.usable=!0,t.slots[s]=i}}else console.warn("没有可用的SLot")}UpdateSlotData(t){if(t.building.functionID==qt.MalePee){let e=this.data.list;e?(ti.UpdateSlotData(t,e.slots),this._SaveToDisk(this._data)):console.error("获取数据失败！",t)}}}class Is extends je{CheckProgress(t){return t.evt==se.UpdateUrinal&&this.Init(),this.progress}Init(){let t=Ss.instance.data.list.slots;this.record=0;for(let e of t)e.uid==Se.instance.data.slot_urinal_config&&e.level>0&&this.record++;this.progress=this.record/this.condition*100}Go(){let t=Fe.instance.FocusPositionByIndex(38,!1),e=new Laya.Vector3(-t.x,t.y,t.z);Ie.PlayEffect(Bt.ZS,1111,1e4,e)}}class ws extends je{CheckProgress(t){return t.evt==se.BuildFemaleToilet&&this.Init(),this.progress}Init(){let t=Qe.instance.GetBuildDataByName(jt.femaleToilet);this.record=2*t.count,this.progress=this.record/this.condition*100}Go(){let t=Fe.instance.FocusPositionByIndex(34,!1),e=new Laya.Vector3(-t.x,t.y,t.z);Ie.PlayEffect(Bt.ZS,1111,1e4,e)}}class Cs extends je{CheckProgress(t){return t.evt==se.UpdatePaper&&this.Init(),this.progress}Init(){let t=ci.data.list;this.record=0;for(let e of t)for(let t of e.slots)t.uid==Se.instance.data.slot_paper_config&&t.level>=3&&this.record++;this.progress=this.record/this.condition*100}Go(){let t=Fe.instance.FocusPositionByIndex(0,!1),e=new Laya.Vector3(-t.x,t.y,t.z);Ie.PlayEffect(Bt.ZS,1111,1e4,e)}}class bs extends je{CheckProgress(t){return t.evt==se.UpdateTrash&&this.Init(),this.progress}Init(){let t=ci.data.list;this.record++;for(let e of t)for(let t of e.slots)t.uid==Se.instance.data.slot_mt_config&&t.level>=4&&this.record++;this.progress=this.record/this.condition*100}Go(){let t=Fe.instance.FocusPositionByIndex(0,!1),e=new Laya.Vector3(-t.x,t.y,t.z);Ie.PlayEffect(Bt.ZS,1111,1e4,e)}}class Ls extends je{CheckProgress(t){return t.evt==se.Guest&&(this.record++,this.progress=this.record/this.condition*100),this.progress}Go(){let t=Fe.instance.FocusPositionByIndex(24,!1),e=new Laya.Vector3(-t.x,t.y,t.z);Ie.PlayEffect(Bt.ZS,1111,1e4,e)}}class vs extends je{CheckProgress(t){return t.evt==se.UpdateSewage&&this.Init(),this.progress}Init(){let t=_s.instance.data.list.slots[0];this.record=t.level,this.progress=this.record/this.condition*100}Go(){let t=Fe.instance.FocusPositionByIndex(20,!1),e=new Laya.Vector3(-t.x,t.y,t.z);Ie.PlayEffect(Bt.ZS,1111,1e4,e)}}class As extends je{CheckProgress(t){return t.evt==se.Money&&(this.record+=t.data,this.progress=this.record/this.condition*100),this.progress}Go(){let t=Fe.instance.FocusPositionByIndex(24,!1),e=new Laya.Vector3(-t.x,t.y,t.z);Ie.PlayEffect(Bt.ZS,1111,1e4,e)}}class xs extends je{CheckProgress(t){return t.evt==se.Money&&(this.record+=t.data,this.progress=this.record/this.condition*100),this.progress}Go(){let t=Fe.instance.FocusPositionByIndex(24,!1),e=new Laya.Vector3(-t.x,t.y,t.z);Ie.PlayEffect(Bt.ZS,1111,1e4,e)}}class ks{constructor(){it.instance.on(Nt.TaskEvent,this,this.Check)}get hasTask(){return null!=this.currentTask}static get instance(){return null==ks._instance&&(ks._instance=new ks),ks._instance}InitTask(){let t=$e.instance.Data.task;if(null==t){if($e.data.allTaskComplete)return this.currentTask=null,void console.log("当前没有任务！");(t=$e.data.task=this.GetNewTask(0)).Init()}let e=this.GetNewTask(t.index);e&&(this.currentTask=e,e.condition=t.condition,isNaN(t.progress)&&(t.progress=0),null==t.progress&&(t.progress=0),e.progress=t.progress,isNaN(t.record)&&(t.record=0),null==t.record&&(t.record=0),e.record=t.record,$e.instance.Data.task=e,it.instance.eventUI(Nt.UpdateTaskProgress))}Check(t){null!=this.currentTask&&(this.currentTask.CheckProgress(t),it.instance.eventUI(Nt.UpdateTaskProgress))}DoNext(){Oe.trackEvent($t.Task,{Index:this.currentTask.index.toString()}),this.currentTask=this.GetNewTask(this.currentTask.NextTask),$e.instance.Data.task=this.currentTask,this.currentTask&&this.currentTask.Init(),null==this.currentTask&&($e.data.allTaskComplete=!0),it.instance.eventUI(Nt.UpdateTaskProgress)}GetNewTask(t){switch(t){case 0:return new cs(0);case 1:return new ds(1);case 2:return new us(2);case 3:return new gs(3);case 4:return new ps(4);case 5:return new fs(5);case 6:return new Is(6);case 7:return new ws(7);case 8:return new Cs(8);case 9:return new bs(9);case 10:return new Ls(10);case 11:return new vs(11);case 12:return new As(12);case 13:return new xs(13)}}}class Ps extends fe{constructor(){super(...arguments),this.moveSpeed=4,this._wpIndex=0,this._currFuncIndex=0,this.isIntoToilet=!1,this._toTarget=new Ct,this._step=new Ct,this._t=0,this._walkTime=0,this._origin=new Laya.Vector3,this._runtimeNextPos=new Laya.Vector3,this.isInqueue=!1}get isMale(){return 1==this.gender}get _currFun(){if(this._currFuncIndex>=this._data.Functions.length)throw console.error("功能模块索引越界,旅客退出场景",this._currFuncIndex,this._data.Functions.length),"功能模块索引越界";return this._data.Functions[this._currFuncIndex]}get _agent(){return oe.NetMap.instance}get animator(){return null==this._runtimeAnimator&&(this._runtimeAnimator=this.sprite3D.getComponent(Laya.Animator)),this._runtimeAnimator}OnComplete(t,e){this._transitionFunc=t,this._transition=e}ReInit(t,e){Laya.timer.clearAll(this),this.sprite3D.active=!0,this.animator.enabled=!0,this._wpIndex=0,this._data=t,this.gender=t.Gender[0],this.moveSpeed=_e.Range(1.68,4),this._currFuncIndex=0,this._runtimeAttachment=e||null,Laya.timer.once(1e3,this,()=>{this.GetEndPoint()})}onStart(){it.instance.on3D(A.DoNext,this,this.OnDoHandleFuncComplete)}PlayMoveAnimation(){this.PlayAnimationByState(Yi.Walk)}PlayAnimationByState(t){if(t){if(t!=this._currAniState){let e=t;switch(t){case Yi.Idle:e="daiji";break;case Yi.Walk:e="zou";break;case Yi.WashHand:break;default:return void(e="daiji")}this.animator.play(e),this._currAniState=t}}else console.error("参数为空，动画转换失败")}StepMove(){Laya.Vector3.subtract(this._target,this.transform.position,this._toTarget),this._toTarget.SqrMagnitude<.01?(this._wpIndex++,this._wpIndex>=this._wayPoints.length?this.OnCompleteWPMove():(this._target=this._wayPoints[this._wpIndex].position,this._target.y=.1)):(Laya.Vector3.normalize(this._toTarget,this._step),Laya.Vector3.scale(this._step,this.moveSpeed*It.deltaTime,this._step),Laya.Vector3.add(this.transform.position,this._step,this.transform.position),this.transform.position=this.transform.position,this.transform.localRotationEulerY=gi.updateRotation(this._step))}LerpMove(){if(this._t>this._walkTime)this._wpIndex++,this._wpIndex>=this._wayPoints.length?this.OnCompleteWPMove():(this._target=this._wayPoints[this._wpIndex].position,this._target.y=.1,this.UpdateRotation());else{this._t+=It.deltaTime;let t=this._t/this._walkTime;Laya.Vector3.lerp(this._origin,this._target,t,this.transform.position),this.transform.position=this.transform.position}}UpdateRotation(){Laya.Vector3.subtract(this._target,this.transform.position,this._toTarget);let t=Laya.Vector3.scalarLength(this._toTarget);this._walkTime=t/this.moveSpeed,this._t=0,this._origin=this.transform.position.clone(),t>.5&&(this.transform.localRotationEulerY=gi.updateRotation(this._toTarget))}OnCompleteWPMove(){this._target=null,this._transitionFunc?(this.OnReach=this._transitionFunc,this.OnReach(),this.OnReach==this._transitionFunc&&(this._transition=null)):console.error("抵达没有回调,或者切换方法为空:",this._transition)}onUpdate(){this._target&&this.LerpMove()}onLateUpdate(){this.DispatchEvent()}DispatchEvent(t){this.isIntoToilet&&(t=null==t?this._runtimeFuncPosInfo.fac.belonger.duration*$e.toiletSpeed:t,t*=.7,Ne.instance.EventDistribute(this.transform.position,this.sprite3D.id,this.eventID,t))}SetWayPoints(t){return t&&t.length>0?(this._wayPoints=t,this._target=this._wayPoints[0].position,this._wpIndex=0,this.UpdateRotation(),this.PlayMoveAnimation()):console.error("路径点数量为0"),this}GetEndPoint(){let t=this._currFun,e=Je.instance.GetEndPoint(t.FunctionId);if(e){let t=this._agent.TrySearchByNearestPos(this.transform.position,e.transform.position);this.SetWayPoints(t).OnComplete(this.TrtEnqueue,"尝试入队")}else this.ExitScene()}TrtEnqueue(){this._runtimeNextPos.toDefault();let t=Je.instance.TrtEnqueue(this._currFun.FunctionId,this,this._runtimeNextPos),e=this._agent.TrySearchByNearestPos(this.transform.position,this._runtimeNextPos);t?(this.isInqueue=!0,this.SetWayPoints(e).OnComplete(this.MoveInQueue,"进入队伍")):(this.PlayAnimationByState(Yi.Idle),this.PlayAngryEmoji(),Laya.timer.once(1e3,this,()=>{this.SetWayPoints(e).OnComplete(this.ExitScene,"ExitScene")}))}MoveInQueue(){if(!this.isInqueue)return;let t=Je.instance.GetNextPointInQueue(this._currFun.FunctionId,this);if(t)this.SetWayPoints([{position:t}]).OnComplete(this.MoveInQueue,"前进一格");else{Je.instance.ExistInQueue(this._currFun.FunctionId,this)?(this.PlayAnimationByState(Yi.Idle),this.PlayWaitEmoji(),Laya.timer.once(1e3,this,this.MoveInQueue)):(this.PlayAnimationByState(Yi.Idle),this.PlayAngryEmoji(),Laya.timer.once(1e3,this,this.ExitScene))}}MoveToEntrancePos(t){Laya.timer.clearAll(this),this.isInqueue=!1,this._runtimeFuncPosInfo=t;let e=this._agent.TrySearchByNearestPos(this.transform.position,t.entrance);this.SetWayPoints(e).OnComplete(this.KnockTheDoor,"敲门")}KnockTheDoor(){switch(this._runtimeFuncPosInfo.fac.belonger.functionID){case qt.MalePee:case qt.FemaleSink:case qt.MaleSink:case qt.Canteen:this.MoveToFuncPos();break;default:Je.instance.RequestOpenTheDoor(this)?this.WaitOpenDoor(!0,600):this.WaitOpenDoor(!1)}}WaitOpenDoor(t,e=1e3){t?(this.PlayAnimationByState(Yi.Idle),Laya.timer.once(e,this,this.MoveToFuncPos)):this.MoveToFuncPos()}MoveToFuncPos(){let t=this._agent.TrySearchByNearestPos(this.transform.position,this._runtimeFuncPosInfo.funcPos);t.push({position:this._runtimeFuncPosInfo.funcPos}),this.SetWayPoints(t).OnComplete(this.HandleFunction,"执行功能")}HandleFunction(){this.PlayAnimationByState(Yi.Idle),this.isIntoToilet=!0;let t=this._currFun.FunctionId,e=this._runtimeFuncPosInfo.slot;switch(this.transform.rotation=this._runtimeFuncPosInfo.fac.sprite.transform.rotation,this.transform.position=this._runtimeFuncPosInfo.fac.sprite.transform.position,t){case qt.MaleToilet:case qt.FemaleToilte:if(this.eventID=Xt.Toilet,e.level<=5)this.PlayAnimationByState(Yi.Verb);else{this.PlayAnimationByState(Yi.Sit);let t=new Laya.Vector3;this._runtimeFuncPosInfo.fac.sprite.transform.getForward(t),Laya.Vector3.scale(t,.35,t),t.y=-.3,Laya.Vector3.subtract(this.transform.position,t,this.transform.position),this.transform.position=this.transform.position}break;case qt.MalePee:let i=Ie.PlayEffect(Bt.Pee,this.sprite3D.id);this.owner.addChild(i),i.transform.rotationEuler=this.transform.rotationEuler,i.transform.localPosition=new Laya.Vector3(0,-.5,0),this.eventID=Xt.Normal,this.PlayAnimationByState(Yi.Pee);break;case qt.MaleSink:case qt.FemaleSink:this.eventID=Xt.Normal,this.PlayAnimationByState(Yi.WashHand);break;case qt.Canteen:case qt.Library:this.eventID=Xt.Normal,this.PlayAnimationByState(Yi.Idle);break;default:this.eventID=Xt.Normal,console.error("此功能还没有匹配动作",t)}}OnDoHandleFuncComplete(t,e=!1){if(this.sprite3D.id==t){e&&Ge.instance.ShowTalkPanel(this.isMale?1:0),Ie.ClearAll(this.sprite3D.id),this._runtimeFuncPosInfo.fac.belonger.CreateIncome(this._runtimeFuncPosInfo.slot);let t=Ie.PlayEffect(Bt.Money,this.id,3e3);this._runtimeFuncPosInfo.fac.sprite.addChild(t),t.transform.localPosition=Ct.zero,t.transform.rotationEuler=this._runtimeFuncPosInfo.fac.sprite.transform.rotationEuler,Laya.timer.once(1500,this,this.PlayHappyEmoji),this.isIntoToilet=!1,this.ExitBuilding(),this.DispatchTaskEvent()}}ExitBuilding(){switch(this._runtimeFuncPosInfo.fac.belonger.functionID){case qt.MalePee:case qt.FemaleSink:case qt.MaleSink:case qt.Canteen:this.OnExitBuilding();break;default:this.OnExitBuildingAfterOpenDoor()}}OnExitBuildingAfterOpenDoor(){Je.instance.ResetFac(this);let t=this._agent.TrySearchByNearestPos(this.transform.position,this._runtimeFuncPosInfo.exit);this.SetWayPoints(t).OnComplete(()=>{Je.instance.RequestOpenTheDoor(this)?(this.PlayAnimationByState(Yi.Idle),Laya.timer.once(600,this,this.DoNext)):this.DoNext()},"开启下一轮")}OnExitBuilding(){Je.instance.ResetFac(this);let t=this._agent.TrySearchByNearestPos(this.transform.position,this._runtimeFuncPosInfo.exit);this.SetWayPoints(t).OnComplete(this.DoNext,"开启下一轮")}DoNext(){this._runtimeFuncPosInfo=null,this._currFuncIndex++,this._currFuncIndex<this._data.Functions.length?this.GetEndPoint():this.ExitScene()}ExitScene(){let t=hs.prefabs[Et.prefab5.Exit],e=t[_e.RangeInt(0,t.length)].transform.position,i=this._agent.TrySearchByNearestPos(this.transform.position,e);i&&i.length>0?this.SetWayPoints(i).OnComplete(this.SetActiveFalse,"退出场景"):console.error("退出场景失败！")}SetActiveFalse(){this.sprite3D.active=!1,this.animator.enabled=!1,this._currAniState=null}PlayWaitEmoji(){if(_e.random>.1)return;let t=null,e=_e.random;t=e<.25?Ie.PlayEffect(Bt.Emoji_sick,this.id,3e3,this.sprite3D.transform.position):e<.5?Ie.PlayEffect(Bt.Emoji_poop,this.id,3e3,this.sprite3D.transform.position):e<.75?Ie.PlayEffect(Bt.Emoji_dead,this.id,3e3,this.sprite3D.transform.position):Ie.PlayEffect(Bt.Emoji_cry,this.id,3e3,this.sprite3D.transform.position),this.sprite3D.addChild(t),t.transform.localPosition=new Laya.Vector3(0,2,0)}PlayHappyEmoji(){if(_e.random>.1)return;let t=null;t=_e.random>.5?Ie.PlayEffect(Bt.Emoji_happy,this.id,1e3,this.sprite3D.transform.position):Ie.PlayEffect(Bt.Emoji_cute,this.id,1e3,this.sprite3D.transform.position),this.sprite3D.addChild(t),t.transform.localPosition=new Laya.Vector3(0,2,0)}PlayAngryEmoji(){if(_e.random>.1)return;Ie.ClearAll(this.id);let t=Ie.PlayEffect(Bt.Emoji_angry,this.id,1e3,this.sprite3D.transform.position);this.sprite3D.addChild(t),t.transform.localPosition=new Laya.Vector3(0,2,0)}DispatchTaskEvent(){if(ks.instance.hasTask){let t=new qe;t.evt=se.Guest,it.instance.eventUI(Nt.TaskEvent,t)}}}!function(t){t.Idle="Idle",t.Clean="Clean",t.Sweep="Sweep",t.Running="Running",t.Walk="Walk",t.Verb="Verb",t.Sit="Sit",t.WashHand="xishou",t.Pee="Pee"}(Yi||(Yi={}));class Ds extends Ps{constructor(){super(...arguments),this._inGuide=!1,this._hasCompleteToilet=!1}static get instance(){return this._instance}onAwake(){Ds._instance=this,super.onAwake()}onUpdate(){super.onUpdate(),this._inGuide&&Fe.instance.LookAt(this.transform.position)}onLateUpdate(){super.onLateUpdate()}DispatchEvent(t){super.DispatchEvent(6)}PlayMoveAnimation(){super.PlayMoveAnimation(),this.moveSpeed=3.5}ReInit(t,e){Laya.timer.clearAll(this),this.sprite3D.active=!0,this.animator.enabled=!0,this._wpIndex=0,this._data=t,this.gender=t.Gender[0],this.moveSpeed=t.MoveSpeed,this._currFuncIndex=0,Laya.timer.once(1e3,this,()=>{this.GetEndPoint()})}HandleFunction(){super.HandleFunction(),this._runtimeFuncPosInfo.fac.belonger.functionID==qt.MaleSink&&(this._inGuide=!1,it.instance.eventUI(Nt.GuideToNext))}ExitBuilding(){if(this._runtimeFuncPosInfo.fac.belonger.functionID==qt.MaleToilet)return this.SetWayPoints([{position:this._runtimeFuncPosInfo.fac.belonger.exit.transform.position}]).OnComplete(()=>{super.PlayAnimationByState(Yi.Idle)},"等待"),Je.instance.ResetFac(this),Je.instance.TryOpenDoor(this.transform.position,!1),this._hasCompleteToilet=!0,void(this._inGuide&&it.instance.eventUI(Nt.GuideToNext,5));super.ExitBuilding(),this._inGuide=!1}Start(){this._inGuide=!0,this._hasCompleteToilet&&it.instance.eventUI(Nt.GuideToNext,5)}Continue(){this.SetWayPoints([{position:this._runtimeFuncPosInfo.fac.belonger.entrance.transform.position}]).OnComplete(()=>{super.DoNext()},"执行下一步"),Laya.timer.once(600,this,()=>Je.instance.TryCloseDoor(this.transform.position))}}class Us extends Ps{constructor(){super(...arguments),this._endPoint=new Laya.Vector3(-6,0,11),this._isWait=!1}SetActive(t){this.sprite3D.active=t,this.GoWc()}onAwake(){it.instance.on3D(A.NetRedLeaveWC,this,this.LeaveWC)}GoWc(){let t=this._agent.TrySearchByNearestPos(this.transform.position,this._endPoint);this.SetWayPoints(t).OnComplete(this.OnReachWC),this.moveSpeed=3}OnReachWC(){it.instance.eventUI(Nt.AddAdUtilityNetRed),this.PlayAnimationByState(Yi.Idle),this.transform.localRotationEulerY=gi.updateRotation(new Laya.Vector3(-1,0,1));let t=Ie.PlayEffect(Bt.Hushen,this.id);this.sprite3D.addChild(t),t.transform.localPosition=Ct.zero,t.transform.localScale=new Laya.Vector3(.2,.2,.2),t.transform.rotationEuler=Ct.zero,this._isWait=!0}LeaveWC(){this._isWait=!1,Ie.ClearAll(this.id),super.ExitScene()}onMouseClick(){Re.IsCompleteAllGuide&&this._isWait&&Ki.ShowPanel(ee.UIMediatorInfluencer)}}class Ts extends fe{constructor(){super(...arguments),this._totalWeight=0,this._pool=[],this._attachmentPool=[],this._malePrefabs=[],this._femalePrefabs=[],this._attachmentPrefabs=[],this._interval=5,this._timer=0,this._popToggle=!1,this._flow=80}static get instance(){return this._instance}get flow(){return this._flow}get count(){let t=0;for(let e of this._pool)e.sprite3D.active&&t++;return t}onAwake(){Ts._instance=this}onLateUpdate(){this._popToggle&&(this._timer+=It.deltaTime,this._timer>this._interval&&(this._timer=0,this.count<this._flow&&this.Pop()))}SetToggle(t){this._popToggle=t}InitPool(t,e){if(it.instance.on3D(A.UpdateMaxFlow,this,this.SetInterval),this._entrances=t,this._exits=e,console.log("旅客对象池初始化..."),this._data=he.instance.m_data,null==this._data||this._data.length<=0)console.warn("对象池初始化失败，Json文件为空");else{for(const t of this._data)this._totalWeight+=t.Weight,t.point=this._totalWeight;this.LoadPrefabs(),this.InitNetRed(),this.InitRandomNumPeople()}}SetParentNode(t){this._parentNode=t}LoadPrefabs(){let t=ls.instance.dataList;if(null==t||t.length<=0)console.warn("加载指定旅客预制体失败，旅客预制体配置表为空");else for(const e of t){let t=S.prefab_url(e.name);if(t&&t.length>0){let i=a.Get(t);i?e.isAttachment?this._attachmentPrefabs.push(i):e.isMale?this._malePrefabs.push(i):this._femalePrefabs.push(i):console.warn("获取预制体失败:",e.name,t)}else console.warn("获取url失败:",e.name,t)}}RandomInstantiate(t){let e,i;if(t?(i=_e.RangeInt(0,this._malePrefabs.length),e=this._malePrefabs[i]):(i=_e.RangeInt(0,this._femalePrefabs.length),e=this._femalePrefabs[i]),e){let t=this.Instantiate(e,this._parentNode).addComponent(Ps);return this._pool.push(t),t}return console.warn("随机获取旅客预制体失败，导致实例化失败:",i,"isMale,",t,"预制体数组",t?this._malePrefabs:this._femalePrefabs),null}RandomGuestData(){let t=_e.Range(0,this._totalWeight);for(const e of this._data)if(t<e.point)return e;return null}SearchPool(t){let e=null;for(let i=0;i<this._pool.length;i++){let s=this._pool[i];if(!s.sprite3D.active&&s.isMale==t){e=s;break}}return null==e&&(e=this.RandomInstantiate(t)),e}InstantiateAttachment(t){let e=null;for(const i of this._attachmentPrefabs)if(i.name==t){e=i;break}return e?this.Instantiate(e,this._parentNode):(console.warn("获取附件的预制体失败,实例化失败:",t),null)}SearchAttachment(t){let e=null;if(this._attachmentPool&&this._attachmentPool.length>0)for(let i=0;i<this._attachmentPool.length;i++)if(this._attachmentPool[i].name==t){e=this._attachmentPool[i];break}return null==e&&(e=this.InstantiateAttachment(t)),e}SpawnAttachment(t){return this.SearchAttachment(t)}SpawnGuest(){let t=this.RandomGuestData(),e=null;if(0==t.Gender[0]?e=this.SearchPool(!1):1==t.Gender[0]?e=this.SearchPool(!0):console.warn("目标是个人吗？",t),e){let i=null;if(t.RandomAttachments&&t.RandomAttachments.length>0){let e=t.RandomAttachments.length,s=_e.RangeInt(0,e),a=t.RandomAttachments[s].toString();i=this.SpawnAttachment(a)}e.ReInit(t,i)}else console.error("对象池生成旅客失败，跳过本次");return e}Pop(){let t=this.SpawnGuest();if(t){let e=_e.random>.5?0:1,i=this.GetEntranceByName("Entrance_"+e);t.transform.position=i.transform.position.clone()}return t}GetEntranceByName(t){for(let e of this._entrances)if(e.name==t)return e}RecycleAttachment(t){if(null==t)throw new ye("被回收的附件为空.");t.active=!1,this._parentNode.addChild(t),this._attachmentPool.indexOf(t)<0?this._attachmentPool.push(t):console.warn("人物附件回收失败",t)}SetInterval(t){this._interval=60/t,console.warn("当前生成频率",t,"/min")}AddPeopleOnWatchAD(t){let e=this.GetEntranceByName("Entrance_2");for(let i=0;i<t;i++)Laya.timer.once(600*i,this,()=>{this.Pop().transform.position=e.transform.position})}InitRandomNumPeople(){if(this._popToggle){let t=_e.RangeInt(10,20);for(let e=0;e<t;e++){let t=_e.Range(-3,3),e=_e.Range(-3,3),i=new Laya.Vector3(-12+t,0,12+e);this.Pop().transform.position=i}}}StartPop(){this.SetToggle(!0),this._pool.length<20&&this.InitRandomNumPeople()}InitNetRed(){let t=S.prefab_url("woman_wh");this._netRedSprite=a.Get(t),this._netRed=this._netRedSprite.addComponent(Us),this._parentNode.addChild(this._netRedSprite),this._netRedSprite.active=!1}PopNetRed(){if(!this._netRed.sprite3D.active){let t=_e.random>.5?0:1,e=this.GetEntranceByName("Entrance_"+t);this._netRed.transform.position=e.transform.position.clone(),this._netRed.SetActive(!0)}}PopGuideUncle(){let t=_e.RangeInt(0,this._malePrefabs.length),e=this._malePrefabs[t],i=this.Instantiate(e,this._parentNode).addComponent(Ds),s=this._data[this._data.length-1];i.ReInit(s,null),i.transform.position=new Laya.Vector3(3.6,0,24.9)}}class Rs extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","PGameMainRecordShare")}onConstruct(){this.m_state=this.getControllerAt(0),this.m_bg=this.getChildAt(1),this.m_text_money=this.getChildAt(6),this.m_btn_record=this.getChildAt(7)}}Rs.URL="ui://8nmf3q47nt6l1ct",function(t){t.None="EPlatformType_None",t.Web="EPlatformType_Web",t.WX="EPlatformType_WX",t.TT="EPlatformType_TT",t.QQ="EPlatformType_QQ",t.VIVO="EPlatformType_VIVO",t.OPPO="EPlatformType_OPPO",t.BD="EPlatformType_BD",t.KG="EPlatformType_KG",t.Alipay="EPlatformType_Alipay",t.HW="EPlatformType_HW",t.QTT="EPlatformType_QTT"}(Xi||(Xi={}));class Os extends l{static get instance(){return null==this._instance&&(this._instance=new Os),this._instance}get PlatformInstance(){return this.m_platformInstance||console.log(...s.packError("还没有设置过平台实例代理！")),this.m_platformInstance}set PlatformInstance(t){this.m_platformInstance=t}static get platformStr(){return Os.GetPlatformStr(this._instance.m_platformInstance.platform)}static GetPlatformStr(t){switch(t){case Xi.None:return"未识别";case Xi.Web:return"网页";case Xi.BD:return"百度";case Xi.OPPO:return"Oppo";case Xi.QQ:return"QQ";case Xi.TT:return"头条";case Xi.VIVO:return"Vivo";case Xi.WX:return"微信";case Xi.QTT:return"趣头条";default:return"未定义"+t}}}class Ms{static get instance(){return this._instance||(this._instance=new Ms),this._instance}get m_bannerAd(){return this.bannerAd}showBannerFun(t){var e,i,s,a;if(console.log("显示Banner广告"),Re.IsCompleteAllGuide)try{let n=null===(e=window.qg)||void 0===e?void 0:e.createBannerAd({adUnitId:t.bannerId});this.bannerAd=n,null===(i=this.bannerAd)||void 0===i||i.show();let o=()=>{var t,e;console.log("视频播放成功"),null===(t=this.bannerAd)||void 0===t||t.offLoad(o),null===(e=this.bannerAd)||void 0===e||e.offError(r)},r=()=>{var t,e;console.log("视频播放失败"),null===(t=this.bannerAd)||void 0===t||t.offLoad(o),null===(e=this.bannerAd)||void 0===e||e.offError(r)};null===(s=this.bannerAd)||void 0===s||s.onLoad(o),null===(a=this.bannerAd)||void 0===a||a.onError(r)}catch(t){console.error(t)}}DestroyAd(){if(Re.IsCompleteAllGuide)try{this.bannerAd&&this.bannerAd.destroy()}catch(t){console.error(t)}}}class Es extends xe{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new Es,this.m_instance._classDefine=Rs),this.m_instance}_OnShow(){super._OnShow(),this.ui.m_bg.m_btn_close.onClick(this,()=>{Ki.ClosePanel(ee.RecordVideo)});let t=new ki;Ms.instance.showBannerFun(t)}ShowPanel(){Ki.ShowPanel(ee.RecordVideo)}Close(){Ki.ClosePanel(ee.RecordVideo),Ms.instance.DestroyAd()}ShowRecord(){this.ShowPanel(),this.ui.m_state.selectedIndex=0,this.ui.m_btn_record.onClick(this,this.StartRecord)}ShowShare(){this.ShowPanel(),this.ui.m_state.selectedIndex=1,this.ui.m_btn_record.onClick(this,this.ShareVideo)}StartRecord(){console.log("StartRecord"),it.instance.eventUI(Nt.OnStartRecord),this.Close(),Os.instance.PlatformInstance.recordManager.StartRecord(Laya.Handler.create(this,()=>{Os.instance.PlatformInstance.ShowToast("录制开始")}),Laya.Handler.create(this,()=>{Os.instance.PlatformInstance.ShowToast("录制结束"),it.instance.eventUI(Nt.OnStopRecord),this.ShowShare()}))}ShareVideo(){console.log("ShareVideo"),Os.instance.PlatformInstance.recordManager.ShareVideo(Laya.Handler.create(this,()=>{$e.Diamond+=300,Ki.PlayDiamondEffect(this.ui.m_btn_record),Ki.ClosePanel(ee.RecordVideo)}),Laya.Handler.create(this,()=>{Os.instance.PlatformInstance.ShowToast("分享取消")}),Laya.Handler.create(this,()=>{Os.instance.PlatformInstance.ShowToast("分享失败")}))}}class Bs extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","Manager")}onConstruct(){this.m_c1=this.getControllerAt(0),this.m_bg=this.getChildAt(0),this.m_manager_Title=this.getChildAt(1),this.m_Buildings=this.getChildAt(4),this.m_Statistics=this.getChildAt(5),this.m_btn_close=this.getChildAt(6)}}Bs.URL="ui://8nmf3q47coka0";class Gs extends ct{}class Ns extends lt{constructor(){super(),it.instance.on3D(A.UpdateBuildingData,this,this.UpdateBuildData),it.instance.onUI(Nt.UpdateSlotData,this,this.UpdateSlotData)}static get instance(){return null==this._instance&&(this._instance=new Ns),this._instance}get data(){return this._data}get _saveName(){return"CanteenData"}getNewData(){return new Gs}InitData(){this._data=this._ReadFromFile(),null==this._data.list&&(this._data.list=new ei,this._data.list.active=!1,this._data.list.functionID=qt.Canteen,this._data.list.name=jt.canteen,this._data.list.index=0,this._data.list.title="便利店",this.InitSlot(this._data.list),this._SaveToDisk(this._data))}InitSlot(t){let e=0,i=ii.instance.dataList;for(let t=0;t<i.length;t++)i[t].canteen_slot>-1&&e++;if(e>0){t.slots=new Array(e);for(let s=0;s<e;s++){let e=new ti;e.level=i[s].canteen_slot_level,e.uid=i[s].canteen_slot,e.name=ce.instance.dataList[e.uid].name,e.id=s,e.usable=Se.Data.slot_cashier_config!=e.uid&&Se.Data.slot_onewindow_config!=e.uid&&Se.Data.slot_shelf_config!=e.uid,t.slots[s]=e}}else console.warn("便利店没有可用的Slot")}UpdateBuildData(t){if(t.Name==jt.canteen){console.log("便利店建造完成开放"),this._data.list.active=!0;let e={buildingName:t.Name,buildingData:this._data.list};it.instance.event3D(A.UpdateBuildingOutlookEvent,e),this._SaveToDisk(this._data),Be.instance.setUIState([{typeIndex:ee.CountDownTime,state:!1}],!1)}}UpdateSlotData(t){if(t.building.functionID==qt.Canteen){let e=this.data.list;e?(ti.UpdateSlotData(t,e.slots),this._SaveToDisk(this._data)):console.error("获取数据失败！",t)}}}class Fs extends xe{constructor(){super(),this._StatisticsArray=[],this._flowArray=new Array(7)}static get instance(){return this.m_instance||(this.m_instance=new Fs,this.m_instance._classDefine=Bs),this.m_instance}get data(){return Qe.instance.data.list}get dict(){return Qe.instance.dict}get config(){return be.instance.dataList}GetStatisticsInfo(){let t=Je.instance.buildingMap;return this._StatisticsArray=[],t.forEach(t=>{if(t.active){let e=t;if(e.income>0){let t={functionID:e.functionID,title:e.title,buildingName:e.buildingName,income:e.income,progress:e.developProgress};this._StatisticsArray.push(t)}}}),this._StatisticsArray}GetUrl(t){switch(t){case qt.MaleToilet:return this.config[0].url;case qt.FemaleToilte:return this.config[1].url;case qt.FemaleSink:return this.config[3].url;case qt.MaleSink:return this.config[4].url;case qt.MalePee:return this.config[2].url;case qt.Library:return this.config[5].url;case qt.Canteen:return this.config[6].url;default:console.error("尚未为此功能建筑配置图标url",t)}}GetGuestVolume(){this._flowArray[0]=Je.instance.flow,this._flowArray[1]=Je.instance.femaleQueueCount,this._flowArray[2]=Je.instance.peeQueueCount,this._flowArray[3]=Je.instance.maleQueueCount,this._flowArray[4]=Je.instance.MaxSizeFemale,this._flowArray[5]=Je.instance.MaxSizePee,this._flowArray[6]=Je.instance.MaxSizeMale}_OnShow(){this.RenderBuildingList(),this.ui.m_btn_close.onClick(this,this.Close),it.instance.onUI(Nt.BuildComplete,this,this.OnBuildComplete),this.RenderStatisticsItem(),this.RenderTopInfo(),Laya.timer.loop(1e3,this,this.RenderTopInfo),this.TotalIncome(),Re.IsCompleteAllGuide?this.isGuide=!1:this.isGuide=!0}Close(){this.ClosePanel(),Ji.instance.ShowNativeAd()}ClosePanel(){Ki.instance.ResetCurrSelectedBuilding(),Laya.timer.clearAll(this),Be.instance.setUIState([{typeIndex:ee.Manager,state:!1}],!1)}RenderBuildingList(){this._buildItemList=new Map,this.ui.m_Buildings.m_list.itemRenderer=Laya.Handler.create(this,(t,e)=>{if(null==this.data[t])return;t>=6&&!Ns.instance.data.list.active&&(t+=1);let i=this.data[t].UID;e.m_txt_title.text=this.config[i].title,e.m_txt_infomation.text=this.config[i].describe,e.m_picture.url=this.config[i].url;let s=this.data[t];this.UpdateBuildItem(s,e),this._buildItemList.set(s.name,e)},null,!1),this.ui.m_Buildings.m_list.numItems=Ns.instance.data.list.active?this.data.length:this.data.length-1}UpdateBuildItem(t,e){let i=be.instance.dataList[t.UID].maxCount;if(t.count>=i)e.m_btn_update.visible=!1,e.m_costWater.visible=!1,e.m_img_fins.visible=!0,e.m_txt_progress.visible=!1;else{e.m_txt_progress.text=t.count.toString()+"/"+i.toString(),e.m_img_fins.visible=!1;let s=$e.Money>=t.costMoney;e.m_btn_update.m_txt_cost.text=We.DoConverter(t.costMoney);let a=$e.MaxWater-$e.Water-t.costWater;a<0?(e.m_txt_waterWarn.visible=!0,e.m_txt_costWater.visible=!1,e.m_spr_water.visible=!1):(e.m_txt_waterWarn.visible=!1,e.m_txt_costWater.visible=!0,e.m_spr_water.visible=!0,e.m_txt_costWater.text=t.costWater.toString()),a<0||!s?(e.m_btn_update.grayed=!0,e.m_btn_update.touchable=!1):(e.m_btn_update.grayed=!1,e.m_btn_update.touchable=!0,e.m_btn_update.onClick(this,this.BuildConstruction,[t.name]))}}BuildConstruction(t){it.instance.eventUI(Nt.BuildConstruction,[Nt.BuildConstruction,t]),this.ClosePanel(),this.isGuide&&it.instance.eventUI(Nt.GuideToNext)}OnBuildComplete(t){if(!this._buildItemList.get(t))throw new ye("刷新建造Item失败",t);{let e=this.dict.get(t),i=this._buildItemList.get(t);this.UpdateBuildItem(e,i)}}RenderStatisticsItem(){this.GetStatisticsInfo(),this._StatisticsArray.length<1||(this._statisticsItemList=new Map,this.ui.m_Statistics.m_list.itemRenderer=Laya.Handler.create(this,(t,e)=>{let i=this._StatisticsArray[t];e.m_txt_title.text=i.title,e.m_txt_progress.text=Math.floor(100*i.progress).toString()+"%",e.m_pro_blue.fillAmount=i.progress,e.m_txt_incomeRate.text=We.DoConverter(i.income)+"/分钟",e.m_itemIcon.url=this.GetUrl(i.functionID),e.m_btn_go.onClick(this,this.OnClick,[i.buildingName])},null,!1),this.ui.m_Statistics.m_list.numItems=this._StatisticsArray.length)}RenderTopInfo(){this.GetGuestVolume(),this.ui.m_Statistics.m_text_flow.text=this._flowArray[0].toString(),this.ui.m_Statistics.m_pro_2.value=this._flowArray[1]/this._flowArray[4]*100,this.ChangeColor(this.ui.m_Statistics.m_pro_2),this.ui.m_Statistics.m_pro_3.value=this._flowArray[2]/this._flowArray[5]*100,this.ChangeColor(this.ui.m_Statistics.m_pro_3),this.ui.m_Statistics.m_pro_4.value=this._flowArray[3]/this._flowArray[6]*100,this.ChangeColor(this.ui.m_Statistics.m_pro_4),this.ui.m_Statistics.m_text_women.text=this._flowArray[1].toString()+"/ "+this._flowArray[4].toString(),this.ui.m_Statistics.m_text_pee.text=this._flowArray[2].toString()+"/ "+this._flowArray[5].toString(),this.ui.m_Statistics.m_text_men.text=this._flowArray[3].toString()+"/ "+this._flowArray[6].toString()}ChangeColor(t){t.value>75&&t.value<100?t.m_c1.selectedIndex=1:t.value>=100?t.m_c1.selectedIndex=2:t.m_c1.selectedIndex=0}TotalIncome(){if(this._StatisticsArray.length>0){let t=0;this._StatisticsArray.forEach(e=>{t+=e.income}),this.ui.m_Statistics.m_text_totalIncome.text=We.DoConverter(t)+"/分钟"}else this.ui.m_Statistics.m_text_totalIncome.text="0/分钟"}_OnHide(){it.instance.offUI(Nt.BuildComplete,this,this.OnBuildComplete)}OnClick(t){this.CameraNavigation(t),this.ClosePanel()}CameraNavigation(t){let e=Le.instance.dataList,i=-1;console.log(t);for(let s of e)if(s.name==t){console.log(s.name),i=s.id;break}-1!=i?Fe.instance.FocusPositionByIndex(i):console.log("获取失败")}}class Vs extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","PGameMainLuckyWheel")}onConstruct(){this.m_State=this.getControllerAt(0),this.m_close=this.getChildAt(0),this.m_wheel=this.getChildAt(2),this.m_btn_start=this.getChildAt(5),this.m_text_residue=this.getChildAt(7),this.m_btn_WatchAd=this.getChildAt(11),this.m_btn_thanks=this.getChildAt(12)}}Vs.URL="ui://8nmf3q47kcbydw";class Ws{static music_url(t){return y.instance.getResURL(m.music)+t+".mp3"}static sound_url(t){return y.instance.getResURL(m.sound)+t+".mp3"}static icon_url(t){return y.instance.getResURL(m.icon)+t+".png"}static img_url(t,e="png"){return y.instance.getResURL(m.img)+t+"."+e}static skin_url(t,e="png"){return y.instance.getResURL(m.skin)+t+"."+e}}class js{constructor(){this._bgPast=[],this._urlBGM="",this._urlSOUND="",this._sounds=[]}static get instance(){return null==this._instance&&(this._instance=new js),this._instance}init(){}playBGM(t,e,i,a){null!=t&&this._bgPast.slice(-1)[0]!=t?(this._bgPast.push(t),this._urlBGM=Ws.music_url(t),this._playMusic(e,i,a),console.log(...s.packLog("播放背景音乐",t))):""!=this._urlBGM&&(this._playMusic(e,i,a),console.log(...s.packLog("播放背景音乐",t)))}shiftBGM(t,e,i,s){if(this._bgPast.slice(-1)[0]==t){this._bgPast.pop(),this._bgPast.slice(-1)[0]&&(this._urlBGM=Ws.music_url(t),this._playMusic(e,i,s))}}pauseBGM(){Laya.SoundManager.setMusicVolume(0),console.log(...s.packLog("停止播放音乐",this._urlBGM))}pauseSound(){Laya.SoundManager.stopAllSound()}playSound(t,e,i,s,a){this._urlSOUND=Ws.sound_url(t);for(let t=0;t<this._sounds.length;t++)if(this._sounds[t]&&this._sounds[t].url.indexOf(this._urlSOUND)>=0){this._sounds[t].stop(),this._sounds.splice(t,1);break}let n=Laya.SoundManager.playSound(this._urlSOUND,e,i,s,a);this._sounds.push(n)}stopSound(t){this._urlSOUND=Ws.sound_url(t),Laya.SoundManager.stopSound(this._urlSOUND)}_playMusic(t=0,e,i){Laya.SoundManager.stopMusic(),Laya.SoundManager.playMusic(this._urlBGM,t,e,i)}}class qs{constructor(){this.IsFirst=!0,this.m_stop=!1,this.m_onLoopSoundList=new Set}static get instance(){return this.m_instance||(this.m_instance=new qs),this.m_instance}stopBGM(){js.instance.pauseBGM()}BGMGoOn(){this.playBGM(this.m_onBGM)}soundSuspend(){this.m_stop=!0;for(let t of this.m_onLoopSoundList)js.instance.stopSound(t)}soundGoOn(){this.m_stop=!1;for(let t of this.m_onLoopSoundList)js.instance.playSound(t,0)}playBGM(t,e,i,s){ut.gameData.ifOpenBgm&&!this.m_stop&&(1==this.IsFirst&&(js.instance.playBGM(t,e,i,s),this.IsFirst=!1),Laya.SoundManager.setMusicVolume(1),this.m_onBGM=t)}playSound(t,e,i,s,a){ut.gameData.ifOpenSound&&!this.m_stop&&(0==e&&this.m_onLoopSoundList.add(t),js.instance.playSound(t,e,i,s,a))}stopSound(t){js.instance.stopSound(t),this.m_onLoopSoundList.has(t)&&this.m_onLoopSoundList.delete(t)}}!function(t){t.null="",t.bgm1="bgm1",t.bgm2="bgm2"}($i||($i={}));class Hs extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","PGameSet")}onConstruct(){this.m_music=this.getControllerAt(0),this.m_effect=this.getControllerAt(1),this.m_close=this.getChildAt(1),this.m_btn_close=this.getChildAt(6),this.m_musicBtn=this.getChildAt(10),this.m_ecffectBtn=this.getChildAt(11),this.m_t1=this.getTransitionAt(0)}}Hs.URL="ui://8nmf3q47d8o30";class zs extends xe{constructor(){super(),this._musicToggle=!0,this._effectToggle=!0}static get instance(){return this.m_instance||(this.m_instance=new zs,this.m_instance._classDefine=Hs),this.m_instance}_OnShow(){this.ui.m_musicBtn.title="音乐".i18n(),this.ui.getChild("n0").asTextField.text="设置".i18n(),super.Show(),this.ui.m_btn_close.onClick(this,this.Close),this.ui.m_close.onClick(this,this.Close),this.ui.m_musicBtn.m_state.selectedIndex=this._musicToggle?0:1,this.ui.m_musicBtn.onClick(this,this.ToggleMusic),Ji.instance.ShowNativeAd();let t=new ki;Ms.instance.showBannerFun(t)}ToggleMusic(){this._musicToggle=!this._musicToggle,this.ui.m_musicBtn.m_state.selectedIndex=this._musicToggle?0:1,this._musicToggle?qs.instance.BGMGoOn():qs.instance.stopBGM()}Close(){Be.instance.setUIState([{typeIndex:ee.Setting,state:!1}],!1)}_OnHide(){super.Hide(),Ms.instance.DestroyAd()}}class Qs{static PlayAudio(){null==this.currBgm?(this.currBgm=this.bgm1,zs.instance._musicToggle&&qs.instance.playBGM($i.bgm1,10)):this.currBgm==this.bgm1?(this.currBgm=this.bgm2,zs.instance._musicToggle&&qs.instance.playBGM($i.bgm2,10)):this.currBgm==this.bgm2&&(this.currBgm=this.bgm1,zs.instance._musicToggle&&qs.instance.playBGM($i.bgm1,10))}}Qs.bgm1="res/bgm/bgm1.mp3",Qs.bgm2="res/bgm/bgm2.mp3",Qs.currBgm=null;class Js extends xe{constructor(){super(),this.itemList=[],this.totalWeight=0,this._layer=Yt.Main,this._runtimeIndex=-1}static get instance(){return this.m_instance||(this.m_instance=new Js,this.m_instance._classDefine=Vs),this.m_instance}InitArray(){this.itemList.push({weight:10,progress:0,type:ts.Money,count:86664}),this.itemList.push({weight:10,progress:0,type:ts.Diamond,count:20}),this.itemList.push({weight:10,progress:0,type:ts.MuchMoney,count:173328}),this.itemList.push({weight:10,progress:0,type:ts.Diamond,count:40}),this.itemList.push({weight:10,progress:0,type:ts.Money,count:21666}),this.itemList.push({weight:10,progress:0,type:ts.MuchDiamond,count:100}),this.itemList.push({weight:10,progress:0,type:ts.Diamond,count:80}),this.itemList.push({weight:10,progress:0,type:ts.LotsMoney,count:256666});for(let t of this.itemList)this.totalWeight+=t.weight,t.progress=this.totalWeight}GetRandomItemIndex(){let t=_e.RangeInt(0,this.totalWeight);for(let e=0;e<this.itemList.length;e++)if(this.itemList[e].progress>t)return e}GetAngle(t){return-45*t}_OnShow(){super.Show(),this.InitArray(),this.ui.m_btn_thanks.onClick(this,this.Close),this.ui.m_btn_WatchAd.on(Laya.Event.CLICK,this,this.OnWatchAd),this.ui.m_btn_start.on(Laya.Event.CLICK,this,this.OnClickBtnStart),this.RenderWheel(),this.UpdatePanel(),Oe.trackEvent($t.LuckWheel),Ji.instance.ShowNativeAd();let t=new ki;Ms.instance.showBannerFun(t)}UpdatePanel(){let t=$e.instance.Data.LuckWheelAdDayNum<$e.instance.Data.LuckWheelAdMaxDayNum;this.ui.m_State.selectedIndex=t?$e.data.LuckWheelAdDayNum>=2?0:1:2,this.ui.m_btn_start.m_text_num.text=$e.data.LuckWheelStartCount+"/2";let e=$e.data.LuckWheelAdMaxDayNum-$e.data.LuckWheelAdDayNum;e=e<0?0:e,this.ui.m_text_residue.text=e.toString()}RenderWheel(){this.ui.m_wheel.m_item_0.m_type.selectedIndex=this.itemList[0].type,this.ui.m_wheel.m_item_0.m_num.text="x"+this.itemList[0].count.toString(),this.ui.m_wheel.m_item_1.m_type.selectedIndex=this.itemList[1].type,this.ui.m_wheel.m_item_1.m_num.text="x"+this.itemList[1].count.toString(),this.ui.m_wheel.m_item_2.m_type.selectedIndex=this.itemList[2].type,this.ui.m_wheel.m_item_2.m_num.text="x"+this.itemList[2].count.toString(),this.ui.m_wheel.m_item_3.m_type.selectedIndex=this.itemList[3].type,this.ui.m_wheel.m_item_3.m_num.text="x"+this.itemList[3].count.toString(),this.ui.m_wheel.m_item_4.m_type.selectedIndex=this.itemList[4].type,this.ui.m_wheel.m_item_4.m_num.text="x"+this.itemList[4].count.toString(),this.ui.m_wheel.m_item_5.m_type.selectedIndex=this.itemList[5].type,this.ui.m_wheel.m_item_5.m_num.text="x"+this.itemList[5].count.toString(),this.ui.m_wheel.m_item_6.m_type.selectedIndex=this.itemList[6].type,this.ui.m_wheel.m_item_6.m_num.text="x"+this.itemList[6].count.toString(),this.ui.m_wheel.m_item_7.m_type.selectedIndex=this.itemList[7].type,this.ui.m_wheel.m_item_7.m_num.text="x"+this.itemList[7].count.toString()}Close(){Be.instance.setUIState([{typeIndex:ee.LuckyWheel,state:!1}],!1)}OnWatchAd(){Os.instance.PlatformInstance.ShowRewardVideoAd(Laya.Handler.create(this,()=>{Qs.PlayAudio(),Oe.trackEvent($t.LuckWheelAD),this.isShow&&this.Turn()}),Laya.Handler.create(this,()=>{Os.instance.PlatformInstance.ShowToast("未看完广告")}))}OnClickBtnStart(){this.Turn()}Turn(){this._runtimeIndex=this.GetRandomItemIndex();let t=this.GetAngle(this._runtimeIndex)+1800+_e.RangeInt(-20,20);this.ui.m_wheel.rotation%=360,Laya.Tween.clearAll(this.ui.m_wheel),Laya.Tween.to(this.ui.m_wheel,{rotation:t},3e3,Laya.Ease.sineOut,new Laya.Handler(this,this.CallBackTurn)),this.ui.m_btn_start.off(Laya.Event.CLICK,this,this.OnClickBtnStart),this.ui.m_close.off(Laya.Event.CLICK,this,this.Close)}CallBackTurn(){if(-1==this._runtimeIndex)return;$e.data.LuckWheelStartCount--,$e.data.LuckWheelAdDayNum++;let t=this.itemList[this._runtimeIndex];t.type==ts.Money||t.type==ts.MuchMoney||t.type==ts.LotsMoney?(Ki.PlayMoneyEffect(this.ui.m_wheel),$e.Money+=t.count):(Ki.PlayDiamondEffect(this.ui.m_wheel),$e.Diamond+=t.count),this._runtimeIndex=-1,this.UpdatePanel(),this.ui.m_btn_start.on(Laya.Event.CLICK,this,this.OnClickBtnStart),this.ui.m_close.on(Laya.Event.CLICK,this,this.Close),Laya.Tween.clearAll(this.ui.m_wheel)}_OnHide(){Laya.Tween.clearAll(this.ui.m_wheel),Ms.instance.DestroyAd()}}!function(t){t[t.Money=0]="Money",t[t.MuchMoney=1]="MuchMoney",t[t.Diamond=2]="Diamond",t[t.MuchDiamond=3]="MuchDiamond",t[t.LotsMoney=4]="LotsMoney"}(ts||(ts={}));!function(t){t[t.diamond=0]="diamond",t[t.money=1]="money"}(es||(es={}));class Ks extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","PGameTask")}onConstruct(){this.m_achieve=this.getControllerAt(0),this.m_close=this.getChildAt(0),this.m_btn_close=this.getChildAt(3),this.m_title=this.getChildAt(4),this.m_taskProgress=this.getChildAt(6),this.m_text_taskDesc=this.getChildAt(9),this.m_text_progress=this.getChildAt(11),this.m_txt_reward=this.getChildAt(13),this.m_btn_go=this.getChildAt(14),this.m_btn_getDouble=this.getChildAt(15),this.m_btn_get=this.getChildAt(16)}}Ks.URL="ui://8nmf3q47jfuc1b9";class Zs extends xe{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new Zs,this.m_instance._classDefine=Ks),this.m_instance}_OnShow(){super.Show(),this.ui.m_btn_close.onClick(this,this.Close),this.ui.m_close.onClick(this,this.Close),this.ui.m_btn_get.onClick(this,this.OnClick1x),this.ui.m_btn_getDouble.onClick(this,this.OnClick2x),this.ui.m_btn_go.onClick(this,()=>{Oe.trackEvent($t.Task,{ClickGO:"Go"}),ks.instance.currentTask.Go(),this.Close()}),it.instance.onUI(Nt.UpdateTaskProgress,this,this.UpdateTaskProgress),this.UpdateTaskProgress(),Oe.trackEvent($t.Task,{OpenTaskUI:"UI"});let t=new ki;Ms.instance.showBannerFun(t)}Close(){Be.instance.setUIState([{typeIndex:ee.Task,state:!1}],!1)}_OnHide(){it.instance.offUI(Nt.UpdateTaskProgress,this,this.UpdateTaskProgress),Ms.instance.DestroyAd()}OnClick1x(){let t=ks.instance.currentTask;this.AddReward(t.reward,t.rewardType),Oe.trackEvent($t.Task,{GetReward:"1X"})}OnClick2x(){Oe.trackEvent($t.Task,{GetReward:"2X"}),Os.instance.PlatformInstance.ShowRewardVideoAd(Laya.Handler.create(this,()=>{Qs.PlayAudio();let t=ks.instance.currentTask;this.AddReward(2*t.reward,t.rewardType)}),Laya.Handler.create(this,()=>{Os.instance.PlatformInstance.ShowToast("未看完广告")}))}AddReward(t,e){e==es.money?$e.Money+=t:e==es.diamond&&($e.Diamond+=t,this.isShow&&Ki.PlayDiamondEffect(this.ui.m_txt_reward)),ks.instance.DoNext()}UpdateTaskProgress(){let t=ks.instance.currentTask;null!=t?this.isShow&&(this.ui.m_taskProgress.value=t.progress,this.ui.m_text_progress.text=t.toProgressString(),this.ui.m_text_taskDesc.text=t.describe,this.ui.m_title.text=t.name,this.ui.m_txt_reward.text=t.reward.toString(),this.ui.m_achieve.selectedIndex=t.progress>=100?1:0):this.Close()}}class Ys extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","PGameVideos")}onConstruct(){this.m_bg_n1=this.getChildAt(2),this.m_progress_1=this.getChildAt(4),this.m_text_Time=this.getChildAt(5),this.m_text_Mul=this.getChildAt(6),this.m_group_1=this.getChildAt(9),this.m_progress_2=this.getChildAt(13),this.m_text_Times=this.getChildAt(14),this.m_group_2=this.getChildAt(18),this.m_btn_close=this.getChildAt(19),this.m_btn_Watch=this.getChildAt(21),this.m_btn_thanks=this.getChildAt(22),this.m_text_Surplus=this.getChildAt(23),this.m_group_3=this.getChildAt(24)}}Ys.URL="ui://8nmf3q47wlyx1e";class Xs extends xe{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new Xs,this.m_instance._classDefine=Ys),this.m_instance}_OnShow(){super.Show(),this.ui.m_btn_close.onClick(this,this.Close),this.ui.m_btn_thanks.onClick(this,this.Close),this.ui.m_btn_Watch.onClick(this,this.OnClickWatchADBtn),this.UpdateUsableAdNum(),this.ui.m_text_Time.text=It.ToTimeString($e.data.DoubleBuffTime);let t=$e.data.OfflineAdTotalNum%$e.data.OfflineDiamondLoop;this.ui.m_text_Times.text=t+"/"+$e.data.OfflineDiamondLoop,this.SetProgressOne($e.data.DoubleBuffTime,$e.data.MaxDoubleBuffTime),this.SetProgressTwo(t,$e.data.OfflineDiamondLoop),it.instance.onUI(Nt.UpdateAdBuffTime,this,this.OnUpdateAdBuffTime),$e.data.OfflineAdDayNum>=$e.data.OfflineMaxDayNum&&this.DisableAdd(),this.isGuide=!Re.IsCompleteAllGuide,Oe.trackEvent($t.DoubleUI),Ji.instance.ShowNativeAd();let e=new ki;Ms.instance.showBannerFun(e)}_OnHide(){it.instance.offUI(Nt.UpdateAdBuffTime,this,this.OnUpdateAdBuffTime),Ms.instance.DestroyAd()}Close(){Be.instance.setUIState([{typeIndex:ee.AD,state:!1}],!1)}SetProgressOne(t,e){this.ui.m_progress_1.value=t/e*100}SetProgressTwo(t,e){this.ui.m_text_Times.text=t+"/"+e,this.ui.m_progress_2.value=t/e*100}OnClickWatchADBtn(){Re.IsCompleteAllGuide?Os.instance.PlatformInstance.ShowRewardVideoAd(Laya.Handler.create(this,()=>{Qs.PlayAudio(),this.WatchAd(),Oe.trackEvent($t.DoubleAD)}),Laya.Handler.create(this,()=>{Os.instance.PlatformInstance.ShowToast("未看完广告")})):this.WatchAd()}WatchAd(){$e.AddDoubleBuffTime(18e5),this.isShow&&(this.ui.m_text_Time.text=It.ToTimeString($e.data.DoubleBuffTime),this.SetProgressOne($e.data.DoubleBuffTime,$e.data.MaxDoubleBuffTime)),$e.data.OfflineAdTotalNum++,$e.data.OfflineAdDayNum++,$e.data.OfflineAdDayNum>=$e.data.OfflineMaxDayNum&&this.isShow&&this.DisableAdd();let t=$e.data.OfflineAdTotalNum%$e.data.OfflineDiamondLoop;$e.data.OfflineAdTotalNum>0&&0==t&&($e.Diamond+=30),this.isShow&&(this.SetProgressTwo(t,$e.data.OfflineDiamondLoop),this.UpdateUsableAdNum()),this.isGuide&&(it.instance.eventUI(Nt.GuideToNext),this.Close())}UpdateUsableAdNum(){let t=8-$e.data.OfflineAdDayNum;t=t<0?0:t,this.ui.m_text_Surplus.text=t.toString()}DisableAdd(){this.ui.m_btn_Watch.grayed=!0,this.ui.m_btn_Watch.touchable=!1}OnUpdateAdBuffTime(){this.ui.m_text_Time.text=It.ToTimeString($e.data.DoubleBuffTime),this.SetProgressOne($e.data.DoubleBuffTime,$e.data.MaxDoubleBuffTime)}}class $s extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","PGameMainInfluencer")}onConstruct(){this.m_bg=this.getChildAt(1),this.m_text_money=this.getChildAt(6),this.m_btn_Start=this.getChildAt(7),this.m_btn_thanks=this.getChildAt(8)}}$s.URL="ui://8nmf3q47b3xq1a6";class ta extends xe{constructor(){super(),this.money=0}static get instance(){return this.m_instance||(this.m_instance=new ta,this.m_instance._classDefine=$s),this.m_instance}_OnShow(){this.ui.m_bg.getChild("title").asTextField.text="网红主播".i18n(),this.ui.m_btn_Start.text="欣然接受".i18n(),this.ui.m_btn_thanks.text="不用了".i18n(),this.ui.getChild("n2").asTextField.text="收益".i18n(),this.ui.getChild("n4").asTextField.text="你的厕所修得真是太美啦，我可以发给我的粉丝吗？".i18n(),this.money=8*Je.instance.GetTotalMoney(),this.ui.m_bg.m_btn_close.onClick(this,this.OnClickBtnClose),this.ui.m_btn_thanks.onClick(this,this.OnClickBtnClose),this.ui.m_btn_Start.onClick(this,this.OnClickWatchAD),this.ui.m_text_money.text=We.DoConverter(this.money),this.isGuide=!Re.IsCompleteAllGuide,Oe.trackEvent($t.WorldEvent,{influencer:"UI"}),Ji.instance.ShowNativeAd(),this.vivoObj=new ki,Ms.instance.showBannerFun(this.vivoObj)}OnClickBtnClose(){Be.instance.setUIState([{typeIndex:ee.UIMediatorInfluencer,state:!1}],!1),ra.instance.RemoveADUtility(is.NetRed),it.instance.event3D(A.NetRedLeaveWC),Ms.instance.DestroyAd()}OnClickWatchAD(){if(!Re.IsCompleteAllGuide)return Ki.PlayMoneyEffect(this.ui.m_btn_Start),ra.instance.RemoveADUtility(is.NetRed),this.OnClickBtnClose(),it.instance.event3D(A.NetRedLeaveWC),void(this.isGuide&&it.instance.eventUI(Nt.GuideToNext));console.log("看广告！+钱"+this.money),Os.instance.PlatformInstance.ShowRewardVideoAd(Laya.Handler.create(this,()=>{Qs.PlayAudio(),$e.Money+=this.money,this.money=0,Oe.trackEvent($t.WorldEvtAD,{influencer:"AD"}),this.isShow&&(Ki.PlayMoneyEffect(this.ui.m_btn_Start),this.OnClickBtnClose()),this.isGuide&&it.instance.eventUI(Nt.GuideToNext)}),Laya.Handler.create(this,()=>{Os.instance.PlatformInstance.ShowToast("未看完广告")}))}}class ea extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","PGameMainRepairMaster")}onConstruct(){this.m_bg=this.getChildAt(1),this.m_btn_start=this.getChildAt(5),this.m_btn_thanks=this.getChildAt(6)}}ea.URL="ui://8nmf3q47b3xq1a9";class ia extends xe{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new ia,this.m_instance._classDefine=ea),this.m_instance}_OnShow(){this.ui.m_bg.getChild("title").asTextField.text="修理大赛".i18n(),this.ui.m_btn_start.text="欣然接受".i18n(),this.ui.m_btn_thanks.text="不用了".i18n(),this.ui.getChild("n2").asTextField.text="立即维修（并清扫）所有设施".i18n(),this.ui.getChild("n4").asTextField.text="立即进行一场别开生面的修理大赛，看谁修理的又快又多！".i18n(),this.ui.m_bg.m_btn_close.onClick(this,this.Close),this.ui.m_btn_thanks.onClick(this,this.Close),this.ui.m_btn_start.onClick(this,this.OnWatchAd),Oe.trackEvent($t.WorldEvent,{repairGame:"UI"}),Ji.instance.ShowNativeAd();let t=new ki;Ms.instance.showBannerFun(t)}Close(){Be.instance.setUIState([{typeIndex:ee.UIMeditorRepairGame,state:!1}],!1),ra.instance.RemoveADUtility(is.RepairGame),Ms.instance.DestroyAd()}OnWatchAd(){Os.instance.PlatformInstance.ShowRewardVideoAd(Laya.Handler.create(this,()=>{Qs.PlayAudio(),la.instance.RepairCompleteNow(),Oe.trackEvent($t.WorldEvtAD,{repairGame:"AD"}),this.Close()}),Laya.Handler.create(this,()=>{Os.instance.PlatformInstance.ShowToast("未看完广告")}))}}class sa extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","PGameMainSpeedUp")}onConstruct(){this.m_dark_bg=this.getChildAt(0),this.m_bg=this.getChildAt(1),this.m_btn_start=this.getChildAt(5),this.m_btn_thanks=this.getChildAt(6)}}sa.URL="ui://8nmf3q47b3xq19y";class aa extends xe{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new aa,this.m_instance._classDefine=sa),this.m_instance}_OnShow(){this.ui.m_bg.getChild("title").asTextField.text="畅通无阻".i18n(),this.ui.m_btn_start.text="欣然接受".i18n(),this.ui.m_btn_thanks.text="不用了".i18n(),this.ui.getChild("n3").asTextField.text="急速入厕持续2分钟".i18n(),this.ui.getChild("n8").asTextField.text="受神秘力量影响，所有人上厕所的速度将大大加快".i18n(),this.ui.m_bg.m_btn_close.onClick(this,this.Close),this.ui.m_btn_thanks.onClick(this,this.Close),this.ui.m_btn_start.onClick(this,this.OnWatchAd),Oe.trackEvent($t.WorldEvent,{speedUp:"UI"}),Ji.instance.ShowNativeAd();let t=new ki;Ms.instance.showBannerFun(t)}Close(){Be.instance.setUIState([{typeIndex:ee.UIMediatorSpeedUp,state:!1}],!1),ra.instance.RemoveADUtility(is.SpeedUp),Ms.instance.DestroyAd()}OnWatchAd(){Os.instance.PlatformInstance.ShowRewardVideoAd(Laya.Handler.create(this,()=>{Qs.PlayAudio(),$e.speedUpTime=12e4,Oe.trackEvent($t.WorldEvtAD,{speedUp:"AD"}),this.Close()}),Laya.Handler.create(this,()=>{Os.instance.PlatformInstance.ShowToast("未看完广告")}))}}class na extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","PGameMainCheers")}onConstruct(){this.m_bg=this.getChildAt(1),this.m_txt_Peoples=this.getChildAt(2),this.m_btn_Start=this.getChildAt(5),this.m_btn_thanks=this.getChildAt(6)}}na.URL="ui://8nmf3q47b3xq1aa";class oa extends xe{constructor(){super(),this.peoples=0}static get instance(){return this.m_instance||(this.m_instance=new oa,this.m_instance._classDefine=na),this.m_instance}_OnShow(){this.ui.m_bg.getChild("title").asTextField.text="干杯吧！".i18n(),this.ui.m_btn_Start.text="欣然接受".i18n(),this.ui.m_btn_thanks.text="不用了".i18n(),this.ui.getChild("n4").asTextField.text="举办一场狂欢并带来一大群急需厕所的客人".i18n(),this.peoples=_e.RangeInt(10,20),this.ui.m_bg.m_btn_close.onClick(this,this.OnClickBtnClose),this.ui.m_btn_thanks.onClick(this,this.OnClickBtnClose),this.ui.m_btn_Start.onClick(this,this.OnClickWatchAD),this.ui.m_txt_Peoples.text="额外".i18n()+this.peoples+"客人".i18n(),Oe.trackEvent($t.WorldEvent,{cheers:"UI"}),Ji.instance.ShowNativeAd();let t=new ki;Ms.instance.showBannerFun(t)}OnClickBtnClose(){Be.instance.setUIState([{typeIndex:ee.UIMediatorCheers,state:!1}],!1),ra.instance.RemoveADUtility(is.Cheers),Ms.instance.DestroyAd()}OnClickWatchAD(){console.log("看广告！+19人"),Os.instance.PlatformInstance.ShowRewardVideoAd(Laya.Handler.create(this,()=>{Qs.PlayAudio(),Ts.instance.AddPeopleOnWatchAD(this.peoples),Oe.trackEvent($t.WorldEvtAD,{cheers:"AD"}),this.isShow&&this.OnClickBtnClose()}),Laya.Handler.create(this,()=>{Os.instance.PlatformInstance.ShowToast("未看完广告")}))}}class ra extends xe{constructor(){super(),this._layer=Yt.Main,this._adUtilityList=[],this._lastTipTime=0,Re.IsCompleteAllGuide?this.isGuide=!1:this.isGuide=!0}static get instance(){return this.m_instance||(this.m_instance=new ra,this.m_instance._classDefine=fi),this.m_instance}_OnShow(){Laya.timer.loop(35e3,this,this.RandomAdBtn),this.ShowPanel(ee.EventPanel,!0,!1),this.ui.m_btn_statistics.onClick(this,this.ShowManager),this.ui.m_btn_video.onClick(this,this.ADClick),this.ui.m_turntableBtn.onClick(this,()=>this.ShowPanel(ee.LuckyWheel,!0,!1)),this.ui.m_setBtn.onClick(this,()=>this.ShowPanel(ee.Setting,!0,!1)),this.ui.m_taskBtn.onClick(this,this.TaskOnClick),this.ui.m_staffBtn.onClick(this,()=>Ki.instance.ShowCleanRoom()),this.ui.m_btn_speedUp.onClick(this,()=>{this.ShowUtilityPanel(ee.UIMediatorSpeedUp)}),this.ui.m_btn_netRed.onClick(this,()=>{this.ShowUtilityPanel(ee.UIMediatorInfluencer)}),this.ui.m_btn_cheers.onClick(this,()=>{this.ShowUtilityPanel(ee.UIMediatorCheers)}),this.ui.m_btn_repair.onClick(this,()=>{this.ShowUtilityPanel(ee.UIMeditorRepairGame)}),this.RenderRightUtility(),this.HideTaskBtn(),it.instance.onUI(Nt.UpdateTaskProgress,this,this.UpdateTaskProgress),it.instance.onUI(Nt.AddAdUtilityNetRed,this,this.OnAddNetRed),it.instance.on(ae.UpdateOnLineTime,this,this.UpdateDoubleTimeLast),this.ShowRecordBtn(!0),this.ui.m_btn_record.onClick(this,this.ShowRecordVideoPanel),it.instance.onUI(Nt.OnStartRecord,this,this.ShowRecordStop),it.instance.onUI(Nt.OnStopRecord,this,this.ShowRecordIdle)}TaskOnClick(){this.ShowPanel(ee.Task,!0,!1)}_OnHide(){it.instance.off(Nt.UpdateTaskProgress,this,this.UpdateTaskProgress),it.instance.off(Nt.AddAdUtilityNetRed,this,this.OnAddNetRed),Laya.timer.clearAll(this)}ShowPanel(t,e,i){Be.instance.setUIState([{typeIndex:t,state:e}],i)}ADClick(){this.ShowPanel(ee.AD,!0,!1),this.isGuide&&(Re.IsCompleteAllGuide||(it.instance.eventUI(Nt.GuideToNext),this.isGuide=!1))}UpdateStaffNumText(t,e){this.isShow&&(this.ui.m_staffBtn.m_txt_num.text=t+"/"+e)}ShowManager(){Be.instance.setUIState([{typeIndex:ee.Manager,state:!0}],!1)}RenderRightUtility(){this.ui.m_btn_cheers.visible=!0,this.ui.m_btn_cheers.touchable=!0,this.ui.m_btn_netRed.visible=!0,this.ui.m_btn_netRed.touchable=!0,this.ui.m_btn_repair.visible=!0,this.ui.m_btn_repair.touchable=!0,this.ui.m_btn_speedUp.visible=!0,this.ui.m_btn_speedUp.touchable=!0;for(let t of this._adUtilityList)switch(t){case is.Cheers:this.ui.m_btn_cheers.visible=!0,this.ui.m_btn_cheers.touchable=!0;break;case is.NetRed:this.ui.m_btn_netRed.visible=!0,this.ui.m_btn_netRed.touchable=!0;break;case is.RepairGame:this.ui.m_btn_repair.visible=!0,this.ui.m_btn_repair.touchable=!0;break;case is.SpeedUp:this.ui.m_btn_speedUp.visible=!0,this.ui.m_btn_speedUp.touchable=!0}}GetRightBtnSpriteUrl(t){switch(t){case is.NetRed:return"/res/sprite/utility/NetRed.png";case is.Cheers:return"/res/sprite/utility/Party.png";case is.RepairGame:return"/res/sprite/utility/Repair.png";case is.SpeedUp:default:return"/res/sprite/utility/SpeedUp.png"}}OnClickRightUtilityBtn(t){switch(t){case is.NetRed:this.ShowUtilityPanel(ee.UIMediatorInfluencer);break;case is.Cheers:this.ShowUtilityPanel(ee.UIMediatorCheers);break;case is.RepairGame:this.ShowUtilityPanel(ee.UIMeditorRepairGame);break;case is.SpeedUp:this.ShowUtilityPanel(ee.UIMediatorSpeedUp);break;default:console.error("打开面板失败！"+t)}}ShowUtilityPanel(t){Be.instance.setUIState([{typeIndex:t,state:!0}],!1)}AddAdUtility(t){if(this._adUtilityList.indexOf(t)<0){this._adUtilityList.push(t),this.RenderRightUtility();let e=(new Date).getTime();if(e-this._lastTipTime>6e4){Ge.instance.ShowTalkPanel(3)&&(this._lastTipTime=e)}}}RemoveADUtility(t){let e=this._adUtilityList.indexOf(t);e>-1&&(this._adUtilityList.splice(e,1),this.RenderRightUtility())}RandomAdBtn(){let t=_e.RangeInt(0,4);t==is.NetRed?Ts.instance&&Ts.instance.PopNetRed():this.AddAdUtility(t),console.log("引导是否结束："+Re.IsCompleteAllGuide),console.log("管理界面是否打开："+Fs.instance.isShow),console.log("转盘界面是否打开："+Js.instance.isShow),console.log("任务界面是否打开："+Zs.instance.isShow),console.log("双倍奖励界面是否打开："+Xs.instance.isShow),console.log("设置界面是否打开："+zs.instance.isShow),console.log("影响界面是否打开："+ta.instance.isShow),console.log("修理界面是否打开："+ia.instance.isShow),console.log("加速界面是否打开："+aa.instance.isShow),console.log("干杯界面是否打开:"+oa.instance.isShow),!Re.IsCompleteAllGuide||Fs.instance.isShow||Js.instance.isShow||Zs.instance.isShow||Xs.instance.isShow||zs.instance.isShow||ta.instance.isShow||ia.instance.isShow||aa.instance.isShow||oa.instance.isShow||(Ji.instance.ShowNativeAd(),console.warn("============>>>>>随机原生广告调用")),console.log("============>>>>>RandomAdBtn")}HideTaskBtn(){this.ui.m_taskBtn.visible=!1,this.ui.m_taskBtn.touchable=!1}UpdateTaskProgress(){if($e.instance.Data.allTaskComplete)this.HideTaskBtn();else{this.ui.m_taskBtn.visible=!0,this.ui.m_taskBtn.touchable=!0;let t=ks.instance.currentTask;this.ui.m_taskBtn.m_progress.value=t.progress,this.ui.m_taskBtn.m_progress.m_text_progress.text=t.toSimpleProgressString(),this.ui.m_taskBtn.m_progress.m_text_task.text=t.name}}OnAddNetRed(){this.AddAdUtility(is.NetRed)}UpdateDoubleTimeLast(){let t=$e.data.DoubleBuffTime;this.ui.m_txt_doubleTime.text=t>0?"2x "+It.ToTimeString(t):"2x"}ShowRecordVideoPanel(){0==this.ui.m_btn_record.m_state.selectedIndex?Es.instance.ShowRecord():(this.ShowRecordIdle(),Os.instance.PlatformInstance.recordManager.StopRecord(Laya.Handler.create(this,()=>{Os.instance.PlatformInstance.ShowToast("录制结束"),Es.instance.ShowShare()})))}ShowRecordBtn(t){let e=Os.instance.PlatformInstance.platform==Xi.TT;this.ui.m_btn_record.visible=t&&e}ShowRecordState(t){this.ui.m_btn_record.m_state.selectedIndex=t}ShowRecordIdle(){this.ShowRecordState(0)}ShowRecordStop(){this.ShowRecordState(2),this.ui.m_btn_record.offClick(this,this.ShowRecordVideoPanel),this.ui.m_btn_record.grayed=!0;for(let t=3;t>=0;t--){let e=t;Laya.timer.once(3e3-1e3*e,this,()=>{this.ui.m_btn_record.m_number.text=t.toString(),e<=0&&(this.ui.m_btn_record.m_number.text="",this.ui.m_btn_record.onClick(this,this.ShowRecordVideoPanel),this.ui.m_btn_record.grayed=!1)})}}}!function(t){t[t.NetRed=0]="NetRed",t[t.Cheers=1]="Cheers",t[t.RepairGame=2]="RepairGame",t[t.SpeedUp=3]="SpeedUp"}(is||(is={}));class la extends _i{constructor(){super(...arguments),this._waitRepairFac=[],this._workList=[],this._workDict=new Map,this._chairList=[],this._lastTipTime=0}get exitPos(){if(null==this._runtimeExitPos){let t=this.sprite3D.getChildByName("exit");this._runtimeExitPos=t.transform.position}return this._runtimeExitPos}get staffNum(){return this._workList.length}static get instance(){return this._instance}onAwake(){super.onAwake(),la._instance=this,it.instance.on3D(A.RepairFacility,this,this.OnRequestRepair),it.instance.on3D(A.FacilityRepairComplete,this,this.OnFacilityRepairComplete),it.instance.on3D(A.AddStaff,this,this.AddWorker),it.instance.onUI(Nt.OnClickRepairBtn,this,this.OnClickRepairBtn)}onStart(){this.InitWorkers(),this.entrance.active=!1}ShowOutlook(){}ShowPlaceholder(){}ClosePlaceholder(){}UpdateFacilityLevel(t,e,i,s){super.UpdateFacilityLevel(t,e,i,s),this.OnUpdateSlot()}InitWorkers(){this.InitChair();let t=a.Get(S.prefab_url(Et.prefab4.Female_worker));if(!t)throw new ye("维修工获取失败");{let e=$e.instance.GetEmployeeList();for(let i=0;i<e.length;i++){let s=this.Instantiate(t,this.owner),a=s.addComponent(pi);a.Init(e[i]),this._workDict.set(a.Name,a),this._workList.push(a),this._chairList[i].worker=a,a.transform.position=this._chairList[i].chair.transform.position,a.transform.rotationEuler=this._chairList[i].chair.transform.rotationEuler,s.active=!0}}this.UpdateStaffNumUI()}AddWorker(t,e){let i=-1;e&&(i=this.GetWorkerIndexByName(e));let s=a.Get(S.prefab_url(Et.prefab4.Female_worker)),n=this.Instantiate(s,this.owner),o=n.addComponent(pi);if(o.Init(t),i>-1){let t=this._workDict.get(e);this._workList[i]=o,this._workDict.delete(e),this._workDict.set(o.Name,o),this.TryRemoveWorkerFromChair(t),t.Disposed()}else this._workDict.set(o.Name,o),this._workList.push(o);let r=this.TryGetEmptyChair(o);o.transform.position=r.transform.position,o.transform.rotationEuler=r.transform.rotationEuler,n.active=!0,this.UpdateStaffNumUI()}GetWorkerIndexByName(t){for(let e=0;e<this._workList.length;e++)if(this._workList[e].Name==t)return e;return-1}OnClickRepairBtn(){let t=this._waitRepairFac[0];t&&this.OnRequestRepair(t),console.log("雇员正在来的路上")}OnRequestRepair(t){if(!this.TryDispatchWorker(t,this.exitPos)){this._waitRepairFac.indexOf(t)<0?(this._waitRepairFac.push(t),console.log("加入待维修的列表")):console.log("不能重复加入待维修的列表")}}TryDispatchWorker(t,e){for(let i of this._workList)if(!i.hasFacTarget)return i.SetFacTarget(t,e),this.TryRemoveWorkerFromChair(i),this.RemoveFacFromList(t),this.UpdateStaffNumUI(),!0;let i=(new Date).getTime();if(i-this._lastTipTime>6e4){Ge.instance.ShowTalkPanel(2)&&(this._lastTipTime=i)}return!1}RemoveFacFromList(t){let e=this._waitRepairFac.indexOf(t);e>-1&&this._waitRepairFac.splice(e,1)}OnFacilityRepairComplete(t,e){if(!e.isDisposed)if(this._waitRepairFac.length>0){let t=this._waitRepairFac[0];this.TryDispatchWorker(t,this.exitPos)}else{let t=this.TryGetEmptyChair(e);e.ReturnChairPos(t),this.UpdateStaffNumUI()}}InitChair(){let t=this.sprite3D.getChildByName(jt.Chair),e=t.numChildren;this._chairList=new Array(e);for(let i=0;i<e;i++){let e=t.getChildAt(i);if(!e)throw new Error("初始化椅子失败！"+i.toString());this._chairList[i]={chair:e,worker:null}}}TryGetEmptyChair(t){let e=null;for(let i of this._chairList)if(null==i.worker){e=i.chair,i.worker=t;break}if(null==e)throw"获取闲置的椅子失败！";return e}TryRemoveWorkerFromChair(t){for(let e of this._chairList)e.worker==t&&(e.worker=null)}onUpdate(){this._waitRepairFac.forEach(t=>{Ne.instance.EventDistribute(t.runtimeFirstChild.transform.position,t.sprite.id,t.eventID,0)})}OnUpdateSlot(){this._workList.forEach(t=>{t.SetRepairTime(this.cleanTime)})}UpdateStaffNumUI(){let t=0;for(let e of this._workList)e.hasFacTarget||t++;let e=this._workList.length;ra.instance.UpdateStaffNumText(t,e)}RepairCompleteNow(){for(let t of this._waitRepairFac)t.SetBreakState(!1),Ne.instance.RecycleBtn(t.sprite.id,t.eventID),Ie.ClearAll(t.sprite.id);this._waitRepairFac=[];for(let t of this._workList)t.hasFacTarget&&t.RepairCompleteNow()}OnClick(){super.OnClick(),Fe.instance.FocusBuild(21)}}class ha extends _i{constructor(){super(...arguments),this._standardTime=12}ShowOutlook(){}ShowPlaceholder(){}ClosePlaceholder(){}OnClick(){this.functionID==qt.FemaleSink?Fe.instance.FocusBuild(19):Fe.instance.FocusBuild(18)}onStart(){super.onStart(),this.entrance.active=!1}}class ca extends _i{constructor(){super(...arguments),this._standardTime=15}print(){console.log(this.buildingName,this.slotPosList)}ShowOutlook(t,e,i=!1){if(this.ClosePlaceholder(),t)this.sprite3D.getChildByName(jt.cs_nan).active=!0,this.sprite3D.getChildByName(jt.cs_nv).active=!1,this.sprite3D.getChildByName(jt.toiletWall).active=!1;else{this.sprite3D.getChildByName(jt.cs_nan).active=!1,this.sprite3D.getChildByName(jt.cs_nv).active=!0;let t=e%2==0;this.sprite3D.getChildByName(jt.toiletWall).active=!t}this._equipmentNode.active=!0,i&&this.PlayBuildEffect(),it.instance.event3D(A.SetDoorActive,[this.transform.position,!0])}ShowPlaceholder(){super.ShowPlaceholder(),it.instance.event3D(A.SetDoorActive,[this.transform.position,!1])}OnClick(){super.OnClick(),this.functionID==qt.MaleToilet?Fe.instance.FocusBuild(this._index-1):Fe.instance.FocusBuild(this._index+5)}}class da extends _i{constructor(){super(...arguments),this._peeLine={},this._maleLine={},this._femaleLine={}}get flow(){let t=this.slots[0];return me.instance.GetSlotConfigByUID(t.uid)[t.level].length}get femaleQueueLength(){let t=this.slots[1];return me.instance.GetSlotConfigByUID(t.uid)[t.level].length}get maleQueueLength(){let t=this.slots[2];return me.instance.GetSlotConfigByUID(t.uid)[t.level].length}get peeQueueLength(){let t=this.slots[3];return me.instance.GetSlotConfigByUID(t.uid)[t.level].length}InitBuilding(t,e){this.active=t.active,this.functionID=t.functionID,this._index=t.index,this._name=t.name,this._title=t.title,this.slots=t.slots,this.InitAllLine();for(let e=0;e<t.slots.length;e++){let i=t.slots[e];this.UpdateFacilityLevel(i.name+"_"+e.toString(),i.level,!1,i)}}UpdateFacilityLevel(t,e,i,s){if(this.UpdateStatistic(),t==jt.slot_flow_config_0)return;let a=this._equipmentNode.getChildByName(t);if(a){let t=this.GetLengthByLevel(s.uid,s.level);a.active=!0,this.ToggleAllChild(a,!1);for(let e=0;e<t;e++){let t=a.getChildByName(e.toString());t?t.active=!0:console.log("获取面片失败！"+a.name,e)}}else console.warn("试图在建筑",this.sprite3D.name,"中获取一个不存在的设备",t,",请检查场景中是否已正确放置此设备...")}GetLengthByLevel(t,e){let i=me.instance.GetSlotConfigByUID(t);if(i){if(i[e])return i[e].length;throw new Error(t+"-"+e+"的配置表等级信息获取失败！")}throw new Error(t+"-"+e+"的配置表获取失败！")}InitAllLine(){this.InitLineUp(jt.slot_femaleQueue_config_1,this._femaleLine),this.InitLineUp(jt.slot_peeQueue_config_2,this._peeLine),this.InitLineUp(jt.slot_maleQueue_config_3,this._maleLine)}InitLineUp(t,e){let i=this._equipmentNode.getChildByName(t),s=i.numChildren;for(let t=0;t<s;t++){let s=i.getChildAt(t);e[s.name]=s}}ShowOutlook(){}onStart(){super.onStart(),this.ToggleQueueShow(!1)}OnClick(){super.OnClick(),this.ToggleQueueShow(!0),Fe.instance.FocusBuild(24)}OffClick(){super.OffClick(),this.ToggleQueueShow(!1)}ToggleQueueShow(t){this._equipmentNode.getChildByName("slot_femaleQueue_config_1").active=t,this._equipmentNode.getChildByName("slot_peeQueue_config_2").active=t,this._equipmentNode.getChildByName("slot_maleQueue_config_3").active=t}}class ua extends _i{constructor(){super(...arguments),this._standardTime=15}ShowOutlook(t,e,i=!1){}UpdateFacOutLook(){let t=this.slots;for(let e of t)this.UpdateFacilityLevel(e.name+"_"+e.id.toString(),e.level,!1,e)}OnClick(){super.OnClick(),Fe.instance.FocusBuild(38)}}class ma extends fe{constructor(){super(...arguments),this._speed=100,this._star=0,this._isAllowOnclick=!1}onStart(){this._time=0,this._money=0}onUpdate(){if(this._time+=It.deltaTime,this._money+=It.deltaTime*this._speed*((this._star+1)*(this._star+1)),this._time>10){this._time=0;let t=Ie.PlayEffect(Bt.Emoji_money,this.id);this.sprite3D.addChild(t),t.transform.localPosition=Ct.zero,this._isAllowOnclick=!0,t.active=!1,t.active=!0}}OnclickCollectMoney(){Ie.Clear(this.id,Bt.Emoji_money);let t=Math.floor(this._money);$e.Money+=t,this._money=0,this._time=0,this._isAllowOnclick=!1;let e=Ie.PlayEffect(Bt.Money,this.id,2e3);this.owner.addChild(e),e.transform.localPosition=Ct.zero,e.transform.rotationEuler=this.transform.rotationEuler}onMouseDown(){this._isAllowOnclick&&this.OnclickCollectMoney()}}class _a extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","CountDownTime")}onConstruct(){this.m_libraryLastTime=this.getChildAt(0),this.m_canteenLastTime=this.getChildAt(1)}}_a.URL="ui://8nmf3q47llxc1cn";class ga extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","PGameOpenCafe")}onConstruct(){this.m_type=this.getControllerAt(0),this.m_btn_close=this.getChildAt(3),this.m_title=this.getChildAt(4),this.m_cafeBulidProgress=this.getChildAt(6),this.m_spirte=this.getChildAt(9),this.m_text_countDown=this.getChildAt(13),this.m_btn_Ad=this.getChildAt(14),this.m_btn_thanks=this.getChildAt(15)}}ga.URL="ui://8nmf3q47b3xq1at";class pa extends xe{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new pa,this.m_instance._classDefine=ga),this.m_instance}_OnShow(){this.ui.m_btn_close.onClick(this,this.Close),this.ui.m_btn_thanks.onClick(this,this.Close),it.instance.on(ae.UpdateOnLineTime,this,this.OnTick),this.ui.m_btn_Ad.onClick(this,this.OnClickAd),Oe.trackEvent($t.OpenCoffeeUI);let t=new ki;Ms.instance.showBannerFun(t)}_OnHide(){it.instance.off(ae.UpdateOnLineTime,this,this.OnTick),Ms.instance.DestroyAd()}ShowPanel(t){Be.instance.setUIState([{typeIndex:ee.OpenCoffee,state:!0}],!1),0==t?(this.ui.m_type.selectedIndex=0,this.ui.m_spirte.url="res/sprite/ui_build_icon/icon_library.png"):(this.ui.m_type.selectedIndex=1,this.ui.m_spirte.url="res/sprite/ui_build_icon/icon_canteen.png"),this.OnTick()}Close(){Be.instance.setUIState([{typeIndex:ee.OpenCoffee,state:!1}],!1)}OnTick(){if(0==this.ui.m_type.selectedIndex){let t=$e.data.LibraryLastTime;this.ui.m_text_countDown.text=t>0?It.ToTimeString(t):"00:00:00"}else{let t=$e.data.CanteenLastTime;t>0?(this.ui.m_text_countDown.text=It.ToTimeString(t),this.ui.m_cafeBulidProgress.value=t/24/60/60/10):(this.ui.m_cafeBulidProgress.value=0,this.ui.m_text_countDown.text="00:00:00")}}OnClickAd(){let t=this.ui.m_type.selectedIndex;Os.instance.PlatformInstance.ShowRewardVideoAd(Laya.Handler.create(this,()=>{Qs.PlayAudio(),0==t?$e.data.LibraryLastTime=$e.data.LibraryLastTime-108e5:$e.data.CanteenLastTime=$e.data.CanteenLastTime-108e5,Oe.trackEvent($t.CoffeeAD),this.isShow&&this.OnTick()}),Laya.Handler.create(this,()=>{Os.instance.PlatformInstance.ShowToast("未看完广告")}))}}class fa extends xe{constructor(){super(),this._layer=Yt.EventLayer,this._lV4Pos=new Laya.Vector4}static get instance(){return this.m_instance||(this.m_instance=new fa,this.m_instance._classDefine=_a),this.m_instance}_OnShow(){it.instance.on(ae.UpdateOnLineTime,this,this.UpdateLastTime),it.instance.onUI(Nt.CanteenTimeOver,this,this.OnCarteenTimeOver),it.instance.onUI(Nt.LibraryTimeOver,this,this.OnLibraryTimeOver),this.ui.m_libraryLastTime.onClick(this,this.OnClickLibrary),this.ui.m_canteenLastTime.onClick(this,this.OnClickCateen)}_OnHide(){it.instance.off(ae.UpdateOnLineTime,this,this.UpdateLastTime),it.instance.offUI(Nt.CanteenTimeOver,this,this.OnCarteenTimeOver),it.instance.offUI(Nt.LibraryTimeOver,this,this.OnLibraryTimeOver)}UpdateLastTime(){if(!this.isShow)return;let t=$e.data.CanteenLastTime;this.ui.m_canteenLastTime.m_txt_lastTime.text=t>0?It.ToTimeString(t):"开发完成！";let e=$e.data.LibraryLastTime;this.ui.m_libraryLastTime.m_txt_lastTime.text=e>0?It.ToTimeString(e):"开发完成！"}ChangPos(t,e,i){et.camera.worldToViewportPoint(e,i),t.x=i.x,t.y=i.y}OnCarteenTimeOver(){this.isShow&&(this.ui.m_canteenLastTime.m_txt_lastTime.text="开发完成！")}OnLibraryTimeOver(){this.isShow&&(this.ui.m_libraryLastTime.m_txt_lastTime.text="开发完成！")}UpdateLibraryTimePos(t){this.isShow&&this.ChangPos(this.ui.m_libraryLastTime,t,this._lV4Pos)}UpdateCanteenTimePos(t){this.isShow&&this.ChangPos(this.ui.m_canteenLastTime,t,this._lV4Pos)}OnClickLibrary(){pa.instance.ShowPanel(0),$e.data.hasLibraryTime||($e.data.hasLibraryTime=!0,$e.data.LibraryLastTime=864e5)}OnClickCateen(){$e.data.hasCanteenTime||($e.data.hasCanteenTime=!0,$e.data.CanteenLastTime=864e5),$e.data.CanteenLastTime>0?pa.instance.ShowPanel(1):this.ui.m_canteenLastTime.m_txt_lastTime.text="开发完成！",$e.data.CanteenLastTime<=0&&(this.BuildCanteen(),this.Close())}BuildCanteen(){it.instance.eventUI(Nt.BuildConstruction,[Nt.BuildConstruction,jt.canteen])}Close(){Be.instance.setUIState([{typeIndex:ee.CountDownTime,state:!1}],!1)}}class ya extends _i{ShowPlaceholder(){super.ShowPlaceholder(),it.instance.event3D(A.SetDoorActive,[this.transform.position,!1])}ShowOutlook(t,e,i=!1){this.sprite3D.getChildByName("outlook").active=!0,super.ClosePlaceholder(),this._equipmentNode.active=!0,i&&this.PlayBuildEffect(),it.instance.event3D(A.SetDoorActive,[this.transform.position,!0])}onStart(){super.onStart(),this.entrance.active=!1}onLateUpdate(){fa.instance.UpdateLibraryTimePos(this.transform.position)}OnClick(){super.OnClick(),Fe.instance.FocusBuild(22)}}class Sa extends ct{}class Ia extends lt{constructor(){super(),it.instance.on3D(A.UpdateBuildingData,this,this.UpdateBuildData),it.instance.onUI(Nt.UpdateSlotData,this,this.UpdateSlotData)}static get instance(){return null==this._instance&&(this._instance=new Ia),this._instance}get data(){return this._data}get _saveName(){return"LibraryData"}getNewData(){return new Sa}InitData(){this._data=this._ReadFromFile(),null==this._data.list&&(this._data.list=new ei,this._data.list.active=!1,this._data.list.functionID=qt.Library,this._data.list.name=jt.Library,this._data.list.index=0,this._data.list.title="图书馆",this.InitSlot(this._data.list),this._SaveToDisk(this._data))}InitSlot(t){let e=ii.instance.dataList,i=0;for(let t of e)t.library_slot>-1&&i++;t.slots=new Array(i);for(let s=0;s<i;s++){let i=new ti,a=e[s];i.id=s,i.uid=a.library_slot,i.name=ce.instance.dataList[i.uid].name,i.level=a.library_slot_level,i.usable=Se.Data.slot_secretaire_config==i.uid,t.slots[s]=i}}UpdateBuildData(t){if(t.Name==jt.Library){console.log("图书馆建造完成开放"),this._data.list.active=!0;let e={buildingName:t.Name,buildingData:this._data.list};it.instance.event3D(A.UpdateBuildingOutlookEvent,e),this._SaveToDisk(this._data)}}UpdateSlotData(t){if(t.building.functionID==qt.Library){let e=this.data.list;e?(ti.UpdateSlotData(t,e.slots),this._SaveToDisk(this._data)):console.error("获取数据失败！",t)}}}class wa extends _i{onLateUpdate(){fa.instance.UpdateCanteenTimePos(this.transform.position)}ShowOutlook(t,e,i=!1){this.sprite3D.getChildByName("outlook").active=!0,super.ClosePlaceholder(),this._equipmentNode.active=!0,i&&this.PlayBuildEffect()}OnClick(){super.OnClick(),Fe.instance.FocusBuild(23)}}class Ca extends _i{ShowOutlook(t,e,i=!1){}ShowPlaceholder(){}onStart(){super.onStart(),this.entrance.active=!1}OnClick(){super.OnClick(),Fe.instance.FocusBuild(20)}}class ba{constructor(){it.instance.on3D(A.OpenBuildBlock,this,this.PlayState)}static get instance(){return null==this._instance&&(this._instance=new ba),this._instance}InitBlockAnimator(t,e){this.maleAnimator=t.getComponent(Laya.Animator),this.femaleAnimator=e.getComponent(Laya.Animator);let i=Qe.instance.dict.get(jt.maleToilet);this.PlayState(i.count,!0);let s=Qe.instance.dict.get(jt.femaleToilet);this.PlayState(s.count,!1)}PlayState(t,e){0<=(t=(t+=1)>=6?6:t)&&t<=6?e?this.maleAnimator.play(t.toString()):this.femaleAnimator.play(t.toString()):console.error("厕所格子等级显示超限！")}}!function(t){t[t.maleToilet_1=0]="maleToilet_1",t[t.maleToilet_2=1]="maleToilet_2",t[t.maleToilet_3=2]="maleToilet_3",t[t.maleToilet_4=3]="maleToilet_4",t[t.maleToilet_5=4]="maleToilet_5",t[t.maleToilet_6=5]="maleToilet_6",t[t.femaleToilet_1=6]="femaleToilet_1",t[t.femaleToilet_2=7]="femaleToilet_2",t[t.femaleToilet_3=8]="femaleToilet_3",t[t.femaleToilet_4=9]="femaleToilet_4",t[t.femaleToilet_5=10]="femaleToilet_5",t[t.femaleToilet_6=11]="femaleToilet_6",t[t.femaleToilet_7=12]="femaleToilet_7",t[t.femaleToilet_8=13]="femaleToilet_8",t[t.femaleToilet_9=14]="femaleToilet_9",t[t.femaleToilet_10=15]="femaleToilet_10",t[t.femaleToilet_11=16]="femaleToilet_11",t[t.femaleToilet_12=17]="femaleToilet_12",t[t.maleSink=18]="maleSink",t[t.femaleSink=19]="femaleSink",t[t.waterRoom=20]="waterRoom",t[t.cleanRoom=21]="cleanRoom",t[t.library=22]="library",t[t.canteen=23]="canteen",t[t.waitArea=24]="waitArea",t[t.maleBlock_1=25]="maleBlock_1",t[t.maleBlock_2=26]="maleBlock_2",t[t.maleBlock_3=27]="maleBlock_3",t[t.maleBlock_4=28]="maleBlock_4",t[t.maleBlock_5=29]="maleBlock_5",t[t.maleBlock_6=30]="maleBlock_6",t[t.femaleBlock_1=31]="femaleBlock_1",t[t.femaleBlock_2=32]="femaleBlock_2",t[t.femaleBlock_3=33]="femaleBlock_3",t[t.femaleBlock_4=34]="femaleBlock_4",t[t.femaleBlock_5=35]="femaleBlock_5",t[t.femaleBlock_6=36]="femaleBlock_6",t[t.VendingMachine=37]="VendingMachine",t[t.peeArea=38]="peeArea",t[t.GuestUncle=39]="GuestUncle",t[t.NetRed=40]="NetRed"}(ss||(ss={})),function(t){t.config=class{},t.path="res/config/GuideInfo.json"}(as||(as={}));class La extends T{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new La),this._instance}initData(){this.m_dataList=as.dataList}}class va extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Guide","GuidePanel")}onConstruct(){this.m_guide=this.getControllerAt(0),this.m_layer=this.getControllerAt(1),this.m_windowsPos=this.getControllerAt(2),this.m_finger=this.getChildAt(2),this.m_window=this.getChildAt(4),this.m_pos2=this.getChildAt(5),this.m_pos3=this.getChildAt(6),this.m_pos=this.getChildAt(7),this.m_a=this.getChildAt(10),this.m_pos4=this.getChildAt(11),this.m_click=this.getChildAt(13),this.m_finger_npcLayer=this.getChildAt(16),this.m_text=this.getChildAt(19)}}va.URL="ui://09olrtmgujue0";class Aa extends xe{constructor(){super(),this.allowClick=!1,this._layer=Yt.Guide}static get instance(){return this.m_instance||(this.m_instance=new Aa,this.m_instance._classDefine=va),this.m_instance}_OnShow(){super.Show(),this.dataList=La.instance.dataList}MaskClick(){this.allowClick&&(68==Re.instance.Data.guideID&&(it.instance.eventUI(Nt.GuideToEnd),console.log("发送关闭引导信号")),this.allowClick=!1,it.instance.eventUI(Nt.GuideToNext))}NextPanel(t){let e=this.dataList[t].delay;this.ui.m_click.off(Laya.Event.CLICK,this,this.MaskClick),0!=e?(this.ui.m_layer.selectedIndex=0,this.ui.m_guide.selectedIndex=3,Laya.timer.once(e,this,this.SetPanel,[t])):this.SetPanel(t)}SetPanel(t){switch(Laya.timer.clearAll(this),this.ui.m_guide.selectedIndex=this.dataList[t].guideIndex,this.ui.m_layer.selectedIndex=this.dataList[t].layerIndex,1==this.ui.m_layer.selectedIndex?this.ui.m_windowsPos.selectedIndex=this.dataList[t].posIndex:(this.ui.m_text.text=this.dataList[t].text.i18n(),Laya.timer.once(500,this,()=>{this.allowClick=!0,this.ui.m_click.on(Laya.Event.CLICK,this,this.MaskClick)}),console.log(this.dataList[t].text.i18n())),t){case 31:this.ui.m_window.x=this.ui.m_pos.x,this.ui.m_window.y=this.ui.m_pos.y;break;case 34:this.ui.m_window.x=this.ui.m_pos2.x,this.ui.m_window.y=this.ui.m_pos2.y;break;case 36:this.ui.m_window.x=this.ui.m_pos.x,this.ui.m_window.y=this.ui.m_pos.y;break;case 39:this.ui.m_window.x=this.ui.m_pos3.x,this.ui.m_window.y=this.ui.m_pos3.y;break;case 41:this.ui.m_window.x=this.ui.m_pos.x,this.ui.m_window.y=this.ui.m_pos.y;break;case 67:this.ui.m_window.x=this.ui.m_pos4.x,this.ui.m_window.y=this.ui.m_pos4.y}}Close(){Be.instance.setUIState([{typeIndex:ee.Guide,state:!1}],!1)}_OnHide(){super.Hide()}}class xa extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("BuildUIPanel","PGameToiletPanel")}onConstruct(){this.m_stuffSwitch=this.getControllerAt(0),this.m_cleanRoomSwitch=this.getControllerAt(1),this.m_close=this.getChildAt(0),this.m_btn_up=this.getChildAt(1),this.m_btn_employee=this.getChildAt(2),this.m_topPanel=this.getChildAt(4),this.m_top_Title=this.getChildAt(5),this.m_rightBtn=this.getChildAt(6),this.m_leftBtn=this.getChildAt(9),this.m_slotList=this.getChildAt(12),this.m_midPanel=this.getChildAt(13),this.m_staffList=this.getChildAt(15)}}xa.URL="ui://vcw5trqln0pdw3";class ka extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("BuildUIPanel","StaffInfoPanel")}onConstruct(){this.m_StaffInfoBg=this.getChildAt(0),this.m_StaffInfo=this.getChildAt(1)}}ka.URL="ui://vcw5trqlgwsg2c2";class Pa extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("BuildUIPanel","PGameMarket")}onConstruct(){this.m_txx_countdownTime=this.getChildAt(4),this.m_list_Market=this.getChildAt(5),this.m_btn_close=this.getChildAt(6),this.m_btn_refresh=this.getChildAt(7)}}Pa.URL="ui://vcw5trqlb3xq2bc";class Da extends xe{constructor(){super(),this._layer=Yt.MarketPanel,this._runtimeReplaceWorkName=null}static get instance(){return this.m_instance||(this.m_instance=new Da,this.m_instance._classDefine=Pa),this.m_instance}_OnShow(){super._OnShow(),this.ui.m_btn_close.onClick(this,this.Close),this.ui.m_btn_refresh.onClick(this,this.OnWatchAdUpdateStaffInfo),this.RenderMarketStaffList(),it.instance.onUI(Nt.RenderMarketStaffList,this,this.RenderMarketStaffList),this.isGuide=!Re.IsCompleteAllGuide,it.instance.on(ae.UpdateOnLineTime,this,this.UpdateCountDownTime),Oe.trackEvent($t.StaffUI)}_OnHide(){super._OnHide(),this._runtimeReplaceWorkName=null,it.instance.offUI(Nt.RenderMarketStaffList,this,this.RenderMarketStaffList),it.instance.off(ae.UpdateOnLineTime,this,this.UpdateCountDownTime)}RenderMarketStaffList(){let t=$e.instance.GetMarketEmployeeList();this.ui.m_list_Market.itemRenderer=Laya.Handler.create(this,(e,i)=>{let s=t[e];i.m_loader_character.url=ge.GetEmployeeSprite(s),i.m_name.text=s.Name.i18n(),i.m_starNum.fillAmount=s.Level/4,i.m_sex.selectedIndex=0==s.Gender?0:1,i.m_skill.selectedIndex=0==s.Skill.length?0:1,i.m_btn_staffBuy.m_text_price.text=s.Price.toString(),s.Skill&&s.Skill.length>0&&(i.m_skillList.itemRenderer=Laya.Handler.create(this,(t,e)=>{let i=s.Skill[t];e.m_Title.text=i.Title.i18n(),e.m_text_desc.text=i.Desc.i18n(),e.m_sprite.url=ge.GetIconSprite(i.Type)},null,!1),i.m_skillList.numItems=s.Skill.length);let a=$e.ContainEmployee(s,$e.instance.Data.staffList);i.m_cutBtn.selectedIndex=a?2:1,a?i.m_btn_staffBuy.offClick(this,this.AddStaff):s.Price<=$e.instance.Data.money?(i.m_btn_staffBuy.grayed=!1,i.m_btn_staffBuy.touchable=!0,i.m_btn_staffBuy.onClick(this,this.AddStaff,[e])):(i.m_btn_staffBuy.grayed=!0,i.m_btn_staffBuy.touchable=!1)},null,!1),this.ui.m_list_Market.numItems=t.length}Close(){this.isGuide&&it.instance.eventUI(Nt.GuideToNext),Be.instance.setUIState([{typeIndex:ee.StaffMarket,state:!1}],!1)}AddStaff(t){let e=this._runtimeReplaceWorkName;this._runtimeReplaceWorkName=$e.instance.GetMarketEmployeeList()[t].Name,it.instance.eventUI(Nt.AddStaff,[t,e])}SetReplaceWorkerName(t){this._runtimeReplaceWorkName=t}OnWatchAdUpdateStaffInfo(){console.log("观看广告立即刷新雇员信息"),Os.instance.PlatformInstance.ShowRewardVideoAd(Laya.Handler.create(this,()=>{Qs.PlayAudio(),$e.instance.UpdateMarketList(),Oe.trackEvent($t.MarkertAD),this.isShow&&this.RenderMarketStaffList()}),Laya.Handler.create(this,()=>{Os.instance.PlatformInstance.ShowToast("未看完广告")}))}UpdateCountDownTime(){this.ui.m_txx_countdownTime.text=It.ToTimeString($e.data.workMarketTime)}}class Ua extends xe{constructor(){super(),this._layer=Yt.StaffInfoPanel}static get instance(){return this.m_instance||(this.m_instance=new Ua,this.m_instance._classDefine=ka),this.m_instance}get staff(){return this.ui.m_StaffInfo}_OnShow(){super._OnShow(),this.ui.m_StaffInfoBg.onClick(this,this.Close)}_OnHide(){super._OnHide(),this._runtimeData=null}InitPanel(t){this.staff.m_name.text=t.Name.i18n(),this.staff.m_starNum.fillAmount=t.Level/4,this.staff.m_cutBtn.selectedIndex=0,this.staff.m_loader_character.url=ge.GetEmployeeSprite(t),this.staff.m_sex.selectedIndex=0==t.Gender?0:1,this.staff.m_skill.selectedIndex=t.Skill&&t.Skill.length>0?1:0,1==this.staff.m_skill.selectedIndex&&(this.staff.m_skillList.itemRenderer=Laya.Handler.create(this,(e,i)=>{let s=t.Skill[e];i.m_sprite.url=s.Icon,i.m_Title.text=s.Title.i18n(),i.m_text_desc.text=s.Desc.i18n()},null,!1),this.staff.m_skillList.numItems=t.Skill.length),this.staff.m_btn_staffReplace.onClick(this,this.OpenMarketPanel)}ShowPanel(t){Be.instance.setUIState([{typeIndex:ee.StaffInfoPanel,state:!0}],!1),this._runtimeData=t,this.InitPanel(t)}Close(){Be.instance.setUIState([{typeIndex:ee.StaffInfoPanel,state:!1}],!1)}OpenMarketPanel(){let t=this._runtimeData.Name;Be.instance.setUIState([{typeIndex:ee.StaffInfoPanel,state:!1},{typeIndex:ee.StaffMarket,state:!0}],!1),Da.instance.SetReplaceWorkerName(t)}}class Ta extends xe{constructor(){super(),this.isGuide=!1,this._layer=Yt.ToiletPanel,this._currentSelectSlotIndex=0}static get instance(){return this.m_instance||(this.m_instance=new Ta,this.m_instance._classDefine=xa),this.m_instance}get _currBuilding(){return Ki.instance.building}get midPanel(){return this.ui.m_midPanel}Close(){Be.instance.setUIState([{typeIndex:ee.Staff,state:!1}],!1),this.isGuide&&(it.instance.eventUI(Nt.GuideToNext),console.log("Close Next Guide"))}GuideClose(){Be.instance.setUIState([{typeIndex:ee.Staff,state:!1}],!1)}get _runtimeSelectedSlot(){return this._currBuilding.slots[this._currentSelectSlotIndex]}_OnShow(){super.Show(),this.ui.m_close.onClick(this,this.Close),this.UpdateTitle(),this.ShowStaffOptionPanel(),this.UpdateTopPanel(),this.RenderSlotList(),this.midPanel.m_btn_up.onClick(this,this.OnClickUpdateBtn),this.midPanel.m_btn_buy.onClick(this,this.OnClickUpdateBtn),it.instance.onUI(Nt.UpdateSlotComplete,this,this.OnUpdateSlotComplete),it.instance.onUI(Nt.RenderMarketStaffList,this,this.RenderStaffList),it.instance.onUI(Nt.ShowCleanRoomStaff,this,this.ShowCleanRoomStaff),this.isGuide=!Re.IsCompleteAllGuide,this.ui.m_btn_employee.on(Laya.Event.CLICK,this,()=>{this.isGuide&&it.instance.eventUI(Nt.GuideToNext)}),Re.IsCompleteAllGuide&&this._currBuilding.OnClick()}_OnHide(){this._currentSelectSlotIndex=0,super.Hide(),it.instance.offUI(Nt.UpdateSlotComplete,this,this.RenderSlotList),it.instance.offUI(Nt.RenderMarketStaffList,this,this.RenderStaffList),Re.IsCompleteAllGuide&&this._currBuilding.OffClick()}OnUpdateSlotComplete(){this.RenderSlotList(),this.UpdateTopPanel()}RenderSlotList(){if(!this._currBuilding)throw new ye("当前所选建筑为空");{let t=this._currBuilding.slots;if(t&&t.length>0){let e=new fgui.Margin;if(e.top=20,e.left=20,this.ui.m_slotList.margin=e,this.ui.m_slotList.itemRenderer=Laya.Handler.create(this,(e,i)=>{let s=t[e];i.m_image.url=ce.instance.dataList[s.uid].url;let a=ce.instance.dataList[s.uid].maxLevel;i.m_bg.selectedIndex=s.level<=0?1:0,s.level<=0?(i.m_level.selectedIndex=0,i.m_state.selectedIndex=0):s.level<a&&(i.m_level.selectedIndex=1,i.m_state.selectedIndex=1,i.m_levelLable.m_title.text=s.level.toString()),s.level>=a&&(i.m_level.selectedIndex=2,i.m_state.selectedIndex=2),s.isBreaking&&(i.m_state.selectedIndex=3),i.offClick(this,this.SlotListButtonEvent),i.onClick(this,this.SlotListButtonEvent,[e])},null,!1),this._currBuilding.functionID==qt.MalePee){let t=Qe.instance.GetBuildDataByName(jt.maleToilet).count;this.ui.m_slotList.numItems=2*t}else this.ui.m_slotList.numItems=t.length}else console.error("建筑slot数据为空：",this._currBuilding)}this._currentSelectSlotIndex<0&&(this._currentSelectSlotIndex=0),this.UpdateMidPanel(this._currentSelectSlotIndex)}SlotListButtonEvent(t){this.UpdateMidPanel(t),this.isGuide&&it.instance.eventUI(Nt.GuideToNext)}ShowStaffOptionPanel(){this.ui.m_cleanRoomSwitch.selectedIndex=this._currBuilding.functionID==qt.CleanRoom?1:0,1==this.ui.m_cleanRoomSwitch.selectedIndex&&this.RenderStaffList()}RenderStaffList(){let t=$e.instance.Data.staffList,e=$e.instance.Data.staffSize;this.ui.m_staffList.itemRenderer=Laya.Handler.create(this,(i,s)=>{if(i<e){let e=t[i];e?(s.m_state.selectedIndex=0==e.Gender?1:2,s.m_Titile.text=e.Name.i18n(),s.m_img_starNum.fillAmount=e.Level/4,e.Skill&&e.Skill.length>0&&(s.m_list_skillicon.itemRenderer=Laya.Handler.create(this,(t,i)=>{i.m_sprite.url=ge.GetIconSprite(e.Skill[t].Type)},null,!1),s.m_list_skillicon.numItems=e.Skill.length),s.m_sprite.url=ge.GetEmployeeSprite(e),s.m_sprite.onClick(this,this.OpenStaffInfoPanel,[e])):(s.m_state.selectedIndex=3,s.m_Titile.text="",s.m_btn_AddStaff.onClick(this,this.OpenStaffMarket,["Open"])),s.m_btn_AD.offClick(this,this.OnWatchADAddStaffPosNum)}else s.m_state.selectedIndex=0,s.m_Titile.text="扩招",console.log("注册事件"),s.m_btn_AD.onClick(this,this.OnWatchADAddStaffPosNum)},null,!1),this.ui.m_staffList.numItems=8}OnWatchADAddStaffPosNum(){console.log("观看广告增加雇员的可用数量"),Os.instance.PlatformInstance.ShowRewardVideoAd(Laya.Handler.create(this,()=>{Qs.PlayAudio(),$e.instance.AddStaffPosNum(),Oe.trackEvent($t.AddStaffPosition),this.isShow&&this.RenderStaffList()}),Laya.Handler.create(this,()=>{Os.instance.PlatformInstance.ShowToast("未看完广告")}))}OpenStaffMarket(){Be.instance.setUIState([{typeIndex:ee.StaffMarket,state:!0}],!1),this.isGuide&&it.instance.eventUI(Nt.GuideToNext)}OpenStaffInfoPanel(t){Ua.instance.ShowPanel(t)}UpdateMidPanel(t){this.midPanel.m_txt_needWater.visible=!1,this._currentSelectSlotIndex=t;let e=this._currBuilding.slots,i=e[t];if(null==i)throw{one:e,two:t};let s=i.level;if(null==s)throw i;let a=i.uid,n=ce.instance.dataList[a].maxLevel;this.ui.m_midPanel.m_picture.url=ce.instance.dataList[a].url,this.midPanel.m_leftLevel.text=s.toString(),this.midPanel.m_levelProgress.text=s.toString()+"/"+n.toString(),this.midPanel.m_levelSlider.fillAmount=s/n;let o=me.instance.GetSlotConfigByUID(a),r=0==s?1:s+1,l=o[r=r>n?n:r],h=o[s];if(h||l?(h=h||{},l=l||{},this.UpdateBuffStateShow(s,r,h,l)):console.error("获取设备等级相关信息失败！",e),this.midPanel.m_btn_up.grayed=!1,this.midPanel.m_btn_up.touchable=!0,l)if(this.midPanel.m_text_mid_title.text=l.Name.i18n(),this.midPanel.m_text_mid_title_desc.text=l.Describe.i18n(),s>=n)this.midPanel.m_upState.selectedIndex=2;else if(l.updateCostCoin){this.midPanel.m_upState.selectedIndex=0,this.midPanel.m_btn_up.m_text_upCast.text=We.DoConverter(l.updateCostCoin),this.midPanel.m_btn_up.grayed=$e.Money<l.updateCostCoin,this.midPanel.m_btn_up.touchable=$e.Money>=l.updateCostCoin,$e.MaxWater-($e.Water-(h.updateCostWater?h.updateCostWater:0)+(l.updateCostWater?l.updateCostWater:0))<0&&this.midPanel.m_btn_up.touchable&&this._currBuilding.functionID!=qt.WaterRoom&&(this.midPanel.m_btn_up.grayed=!0,this.midPanel.m_btn_up.touchable=!1,this.midPanel.m_txt_needWater.visible=!0)}else l.updataCostDiamond?(this.midPanel.m_upState.selectedIndex=1,this.midPanel.m_btn_buy.m_text_price.text=l.updataCostDiamond.toString(),this.midPanel.m_btn_buy.m_btn_bg.grayed=$e.Diamond<l.updataCostDiamond,this.midPanel.m_btn_buy.touchable=$e.Diamond>=l.updataCostDiamond):console.error("配置表单元格名字错误，检查",i.name,l);t==this._currentSelectSlotIndex&&this.midPanel.m_btn_up.touchable&&(i.isBreaking?(this.midPanel.m_btn_up.grayed=!0,this.midPanel.m_btn_up.touchable=!1):(this.midPanel.m_btn_up.grayed=!1,this.midPanel.m_btn_up.touchable=!0))}UpdateBuffStateShow(t,e,i,s){if(i.updateCostWater||s.updateCostWater){this.midPanel.m_group_water.visible=!0,this.midPanel.m_text_water.text=null!=i.updateCostWater?i.updateCostWater.toString():"0";let a=(null!=i.updateCostWater?i.updateCostWater:0)-(null!=s.updateCostWater?s.updateCostWater:0);this.UpdateBuffAddState(t,e,this.midPanel.m_text_water_WaterAdd,-a)}else this.midPanel.m_group_water.visible=!1;null!=i.income||null!=s.income?(this.midPanel.m_bottomState.selectedIndex=ns.Money,this.midPanel.m_text_money.text=null!=i.income?i.income.toString():"0",this.UpdateBuffAddState(t,e,this.midPanel.m_text_money_MoneyAdd,s.income)):null!=i.Buff||null!=s.Buff?(this.midPanel.m_bottomState.selectedIndex=ns.time,this.midPanel.m_text_time.text=null!=i.Buff?i.Buff.toString():"0",this.UpdateBuffAddState(t,e,this.midPanel.m_text_time_timeSub,s.Buff)):null!=i.sweep_time||null!=s.sweep_time?(this.midPanel.m_bottomState.selectedIndex=ns.clean,this.midPanel.m_text_clean_Money.text=null!=i.sweep_time?i.sweep_time.toString():"0",this.UpdateBuffAddState(t,e,this.midPanel.m_text_clean_MoneyAdd,s.sweep_time)):null!=i.length||null!=s.length?(this.midPanel.m_bottomState.selectedIndex=ns.queue,this.midPanel.m_text_volume.text=null!=i.length?i.length.toString():"0",this.UpdateBuffAddState(t,e,this.midPanel.m_text_volume_volumeAdd,s.length)):null!=i.water_add||null!=s.water_add?(this.midPanel.m_group_water.visible=!0,this.midPanel.m_text_water_WaterAdd.visible=!1,this.midPanel.m_text_water.text=null!=i.water_add?i.water_add.toString():"0",this.midPanel.m_text_money.text="0",this.midPanel.m_text_money_MoneyAdd.text=""):null!=i.repair_time||null!=s.repair_time?(this.midPanel.m_bottomState.selectedIndex=ns.repair,this.midPanel.m_text_replace_time.text=null!=i.repair_time?i.repair_time.toString():"0",this.UpdateBuffAddState(t,e,this.midPanel.m_text_replace_timeSub,s.repair_time)):(console.log(s.sweep_time),console.log("尚未完成.."))}OnClickUpdateBtn(){let t=this._runtimeSelectedSlot.uid,e={slotIndex:this._currentSelectSlotIndex,building:this._currBuilding,uid:t};it.instance.eventUI(Nt.UpdateSlotData,e),this.isGuide&&(console.log("UpdateBtn Next Guide"),it.instance.eventUI(Nt.GuideToNext))}UpdateBuffAddState(t,e,i,s){t<e?(i.visible=!0,i.text=s>=0?"+"+s.toString():s.toString()):i.visible=!1}UpdateTopPanel(){let t=this._currBuilding,e=this._currBuilding.functionID,i=t.developProgress;switch(i>=1?(this.ui.m_topPanel.m_progress.selectedIndex=1,this.ui.m_topPanel.m_topProgress.value=100):(this.ui.m_topPanel.m_progress.selectedIndex=0,this.ui.m_topPanel.m_topProgress.value=100*i),e){case qt.MaleToilet:case qt.FemaleToilte:case qt.MalePee:case qt.FemaleSink:case qt.MaleSink:case qt.Library:case qt.Canteen:this.ui.m_topPanel.m_c1.selectedIndex=0,this.ui.m_topPanel.m_text_top_moneyAdd.text=t.income.toString()+"/分钟",this.ui.m_topPanel.m_text_top_time.text=t.duration.toString()+"s",this.ui.m_topPanel.m_text_top_water.text=t.wasteWater.toString();break;case qt.CleanRoom:let s=t;this.ui.m_topPanel.m_c1.selectedIndex=1,this.ui.m_topPanel.m_text_top_repairTime.text=s.cleanTime.toString(),this.ui.m_topPanel.m_text_top_cleanTime.text=s.sweepTime.toString(),this.ui.m_topPanel.m_text_top_stuffNum.text=s.staffNum.toString();break;case qt.WaterRoom:this.ui.m_topPanel.m_c1.selectedIndex=2,this.ui.m_topPanel.m_text_top_expendWater.text=t.waterAdd.toString();break;case qt.WaitAera:this.ui.m_topPanel.m_c1.selectedIndex=3;let a=t;this.ui.m_topPanel.m_text_top_ridership.text=a.flow.toString(),this.ui.m_topPanel.m_text_top_queueMan.text=a.maleQueueLength.toString(),this.ui.m_topPanel.m_text_top_queueWoman.text=a.femaleQueueLength.toString(),this.ui.m_topPanel.m_text_top_queuePee.text=a.peeQueueLength.toString();break;default:console.error("尚未此建筑设置更新统计显示!",e)}}UpdateTitle(){this.ui.m_top_Title.text=this._currBuilding.title}ShowCleanRoomStaff(){this.ui.m_stuffSwitch.selectedIndex=1,this.ui.m_cleanRoomSwitch.selectedIndex=1}}!function(t){t[t.Money=0]="Money",t[t.time=1]="time",t[t.clean=2]="clean",t[t.repair=3]="repair",t[t.queue=4]="queue",t[t.women=5]="women",t[t.pee=6]="pee",t[t.man=7]="man"}(ns||(ns={}));class Ra{constructor(){this.breakPoint=0,this.isGuideState=!1,this.allowDelay=!1,this.data=Re.instance.Data}static get instance(){return this.m_instance||(this.m_instance=new Ra),this.m_instance}StartGuide(){if(Fe.instance.enabled=!1,it.instance.onUI(Nt.GuideToNext,this,this.ToNext),it.instance.onUI(Nt.GuideToEnd,this,this.EndGuide),Ts.instance.PopNetRed(),0==this.data.isCompleteGuide1)this.data.guideID=0,this.data.isCompleteGuide1=!0,Re.instance.SaveData();else if(0==this.data.isCompleteGuide2)this.data.guideID=19,this.data.isCompleteGuide2=!0,Re.instance.SaveData();else if(0==this.data.isCompleteGuide3)this.data.guideID=36,this.data.isCompleteGuide3=!0,Re.instance.SaveData();else{if(0!=this.data.isCompleteGuide4)return this.data.isCompleteGuide5=!0,Re.instance.SaveData(),void this.EndGuide();this.data.guideID=43,this.data.isCompleteGuide4=!0,Re.instance.SaveData()}this.OpenGuide()}EndGuide(){console.log("完成所有引导关闭所有监听"),it.instance.offUI(Nt.GuideToNext,this,this.ToNext),it.instance.offUI(Nt.GuideToEnd,this,this.EndGuide),this.Close(),this.data.isCompleteGuide5=!0,Re.instance.SaveData(),Ts.instance.StartPop(),Be.instance.setUIState([{typeIndex:ee.CountDownTime,state:!0}],!1),Fe.instance.enabled=!0,ra.instance.ShowRecordBtn(!0),it.instance.event3D(A.OnUpdateSlotComplete),Oe.trackEvent($t.GuideProgress,{progress:"end"}),Oe.trackEvent($t.GuideEnd)}get guideID(){return this.data.guideID}set guideID(t){this.data.guideID=t}OpenGuide(){if(this.ShowPanel(ee.Guide),Aa.instance.isShow){if(console.log("引导"+this.guideID),!(this.guideID>68)){switch(this.guideID){case 27:Oe.trackEvent($t.GuideProgress,{progress:"UpdateGuestFlow"});break;case 35:Oe.trackEvent($t.GuideProgress,{progress:"BuildMaleToilet"})}switch(this.guideID){case 0:Ts.instance.PopGuideUncle();break;case 3:Fe.instance.enabled=!0;let t=Ds.instance.transform.position.clone();t.x=-t.x,Fe.instance.FocusPosition(t,!1,Laya.Handler.create(this,()=>{Ds.instance.Start()}));break;case 4:Fe.instance.enabled=!1;break;case 7:this.PlayIndicate(78787,ss.maleToilet_1);break;case 8:Ie.ClearAll(78787),Ki.instance.ShowRoom(qt.MaleToilet);break;case 17:Ds.instance.Continue();break;case 18:case 19:break;case 20:Ki.instance.ShowRoom(qt.MaleSink);break;case 24:this.PlayIndicate(242424,ss.waitArea),this.CameraNavigation(ss.waitArea);break;case 25:Ie.ClearAll(242424),Ki.instance.ShowRoom(qt.WaitAera);break;case 29:this.CameraNavigation(ss.NetRed);break;case 31:Ie.ClearAll(30303),this.ShowPanel(ee.UIMediatorInfluencer);break;case 33:this.CameraNavigation(ss.maleBlock_3),this.PlayIndicate(333333,ss.maleBlock_3);break;case 34:Ie.ClearAll(333333),this.ShowPanel(ee.Manager);break;case 35:break;case 36:this.ShowPanel(ee.DailySign);break;case 40:this.ShowPanel(ee.AD);break;case 43:this.PlayIndicate(434343,ss.cleanRoom),this.CameraNavigation(ss.cleanRoom);break;case 44:Ie.ClearAll(434343),Ki.instance.ShowRoom(qt.CleanRoom);break;case 51:return void this.Close();case 52:Ta.instance.isShow&&Ta.instance.GuideClose(),this.CameraNavigation(ss.maleToilet_1);break;case 53:Ki.instance.ShowRoom(qt.MaleToilet);break;case 62:Ta.instance.isShow&&Ta.instance.GuideClose(),this.PlayIndicate(636363,ss.waterRoom),this.CameraNavigation(ss.waterRoom);break;case 63:break;case 64:Ie.ClearAll(636363),Ki.instance.ShowRoom(qt.WaterRoom);break;case 66:Ta.instance.isShow&&Ta.instance.GuideClose();break;case 68:this.ShowPanel(ee.Task)}Aa.instance.NextPanel(this.guideID)}}else console.log("打开面板失败")}CameraNavigation(t){Fe.instance.enabled=!0,Fe.instance.FocusPositionByIndex(t),Laya.timer.once(500,this,()=>Fe.instance.enabled=!1)}ToNext(t=null){this.guideID=this.guideID+1,null!=t&&(this.guideID=5),19==this.guideID?this.data.isCompleteGuide2=!0:36==this.guideID?this.data.isCompleteGuide3=!0:43==this.guideID&&(this.data.isCompleteGuide4=!0),Re.instance.SaveData(),this.OpenGuide()}ShowPanel(t){t==ee.Guide&&Aa.instance.isShow||Be.instance.setUIState([{typeIndex:t,state:!0}],!1)}Close(){Be.instance.setUIState([{typeIndex:ee.Guide,state:!1}],!1),Aa.instance.isShow&&Aa.instance.Hide(),console.log("关闭引导面板")}PlayIndicate(t,e){let i=Le.instance.dataList[e],s=new Laya.Vector3(-i.x,i.y,i.z);Ie.PlayEffect(Bt.ZS,t,1e4,s)}}!function(t){t.GuideToNext="GuideToNext"}(os||(os={}));class Oa extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","PGameOfflineIncome")}onConstruct(){this.m_btn_close=this.getChildAt(4),this.m_text_money=this.getChildAt(6),this.m_progress=this.getChildAt(8),this.m_text_maxTime=this.getChildAt(9),this.m_text_time=this.getChildAt(10),this.m_btn_2x=this.getChildAt(12),this.m_btn_1x=this.getChildAt(13)}}Oa.URL="ui://8nmf3q47jfuc1b1";class Ma extends xe{constructor(){super(),this._layer=Yt.Main,this._money=0}static get instance(){return this.m_instance||(this.m_instance=new Ma,this.m_instance._classDefine=Oa),this.m_instance}get hasMoney(){return this._money>0}TryShowPanel(){(new Date).getTime()-$e.instance.Data.onLineTime<3e5||Be.instance.setUIState([{typeIndex:ee.OffLineIncomePanel,state:!0}],!1)}_OnShow(){let t=(new Date).getTime()-$e.instance.Data.onLineTime,e=60*$e.instance.Data.maxOffLineTime*60*1e3;this.ui.m_text_time.text=It.ToTimeString(t),this.ui.m_text_maxTime.text="上限"+$e.instance.Data.maxOffLineTime+"个小时";let i=t>e?e:t;this.ui.m_progress.value=i,this.ui.m_progress.max=e,this._money=Je.instance.GetTotalMoney(),this._money=this._money*i/1e3/60,this.ui.m_text_money.text=We.DoConverter(this._money),this.ui.m_btn_1x.onClick(this,this.OnClick1x),this.ui.m_btn_2x.onClick(this,this.OnClick2x),this.ui.m_btn_close.onClick(this,this.OnClickClose);let s=new ki;Ms.instance.showBannerFun(s)}OnClick1x(){this.AddMoney()}OnClick2x(){Os.instance.PlatformInstance.ShowRewardVideoAd(Laya.Handler.create(this,()=>{Qs.PlayAudio(),this.AddMoney(!0)}),Laya.Handler.create(this,()=>{Os.instance.PlatformInstance.ShowToast("未看完广告")}))}AddMoney(t=!1){t&&(this._money+=this._money),$e.Money+=this._money,this.isShow&&Ki.PlayMoneyEffect(this.ui.m_text_money),this._money=0,this.OnClickClose()}OnClickClose(){Be.instance.setUIState([{typeIndex:ee.OffLineIncomePanel,state:!1}],!1),Ms.instance.DestroyAd()}}class Ea{Init(t,e){if(null==t||null==e)throw new ye;let i=Lt.instance.camera;this._prefabs=e,hs.instance.SetPrefabs(e),this.InitVendingMachine(),i.addComponent(Ie).InitAllPrefabs(),ba.instance.InitBlockAnimator(this._prefabs[Et.prefab5.Male_wall][0],this._prefabs[Et.prefab5.Female_wall][0]),this._buildManager=i.addComponent(Je),this._buildManager.SetPrefabs(e);let s=i.addComponent(Ts);i.addComponent(Fe).Init(this._prefabs[Et.prefab5.Limit][0]),Ki.instance.Init(),he.instance.init(),oe.NetMap.instance.InitData(jt.MapRoot),s.SetParentNode(t),s.InitPool(e[Et.prefab5.Entrance],e[Et.prefab5.Exit]),Re.IsCompleteAllGuide&&s.StartPop(),ks.instance.InitTask(),this.InitBuildings(ca,Et.prefab0.Toilet,ci.data.list),this.InitBuildings(ha,Et.prefab0.FamaleSink,[ri.instance.femaleSinkData]),this.InitBuildings(ha,Et.prefab0.MaleSink,[ri.instance.maleSinkData]),this.InitBuildings(la,Et.prefab5.CleanRoom,[ai.instance.data.list]),this.InitBuildings(da,Et.prefab0.WaitAera,[ui.instance.data.list]),this.InitBuildings(ua,Et.prefab0.PeeArea,[Ss.instance.data.list]),this.InitBuildings(ya,Et.prefab0.Library,[Ia.instance.data.list]),this.InitBuildings(wa,Et.prefab0.Canteen,[Ns.instance.data.list]),this.InitBuildings(Ca,Et.prefab0.WaterRoom,[_s.instance.data.list]),it.instance.event3D(A.SceneLoadComplete),this.InitGuide(),Ye.instance.Start(),Laya.timer.once(200,this,()=>{this.ShowDailyPanel(),this.ShowOfflineIncomePanel(),this.ShowCountDownTime()}),Qs.PlayAudio(),Re.IsCompleteAllGuide&&$e.instance.UpdateIncomeMin()}GetSpriteByName(t,e){if(null==t||null==e||0==e.length)return null;for(const i of e)if(i.name==t)return i}InitBuildings(t,e,i){let s=this._prefabs[e];if(null==s||s.length<=0)console.warn("场景中没有",e,",跳过此项初始化");else{if(!(i&&i.length>0))throw new ye(e+"数据为null");for(let a of i){let i=this.GetSpriteByName(a.name,s);if(i){let e=i.addComponent(t);e.InitBuilding(a,!1),this._buildManager.AddBuild(e,a.functionID)}else console.warn("添加脚本失败,预制体名字",e,",建筑名字:",a.name,"预制体数组:",s)}}}InitVendingMachine(){this._prefabs[Et.prefab5.VendingMachine][0].addComponent(ma)}InitGuide(){Re.IsCompleteAllGuide?console.log("引导完成",Re.IsCompleteAllGuide):(console.log("开始引导"),Oe.trackEvent($t.GuideStart),Ra.instance.StartGuide())}ShowOfflineIncomePanel(){Re.IsCompleteAllGuide&&Ma.instance.TryShowPanel()}ShowDailyPanel(){Re.IsCompleteAllGuide&&($e.data.hasSign||Be.instance.setUIState([{typeIndex:ee.DailySign,state:!0}],!1))}ShowCountDownTime(){let t=Ns.instance.data.list.active;Re.IsCompleteAllGuide&&!t&&Be.instance.setUIState([{typeIndex:ee.CountDownTime,state:!0}],!1)}}class Ba{constructor(){this.m_ifInit=!1,this.m_otherScene={}}static get instance(){return this.m_instance||(this.m_instance=new Ba),this.m_instance}get ifSceneBuild(){return this.m_ifSceneBuild}init(){this.m_ifSceneBuild=!1,ut.initCustoms(O.instance.getLevelNumber()),it.instance.on3D(A.GameLevelsBuild,this,this.gameLevelsBuild),it.instance.on3D(A.GameLevelsDelete,this,this.gameLevelsDelete),it.instance.on3D(A.GameOtherLevelsBuild,this,this.gameOtherLevelsBuild),it.instance.on3D(A.GameOtherLevelsDelete,this,this.gameOtherLevelsDelete)}initLevelBuild(){this.gameLevelsBuild()}gameLevelsBuild(t){if(this.m_ifSceneBuild)return void console.warn("有场景正在构建！");let i;this.m_ifInit?i=ut.gameData.onCustoms:(this.m_ifInit=!0,i=ut.getDefaultCustoms());let s=G.instance.getSceneByLv(i);this.m_scene=s,this.m_ifSceneBuild=!0,it.instance.event3D(A.GameLevelsBuildBefore),it.instance.eventUI(Nt.SceneGameCustomsLoading,[-1]),s.buildScene(Laya.Handler.create(this,this.customsProgress,null,!1)).then(a=>{if(this.m_ifSceneBuild=!1,Lt.instance.setEnvironment(this.m_scene.scene),e.addScrCon(s.scene),e.addCommonCon(),N.ifPreloadCustoms){let t=ut.getPreloadCustoms();G.instance.preloadSceneRes(t)}this.onCustomsInit(i),t&&t.run(),(new Ea).Init(s.scene,s.prefabs),it.instance.event3D(A.GameLevelsOnBuild),it.instance.eventUI(Nt.SceneGameCustomsInit)})}onCustomsInit(t){}customsProgress(t){this.m_ifSceneBuild&&(void 0===t&&(t=1),it.instance.eventUI(Nt.SceneGameCustomsLoading,[100*t]))}gameLevelsDelete(){it.instance.event3D(A.GameLevelsDeleteBefore),this.m_scene&&this.m_scene.scene&&this.m_scene.clearScene(),this.m_scene=null,it.instance.event3D(A.GameLevelsOnDelete),it.instance.eventUI(Nt.SceneGameCustomDelete)}gameOtherLevelsBuild(t,e){if(this.m_ifSceneBuild)return void console.warn("有场景正在构建！");let i=G.instance.getOtherSceneByName(t);this.m_otherScene[t]=i,this.m_ifSceneBuild=!0,it.instance.event3D(A.GameLevelsBuildBefore),it.instance.eventUI(Nt.SceneGameCustomsLoading,[-1]),i.buildScene(Laya.Handler.create(this,this.customsProgress,null,!1)).then(s=>{this.m_ifSceneBuild=!1,Lt.instance.setOtherEnvironment(t,s),Gt.instance.AllotOtherScenePre(t,i.prefabs),e&&e.run()})}gameOtherLevelsDelete(t){let e=this.m_otherScene[t];e?(e.clearScene(),this.m_otherScene[t]=void 0):console.warn("试图清除不存在的场景！")}}class Ga extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGameLoading")}onConstruct(){this.m_shade=this.getChildAt(0),this.m_text=this.getChildAt(1),this.m_progress=this.getChildAt(2)}}Ga.URL="ui://kk7g5mmmg7a1o";class Na extends xe{constructor(){super(),this._layer=Yt.Loading}static get instance(){return this.m_instance||(this.m_instance=new Na,this.m_instance._classDefine=Ga),this.m_instance}_OnShow(){it.instance.onGlobal(te.GameLoading,this,this.gameLoading)}gameLoading(t){this.ui.m_progress.value=t}_OnHide(){it.instance.offGlobal(te.GameLoading,this,this.gameLoading)}}class Fa extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGamePlay")}onConstruct(){this.m_text=this.getChildAt(0)}}Fa.URL="ui://kk7g5mmmg7a1r";class Va extends xe{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new Va,this.m_instance._classDefine=Fa),this.m_instance}_OnShow(){}_OnHide(){}}class Wa extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGameStart")}onConstruct(){this.m_text=this.getChildAt(0)}}Wa.URL="ui://kk7g5mmmg7a1v";class ja extends xe{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new ja,this.m_instance._classDefine=Wa),this.m_instance}_OnShow(){}_OnHide(){}}class qa extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGameCustomsLoading")}onConstruct(){this.m_shade=this.getChildAt(0),this.m_text=this.getChildAt(1),this.m_progress=this.getChildAt(2)}}qa.URL="ui://kk7g5mmmnsx3ou";class Ha extends xe{constructor(){super(),this._layer=Yt.Loading}static get instance(){return this.m_instance||(this.m_instance=new Ha,this.m_instance._classDefine=qa),this.m_instance}_OnShow(){it.instance.onUI(Nt.SceneGameCustomsLoading,this,this.CustomsLoading)}CustomsLoading(t){this.ui.m_progress.value=t,100==t&&Be.instance.setUIState([{typeIndex:ee.CustomsLoading,state:!1}],!1)}_OnHide(){it.instance.offUI(Nt.SceneGameCustomsLoading,this,this.CustomsLoading)}}class za extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGamePause")}onConstruct(){this.m_text=this.getChildAt(0)}}za.URL="ui://kk7g5mmm6vcq5g";class Qa extends xe{constructor(){super(),this._layer=Yt.Pause}static get instance(){return this.m_instance||(this.m_instance=new Qa,this.m_instance._classDefine=za),this.m_instance}_OnShow(){}_OnHide(){}}class Ja extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGameSetting")}onConstruct(){this.m_text=this.getChildAt(0)}}Ja.URL="ui://kk7g5mmm6vcq4u";class Ka extends xe{constructor(){super(),this._layer=Yt.Set}static get instance(){return this.m_instance||(this.m_instance=new Ka,this.m_instance._classDefine=Ja),this.m_instance}_OnShow(){}_OnHide(){}}class Za extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGameCom")}onConstruct(){this.m_text=this.getChildAt(0)}}Za.URL="ui://kk7g5mmmq3ng9w";class Ya extends xe{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new Ya,this.m_instance._classDefine=Za),this.m_instance}_OnShow(){}_OnHide(){}}class Xa extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGameEnd")}onConstruct(){this.m_text=this.getChildAt(0)}}Xa.URL="ui://kk7g5mmmlaxd19";class $a extends xe{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new $a,this.m_instance._classDefine=Xa),this.m_instance}_OnShow(){}_OnHide(){}}class tn extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGameTestMain")}onConstruct(){this.m_test=this.getChildAt(0),this.m_testText=this.getChildAt(1),this.m__test=this.getChildAt(2)}}tn.URL="ui://kk7g5mmmo9js9x";class en extends xe{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new en,this.m_instance._classDefine=tn),this.m_instance}_OnShow(){this.ui.m_test.onClick(this,this.Test)}Test(){Be.instance.setUIState([{typeIndex:ee.TestPlatform}],!1)}_OnHide(){}}class sn extends xi{constructor(){super(...arguments),this.appId="",this.appKey="",this.bannerId="",this.rewardVideoId="",this.interstitialId="",this.nativeId="",this.nativeBannerIds=[],this.nativeIconIds=[],this.nativeinterstitialIds=[],this.nativeinpageIds=[],this.shareId=""}}class an extends xi{constructor(){super(...arguments),this.appId="",this.appKey="",this.bannerId="",this.rewardVideoId="",this.interstitialId="",this.nativeId="",this.nativeBannerIds=[],this.nativeIconIds=[],this.nativeinterstitialIds=[],this.nativeinpageIds=[],this.shareId=""}}class nn extends xi{constructor(){super(...arguments),this.appId="",this.appKey="",this.bannerId="",this.rewardVideoId="",this.interstitialId="",this.nativeId="",this.nativeBannerIds=[],this.nativeIconIds=[],this.nativeinterstitialIds=[],this.nativeinpageIds=[],this.shareId=""}}class on extends xi{constructor(){super(...arguments),this.appId="",this.appKey="",this.bannerId="",this.rewardVideoId="",this.interstitialId="",this.nativeId="",this.nativeBannerIds=[],this.nativeIconIds=[],this.nativeinterstitialIds=[],this.nativeinpageIds=[],this.shareId=""}}class rn extends xi{constructor(){super(...arguments),this.appId="tt6bd21d6ff4e96e09",this.appKey="",this.bannerId="2cm4be1lhe2j98rt00",this.rewardVideoId="15i65j26gjj19l0bca",this.interstitialId="4b2q73lp8i89nglf7p",this.nativeId="",this.nativeBannerIds=[],this.nativeIconIds=[],this.nativeinterstitialIds=[],this.nativeinpageIds=[],this.shareId=""}}class ln extends xi{constructor(){super(...arguments),this.appId="wx3fe7c138d80bcddb",this.appKey="",this.bannerId="adunit-5536ac3ed2ab7c7c",this.rewardVideoId="adunit-441ef577c2eb1442",this.interstitialId="adunit-280c0055a1f9d458",this.nativeId="",this.nativeBannerIds=[],this.nativeIconIds=[],this.nativeinterstitialIds=[],this.nativeinpageIds=[],this.shareId=""}}!function(t){t.PAUSE_AUDIO="PAUSE_AUDIO",t.RESUM_AUDIO="RESUM_AUDIO",t.AD_CONFIG_GETTED="AD_CONFIG_GETTED",t.SELF_AD_INITED="SELF_AD_INITED"}(rs||(rs={}));class hn{Vibrate(t){console.log("调用震动",t),navigator.vibrate?t?navigator.vibrate(400):navigator.vibrate(15):console.log("不支持设备震动！")}}class cn extends hn{Vibrate(t){console.log("调用震动",t),window.wx&&(t?Laya.timer.callLater(wx,wx.vibrateLong,[null]):Laya.timer.callLater(wx,wx.vibrateShort,[null]))}}class dn{constructor(){this.supportRecord=!1,this.isRecording=!1,this.isPausing=!1,this.isRecordSuccess=!1}StartRecord(t,e){console.log("该平台"+Os.platformStr+"不支持录制视频")}StopRecord(t){console.log("该平台"+Os.platformStr+"不支持录制视频")}Pause(t){console.log("该平台"+Os.platformStr+"不支持录制视频")}Resume(t){console.log("该平台"+Os.platformStr+"不支持录制视频")}RecordClip(t){console.log("该平台"+Os.platformStr+"不支持录制视频")}ShareVideo(t,e,i){i&&i.run()}}class un{}class mn{constructor(){this._shareInfoList=[]}static get instance(){return null==this._instance&&(this._instance=new mn),this._instance}AddShareInfo(t){for(let e of this._shareInfoList)if(e.shareId==t.shareId)return;this._shareInfoList.push(t)}GetShareInfo(t=null){if(0==this._shareInfoList.length){return new un}if(null!=t)for(let e of this._shareInfoList)if(e.shareId==t)return e;return Si.RandomFromArray(this._shareInfoList)}ShareAppMessage(t){Os.instance.PlatformInstance.ShareAppMessage(t,Laya.Handler.create(this,()=>{console.log("分享成功")}),null)}}class _n{constructor(){this.platform=Xi.WX,this.safeArea=null,this.recordManager=new dn,this.device=new cn,this.loginCode=null,this.isSupportJumpOther=!0,this._isBannerLoaded=!1,this._isVideoLoaded=!1,this._isInterstitialLoaded=!1,this._cacheVideoAD=!1,this.NavigateToAppSuccess=null}Init(t){this._base=window.wx,null!=this._base?(this.platformData=t,this.recordManager.Platform=this,this._InitLauchOption(),this._Login(),this._InitShareInfo(),this._InitSystemInfo(),this._CreateBannerAd(),this._CreateVideoAd(),this._CreateInterstitalAd(),window.iplatform=this):console.error(...s.packError("平台初始化错误",Os.platformStr))}_CheckUpdate(){let t=this._base.getUpdateManager();null!=t&&(t.onCheckForUpdate(function(t){console.log("onCheckForUpdate",t.hasUpdate),t.hasUpdate&&this._base.showToast({title:"即将有更新请留意"})}),t.onUpdateReady(()=>{this._base.showModal({title:"更新提示",content:"新版本已经准备好，是否立即使用？",success:function(e){e.confirm?t.applyUpdate():this._base.showToast({icon:"none",title:"小程序下一次「冷启动」时会使用新版本"})}})}),t.onUpdateFailed(()=>{this._base.showToast({title:"更新失败，下次启动继续..."})}))}_Login(){this.loginState={isLogin:!1,code:""};let t={};t.success=(t=>{this.loginCode=t.code,this._OnLoginSuccess(t),console.error(this.loginState)}),t.fail=(t=>{console.error(Os.platformStr,"登录失败",t),this.loginState.isLogin=!1,this.loginState.code=""}),t.complete=(()=>{null!=this.onLoginEnd&&this.onLoginEnd.run()}),this._base.login(t)}GetStorage(t){if(this.base&&this.base.getStorageSync&&t)try{return this.base.getStorageSync(t)}catch(t){return console.log("getStorageSync error: ",JSON.stringify(t)),null}}SetStorage(t,e){if(this.base&&this.base.getStorageSync&&t)try{return this.base.setStorageSync(t,e)}catch(t){console.log("setStorageSync error: ",JSON.stringify(t))}}_OnLoginSuccess(t){console.log(Os.platformStr,"登录成功",t),this.loginState.isLogin=!0,this.loginState.code=t.code}_InitLauchOption(){this._base.onShow(this._OnShow),this._base.onHide(this._OnHide);let t=this._base.getLaunchOptionsSync();this._OnShow(t)}_InitShareInfo(){this._base.showShareMenu({withShareTicket:!0,success:t=>{console.log("InitShareSuccess",t)},fail:t=>{console.log("InitShareFailed",t)},complete:t=>{console.log("InitShareComplete",t)}}),this._base.onShareAppMessage(()=>{let t=mn.instance.GetShareInfo();return _n._WrapShareInfo(t)})}static _WrapShareInfo(t){let e={};if(t.shareTitle&&(e.title=t.shareTitle),t.shareImg&&(e.imageUrl=t.shareImg),t.sharePath){e.query={};let i=t.sharePath.split("?")[1].split("&");for(let t of i){let i=t.split("=");e.query[i[0]]=i[1]}}return e}_InitSystemInfo(){this.base=this._base;try{this.systemInfo=this._base.getSystemInfoSync(),console.log("系统信息已获取",this.systemInfo),this.safeArea=this.systemInfo.safeArea,this._cacheScreenScale=this.systemInfo.screenWidth/Laya.stage.width}catch(t){console.error(t),console.error("获取设备信息失败,执行默认初始化"),this.safeArea=null}}_CreateInterstitalAd(){if(at.IsNullOrEmpty(this.platformData.interstitialId))return void console.log("无有效的插页广告ID,取消加载");this._interstitalFailedCount=0;let t={};t.adUnitId=this.platformData.interstitialId,this._intersitialAd=this._base.createInterstitialAd(t),this._intersitialAd&&(this._intersitialAd.onLoad(()=>{console.log("插页广告加载成功"),this._isInterstitialLoaded=!0}),this._intersitialAd.onError(t=>{this._interstitalFailedCount++,console.error("插页广告加载失败",t),this._interstitalFailedCount>10&&(console.log("第",this._interstitalFailedCount,"次重新加载插页广告"),this._intersitialAd.load())}))}_CreateVideoAd(){if(console.log("vedio ad id",this.platformData.rewardVideoId),!this._cacheVideoAD)return void console.log("当前策略为不缓存视频广告");let t=this._base.createRewardedVideoAd;if(null==t)return void console.error("无createRewardedVideoAd方法,跳过初始化");if(at.IsNullOrEmpty(this.platformData.rewardVideoId))return void console.log("无有效的视频广告ID,取消加载");this._videoFailedCount=0;let e={};e.adUnitId=this.platformData.rewardVideoId,this._rewardVideo=t(e),this._rewardVideo.onLoad(()=>{console.log("视频广告加载成功"),this._isVideoLoaded=!0}),this._rewardVideo.onError(t=>{this._videoFailedCount++,console.error("视频广告加载失败",t),this._videoFailedCount>10&&(console.log("第",this._videoFailedCount,"次重新加载视频广告"),this._rewardVideo.load())}),this._rewardVideo.onClose(t=>{Laya.stage.event(rs.RESUM_AUDIO),console.log("视频回调",t);let e=t.isEnded;yi.NextFrame().then(()=>{e?this._rewardSuccessed&&this._rewardSuccessed.run():this._rewardSkipped&&this._rewardSkipped.run()})})}_CreateBannerAd(){if(at.IsNullOrEmpty(this.platformData.bannerId))return void console.log("无有效的banner广告ID,取消加载");let t=this._base.getSystemInfoSync().windowWidth,e=this._base.getSystemInfoSync().windowHeight,i={};i.adUnitId=this.platformData.bannerId,i.adIntervals=30;let s={left:0,top:0,width:300};i.style=s,this._bannerAd=this._base.createBannerAd(i),this._isBannerLoaded=!1,this._bannerAd.onLoad(()=>{console.log("banner加载成功"),this._isBannerLoaded=!0,this._bannerAd.style.top=e-this._bannerAd.style.realHeight,this._bannerAd.style.left=(t-this._bannerAd.style.realWidth)/2}),this._bannerAd.onError(t=>{console.error("banner广告加载失败",t)})}IsBannerAvaliable(){return this._isBannerLoaded}IsVideoAvaliable(){return this._isVideoLoaded}IsInterstitalAvaliable(){return this._isInterstitialLoaded}ShowBannerAd(){this.IsBannerAvaliable()&&this._bannerAd.show()}HideBannerAd(){this._bannerAd.hide()}_DoCacheShowVideo(t,e){this._isVideoLoaded?(this._rewardSuccessed=t,this._rewardSkipped=e,this._isVideoLoaded=!1,Laya.stage.event(rs.PAUSE_AUDIO),this._rewardVideo.show()):console.error("视频广告尚未加载好")}_DoNoCacheShowVideo(t,e){if(this._rewardSuccessed=t,this._rewardSkipped=e,at.IsNullOrEmpty(this.platformData.rewardVideoId))return console.log("无有效的视频广告ID,取消加载"),void e.run();let i=this._base.createRewardedVideoAd;if(null==i)return console.error("无createRewardedVideoAd方法,跳过初始化"),void e.run();this._videoFailedCount=0;let s={};s.adUnitId=this.platformData.rewardVideoId,this._rewardVideo&&this._rewardVideo.offClose(this.onVideoClose),this._rewardVideo=i(s),this._rewardVideo.onLoad(()=>{console.log("视频广告加载成功"),this._isVideoLoaded=!0}),this._rewardVideo.onError(t=>{this._videoFailedCount++,console.error("视频广告加载失败",t,this._videoFailedCount)}),this._rewardVideo.onClose(t=>{Laya.stage.event(rs.RESUM_AUDIO),console.log("视频回调",t);let e=t.isEnded;yi.NextFrame().then(()=>{e?this._rewardSuccessed&&this._rewardSuccessed.run():this._rewardSkipped&&this._rewardSkipped.run()})}),this._rewardVideo.load().then(()=>(console.log("激励视频 加载成功"),this._rewardVideo.show().then(()=>{}).catch(t=>{console.error(t)})))}onVideoClose(t){Laya.stage.event(rs.RESUM_AUDIO),console.log("视频回调",t);let e=t.isEnded;yi.NextFrame().then(()=>{e?this._rewardSuccessed&&this._rewardSuccessed.run():this._rewardSkipped&&this._rewardSkipped.run()})}ShowRewardVideoAd(t,e){this._cacheVideoAD?this._DoCacheShowVideo(t,e):this._DoNoCacheShowVideo(t,e)}ShowRewardVideoAdAsync(){return new Promise(function(t){Os.instance.PlatformInstance.ShowRewardVideoAd(Laya.Handler.create(this,()=>{t(!0)}),Laya.Handler.create(this,()=>{t(!1)}))})}ShowInterstitalAd(){this._isInterstitialLoaded?this._intersitialAd.show():console.error("插页广告尚未加载好")}GetFromAppId(){return null==this.lauchOption.referrerInfo?null:at.IsNullOrEmpty(this.lauchOption.referrerInfo.appId)?null:this.lauchOption.referrerInfo.appId}_OnShow(t){console.log(Os.platformStr,"OnShow",t),Os.instance.PlatformInstance.lauchOption=t,Os.instance.PlatformInstance._CheckUpdate(),this.NavigateToAppSuccess=null,yi.NextFrame().then(()=>{Os.instance.PlatformInstance.onResume&&Os.instance.PlatformInstance.onResume.runWith(t)})}_OnHide(t){console.log(Os.platformStr,"OnHide",t),Os.instance.PlatformInstance.onPause&&Os.instance.PlatformInstance.onPause.runWith(t),this.NavigateToAppSuccess&&this.NavigateToAppSuccess()}ShareAppMessage(t,e,i){console.log("分享消息",t);let s=_n._WrapShareInfo(t);this._base.shareAppMessage(s),e&&e.run()}LoadSubpackage(t,e,i,s){if(null==this._base.loadSubpackage)return console.log("无加载子包方法,跳过加载子包",t),void(e&&e.run());let a={};a.name=t,a.success=(()=>{console.log("分包加载成功",t),e&&e.run()}),a.fail=(()=>{console.error("分包加载失败",t),i&&i.run()}),this._base.loadSubpackage(a).onProgressUpdate(t=>{Laya.Browser.onMobile&&console.log("分包加载进度",t),s&&s.runWith(t.progress/100)})}RecordEvent(t,e){console.log("记录事件",t,e);let i=this._base.aldSendEvent;null!=i?null!=e?i(t,e):i(t):console.error("阿拉丁sdk尚未接入,请检查配置")}CreateShareVideoBtn(t,e,i,s){let a={};a.style={left:t*this._cacheScreenScale,top:e*this._cacheScreenScale,height:s*this._cacheScreenScale,width:i*this._cacheScreenScale},a.share={query:{tick:1},bgm:"",timeRange:[0,6e4]},null==this._shareVideoBtn?this._shareVideoBtn=this._base.createGameRecorderShareButton(a):this._shareVideoBtn.show()}HideShareVideoBtn(){null!=this._shareVideoBtn&&this._shareVideoBtn.hide()}ShowToast(t){this._base.showToast({title:t,duration:2e3})}OpenGameBox(t){console.error("当前平台",Os.platformStr,"暂不支持互推游戏盒子")}NavigateToApp(t,e,i,s,a,n){return new Promise((s,a)=>{wx.navigateToMiniProgram({appId:t,path:e,extraData:i,envVersion:"",success:t=>{console.log("小游戏跳转成功",t),s(!0)},fail:()=>{console.log("小游戏跳转失败："),a(!1)},complete:()=>{}})})}createShortcut(){console.log("暂未实现")}}class gn extends _n{constructor(){super(...arguments),this.platform=Xi.BD,this._showVideoLoad=!1}Init(t){this._base=window.swan,null!=this._base?(this.platformData=t,this.recordManager.Platform=this,this._InitLauchOption(),this._InitShareInfo(),this._InitSystemInfo(),this._isBannerLoaded=!1,this._isBannerShowed=!1,this._CreateVideoAd(),this._CreateInterstitalAd(),window.iplatform=this):console.error(...s.packError("平台初始化错误"))}_CreateBannerAd(){if(at.IsNullOrEmpty(this.platformData.bannerId))return void console.log("无有效的banner广告ID,取消加载");let t=this._base.getSystemInfoSync().windowWidth,e=this._base.getSystemInfoSync().windowHeight,i={};i.adUnitId=this.platformData.bannerId,i.appSid=this.platformData.sid;let s={left:0,top:0};s.width=t,i.style=s,this._bannerAd=this._base.createBannerAd(i),this._bannerAd.onLoad(()=>{console.log("banner加载成功"),this._isBannerLoaded=!0,this._bannerAd.style.top=e-this._bannerAd.style.height,this._bannerAd.show()}),this._bannerAd.onError(t=>{console.error("banner广告加载失败",t)})}_CreateVideoAd(){if(at.IsNullOrEmpty(this.platformData.rewardVideoId))return void console.log("无有效的视频广告ID,取消加载");this._videoFailedCount=0;let t={};t.adUnitId=this.platformData.rewardVideoId,t.appSid=this.platformData.sid,this._rewardVideo=this._base.createRewardedVideoAd(t),this._rewardVideo.onLoad(()=>{console.log("视频广告加载成功"),this._isVideoLoaded=!0}),this._rewardVideo.onError(t=>{this._videoFailedCount++,console.error("视频广告加载失败",t),this._videoFailedCount>10&&(console.log("第",this._videoFailedCount,"次重新加载视频广告"),this._rewardVideo.load())}),this._rewardVideo.onClose(t=>{this._base.hideLoading(),Laya.stage.event(rs.RESUM_AUDIO),console.log("视频回调",t),t.isEnded?this._rewardSuccessed&&this._rewardSuccessed.run():this._rewardSkipped&&this._rewardSkipped.run(),this._rewardVideo.load()})}_CreateInterstitalAd(){}LoadSubpackage(t,e,i,s){let a={};a.name=t,a.success=(()=>{console.log("分包加载成功",t),e&&e.run()}),a.fail=(()=>{console.error("分包加载失败",t),i&&i.run()}),this._base.loadSubpackage(a).onProgressUpdate(t=>{if(s){let e=t.progress/100;isNaN(e)&&(e=t.loaded/t.total),s.runWith(e)}})}RecordEvent(t,e){this._base.reportAnalytics(t,e)}ShowBannerAd(){this._isBannerLoaded||this._CreateBannerAd()}HideBannerAd(){this._isBannerLoaded&&(this._isBannerLoaded=!1,this._bannerAd&&this._bannerAd.destroy())}}class pn extends dn{constructor(){super(...arguments),this.supportRecord=!1}ShareVideo(t,e,i){this.supportRecord?(console.log("强制模拟成功"),t&&t.run()):(console.log("强制模拟失败"),i&&i.run())}}class fn{constructor(){this.platform=Xi.Web,this.safeArea=null,this.recordManager=new pn,this.device=new hn,this.systemInfo=null,this.isSupportJumpOther=!0}Init(t){this.loginState={isLogin:!1,code:null},this.recordManager.Platform=this,Laya.timer.once(500,this,this._FakeLoginEnd)}_FakeLoginEnd(){this.onLoginEnd&&this.onLoginEnd.run()}IsBannerAvaliable(){return!1}IsVideoAvaliable(){return!0}IsInterstitalAvaliable(){return!1}ShowBannerAd(){console.log("调用ShowBannerAd")}HideBannerAd(){console.log("调用HideBannerAd")}ShowRewardVideoAd(t,e){console.log("调用ShowRewardVideoAd"),t.run()}ShowRewardVideoAdAsync(){return new Promise(function(t){Os.instance.PlatformInstance.ShowRewardVideoAd(Laya.Handler.create(this,()=>{t(!0)}),Laya.Handler.create(this,()=>{t(!1)}))})}ShowInterstitalAd(){console.log("调用ShowInterstitalAd")}GetFromAppId(){return null}ShareAppMessage(t,e=null,i=null){console.log("分享消息",t),e&&e.run()}LoadSubpackage(t,e,i){e&&e.run()}RecordEvent(t,e){console.log("记录事件",t,e)}ShareVideoInfo(){console.log(Os.platformStr,"暂未实现录屏功能")}_CheckUpdate(){}ShowToast(t){console.log("显示消息：",t)}OpenGameBox(){console.error("当前平台",Os.platformStr,"暂不支持互推游戏盒子")}NavigateToApp(t,e,i){return new Promise((e,i)=>{console.error("当前平台",Os.platformStr,`暂不支持小程序跳转appid:${t}`),e(!1)})}createShortcut(){console.log("创建桌面图标")}GetStorage(t){return console.log("读本地存储"),Laya.LocalStorage.getItem(t)}SetStorage(t,e){console.log("写本地存储"),Laya.LocalStorage.setItem(t,e)}}function __awaiter(t,e,i,s){return new(i||(i=Promise))(function(a,n){function fulfilled(t){try{step(s.next(t))}catch(t){n(t)}}function rejected(t){try{step(s.throw(t))}catch(t){n(t)}}function step(t){t.done?a(t.value):new i(function(e){e(t.value)}).then(fulfilled,rejected)}step((s=s.apply(t,e||[])).next())})}class yn extends _n{constructor(){super(...arguments),this.platform=Xi.OPPO,this.safeArea=null,this.recordManager=new dn,this.device=new hn,this.isSupportJumpOther=!0,this._isBannerLoaded=!1,this._isVideoLoaded=!1,this._isInterstitialLoaded=!1,this._isInterstitialCanShow=!0,this._nativeAdLoaded=!1,this._cacheVideoAD=!1}Init(t){this._base=window.qg,null!=this._base?(this.platformData=t,this.recordManager.Platform=this,this._InitLauchOption(),this._Login(),this._InitSystemInfo(),this.getSystemInfo(),this.systemInfo.platformVersion>=1051||this._base.initAdService({appId:t.appId,isDebug:!0,success:()=>{console.log("oppo广告","初始化广告服务成功",t),this._CreateVideoAd()},fail:()=>{console.error("oppo广告","初始化广告服务失败")}}),window.iplatform=this):console.error(...s.packError("平台初始化错误",Os.platformStr))}getSystemInfo(){this._base.getSystemInfo({success:t=>{this.systemInfo=t,console.log(this.systemInfo)},fail:()=>{},complete:()=>{}})}reportMonitor(){console.log("oppo上报数据",this.systemInfo),this.systemInfo&&this.systemInfo.platformVersion>=1060&&this._base.reportMonitor("game_scene",0)}_CheckUpdate(){}_Login(){this.loginState={isLogin:!1,code:""};let t={};t.success=(t=>{this._OnLoginSuccess(t)}),t.fail=(t=>{console.error(Os.platformStr,"登录失败",t),this.loginState.isLogin=!1,this.loginState.code=""}),t.complete=(t=>{null!=this.onLoginEnd&&this.onLoginEnd.run()}),this._base.login(t)}_OnLoginSuccess(t){console.log(Os.platformStr,"登录成功",t),this.loginState.isLogin=!0,this.loginState.code=t.token}ShareAppMessage(t,e,i){}_InitLauchOption(){this._base.onShow(this._OnShow),this._base.onHide(this._OnHide);let t=this._base.getLaunchOptionsSync();this._OnShow(t)}canCreateShortcut(){return new Promise((t,e)=>{qg.hasShortcutInstalled({success:function(e){t(e)},fail:function(t){e()},complete:function(){}})})}createShortcut(){return new Promise((t,e)=>{qg.hasShortcutInstalled({success:function(i){0==i?qg.installShortcut({success:function(){t()},fail:function(t){e()},complete:function(){}}):t()},fail:function(t){e()},complete:function(){}})})}_CreateInterstitalAd(){}_CreateVideoAd(){if(!this._cacheVideoAD)return void console.log("当前策略为不缓存视频广告");let t=this._base.createRewardedVideoAd;if(null==t)return void console.error("无createRewardedVideoAd方法,跳过初始化");if(at.IsNullOrEmpty(this.platformData.rewardVideoId))return void console.log("无有效的视频广告ID,取消加载");this._videoFailedCount=0;let e={};e.adUnitId=this.platformData.rewardVideoId,this._rewardVideo=t(e),this._rewardVideo.onLoad(()=>{console.log("视频广告加载成功"),this._isVideoLoaded=!0}),this._rewardVideo.onError(t=>{this._videoFailedCount++,console.error("视频广告加载失败",t),this._videoFailedCount>10&&(console.log("第",this._videoFailedCount,"次重新加载视频广告"),this._rewardVideo.load())}),this._rewardVideo.onClose(t=>{Laya.stage.event(rs.RESUM_AUDIO),console.log("视频回调",t);let e=t.isEnded;yi.NextFrame().then(()=>{e?this._rewardSuccessed&&this._rewardSuccessed.run():this._rewardSkipped&&this._rewardSkipped.run()})})}IsBannerAvaliable(){return this._isBannerLoaded}IsVideoAvaliable(){return this._isVideoLoaded}IsInterstitalAvaliable(){return!1}IsNativeAvaliable(){return this._nativeAdLoaded}ShowBannerAd(){return __awaiter(this,void 0,void 0,function*(){if(at.IsNullOrEmpty(this.platformData.bannerId))return void console.log("无有效的banner广告ID,取消加载");if(this._bannerAd)return this._bannerAd.show(),void console.log("展示已有banner");this.HideBannerAd(),this._bannerAd=this._base.createBannerAd({adUnitId:this.platformData.bannerId});let t=!0,e=!1;for(this._bannerAd.show().then(i=>{console.log("banner加载成功",i),0==i.code&&(e=!0),t=!1}).catch(e=>{console.error("banner加载失败",e),t=!1});t;)yield yi.NextFrame();if(!e){console.log("banner展示失败,展示native广告"),this._bannerAd&&(this._bannerAd.destroy(),this._bannerAd=null);for(let t=0;t<this.platformData.nativeIconIds.length;++t){if(yield this._ShowNativeBanner(t))break;this._bannerAd.destroy()}}})}_ShowNativeBanner(t){return __awaiter(this,void 0,void 0,function*(){let e=this.base.createNativeAd({adUnitId:this.platformData.nativeBannerIds[t]});this._bannerAd=e;let i=yield e.load();if(0==i.code){let t=i.adList;return null==t||0==t.length?(console.error("native banner加载失败",i),!1):null!=t[0]||(console.error("native banner加载失败",i),!1)}return console.error("native banner加载失败",i),!1})}HideBannerAd(){this._bannerAd&&(this._bannerAd.destroy(),this._bannerAd=null)}ShowNativeAd(){return __awaiter(this,void 0,void 0,function*(){this.IsNativeAvaliable()})}HideNativeAd(){this.IsNativeAvaliable()}_DoCacheShowVideo(t,e){this._isVideoLoaded?(this._rewardSuccessed=t,this._rewardSkipped=e,this._isVideoLoaded=!1,Laya.stage.event(rs.PAUSE_AUDIO),this._rewardVideo.show()):console.error("视频广告尚未加载好")}_DoNoCacheShowVideo(t,e){if(this._rewardSuccessed=t,this._rewardSkipped=e,at.IsNullOrEmpty(this.platformData.rewardVideoId))return console.log("无有效的视频广告ID,取消加载"),void(this._rewardSkipped&&this._rewardSkipped.run());let i=this._base.createRewardedVideoAd;if(null==i)return console.error("无createRewardedVideoAd方法,跳过初始化"),void(this._rewardSkipped&&this._rewardSkipped.run());this._rewardVideo&&this._rewardVideo.destroy();let s={};s.adUnitId=this.platformData.rewardVideoId,this._rewardVideo=i(s),console.log("广告创建完成",s),this._rewardVideo.onClose(t=>{Laya.stage.event(rs.RESUM_AUDIO),console.log("视频回调",t);let e=t.isEnded;yi.NextFrame().then(()=>{e?this._rewardSuccessed&&this._rewardSuccessed.run():this._rewardSkipped&&this._rewardSkipped.run()})}),this._rewardVideo.onError(t=>{console.log("广告组件出现问题",t),this._rewardSkipped&&this._rewardSkipped.run()}),this._rewardVideo.onLoad(t=>{console.log("广告加载成功",t)}),this._rewardVideo.load().then(()=>{this._rewardVideo.show()})}ShowRewardVideoAd(t,e){this._cacheVideoAD?this._DoCacheShowVideo(t,e):this._DoNoCacheShowVideo(t,e)}ShowRewardVideoAdAsync(){return new Promise(function(t){Os.instance.PlatformInstance.ShowRewardVideoAd(Laya.Handler.create(this,()=>{t(!0)}),Laya.Handler.create(this,()=>{t(!1)}))})}_DisableInterstitalAd(){return __awaiter(this,void 0,void 0,function*(){this._isInterstitialCanShow=!1,yield yi.Seconds(60),this._isInterstitialCanShow=!0})}GetFromAppId(){return null==this.lauchOption.referrerInfo?null:at.IsNullOrEmpty(this.lauchOption.referrerInfo.appId)?null:this.lauchOption.referrerInfo.appId}CreatShortcut(){return new Promise((t,e)=>{qg.hasShortcutInstalled({success:function(i){0==i?qg.installShortcut({success:function(){t()},fail:function(t){e()},complete:function(){}}):t()},fail:function(t){e()},complete:function(){}})})}LoadSubpackage(t,e,i,s){let a={};a.name=t,a.success=(()=>{console.log("分包加载成功",t),e&&e.run()}),a.fail=(()=>{console.error("分包加载失败",t),i&&i.run()}),this._base.loadSubpackage(a).onProgressUpdate(t=>{console.log("分包加载进度",t),s&&s.runWith(t.progress/100)})}RecordEvent(t,e){console.log("[记录事件]",t,e)}CreateShareVideoBtn(t,e,i,s){}HideShareVideoBtn(){null!=this._shareVideoBtn&&this._shareVideoBtn.hide()}ShowToast(t){this._base.showToast({title:t,duration:2e3})}OpenGameBox(t){console.error("当前平台",Os.platformStr,"暂不支持互推游戏盒子")}NavigateToApp(t,e,i){return new Promise((s,a)=>{Laya.Browser.window.qg.navigateToMiniGame({pkgName:t,path:e,extraData:i,success:function(){s(!0),console.log("oppo小游戏跳转成功")},fail:function(t){a(!1),console.log("oppo小游戏跳转失败：",JSON.stringify(t))}})})}}class Sn extends _n{constructor(){super(...arguments),this.platform=Xi.QQ,this.isBannerShowing=!1}Init(t){this._base=window.qq,null!=this._base?(this.platformData=t,this.recordManager.Platform=this,this._InitLauchOption(),this._Login(),this._InitShareInfo(),this._InitSystemInfo(),this._CreateBannerAd(),this._CreateVideoAd(),this._CreateInterstitalAd(),window.iplatform=this,console.error("平台初始化完成",Os.platformStr)):console.error(...s.packError("平台初始化错误",Os.platformStr))}_InitSystemInfo(){try{let t=this._base.getSystemInfoSync();this._cacheScreenScale=t.screenWidth/Laya.stage.width,this.safeArea={},this.safeArea.width=t.windowWidth,this.safeArea.height=t.windowHeight,this.safeArea.top=t.statusBarHeight,this.safeArea.bottom=0,console.log("QQ覆写_InitSystemInfo",this.safeArea)}catch(t){console.error(t),console.error("获取设备信息失败,执行默认初始化"),this.safeArea=null}}_CreateBannerAd(t){if(at.IsNullOrEmpty(this.platformData.bannerId))return void console.log("无有效的banner广告ID,取消加载");let e=this._base.getSystemInfoSync().windowWidth,i=this._base.getSystemInfoSync().windowHeight,s={};s.adUnitId=this.platformData.bannerId;let a={};a.top=i-80,a.width=300,a.left=(e-a.width)/2,s.style=a,this._bannerAd=this._base.createBannerAd(s),this._isBannerLoaded=!1,this._bannerAd.onLoad(()=>{console.log("qq banner加载成功",this._bannerAd),this._isBannerLoaded=!0,t&&this._bannerAd.show()}),this._bannerAd.onError(t=>{console.error("banner广告加载失败",t)}),this._bannerAd.onResize(t=>{console.log("onResize",t),this._bannerAd.style.top=i-80,this._bannerAd.style.left=(e-300)/2,console.log("onResize",this._bannerAd)})}IsBannerAvaliable(){return this._isBannerLoaded}IsVideoAvaliable(){return this._isVideoLoaded}IsInterstitalAvaliable(){return this._isInterstitialLoaded}ShowBannerAd(){this.IsBannerAvaliable()&&(this._bannerAd.show(),this.isBannerShowing=!0,Laya.timer.loop(15e3,this,this.refreshBanner))}refreshBanner(){this.isBannerShowing&&(console.log("refresh banner"),this._bannerAd.hide(),this._CreateBannerAd(!0))}HideBannerAd(){this.IsBannerAvaliable()&&(this._bannerAd&&(this._bannerAd.hide(),Laya.timer.clear(this,this.refreshBanner),this.isBannerShowing=!1),this._CreateBannerAd())}_DoCacheShowVideo(t,e){this._isVideoLoaded?(this._rewardSuccessed=t,this._rewardSkipped=e,this._isVideoLoaded=!1,Laya.stage.event(rs.PAUSE_AUDIO),this._rewardVideo.show()):console.error("视频广告尚未加载好")}_DoNoCacheShowVideo(t,e){if(this._rewardSuccessed=t,this._rewardSkipped=e,!this._isVideoLoaded||!this._rewardVideo){if(at.IsNullOrEmpty(this.platformData.rewardVideoId))return console.log("无有效的视频广告ID,取消加载"),void e.run();let t=this._base.createRewardedVideoAd;if(null==t)return console.error("无createRewardedVideoAd方法,跳过初始化"),void e.run();this._videoFailedCount=0;let i={};i.adUnitId=this.platformData.rewardVideoId,this._rewardVideo=t(i),this._rewardVideo.onLoad(()=>{console.log("视频广告加载成功"),this._isVideoLoaded=!0}),this._rewardVideo.onError(t=>{this._videoFailedCount++,console.error("视频广告加载失败",t,this._videoFailedCount)}),this._rewardVideo.onClose(t=>{Laya.stage.event(rs.RESUM_AUDIO),console.log(" NoCache - 视频回调",t);let e=t.isEnded;console.log("noCache---",e,"----",!!this._rewardSuccessed,"-----",!!this._rewardSkipped),e?this._rewardSuccessed&&this._rewardSuccessed.run():this._rewardSkipped&&this._rewardSkipped.run()})}this._rewardVideo.show().then(()=>{}).catch(t=>{console.log("广告组件出现问题",t),this._rewardVideo.load().then(()=>(console.log("手动加载成功"),this._rewardVideo.show().then(()=>{})))})}ShowRewardVideoAd(t,e){this._cacheVideoAD?this._DoCacheShowVideo(t,e):this._DoNoCacheShowVideo(t,e)}ShowRewardVideoAdAsync(){return new Promise(function(t){Os.instance.PlatformInstance.ShowRewardVideoAd(Laya.Handler.create(this,()=>{t(!0)},null,!0),Laya.Handler.create(this,()=>{t(!1)},null,!0))})}ShowInterstitalAd(){this._isInterstitialLoaded?this._intersitialAd.show():console.error("插页广告尚未加载好")}OpenGameBox(t=[]){this.showAppBox()}showAppBox(){this.appBox&&this.appBox.show()}createAppBox(t){this.appBox||(this.appBox=this._base.createAppBox({adUnitId:""})),this.appBox.load().then(()=>{t&&this.appBox.show()}),this.appBox.onClose(()=>{console.log("关闭盒子")})}hideAppBox(){this.appBox&&this.appBox.destroy()}showBlockAd(t=1){let e={adUnitId:"",style:{left:55,top:Laya.stage.height/2},size:t,orientation:"vertical"};this.blockAd=this._base.createBlockAd(e),this.blockAd.onLoad(()=>{console.log("积木广告加载完成"),this.blockAd.show().then(()=>{console.log("积木展示成功")}).catch(t=>{console.error("积木展示失败",t)})}),this.blockAd.onError(t=>{console.error("积木广告加载错误",t)}),this.blockAd.onResize(t=>{console.log("积木resize",t)})}hideBlockAd(){this.blockAd&&(this.blockAd.hide(),this.blockAd.destroy())}}class In extends _n{constructor(){super(...arguments),this.platform=Xi.QTT}Init(t){this._base=window.qttGame,null!=this._base?(this.platformData=t,this.recordManager.Platform=this,window.iplatform=this):console.error(...s.packError("平台初始化错误"))}IsBannerAvaliable(){return!0}ShowBannerAd(){this._base.showBanner({index:1})}HideBannerAd(){this._base.hideBanner()}IsVideoAvaliable(){return!0}ShowRewardVideoAd(t,e){let i={index:1,gametype:1,rewardtype:1,data:{}};i.data.title="获得奖励",Laya.stage.event(rs.PAUSE_AUDIO),this._base.showVideo(i=>{Laya.stage.event(rs.RESUM_AUDIO),1==i?t&&t.run():e&&e.run()},i)}ShowInterstitalAd(){this.ShowHDReward()}ShowHDReward(){let t={index:1,rewardtype:1};this._base.showHDReward(t)}RecordEvent(t,e){console.log("记录事件",t,e)}}class wn extends hn{constructor(t){super(),this._base=t}Vibrate(t){console.log("调用震动",t),t?this._base.vibrateLong({success(t){},fail(t){console.error("调用震动失败",t)},complete(t){}}):this._base.vibrateShort({success(t){},fail(t){console.error("调用震动失败",t)},complete(t){}})}}class Cn extends dn{constructor(t){super(),this.supportRecord=!0,this._base=t,this.isRecording=!1,this.isRecordSuccess=!1,this.isPausing=!1,this._nativeManager=this._base.getGameRecorderManager(),this._nativeManager.onStart(t=>{console.log("平台开始录制",t),this.isRecording=!0,this.isRecordSuccess=!1,this._cacheStartHandle&&this._cacheStartHandle.run()}),this._nativeManager.onStop(t=>{console.log("平台停止录制",t),this.videoSavePath=t.videoPath,this.isRecording=!1,this.isRecordSuccess=!0,this._cacheStopHandle?this._cacheStopHandle.run():this._cacheOverTimeHandle&&this._cacheOverTimeHandle.run()}),this._nativeManager.onError(t=>{console.log("录制发生错误",t),this.isRecordSuccess=!1,this.isRecording=!1}),this._nativeManager.onPause(t=>{console.log("暂停录制视频",t),this.isPausing=!0,this._cachePauseHandle&&this._cachePauseHandle.run()}),this._nativeManager.onResume(t=>{console.log("暂停录制视频",t),this.isPausing=!1,this._cacheResumeHandle&&this._cacheResumeHandle.run()})}StartRecord(t,e){console.log("调用开始录屏"),this._cacheStartHandle=t,this._cacheOverTimeHandle=e,this._cacheStopHandle=null,this._nativeManager.start({duration:300})}Pause(t){this.isRecording?this.isPausing?console.log("当前录制状态已暂停"):(console.log("调用暂停录制"),this._cachePauseHandle=t,this._nativeManager.pause()):console.error("当前未开始录制,无法暂停录制")}Resume(t){this.isRecording?this.isPausing?(console.log("调用恢复录制"),this._cacheResumeHandle=t,this._nativeManager.resume()):console.log("当前录制状态正在进行中"):console.error("当前未开始录制,无法恢复录制")}RecordClip(t){this.isRecording?this.isPausing?console.log("当前录制状态已暂停,无法记录精彩时刻"):null==t?this._nativeManager.recordClip({}):this._nativeManager.recordClip({timeRange:t}):console.error("当前未开始录制,无法记录精彩时刻")}StopRecord(t){console.log("调用结束录屏"),this._cacheStopHandle=t,this._nativeManager.stop()}ShareVideo(t,e,i){if(this.isRecordSuccess){let i={channel:"video",title:"",desc:"",imageUrl:"",templateId:this.Platform.platformData.shareId,query:"",extra:{videoPath:this.videoSavePath,videoTopics:["抖音小游戏","开间厕所当老板"]},success(){t&&t.run()},fail(t){e&&e.run()}};this._base.shareAppMessage(i)}else console.log("无视频可以分享"),i&&i.run()}}class bn extends _n{constructor(){super(...arguments),this.platform=Xi.TT,this._showVideoLoad=!1}Init(t){if(this._base=window.tt,null==this._base)return void console.error(...s.packError("平台初始化错误"));this.platformData=t;let e=this._base.getSystemInfoSync();"ios"==e.platform&&(this.isSupportJumpOther=!1);let[i,a]=e.SDKVersion.split(".");i>=1&&a>=33||(this.isSupportJumpOther=!1),this._InitLauchOption(),this._InitShareInfo(),this._InitSystemInfo(),this._CreateBannerAd(),this._CreateVideoAd(),this._CreateInterstitalAd(),this.recordManager=new Cn(this._base),this.recordManager.Platform=this,this.device=new wn(this._base),window.iplatform=this}_CreateBannerAd(){if(at.IsNullOrEmpty(this.platformData.bannerId))return void console.log("无有效的banner广告ID,取消加载");let t=this._base.getSystemInfoSync().windowWidth,e=this._base.getSystemInfoSync().windowHeight,i={};i.adUnitId=this.platformData.bannerId,i.adIntervals=30;let s={left:0,top:0};s.width=t,i.style=s,this._bannerAd=this._base.createBannerAd(i),this._isBannerLoaded=!1,this._bannerAd&&(this._bannerAd.onLoad(()=>{console.log("banner加载成功",this._bannerAd),this._isBannerLoaded=!0}),this._bannerAd.onError(t=>{console.error("banner广告加载失败",t),this._bannerAd}),this._bannerAd.onResize(i=>{this._bannerAd.style.top=e-i.height,this._bannerAd.style.left=(t-i.width)/2}))}RecordEvent(t,e){let i=this._base.reportAnalytics;i?(null==e&&(e={}),i(t,e)):console.error("reportAnalytics 方法不存在")}ShowBannerAd(){this.IsBannerAvaliable()&&this._bannerAd.show()}ShareAppMessage(t,e,i){console.log("分享消息",t);let s=_n._WrapShareInfo(t);s.success=(()=>{e&&e.run()}),s.fail=(()=>{i&&i.run()}),this._base.shareAppMessage(s)}OpenGameBox(t){let e=[];for(let i=0;i<t.length;++i)e.push({appId:t[i]});this._base.showMoreGamesModal({appLaunchOptions:e})}NavigateToApp(t,e,i){return new Promise((e,i)=>{this.isSupportJumpOther?this._base.showMoreGamesModal({appLaunchOptions:[{appId:this.platformData.appId,query:"foo=bar&baz=qux",extraData:{}}],success(i){e(!0),console.log("跳转小游戏成功",t)},fail(e){i(!1),console.log("跳转小游戏失败",t)}}):(i(!1),console.log("当前平台不支持小游戏跳转",this))})}}class Ln{constructor(){this.isSupportJumpOther=!0,this.platform=Xi.VIVO,this.platformData=new ki,this.recordManager=new dn,this.safeArea=null,this.loginCode=null,this._isBannerLoaded=!1,this._isVideoLoaded=!1,this._isInterstitialLoaded=!1,this._cacheVideoAD=!1,this.NavigateToAppSuccess=null}Init(t){this._base=window.qg,null!=this._base?(this.platformData=t,this.recordManager.Platform=this,this._InitLauchOption(),this._Login(),this._InitSystemInfo(),this._CreateVideoAd(),window.iplatform=this):console.error(...s.packError("平台初始化错误,获取window失败：",Os.platformStr))}_CheckUpdate(){let t=this._base.getUpdateManager();null!=t&&(t.onCheckForUpdate(function(t){console.log("onCheckForUpdate",t.hasUpdate),t.hasUpdate&&this._base.showToast({title:"即将有更新请留意"})}),t.onUpdateReady(()=>{this._base.showModal({title:"更新提示",content:"新版本已经准备好，是否立即使用？",success:function(e){e.confirm?t.applyUpdate():this._base.showToast({icon:"none",title:"小程序下一次「冷启动」时会使用新版本"})}})}),t.onUpdateFailed(()=>{this._base.showToast({title:"更新失败，下次启动继续..."})}))}_Login(){this.loginState={isLogin:!1,code:""};let t={};t.success=(t=>{this.loginCode=t.code,this._OnLoginSuccess(t),console.log(this.loginState)}),t.fail=(t=>{console.error(Os.platformStr,"登录失败",t),this.loginState.isLogin=!1,this.loginState.code=""}),t.complete=(()=>{null!=this.onLoginEnd&&this.onLoginEnd.run()}),this._base.login(t)}GetStorage(t){if(this.base&&this.base.getStorageSync&&t)try{return this.base.getStorageSync(t)}catch(t){return console.log("getStorageSync error: ",JSON.stringify(t)),null}}SetStorage(t,e){if(this.base&&this.base.getStorageSync&&t)try{return this.base.setStorageSync(t,e)}catch(t){console.log("setStorageSync error: ",JSON.stringify(t))}}_OnLoginSuccess(t){console.log(Os.platformStr,"登录成功",t),this.loginState.isLogin=!0,this.loginState.code=t.code}_InitLauchOption(){this._base.onShow(this._OnShow),this._base.onHide(this._OnHide);let t=this._base.getLaunchOptionsSync();this._OnShow(t)}_InitShareInfo(){this._base.showShareMenu({withShareTicket:!0,success:t=>{console.log("InitShareSuccess",t)},fail:t=>{console.log("InitShareFailed",t)},complete:t=>{console.log("InitShareComplete",t)}}),this._base.onShareAppMessage(()=>{let t=mn.instance.GetShareInfo();return Ln._WrapShareInfo(t)})}static _WrapShareInfo(t){let e={};if(t.shareTitle&&(e.title=t.shareTitle),t.shareImg&&(e.imageUrl=t.shareImg),t.sharePath){e.query={};let i=t.sharePath.split("?")[1].split("&");for(let t of i){let i=t.split("=");e.query[i[0]]=i[1]}}return e}_InitSystemInfo(){this.base=this._base;try{this.systemInfo=this._base.getSystemInfoSync(),console.log("系统信息已获取",this.systemInfo),this.safeArea=this.systemInfo.safeArea,this._cacheScreenScale=this.systemInfo.screenWidth/Laya.stage.width}catch(t){console.error(t),console.error("获取设备信息失败,执行默认初始化"),this.safeArea=null}}_CreateInterstitalAd(){if(at.IsNullOrEmpty(this.platformData.interstitialId))return void console.log("无有效的插页广告ID,取消加载");this._interstitalFailedCount=0;let t={};t.adUnitId=this.platformData.interstitialId,this._intersitialAd=this._base.createInterstitialAd(t),this._intersitialAd&&(this._intersitialAd.onLoad(()=>{console.log("插页广告加载成功"),this._isInterstitialLoaded=!0}),this._intersitialAd.onError(t=>{this._interstitalFailedCount++,console.error("插页广告加载失败",t),this._interstitalFailedCount>10&&(console.log("第",this._interstitalFailedCount,"次重新加载插页广告"),this._intersitialAd.load())}))}_CreateVideoAd(){if(console.log("vedio ad id",this.platformData.rewardVideoId),!this._cacheVideoAD)return void console.log("当前策略为不缓存视频广告");let t=this._base.createRewardedVideoAd;if(null==t)return void console.error("无createRewardedVideoAd方法,跳过初始化");if(at.IsNullOrEmpty(this.platformData.rewardVideoId))return void console.log("无有效的视频广告ID,取消加载");this._videoFailedCount=0;let e={};e.adUnitId=this.platformData.rewardVideoId,this._rewardVideo=t(e),this._rewardVideo.onLoad(()=>{console.log("视频广告加载成功"),this._isVideoLoaded=!0}),this._rewardVideo.onError(t=>{this._videoFailedCount++,console.error("视频广告加载失败",t),this._videoFailedCount>10&&(console.log("第",this._videoFailedCount,"次重新加载视频广告"),this._rewardVideo.load())}),this._rewardVideo.onClose(t=>{Laya.stage.event(rs.RESUM_AUDIO),console.log("视频回调",t);let e=t.isEnded;yi.NextFrame().then(()=>{e?this._rewardSuccessed&&this._rewardSuccessed.run():this._rewardSkipped&&this._rewardSkipped.run()})})}_CreateBannerAd(){if(at.IsNullOrEmpty(this.platformData.bannerId))return void console.log("无有效的banner广告ID,取消加载");let t=this._base.getSystemInfoSync().windowWidth,e=this._base.getSystemInfoSync().windowHeight,i={};i.adUnitId=this.platformData.bannerId,i.adIntervals=30;let s={left:0,top:0,width:300};i.style=s,this._bannerAd=this._base.createBannerAd(i),this._isBannerLoaded=!1,this._bannerAd.onLoad(()=>{console.log("banner加载成功"),this._isBannerLoaded=!0,this._bannerAd.style.top=e-this._bannerAd.style.realHeight,this._bannerAd.style.left=(t-this._bannerAd.style.realWidth)/2}),this._bannerAd.onError(t=>{console.error("banner广告加载失败",t)})}IsBannerAvaliable(){return this._isBannerLoaded}IsVideoAvaliable(){return this._isVideoLoaded}IsInterstitalAvaliable(){return this._isInterstitialLoaded}ShowBannerAd(){this.IsBannerAvaliable()&&this._bannerAd.show()}HideBannerAd(){this._bannerAd.hide()}_DoCacheShowVideo(t,e){this._isVideoLoaded?(this._rewardSuccessed=t,this._rewardSkipped=e,this._isVideoLoaded=!1,Laya.stage.event(rs.PAUSE_AUDIO),this._rewardVideo.show()):console.error("视频广告尚未加载好")}_DoNoCacheShowVideo(t,e){if(this._rewardSuccessed=t,this._rewardSkipped=e,at.IsNullOrEmpty(this.platformData.rewardVideoId))return console.log("无有效的视频广告ID,取消加载"),void e.run();let i=this._base.createRewardedVideoAd;if(null==i)return console.error("无createRewardedVideoAd方法,跳过初始化"),void e.run();this._videoFailedCount=0;let s={};s.adUnitId=this.platformData.rewardVideoId,this._rewardVideo&&this._rewardVideo.offClose(this.onVideoClose),this._rewardVideo=i(s),this._rewardVideo.onLoad(()=>{console.log("视频广告加载成功"),this._isVideoLoaded=!0}),this._rewardVideo.onError(t=>{this._videoFailedCount++,console.error("视频广告加载失败",t,this._videoFailedCount)}),this._rewardVideo.onClose(t=>{Laya.stage.event(rs.RESUM_AUDIO),console.log("视频回调",t);let e=t.isEnded;yi.NextFrame().then(()=>{e?this._rewardSuccessed&&this._rewardSuccessed.run():this._rewardSkipped&&this._rewardSkipped.run()})}),this._rewardVideo.load().then(()=>(console.log("激励视频 加载成功"),this._rewardVideo.show().then(()=>{}).catch(t=>{console.error(t)})))}onVideoClose(t){Laya.stage.event(rs.RESUM_AUDIO),console.log("视频回调",t);let e=t.isEnded;yi.NextFrame().then(()=>{e?this._rewardSuccessed&&this._rewardSuccessed.run():this._rewardSkipped&&this._rewardSkipped.run()})}ShowRewardVideoAd(t,e){let i=Laya.SoundManager.muted;Laya.SoundManager.muted=!0;let s=()=>{Laya.SoundManager.muted=i},a=Laya.Handler.create(this,()=>{s(),t&&t.run()}),n=Laya.Handler.create(this,()=>{s(),e&&e.run()});this._cacheVideoAD?this._DoCacheShowVideo(a,n):this._DoNoCacheShowVideo(a,n)}ShowRewardVideoAdAsync(){return new Promise(function(t){Os.instance.PlatformInstance.ShowRewardVideoAd(Laya.Handler.create(this,()=>{t(!0)}),Laya.Handler.create(this,()=>{t(!1)}))})}ShowInterstitalAd(){this._isInterstitialLoaded?this._intersitialAd.show():console.error("插页广告尚未加载好")}GetFromAppId(){return null==this.lauchOption.referrerInfo?null:at.IsNullOrEmpty(this.lauchOption.referrerInfo.appId)?null:this.lauchOption.referrerInfo.appId}_OnShow(t){console.log(Os.platformStr,"OnShow",t),Os.instance.PlatformInstance.lauchOption=t,Os.instance.PlatformInstance._CheckUpdate(),this.NavigateToAppSuccess=null,yi.NextFrame().then(()=>{Os.instance.PlatformInstance.onResume&&Os.instance.PlatformInstance.onResume.runWith(t)})}_OnHide(t){console.log(Os.platformStr,"OnHide",t),Os.instance.PlatformInstance.onPause&&Os.instance.PlatformInstance.onPause.runWith(t),this.NavigateToAppSuccess&&this.NavigateToAppSuccess()}ShareAppMessage(t,e,i){console.log("分享消息",t);let s=Ln._WrapShareInfo(t);this._base.shareAppMessage(s),e&&e.run()}LoadSubpackage(t,e,i,s){if(null==this._base.loadSubpackage)return console.log("无加载子包方法,跳过加载子包",t),void(e&&e.run());let a={};a.name=t,a.success=(()=>{console.log("分包加载成功",t),e&&e.run()}),a.fail=(()=>{console.error("分包加载失败",t),i&&i.run()}),this._base.loadSubpackage(a).onProgressUpdate(t=>{Laya.Browser.onMobile&&console.log("分包加载进度",t),s&&s.runWith(t.progress/100)})}RecordEvent(t,e){console.log("记录事件",t,e);let i=this._base.aldSendEvent;null!=i?null!=e?i(t,e):i(t):console.error("阿拉丁sdk尚未接入,请检查配置")}CreateShareVideoBtn(t,e,i,s){let a={};a.style={left:t*this._cacheScreenScale,top:e*this._cacheScreenScale,height:s*this._cacheScreenScale,width:i*this._cacheScreenScale},a.share={query:{tick:1},bgm:"",timeRange:[0,6e4]},null==this._shareVideoBtn?this._shareVideoBtn=this._base.createGameRecorderShareButton(a):this._shareVideoBtn.show()}HideShareVideoBtn(){null!=this._shareVideoBtn&&this._shareVideoBtn.hide()}ShowToast(t){this._base.showToast({title:t,duration:2e3})}OpenGameBox(t){console.error("当前平台",Os.platformStr,"暂不支持互推游戏盒子")}NavigateToApp(t,e,i,s,a,n){return new Promise((s,a)=>{wx.navigateToMiniProgram({appId:t,path:e,extraData:i,envVersion:"",success:t=>{console.log("小游戏跳转成功",t),s(!0)},fail:()=>{console.log("小游戏跳转失败："),a(!1)},complete:()=>{}})})}createShortcut(){console.log("暂未实现")}}class vn{constructor(){this.platform=Xi.Web,this.safeArea=null,this.recordManager=new pn,this.device=new hn,this.systemInfo=null,this.isSupportJumpOther=!0}Init(t){this.loginState={isLogin:!1,code:null},this.recordManager.Platform=this,Laya.timer.once(500,this,this._FakeLoginEnd)}_FakeLoginEnd(){this.onLoginEnd&&this.onLoginEnd.run()}IsBannerAvaliable(){return!1}IsVideoAvaliable(){return!0}IsInterstitalAvaliable(){return!1}ShowBannerAd(){console.log("调用ShowBannerAd")}HideBannerAd(){console.log("调用HideBannerAd")}ShowRewardVideoAd(t,e){console.log("调用ShowRewardVideoAd"),t.run()}ShowRewardVideoAdAsync(){return new Promise(function(t){Os.instance.PlatformInstance.ShowRewardVideoAd(Laya.Handler.create(this,()=>{t(!0)}),Laya.Handler.create(this,()=>{t(!1)}))})}ShowInterstitalAd(){console.log("调用ShowInterstitalAd")}GetFromAppId(){return null}ShareAppMessage(t,e=null,i=null){console.log("分享消息",t),e&&e.run()}LoadSubpackage(t,e,i){e&&e.run()}RecordEvent(t,e){console.log("记录事件",t,e)}ShareVideoInfo(){console.log(Os.platformStr,"暂未实现录屏功能")}_CheckUpdate(){}ShowToast(t){console.log("显示消息：",t)}OpenGameBox(){console.error("当前平台",Os.platformStr,"暂不支持互推游戏盒子")}NavigateToApp(t,e,i){return new Promise((e,i)=>{console.error("当前平台",Os.platformStr,`暂不支持小程序跳转appid:${t}`),e(!1)})}createShortcut(){console.log("创建桌面图标")}GetStorage(t){return console.log("读本地存储"),Laya.LocalStorage.getItem(t)}SetStorage(t,e){console.log("写本地存储"),Laya.LocalStorage.setItem(t,e)}}class An{static get instance(){return null==this._instance&&(this._instance=new An),this._instance}static get PlatformInstance(){return this.instance.m_platformInstance||console.log(...s.packError("还没有设置过平台实例代理！")),this.instance.m_platformInstance}init(){if(null!=this.m_platformInstance)return console.error(...s.packError("已调用过平台创建为",Os.GetPlatformStr(this.m_platformInstance.platform),"不能重复创建")),this.m_platformInstance;let t,e=null!=window.qttGame;null!=window.tt?(t=new bn,this.m_platformData=new rn):Laya.Browser.onMiniGame?(t=new _n,this.m_platformData=new ln):Laya.Browser.onBDMiniGame?(t=new gn,this.m_platformData=new sn):e?(t=new In,this.m_platformData=new on):Laya.Browser.onQQMiniGame?(t=new Sn,this.m_platformData=new nn):Laya.Browser.onQGMiniGame?(t=new yn,this.m_platformData=new an):Laya.Browser.onVVMiniGame?(t=new Ln,this.m_platformData=new ki):Laya.Browser.onAndroid?t=new vn:Laya.Browser.onIOS||Laya.Browser.onIPhone||Laya.Browser.onIPad?t=new vn:(console.log(...s.packWarn("未识别平台,默认创建为web",Laya.Browser.userAgent)),t=new fn),t=new fn,this.m_platformInstance=t,Os.instance.PlatformInstance=t,window.$Platform=this.m_platformInstance,console.log(...s.packPlatform("平台实例创建完成",Os.GetPlatformStr(this.m_platformInstance.platform)))}initPlatform(){this.m_platformInstance.Init(this.m_platformData),console.log(...s.packPlatform("平台初始化完成"))}}class xn extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGameTestPlatform")}onConstruct(){this.m_bg=this.getChildAt(0),this.m_lookVAd=this.getChildAt(1),this.m_lookVAdText=this.getChildAt(2),this.m__lookVAd=this.getChildAt(3),this.m_share=this.getChildAt(4),this.m_shareText=this.getChildAt(5),this.m__share=this.getChildAt(6),this.m_showToast=this.getChildAt(7),this.m_showToastText=this.getChildAt(8),this.m__showToast=this.getChildAt(9)}}xn.URL="ui://kk7g5mmmt1pw9y";class kn extends xe{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new kn,this.m_instance._classDefine=xn),this.m_instance}_OnShow(){this.ui.m_bg.onClick(this,this.close),this.ui.m_lookVAd.onClick(this,this.lookVAd),this.ui.m_showToast.onClick(this,this.showToast),this.ui.m_share.onClick(this,this.share)}lookVAd(){console.log("看广告测试"),An.PlatformInstance.ShowRewardVideoAdAsync().then(t=>{console.log("看广告完成测试",t)})}showToast(){console.log("显示消息测试"),An.PlatformInstance.ShowToast("显示消息测试")}share(){console.log("分享测试"),An.PlatformInstance.ShareAppMessage({shareId:void 0,shareImg:void 0,sharePath:void 0,shareTitle:"分享消息"},Laya.Handler.create(this,()=>{console.log("分享成功")}),Laya.Handler.create(this,()=>{console.log("分享失败！")}))}close(){Be.instance.setUIState([{typeIndex:ee.TestPlatform,state:!1}],!1)}_OnHide(){}}class Pn{constructor(){this.initUIMediator(),this._initUIMediator()}initUIMediator(){}_initUIMediator(){let t,e;this.m_UIMediator||console.log(...s.packWarn("注意！没有注册UI代理类。")),this.m_UIProxy.setProxyMediatroList(this.m_UIMediator);for(let i in this.m_UIMediator)this.m_UIMediator[i].keyId=i,t=[],this.getUIBelongSerialNumber(this.m_UIMediator[i],t),(e=t.length)!=(t=I.Unique(t)).length&&console.log(...s.packError("UI调度者",i,"的附属UI有重复出现！"))}getUIBelongSerialNumber(t,e,i=!1){t.belongDownUIMediator.length>0&&t.belongDownUIMediator.forEach(t=>{this.getUIBelongSerialNumber(t,e,!0)}),i?t.ifBelongUIMediator||console.log(...s.packWarn("注意！有一个不是附属的UI调度者被添加进了附属列表中")):t.ifBelongUIMediator&&console.log(...s.packWarn("注意！有一个附属UI调度者被添加进了UI管理器列表中，它将不会被显示。")),e.push(t.serialNumber),t.belongUpUIMediator.length>0&&t.belongUpUIMediator.forEach(t=>{this.getUIBelongSerialNumber(t,e,!0)})}}class Dn extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","EventLayer")}onConstruct(){this.m_layer=this.getChildAt(0)}}Dn.URL="ui://8nmf3q47p8qa15";var Un,Tn,Rn,On,Mn,En,Bn,Gn,Nn,Fn=Laya.MouseManager;class Vn extends xe{constructor(){super(),this._layer=Yt.EventLayer,this._lastFramePos=new Laya.Vector2,this._isDrag=!1,this._point=new Laya.Vector2,this._ray=new Laya.Ray(Ct.zero,Ct.zero),this._out=new Laya.HitResult}static get instance(){return this.m_instance||(this.m_instance=new Vn,this.m_instance._classDefine=Dn),this.m_instance}get mousePosition(){return this._point.x=Fn.instance.mouseX,this._point.y=Fn.instance.mouseY,this._point}get _camera(){return et.camera}get _scene(){return et.s3d}_OnShow(){this.ui.m_layer.on(Laya.Event.MOUSE_DOWN,this,this.onDown),this.ui.m_layer.on(Laya.Event.MOUSE_MOVE,this,this.onMove),this.ui.m_layer.on(Laya.Event.MOUSE_UP,this,this.onUp)}onDown(){this._lastFramePos.x=this.mousePosition.x,this._lastFramePos.y=this.mousePosition.y}onMove(){Math.abs(this.mousePosition.x-this._lastFramePos.x)<5||Math.abs(this.mousePosition.y-this._lastFramePos.y)<5||(this._isDrag=!0)}onUp(){if(this._isDrag&&1==this._scene.input.touchCount())this._isDrag=!1;else if(0==this._isDrag)if(this._camera.viewportPointToRay(this.mousePosition,this._ray),this._scene.physicsSimulation.rayCast(this._ray,this._out)){console.log("检测物",this._out.collider.owner.name);let t=this._out.collider.owner.name;it.instance.event3D(A.OnClickBuilding,[t])}else console.log("没有检测到box")}}class Wn extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("EffectLayer","MoneyEffect")}onConstruct(){this.m_momeyEffect=this.getTransitionAt(0)}}Wn.URL="ui://c2q7aw0bgywm1";class jn extends xe{constructor(){super(),this._layer=Yt.Top}static get instance(){return this.m_instance||(this.m_instance=new jn,this.m_instance._classDefine=Wn),this.m_instance}_OnShow(){super._OnShow(),this.ui.m_momeyEffect.play(),Laya.timer.once(2200,this,this.ClosePanel)}ClosePanel(){Be.instance.setUIState([{typeIndex:ee.UIMoneyEffect,state:!1}],!1)}}class qn extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","PGameMainDaily")}onConstruct(){this.m_c1=this.getControllerAt(0),this.m_btn_close=this.getChildAt(5),this.m_day_1=this.getChildAt(6),this.m_SignInBtn=this.getChildAt(7),this.m_day_2=this.getChildAt(8),this.m_SignInBtn2=this.getChildAt(9),this.m_day_3=this.getChildAt(10),this.m_SignInBtn3=this.getChildAt(11),this.m_day_4=this.getChildAt(12),this.m_SignInBtn4=this.getChildAt(13),this.m_day_5=this.getChildAt(14),this.m_SignInBtn5=this.getChildAt(15),this.m_day_6=this.getChildAt(16),this.m_SignInBtn6=this.getChildAt(17),this.m_day_7=this.getChildAt(18),this.m_SignInBtn7=this.getChildAt(19),this.m_btn_ad=this.getChildAt(21),this.m_btn_get=this.getChildAt(22)}}qn.URL="ui://8nmf3q47b3xq1ab";class Hn extends xe{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new Hn,this.m_instance._classDefine=qn),this.m_instance}_OnShow(){console.log("UIMediatorDailySign _OnShow:",this.ui);const t=this.ui.getChild("n4").asTextField;t&&(t.text="每日登陆".i18n()),this.ui.m_btn_get.text="领取".i18n(),this.ui.m_btn_get.onClick(this,this.OnClickGet),this.ui.m_btn_close.onClick(this,this.OnClickClose),this.ui.m_btn_ad.text="X2"+"领取".i18n(),this.ui.m_btn_ad.onClick(this,this.OnClickAd),this.UpdateShow(),Re.IsCompleteAllGuide?this.isGuide=!1:this.isGuide=!0}UpdateShow(){let t=$e.data.signDay;this.ui.m_day_1.m_bgColor.selectedIndex=t<=0?0:1,this.ui.m_day_2.m_bgColor.selectedIndex=t<=1?0:1,this.ui.m_day_3.m_bgColor.selectedIndex=t<=2?0:1,this.ui.m_day_4.m_bgColor.selectedIndex=t<=3?0:1,this.ui.m_day_5.m_bgColor.selectedIndex=t<=4?0:1,this.ui.m_day_6.m_bgColor.selectedIndex=t<=5?0:1,this.ui.m_day_7.m_bgColor.selectedIndex=t<=6?0:1}OnClickAd(){Os.instance.PlatformInstance.ShowRewardVideoAd(Laya.Handler.create(this,()=>{Qs.PlayAudio(),this.GetDailyReward(2)}),Laya.Handler.create(this,()=>{Os.instance.PlatformInstance.ShowToast("未看完广告")}))}OnClickGet(){this.GetDailyReward(1)}GetDailyReward(t=1){switch(this.isShow&&Ki.PlayDiamondEffect(this.ui.m_btn_get),$e.data.signDay){case 1:case 2:$e.Diamond+=50*t;break;case 3:$e.Diamond+=60*t;break;case 4:$e.Diamond+=70*t;break;case 5:$e.Diamond+=80*t;break;case 6:$e.Diamond+=100*t;break;default:$e.Diamond+=30*t}$e.instance.AddSignDay(),$e.data.hasSign=!0,this.OnClickClose(),this.isGuide&&it.instance.eventUI(Nt.GuideToNext)}OnClickClose(){Be.instance.setUIState([{typeIndex:ee.DailySign,state:!1}],!1)}}class zn extends Pn{constructor(){super()}static get instance(){return this.m_instance||(this.m_instance=new zn),this.m_instance}initUIMediator(){this.m_UIMediator={[ee.GameLoading]:Na.instance,[ee.CustomsLoading]:Ha.instance,[ee.TestMain]:en.instance,[ee.TestPlatform]:kn.instance,[ee.Set]:Ka.instance,[ee.Play]:Va.instance,[ee.Start]:ja.instance,[ee.Pause]:Qa.instance,[ee.Com]:Ya.instance,[ee.End]:$a.instance,[ee.Main]:ra.instance,[ee.Manager]:Fs.instance,[ee.EventLayer]:Vn.instance,[ee.AD]:Xs.instance,[ee.LuckyWheel]:Js.instance,[ee.Setting]:zs.instance,[ee.Task]:Zs.instance,[ee.Staff]:Ta.instance,[ee.EventPanel]:Ne.instance,[ee.TopPanel]:Ai.instance,[ee.StaffMarket]:Da.instance,[ee.StaffInfoPanel]:Ua.instance,[ee.Guide]:Aa.instance,[ee.OffLineIncomePanel]:Ma.instance,[ee.UIMoneyEffect]:jn.instance,[ee.UIMediatorCheers]:oa.instance,[ee.UIMediatorInfluencer]:ta.instance,[ee.UIMeditorRepairGame]:ia.instance,[ee.UIMediatorSpeedUp]:aa.instance,[ee.UIMediatorFlyPanel]:bi.instance,[ee.DailySign]:Hn.instance,[ee.OpenCoffee]:pa.instance,[ee.CountDownTime]:fa.instance,[ee.RecordVideo]:Es.instance,[ee.TalkPanel]:Ge.instance,[ee.NativeAD]:Ji.instance},this.m_UIProxy=Be.instance}init(){}Start(){this.m_UIProxy.Start()}}class Qn{constructor(){this.m_GameIfInit=!1}static get instance(){return this.m_instance||(this.m_instance=new Qn),this.m_instance}init(){}get gameIfInit(){return this.m_GameIfInit}GameInit(){this.m_GameIfInit=!1,it.instance.eventGlobal(te.GameInit)}GameOnInit(){this.m_GameIfInit=!0,it.instance.eventGlobal(te.GameOnInit)}}class Jn extends ot{}class Kn extends ht{clone(){return JSON.parse(JSON.stringify(this))}}class Zn extends ht{constructor(){super(...arguments),this.onCustomsData=new Kn}clone(){return JSON.parse(JSON.stringify(this))}}class Yn extends Jn{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new Yn),this._instance}InitData(){this._shortData=new Zn}static get shortData(){return this._instance._shortData.clone()}static get getEditableOnCustomData(){return this._instance._shortData.onCustomsData}static initShortData(){}static syncShortData(){}static emptyGameOnCustomData(){this._instance._shortData=new Zn}}class Xn{constructor(){}static get instance(){return this.m_instance||(this.m_instance=new Xn),this.m_instance}init(){it.instance.on3D(A.GameLevelsBuildBefore,this,this.gameLevelsBuildBefore),it.instance.on3D(A.GameLevelsOnBuild,this,this.gameLevelsOnBuild),it.instance.on3D(A.GameLevelsDelete,this,this.gameLevelsDelete),it.instance.on3D(A.GameStart,this,this.gameStart)}gameLevelsBuildBefore(){Yn.emptyGameOnCustomData()}gameLevelsOnBuild(){}gameLevelsDelete(){}gameStart(){}}!function(t){t.config=class{},t.path="res/config/TestConst.json"}(Un||(Un={}));class $n extends R{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new $n),this._instance}get data(){}initData(){this.m_data=Un.data}get ifDebug(){return!st.OnLine&&this.m_data.if_debug}get ifShowOimoMesh(){return!st.OnLine&&this.m_data.if_show_oimo_mesh}get oimoMeshDiaphaneity(){return this.m_data.oimo_mesh_diaphaneity}}!function(t){t.BGMSuspend="_EEventAudio_BGMSuspend",t.BGMGoOn="_EEventAudio_BGMGoOn",t.SoundSuspend="_EEventAudio_SoundSuspend",t.SoundGoOn="_EEventAudio_SoundGoOn",t.BGMVolumeChange="_EEventAudio_BGMVolumeChange",t.SoundVolumeChange="_EEventAudio_BGMVolumeChange"}(Tn||(Tn={}));class to{constructor(){}static get instance(){return null==this._instance&&(this._instance=new to),this._instance}init(){it.instance.onAudio(Tn.BGMSuspend,this,this.BGMsuSpend),it.instance.onAudio(Tn.BGMGoOn,this,this.BGMGoOn),it.instance.onAudio(Tn.SoundSuspend,this,this.soundSuspend),it.instance.onAudio(Tn.SoundGoOn,this,this.soundGoOn),it.instance.onAudio(Tn.BGMVolumeChange,this,this.bgmVolumeChange),it.instance.onAudio(Tn.SoundVolumeChange,this,this.soundVolumeChange)}BGMsuSpend(){qs.instance.stopBGM()}BGMGoOn(){qs.instance.BGMGoOn()}soundSuspend(){qs.instance.soundSuspend()}soundGoOn(){qs.instance.soundGoOn()}bgmVolumeChange(t=1){Laya.SoundManager.setMusicVolume(t)}soundVolumeChange(t=1){Laya.SoundManager.setSoundVolume(t)}}class eo{constructor(){}static get instance(){return null==this._instance&&(this._instance=new eo),this._instance}enterGame(){this.initGame(),this._startGame(),this.startGame()}initGame(){Qn.instance.init(),it.instance.init(),to.instance.init(),Xn.instance.init(),Lt.instance.init(),zn.instance.init(),Ba.instance.init()}_startGame(){$n.instance.ifDebug?Laya.Stat.show():Laya.Stat.hide()}startGame(){zn.instance.Start(),Ba.instance.initLevelBuild()}}class io{static get needLoadCount(){return this._configList.length}static AddConfig(t){io._configList.push(t)}static AddExtraConfig(t){t.length>0&&(io._extraConfig.push(...t),io._extraConfig=I.Unique(io._extraConfig))}static StartLoad(t,e=null){if(0==io._configList.length)return void(t&&t.run());var i=[];for(let t of io._configList)i.push(S.ConfigURL(t.path.match(/[a-zA-Z0-9.]*$/)[0]));let s=[];i.forEach(t=>{s.push(t)}),i.push(...this._extraConfig),Laya.loader.create(i,Laya.Handler.create(this,()=>{for(let t of io._configList){t.data=Laya.loader.getRes(S.ConfigURL(t.path.match(/[a-zA-Z0-9.]*$/)[0])),t.dataList=[];for(let e in t.data){let i=t.data[e];null!=i&&t.dataList.push(i)}t.dataList.length>0&&(t.lastData=t.dataList[t.dataList.length-1])}t&&t.run(),s.forEach(t=>{a.Unload(t)})}),e)}}io._configList=[],io._extraConfig=[],function(t){t.config=class{},t.path="res/config/GameConst.json"}(Rn||(Rn={}));class so{constructor(t,e=-1,i){this.packPath=t,this.atliasCount=e,this.m_extraURL=i}PushUrl(t){if(t.push({url:this.packPath+".bin",type:Laya.Loader.BUFFER}),this.m_extraURL&&this.m_extraURL.length>0&&t.push(...this.m_extraURL),this.atliasCount>=0){t.push({url:this.packPath+"_atlas0.png",type:Laya.Loader.IMAGE});for(let e=1;e<=this.atliasCount;e++)t.push({url:this.packPath+"_atlas0_"+e+".png",type:Laya.Loader.IMAGE})}}AddPackage(){fgui.UIPackage.addPackage(this.packPath)}}class ao extends ct{}class no extends lt{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new no),this._instance}static get comData(){return this._instance._saveData}get _saveName(){return"->CommonDataSave<-"}InitData(){this._saveData=this._ReadFromFile()}getNewData(){return new ao}static SaveToDisk(){this._instance._SaveToDisk(this._instance._saveData)}}class oo{constructor(){this._needLoadOtherUIPack=[],this._loadProgressWeight={config:1,gameRes:5,otherUI:3},this._configProgress=0,this._otherUIProgress=0,this._resProgress=0}get loadProgress(){let t=0;for(let e in this._loadProgressWeight)t+=this._loadProgressWeight[e];return(this._loadProgressWeight.config*this._configProgress+this._loadProgressWeight.gameRes*this._resProgress+this._loadProgressWeight.otherUI*this._otherUIProgress)/t*100}Enter(t,e,i){this.m_handlerThis=t,this.m_beforeHandler=e,this.m_backHandler=i,this.Init()}_Init(){}Init(){let t=this._Init(),e=()=>{this.initEmptyScreen()};t?t.then(()=>{e()}):e()}initEmptyScreen(){G.instance.init(),this.OnBindUI();let t=[];this._initEmptyScreen.PushUrl(t),0!=t.length?Laya.loader.load(t,Laya.Handler.create(this,this.InitUI)):this.InitUI()}InitUI(){this._initEmptyScreen.AddPackage(),this._OnInitEmptyScreen();let t=()=>{let t=[];this._initUiPack.PushUrl(t),0!=t.length?Laya.loader.load(t,Laya.Handler.create(this,this.OnInitUILoaded)):this.OnInitUILoaded()};this.m_beforeHandler?this.m_beforeHandler.call(this.m_handlerThis).then(()=>{t()}):t()}OnInitUILoaded(){this._initUiPack.AddPackage(),this._OnInitUILoaded(),this.onLoading(this.loadProgress),this.OnConfigLoaded()}OnConfigLoaded(){this.OnSetLoadConfig();let t=[];for(let e in u)u[e]&&t.push(S.levelConfigURL(u[e]));if(io.AddExtraConfig(t),io.needLoadCount<=0)return this._OnConfigProgress(1),void this._OnConfigLoaded();io.StartLoad(Laya.Handler.create(this,this._OnConfigLoaded),Laya.Handler.create(this,this._OnConfigProgress,null,!1))}_OnConfigProgress(t){this._configProgress=t,this.onLoading(this.loadProgress)}_OnConfigLoaded(){G.instance.initConfig();let t=[];for(let e=0;e<this._needLoadOtherUIPack.length;++e)this._needLoadOtherUIPack[e].PushUrl(t);if(0==t.length)return this._OnOtherUIProgress(1),void this._OnOtherUILoaded();Laya.loader.load(t,Laya.Handler.create(this,this._OnOtherUILoaded),Laya.Handler.create(this,this._OnOtherUIProgress,null,!1))}_OnOtherUIProgress(t){this._otherUIProgress=t,this.onLoading(this.loadProgress)}_OnOtherUILoaded(){for(let t=0;t<this._needLoadOtherUIPack.length;++t)this._needLoadOtherUIPack[t].AddPackage();let t=[];if(this.OnGameResPrepared(t),t.push(...S.EssentialOtherResUrl()),G.instance.Preload(t),0==t.length)return this._OnResProgress(1),void this._OnResLoaded();Laya.loader.create(t,Laya.Handler.create(this,this._OnResLoaded),Laya.Handler.create(this,this._OnResProgress,null,!1))}_OnResProgress(t){this._resProgress=t,this.onLoading(this.loadProgress)}_OnResLoaded(){this.loginCommonData(),this.loginData(),this.m_backHandler?this.m_backHandler.call(this.m_handlerThis).then(()=>{this.OnComplete()}):this.OnComplete()}loginCommonData(){no.instance.InitData()}OnBindUI(){}OnSetLoadConfig(){}OnGameResPrepared(t){}_OnInitEmptyScreen(){}_OnInitUILoaded(){}onLoading(t){}loginData(){}OnComplete(){}}!function(t){t.config=class{},t.path="res/config/SkinConfig.json"}(On||(On={}));class ro extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("InitLoad","splash")}onConstruct(){this.m_bg=this.getChildAt(0),this.m_progress=this.getChildAt(2),this.m_loading_progress=this.getChildAt(3),this.m_text_logo=this.getChildAt(4),this.m_text_progress=this.getChildAt(5),this.m_text_laya=this.getChildAt(6),this.m_text_explain=this.getChildAt(7),this.m_text_v=this.getChildAt(8),this.m_text_laya_v=this.getChildAt(9),this.m_text_game_explain=this.getChildAt(10)}}ro.URL="ui://n3oedpp6nihr0",function(t){t.config=class{},t.path="res/config/GameStateConst.json"}(Mn||(Mn={}));class lo extends fairygui.GButton{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","EffectsPButton")}onConstruct(){this.m_sprite=this.getChildAt(0),this.m_t0=this.getTransitionAt(0),this.m_t1=this.getTransitionAt(1)}}lo.URL="ui://kk7g5mmmkcbyo6";class ho extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameMain","PGameMain")}onConstruct(){this.m_t0=this.getTransitionAt(0)}}ho.URL="ui://kk7g5mmmsyta9f";class co{static bindAll(){fairygui.UIObjectFactory.setPackageItemExtension(Ja.URL,Ja),fairygui.UIObjectFactory.setPackageItemExtension(za.URL,za),fairygui.UIObjectFactory.setPackageItemExtension(Ga.URL,Ga),fairygui.UIObjectFactory.setPackageItemExtension(Fa.URL,Fa),fairygui.UIObjectFactory.setPackageItemExtension(Wa.URL,Wa),fairygui.UIObjectFactory.setPackageItemExtension(lo.URL,lo),fairygui.UIObjectFactory.setPackageItemExtension(Xa.URL,Xa),fairygui.UIObjectFactory.setPackageItemExtension(qa.URL,qa),fairygui.UIObjectFactory.setPackageItemExtension(tn.URL,tn),fairygui.UIObjectFactory.setPackageItemExtension(Za.URL,Za),fairygui.UIObjectFactory.setPackageItemExtension(ho.URL,ho),fairygui.UIObjectFactory.setPackageItemExtension(xn.URL,xn)}}class uo extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("InitEmptyScreen","EmptyScreen")}onConstruct(){this.m_bg=this.getChildAt(0)}}uo.URL="ui://7ktzib8oq3ng0";class mo{static bindAll(){fairygui.UIObjectFactory.setPackageItemExtension(uo.URL,uo)}}class _o{static bindAll(){fairygui.UIObjectFactory.setPackageItemExtension(ro.URL,ro)}}!function(t){t.null=""}(En||(En={})),function(t){t.config=class{},t.path="res/config/LightingConst.json"}(Bn||(Bn={}));class go extends ct{constructor(){super(...arguments),this.coinCount=0}clone(){return JSON.parse(JSON.stringify(this))}}class po extends lt{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new po),this._instance}get _saveName(){return"->GamePropDataSave<-"}InitData(){this._saveData=this._ReadFromFile()}static get propData(){return this._instance._saveData.clone()}static addCoin(t){t=Math.floor(t),this._instance._saveData.coinCount+=t,this._instance._saveData.coinCount<0&&(this._instance._saveData.coinCount=0),this.SaveToDisk()}getNewData(){return new go}static SaveToDisk(){this._instance._SaveToDisk(this._instance._saveData)}}class fo extends ct{clone(){return JSON.parse(JSON.stringify(this))}}class yo extends lt{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new yo),this._instance}get _saveName(){return"->GameSkinData<-"}InitData(){this._saveData=this._ReadFromFile()}static get skinData(){return this._instance._saveData.clone()}getNewData(){return new fo}static SaveToDisk(){this._instance._SaveToDisk(this._instance._saveData)}}class So extends ct{constructor(){super(...arguments),this.ifSignIn=!1,this.ifOneDay=!1}clone(){return JSON.parse(JSON.stringify(this))}}class Io extends lt{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new Io),this._instance}get _saveName(){return"->GameSignDataSave<-"}InitData(){this._saveData=this._ReadFromFile()}static get signData(){return this._instance._saveData.clone()}getNewData(){return new So}static SaveToDisk(){this._instance._SaveToDisk(this._instance._saveData)}}!function(t){t.config=class{},t.path="res/config/LevelPropConfig.json"}(Gn||(Gn={})),function(t){t.config=class{},t.path="res/config/OtherConst.json"}(Nn||(Nn={}));class wo extends lt{constructor(){super()}static get instance(){return null==this._instance&&(this._instance=new wo),this._instance}get _saveName(){return"->GameNewHandDataSave<-"}InitData(){this._saveData=this._ReadFromFile()}static get propData(){return this._instance._saveData.clone()}getNewData(){return new go}static SaveToDisk(){this._instance._SaveToDisk(this._instance._saveData)}}class Co extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","Wheel_item")}onConstruct(){this.m_type=this.getControllerAt(0),this.m_num=this.getChildAt(1)}}Co.URL="ui://8nmf3q479f3e1c1";class bo extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","Item_building")}onConstruct(){this.m_txt_infomation=this.getChildAt(1),this.m_txt_title=this.getChildAt(2),this.m_img_fins=this.getChildAt(3),this.m_btn_update=this.getChildAt(4),this.m_spr_water=this.getChildAt(5),this.m_txt_costWater=this.getChildAt(6),this.m_txt_waterWarn=this.getChildAt(7),this.m_costWater=this.getChildAt(8),this.m_picture=this.getChildAt(9),this.m_txt_progress=this.getChildAt(10)}}bo.URL="ui://8nmf3q47aucl1w";class Lo extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","Item_Statistics")}onConstruct(){this.m_pro_blue=this.getChildAt(2),this.m_itemIcon=this.getChildAt(3),this.m_txt_progress=this.getChildAt(6),this.m_txt_title=this.getChildAt(7),this.m_txt_incomeRate=this.getChildAt(8),this.m_btn_go=this.getChildAt(9)}}Lo.URL="ui://8nmf3q47aucl1x";class vo extends fairygui.GButton{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","statistics_btn")}onConstruct(){this.m_shadow=this.getChildAt(0)}}vo.URL="ui://8nmf3q47aucl7";class Ao extends fairygui.GButton{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","BasePanel")}onConstruct(){this.m_btn_close=this.getChildAt(3)}}Ao.URL="ui://8nmf3q47b3xq1a7";class xo extends fairygui.GButton{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","DailyComm")}onConstruct(){this.m_bgColor=this.getControllerAt(1)}}xo.URL="ui://8nmf3q47b3xq1aj";class ko extends fairygui.GButton{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","DailyComm2")}onConstruct(){this.m_bgColor=this.getControllerAt(1),this.m_t0=this.getTransitionAt(0)}}ko.URL="ui://8nmf3q47b3xq1ao";class Po extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","Wheel_six")}onConstruct(){this.m_img_wheel=this.getChildAt(0),this.m_item_0=this.getChildAt(1),this.m_item_1=this.getChildAt(2),this.m_item_2=this.getChildAt(3),this.m_item_3=this.getChildAt(4),this.m_item_4=this.getChildAt(5),this.m_item_5=this.getChildAt(6),this.m_item_6=this.getChildAt(7),this.m_item_7=this.getChildAt(8)}}Po.URL="ui://8nmf3q47b3xq1as";class Do extends fairygui.GButton{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","SetButton")}onConstruct(){this.m_state=this.getControllerAt(0)}}Do.URL="ui://8nmf3q47b3xqc";class Uo extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","BackgroundAnimation")}onConstruct(){this.m_t0=this.getTransitionAt(0)}}Uo.URL="ui://8nmf3q47b3xqi";class To extends fairygui.GButton{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","BoxEffect")}onConstruct(){this.m_t0=this.getTransitionAt(0),this.m_t1=this.getTransitionAt(1),this.m_t2=this.getTransitionAt(2),this.m_t3=this.getTransitionAt(3),this.m_t4=this.getTransitionAt(4)}}To.URL="ui://8nmf3q47bj851y";class Ro extends fairygui.GButton{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","StaffBtn")}onConstruct(){this.m_txt_num=this.getChildAt(2)}}Ro.URL="ui://8nmf3q47bj85e";class Oo extends fairygui.GButton{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","Btn_turntable")}onConstruct(){this.m_t0=this.getTransitionAt(0)}}Oo.URL="ui://8nmf3q47bj85g";class Mo extends fairygui.GButton{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","TaskBtn")}onConstruct(){this.m_progress=this.getChildAt(0)}}Mo.URL="ui://8nmf3q47bj85o";class Eo extends fairygui.GProgressBar{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","task_progress")}onConstruct(){this.m_text_progress=this.getChildAt(3),this.m_text_task=this.getChildAt(4)}}Eo.URL="ui://8nmf3q47bj85p";class Bo extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","Buildings")}onConstruct(){this.m_Top1=this.getChildAt(3),this.m_list=this.getChildAt(4)}}Bo.URL="ui://8nmf3q47fk6416";class Go extends fairygui.GButton{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","Btn_build")}onConstruct(){this.m_txt_cost=this.getChildAt(1)}}Go.URL="ui://8nmf3q47fk6419";class No extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","Statistics")}onConstruct(){this.m_bg=this.getChildAt(0),this.m_text_totalIncome=this.getChildAt(4),this.m_bg1=this.getChildAt(7),this.m_text_flow=this.getChildAt(9),this.m_pro_2=this.getChildAt(11),this.m_text_women=this.getChildAt(12),this.m_pro_3=this.getChildAt(15),this.m_text_pee=this.getChildAt(16),this.m_pro_4=this.getChildAt(19),this.m_text_men=this.getChildAt(20),this.m_topPanel=this.getChildAt(23),this.m_list=this.getChildAt(24)}}No.URL="ui://8nmf3q47fk641c";class Fo extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","dark_bg")}onConstruct(){this.m_dark_bg=this.getChildAt(0)}}Fo.URL="ui://8nmf3q47gok71br";class Vo extends fairygui.GButton{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","StartBtn")}onConstruct(){this.m_text_num=this.getChildAt(3)}}Vo.URL="ui://8nmf3q47kcby18v";class Wo extends fairygui.GButton{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","ButtonAD")}onConstruct(){this.m_state=this.getControllerAt(1)}}Wo.URL="ui://8nmf3q47l4g51cz";class jo extends fairygui.GButton{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","ButtonRecordShare")}onConstruct(){this.m_state=this.getControllerAt(1),this.m_number=this.getChildAt(1)}}jo.URL="ui://8nmf3q47nt6l1cu";class qo extends fairygui.GButton{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","ButtonLastTime")}onConstruct(){this.m_txt_lastTime=this.getChildAt(3)}}qo.URL="ui://8nmf3q47pe2t1c4";class Ho extends fairygui.GProgressBar{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Main","ProgressBar1")}onConstruct(){this.m_c1=this.getControllerAt(0),this.m_bg1=this.getChildAt(2)}}Ho.URL="ui://8nmf3q47u5d1s";class zo{static bindAll(){fairygui.UIObjectFactory.setPackageItemExtension(Co.URL,Co),fairygui.UIObjectFactory.setPackageItemExtension(fi.URL,fi),fairygui.UIObjectFactory.setPackageItemExtension(bo.URL,bo),fairygui.UIObjectFactory.setPackageItemExtension(Lo.URL,Lo),fairygui.UIObjectFactory.setPackageItemExtension(vo.URL,vo),fairygui.UIObjectFactory.setPackageItemExtension(sa.URL,sa),fairygui.UIObjectFactory.setPackageItemExtension($s.URL,$s),fairygui.UIObjectFactory.setPackageItemExtension(Ao.URL,Ao),fairygui.UIObjectFactory.setPackageItemExtension(ea.URL,ea),fairygui.UIObjectFactory.setPackageItemExtension(na.URL,na),fairygui.UIObjectFactory.setPackageItemExtension(qn.URL,qn),fairygui.UIObjectFactory.setPackageItemExtension(xo.URL,xo),fairygui.UIObjectFactory.setPackageItemExtension(ko.URL,ko),fairygui.UIObjectFactory.setPackageItemExtension(Po.URL,Po),fairygui.UIObjectFactory.setPackageItemExtension(ga.URL,ga),fairygui.UIObjectFactory.setPackageItemExtension(Do.URL,Do),fairygui.UIObjectFactory.setPackageItemExtension(Uo.URL,Uo),fairygui.UIObjectFactory.setPackageItemExtension(To.URL,To),fairygui.UIObjectFactory.setPackageItemExtension(Ro.URL,Ro),fairygui.UIObjectFactory.setPackageItemExtension(Oo.URL,Oo),fairygui.UIObjectFactory.setPackageItemExtension(Mo.URL,Mo),fairygui.UIObjectFactory.setPackageItemExtension(Eo.URL,Eo),fairygui.UIObjectFactory.setPackageItemExtension(Bs.URL,Bs),fairygui.UIObjectFactory.setPackageItemExtension(Hs.URL,Hs),fairygui.UIObjectFactory.setPackageItemExtension(Bo.URL,Bo),fairygui.UIObjectFactory.setPackageItemExtension(Go.URL,Go),fairygui.UIObjectFactory.setPackageItemExtension(No.URL,No),fairygui.UIObjectFactory.setPackageItemExtension(Fo.URL,Fo),fairygui.UIObjectFactory.setPackageItemExtension(Me.URL,Me),fairygui.UIObjectFactory.setPackageItemExtension(Oa.URL,Oa),fairygui.UIObjectFactory.setPackageItemExtension(Ks.URL,Ks),fairygui.UIObjectFactory.setPackageItemExtension(Vo.URL,Vo),fairygui.UIObjectFactory.setPackageItemExtension(Vs.URL,Vs),fairygui.UIObjectFactory.setPackageItemExtension(Wo.URL,Wo),fairygui.UIObjectFactory.setPackageItemExtension(_a.URL,_a),fairygui.UIObjectFactory.setPackageItemExtension(Rs.URL,Rs),fairygui.UIObjectFactory.setPackageItemExtension(jo.URL,jo),fairygui.UIObjectFactory.setPackageItemExtension(Dn.URL,Dn),fairygui.UIObjectFactory.setPackageItemExtension(qo.URL,qo),fairygui.UIObjectFactory.setPackageItemExtension(Ho.URL,Ho),fairygui.UIObjectFactory.setPackageItemExtension(Ys.URL,Ys)}}class Qo extends ct{}class Jo extends lt{static get instance(){return null==this._instance&&(this._instance=new Jo),this._instance}get data(){return this._data}get _saveName(){return"DisableRoomData"}getNewData(){return new Qo}InitData(){this._data=this._ReadFromFile(),null==this._data.list&&(this._data.list=new ei,this._data.list.active=!1,this._data.list.functionID=qt.DisableToilet,this._data.list.index=0,this._data.list.title="无障碍卫生间",this._data.list.name=jt.disableRoom,this._data.list.slots=[],this._SaveToDisk(this._data))}}class Ko extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("BuildUIPanel","PGameStaffInfo")}onConstruct(){this.m_skill=this.getControllerAt(0),this.m_sex=this.getControllerAt(1),this.m_cutBtn=this.getControllerAt(2),this.m_starNum=this.getChildAt(4),this.m_loader_character=this.getChildAt(5),this.m_name=this.getChildAt(6),this.m_btn_staffReplace=this.getChildAt(10),this.m_btn_staffBuy=this.getChildAt(11),this.m_skillList=this.getChildAt(12)}}Ko.URL="ui://vcw5trqlb3xq2b5";class Zo extends fairygui.GButton{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("BuildUIPanel","StaffBuy")}onConstruct(){this.m_text_price=this.getChildAt(2)}}Zo.URL="ui://vcw5trqlb3xq2bb";class Yo extends fairygui.GButton{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("BuildUIPanel","Employee")}onConstruct(){this.m_state=this.getControllerAt(0),this.m_Titile=this.getChildAt(3),this.m_sprite=this.getChildAt(4),this.m_list_skillicon=this.getChildAt(5),this.m_img_starNum=this.getChildAt(7),this.m_btn_AD=this.getChildAt(8),this.m_btn_AddStaff=this.getChildAt(9)}}Yo.URL="ui://vcw5trqlgwsg2bz";class Xo extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("BuildUIPanel","EmployeeBG")}onConstruct(){this.m_state=this.getControllerAt(0)}}Xo.URL="ui://vcw5trqlgwsg2c0";class $o extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("BuildUIPanel","StaffMarketBtnBg")}onConstruct(){this.m_state=this.getControllerAt(0)}}$o.URL="ui://vcw5trqlgwsg2c1";class tr extends fairygui.GButton{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("BuildUIPanel","staffSkillicon")}onConstruct(){this.m_sprite=this.getChildAt(0)}}tr.URL="ui://vcw5trqljfuc2bv";class er extends fairygui.GButton{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("BuildUIPanel","Btn_Staff")}onConstruct(){this.m_sex=this.getControllerAt(0),this.m_Titile=this.getChildAt(8),this.m_sprite=this.getChildAt(9),this.m_list_skillicon=this.getChildAt(10),this.m_img_starNum=this.getChildAt(12),this.m_btn_AD=this.getChildAt(13),this.m_btn_AddStaff=this.getChildAt(14)}}er.URL="ui://vcw5trqlkcby2b0";class ir extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("BuildUIPanel","BottomPanel")}onConstruct(){this.m_btn_close=this.getChildAt(0)}}ir.URL="ui://vcw5trqln0pd0";class sr extends fairygui.GButton{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("BuildUIPanel","PButton_up")}onConstruct(){this.m_btn_bg=this.getChildAt(0),this.m_text_upCast=this.getChildAt(2)}}sr.URL="ui://vcw5trqlopplw9";class ar extends fairygui.GButton{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("BuildUIPanel","skillPanel")}onConstruct(){this.m_profession=this.getControllerAt(0),this.m_sprite=this.getChildAt(1),this.m_Title=this.getChildAt(2),this.m_text_desc=this.getChildAt(3)}}ar.URL="ui://vcw5trqls1ev2bs";class nr extends fairygui.GButton{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("BuildUIPanel","PButton_diam")}onConstruct(){this.m_btn_bg=this.getChildAt(0),this.m_text_price=this.getChildAt(3)}}nr.URL="ui://vcw5trqltp8l11n";class or extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("BuildUIPanel","MidPanel")}onConstruct(){this.m_upState=this.getControllerAt(0),this.m_bottomState=this.getControllerAt(1),this.m_levelSlider=this.getChildAt(2),this.m_picture=this.getChildAt(3),this.m_levelProgress=this.getChildAt(5),this.m_leftLevel=this.getChildAt(7),this.m_text_mid_title=this.getChildAt(8),this.m_text_mid_title_desc=this.getChildAt(9),this.m_btn_up=this.getChildAt(10),this.m_btn_buy=this.getChildAt(11),this.m_text_money_MoneyAdd=this.getChildAt(13),this.m_text_money=this.getChildAt(14),this.m_group_money=this.getChildAt(16),this.m_text_time=this.getChildAt(18),this.m_text_time_timeSub=this.getChildAt(19),this.m_group_time=this.getChildAt(20),this.m_text_clean_MoneyAdd=this.getChildAt(22),this.m_text_clean_Money=this.getChildAt(23),this.m_group_clean=this.getChildAt(24),this.m_text_replace_time=this.getChildAt(26),this.m_text_replace_timeSub=this.getChildAt(27),this.m_group_repair=this.getChildAt(28),this.m_text_volume=this.getChildAt(30),this.m_text_volume_volumeAdd=this.getChildAt(31),this.m_group_queue=this.getChildAt(32),this.m_text_woman=this.getChildAt(34),this.m_text_woman_womanadd=this.getChildAt(35),this.m_group_woman=this.getChildAt(36),this.m_text_pee=this.getChildAt(38),this.m_text_pee_peeadd=this.getChildAt(39),this.m_group_pee=this.getChildAt(40),this.m_text_man=this.getChildAt(42),this.m_text_pee_manAdd=this.getChildAt(43),this.m_group_man=this.getChildAt(44),this.m_group_water=this.getChildAt(45),this.m_text_water_WaterAdd=this.getChildAt(46),this.m_text_water=this.getChildAt(47),this.m_txt_needWater=this.getChildAt(49)}}or.URL="ui://vcw5trqltp8l11o";class rr extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("BuildUIPanel","TopPanel")}onConstruct(){this.m_progress=this.getControllerAt(0),this.m_c1=this.getControllerAt(1),this.m_topProgress=this.getChildAt(0),this.m_text_top_moneyAdd=this.getChildAt(6),this.m_text_top_water=this.getChildAt(7),this.m_text_top_time=this.getChildAt(8),this.m_toilet=this.getChildAt(9),this.m_text_top_cleanTime=this.getChildAt(13),this.m_text_top_stuffNum=this.getChildAt(14),this.m_text_top_repairTime=this.getChildAt(15),this.m_cleanroom=this.getChildAt(16),this.m_text_top_expendWater=this.getChildAt(18),this.m_text_top_expend=this.getChildAt(19),this.m_handingroom=this.getChildAt(20),this.m_text_top_queueWoman=this.getChildAt(25),this.m_text_top_ridership=this.getChildAt(26),this.m_text_top_queueMan=this.getChildAt(27),this.m_text_top_queuePee=this.getChildAt(28),this.m_queue=this.getChildAt(29)}}rr.URL="ui://vcw5trqltp8l11q";class lr extends fairygui.GButton{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("BuildUIPanel","commButton")}onConstruct(){this.m_bg=this.getControllerAt(1),this.m_level=this.getControllerAt(2),this.m_state=this.getControllerAt(3),this.m_bg_1=this.getChildAt(1),this.m_image=this.getChildAt(4),this.m_levelLable=this.getChildAt(7),this.m_t0=this.getTransitionAt(0)}}lr.URL="ui://vcw5trqltp8l11s";class hr extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("BuildUIPanel","label")}onConstruct(){this.m_title=this.getChildAt(1)}}hr.URL="ui://vcw5trqltp8l11t";class cr{static bindAll(){fairygui.UIObjectFactory.setPackageItemExtension(Ko.URL,Ko),fairygui.UIObjectFactory.setPackageItemExtension(Zo.URL,Zo),fairygui.UIObjectFactory.setPackageItemExtension(Pa.URL,Pa),fairygui.UIObjectFactory.setPackageItemExtension(Yo.URL,Yo),fairygui.UIObjectFactory.setPackageItemExtension(Xo.URL,Xo),fairygui.UIObjectFactory.setPackageItemExtension($o.URL,$o),fairygui.UIObjectFactory.setPackageItemExtension(ka.URL,ka),fairygui.UIObjectFactory.setPackageItemExtension(tr.URL,tr),fairygui.UIObjectFactory.setPackageItemExtension(er.URL,er),fairygui.UIObjectFactory.setPackageItemExtension(ir.URL,ir),fairygui.UIObjectFactory.setPackageItemExtension(xa.URL,xa),fairygui.UIObjectFactory.setPackageItemExtension(sr.URL,sr),fairygui.UIObjectFactory.setPackageItemExtension(ar.URL,ar),fairygui.UIObjectFactory.setPackageItemExtension(nr.URL,nr),fairygui.UIObjectFactory.setPackageItemExtension(or.URL,or),fairygui.UIObjectFactory.setPackageItemExtension(rr.URL,rr),fairygui.UIObjectFactory.setPackageItemExtension(lr.URL,lr),fairygui.UIObjectFactory.setPackageItemExtension(hr.URL,hr)}}class dr{static bindAll(){fairygui.UIObjectFactory.setPackageItemExtension(vi.URL,vi)}}class ur extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("EventPanel","NewHappyEmoji")}onConstruct(){this.m_t1=this.getTransitionAt(0)}}ur.URL="ui://gp34j27l8pj8ux";class mr extends fairygui.GButton{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("EventPanel","NewHelpButton")}onConstruct(){this.m_switch=this.getControllerAt(0),this.m_fill_yellow=this.getChildAt(2),this.m_fill_red=this.getChildAt(3),this.m_t1=this.getTransitionAt(0),this.m_happy=this.getTransitionAt(1)}}mr.URL="ui://gp34j27l8pj8uy";class _r extends fairygui.GButton{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("EventPanel","CommonButton")}onConstruct(){this.m_state=this.getControllerAt(0),this.m_bg=this.getChildAt(0),this.m_fill_green=this.getChildAt(1),this.m_t0=this.getTransitionAt(0),this.m_t1=this.getTransitionAt(1)}}_r.URL="ui://gp34j27lophfug";class gr extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("EventPanel","effectBG")}onConstruct(){this.m_switch=this.getControllerAt(0)}}gr.URL="ui://gp34j27lqrltul";class pr{static bindAll(){fairygui.UIObjectFactory.setPackageItemExtension(ur.URL,ur),fairygui.UIObjectFactory.setPackageItemExtension(mr.URL,mr),fairygui.UIObjectFactory.setPackageItemExtension(Ue.URL,Ue),fairygui.UIObjectFactory.setPackageItemExtension(Pe.URL,Pe),fairygui.UIObjectFactory.setPackageItemExtension(_r.URL,_r),fairygui.UIObjectFactory.setPackageItemExtension(gr.URL,gr),fairygui.UIObjectFactory.setPackageItemExtension(De.URL,De)}}class fr extends fairygui.GComponent{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("Guide","GuideClick")}onConstruct(){this.m_t0=this.getTransitionAt(0)}}fr.URL="ui://09olrtmgujuei";class yr{static bindAll(){fairygui.UIObjectFactory.setPackageItemExtension(va.URL,va),fairygui.UIObjectFactory.setPackageItemExtension(fr.URL,fr)}}class Sr{static bindAll(){fairygui.UIObjectFactory.setPackageItemExtension(Wn.URL,Wn),fairygui.UIObjectFactory.setPackageItemExtension(Ii.URL,Ii),fairygui.UIObjectFactory.setPackageItemExtension(wi.URL,wi),fairygui.UIObjectFactory.setPackageItemExtension(Ci.URL,Ci)}}class Ir extends fairygui.GButton{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameAd","Button1")}onConstruct(){this.m_BtnTitle=this.getChildAt(2)}}Ir.URL="ui://ch5t1ckll2oz7";class wr extends fairygui.GButton{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameAd","Button2")}onConstruct(){this.m_CircleImg=this.getChildAt(0),this.m_forkImg=this.getChildAt(2)}}wr.URL="ui://ch5t1ckll2oz8";class Cr extends fairygui.GButton{constructor(){super()}static createInstance(){return fairygui.UIPackage.createObject("GameAd","AdUI")}onConstruct(){this.m_loaderIcon=this.getChildAt(0),this.m_FIeld=this.getChildAt(1)}}Cr.URL="ui://ch5t1ckll2oz9";class br{static bindAll(){fairygui.UIObjectFactory.setPackageItemExtension(Qi.URL,Qi),fairygui.UIObjectFactory.setPackageItemExtension(Ir.URL,Ir),fairygui.UIObjectFactory.setPackageItemExtension(wr.URL,wr),fairygui.UIObjectFactory.setPackageItemExtension(Cr.URL,Cr)}}class Lr{static load(){return new Promise(t=>{Laya.loader.load(["whiteScreen.png","whiteScreen.json"],Laya.Handler.create(this,()=>{t()}))})}static open(){return new Promise(t=>{Laya.Scene.open("whiteScreen.json",void 0,void 0,Laya.Handler.create(this,e=>{this.m_scene=e,this.m_bg=this.m_scene.getChildByName("bg"),this.updateView(),Laya.stage.on(Laya.Event.RESIZE,this,this.updateView),this.openLater().then(t)}))})}static openLater(){return Promise.resolve()}static close(){this.m_scene&&this.m_scene.destroy(),this.m_scene=null,this.m_bg=null,Laya.stage.offAllCaller(this)}static updateView(){let t=Laya.stage.width,e=Laya.stage.height;this.m_scene.width=t,this.m_scene.height=e,this.m_bg.width=t,this.m_bg.height=e}}class vr extends oo{constructor(){super(...arguments),this._progress={0:!1,30:!1,50:!1,80:!1,100:!1}}_Init(){Qn.instance.GameInit(),this._initEmptyScreen=new so(S.FGUIPack("InitEmptyScreen")),this._initUiPack=new so(S.FGUIPack("InitLoad"),0),this._needLoadOtherUIPack=[new so(S.FGUIPack("GameMain"),0),new so(S.FGUIPack("Main"),0),new so(S.FGUIPack("BuildUIPanel"),0),new so(S.FGUIPack("TopInfoUI"),0),new so(S.FGUIPack("EventPanel"),0),new so(S.FGUIPack("Guide"),0),new so(S.FGUIPack("EffectLayer"),0),new so(S.FGUIPack("GameAd"),0)]}_OnInitEmptyScreen(){}_OnInitUILoaded(){Lr.close(),this._loadShowUI=Ae.AddUI(ro,Yt.Loading),this._loadShowUI.sortingOrder=Number.MAX_SAFE_INTEGER,this._loadShowUI.m_text_explain.text=st.GameWhatTeam,this._loadShowUI.m_text_logo.text=st.GameName_,this._loadShowUI.m_text_v.text=st.versions,this._loadShowUI.m_text_game_explain.text=st.GameExplain,this._loadShowUI.m_text_laya_v.text=Laya.version,this._loadingProgress=this._loadShowUI.m_progress,this._loadingProgressText=this._loadShowUI.m_loading_progress,this._loadingProgress.value=0}OnBindUI(){mo.bindAll(),_o.bindAll(),co.bindAll(),zo.bindAll(),cr.bindAll(),dr.bindAll(),pr.bindAll(),yr.bindAll(),Sr.bindAll(),br.bindAll()}OnSetLoadConfig(){io.AddConfig(D),io.AddConfig(k),io.AddConfig(P),io.AddConfig(Rn),io.AddConfig(Mn),io.AddConfig(b),io.AddConfig(L),io.AddConfig(Gn),io.AddConfig(Bn),io.AddConfig(Nn),io.AddConfig(On),io.AddConfig(Un),io.AddConfig(Ft),io.AddConfig(Zi),io.AddConfig(Jt),io.AddConfig(zt),io.AddConfig(Qt),io.AddConfig(ne),io.AddConfig(Ht),io.AddConfig(Kt),io.AddConfig(as),io.AddConfig(ie),io.AddConfig(Wt)}loginData(){ut.instance.InitData(),wo.instance.InitData(),po.instance.InitData(),yo.instance.InitData(),Io.instance.InitData(),Yn.instance.InitData(),ci.instance.InitData(),ri.instance.InitData(),Qe.instance.InitData(),Jo.instance.InitData(),ai.instance.InitData(),ui.instance.InitData(),Ss.instance.InitData(),Ia.instance.InitData(),Ns.instance.InitData(),$e.instance.InitData(),_s.instance.InitData(),$e.instance.InitData(),Re.instance.InitData()}OnGameResPrepared(t){let e;for(let i in $i)""!=(e=$i[i])&&t.push(Ws.music_url(e));for(let i in En)""!=(e=En[i])&&t.push(Ws.sound_url(e));t.push(S.ConfigURL(jt.GusetPool)),t.push(S.ConfigURL(jt.MapRoot)),t.push(S.ConfigURL(jt.EmployeeData));for(let e of de.list)t.push(S.ConfigURL(de.NameUpper(e)+".json"))}onLoading(t){this._loadingProgress.value=t;let e=Math.floor(t);this._loadingProgressText.text=e.toString()+"%",this.Check(0,e),this.Check(30,e),this.Check(50,e),this.Check(80,e),this.Check(100,e)}Check(t,e){if(e==t){this._progress[t]||(this._progress[t]=!0,console.log("加载"+t),Oe.trackEvent($t.LoadProgress,{LoadProgress:t.toString()}))}}OnComplete(){this._loadShowUI.dispose(),Qn.instance.GameOnInit()}}class Ar{constructor(){}static get instance(){return null==this._instance&&(this._instance=new Ar),this._instance}enterGame(){this.initGame()}initGame(){}}class xr{startTest(){}}class kr extends xr{constructor(){super(...arguments),this._consoleExStr="输出测试"}startTest(){console.log("->开启测试<-"),console.log(...s.packLog(this._consoleExStr)),console.log(...s.packWarn(this._consoleExStr)),console.log(...s.packError(this._consoleExStr))}}class Pr extends xr{startTest(){(new kr).startTest()}}class Dr extends xr{startTest(){this.asyncTest()}asyncTest(){return __awaiter(this,void 0,void 0,function*(){console.log("异步开始"),yield this._asyncTest(),console.log("异步结束")})}_asyncTest(){return new Promise(t=>{Laya.timer.once(1e3,this,()=>{console.log("异步函数执行中"),t()})})}}class Ur extends xr{static get instance(){return this._instance?this._instance:(this._instance=new Ur,this._instance)}start(t){}}class Tr extends xr{startTest(){(new Dr).startTest(),(new Ur).startTest()}}class Rr{constructor(){this.init().then(()=>{this.upGameLoad(),this.gameLoad()})}init(){return new Promise(t=>{An.instance.init(),An.instance.initPlatform(),this.loadSubpackage().then(()=>{t()})})}loadSubpackage(){return new Promise(t=>{if(f.subpackages.length>0){let e=[];for(let t of f.subpackages)t.name&&e.push(new Promise(e=>{An.PlatformInstance.LoadSubpackage(t.name,Laya.Handler.create(this,()=>{e()}),Laya.Handler.create(this,()=>{e()}),void 0)}));Promise.all(e).then(()=>{t()})}else t()})}upGameLoad(){$.ifTest&&((new Pr).startTest(),(new Tr).startTest())}gameLoad(){let t=new vr;console.log(...s.comLog("开始加载游戏")),t.Enter(this,void 0,this.OnGameLoad)}OnGameLoad(){return new Promise(t=>{t(),me.instance.initData(),console.log(...s.comLog("游戏加载完成")),$.support3D&&eo.instance.enterGame(),$.support2D&&Ar.instance.enterGame(),this.OnGameEnter()})}OnGameEnter(){Oe.trackEvent($t.OnGameEnter)}}class Or{constructor(){Ae.Init(),et.InitAll()}}new class{constructor(){window.Laya3D?Laya3D.init(t.width,t.height):Laya.init(t.width,t.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=t.scaleMode,Laya.stage.screenMode=t.screenMode,Laya.stage.alignV=t.alignV,Laya.stage.alignH=t.alignH,Laya.URL.exportSceneToJson=t.exportSceneToJson,(t.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),t.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),t.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){Laya.Browser.onVVMiniGame?console.log("vivo平台11"):console.log("不是vivo平台11223344"),Oe.InitUma(),Lr.load().then(()=>{new Or,Lr.open().then(()=>{zi.instance.start().then(()=>{new Rr})})})}}}();